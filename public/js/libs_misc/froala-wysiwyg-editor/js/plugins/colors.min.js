!function(o){"function"==typeof define&&define.amd?define(["jquery"],o):"object"==typeof module&&module.exports?module.exports=function(t,e){return void 0===e&&(e="undefined"!=typeof window?require("jquery"):require("jquery")(t)),o(e),e}:o(jQuery)}(function(o){"use strict";o.extend(o.FE.POPUP_TEMPLATES,{"colors.picker":"[_BUTTONS_][_TEXT_COLORS_][_BACKGROUND_COLORS_]"}),o.extend(o.FE.DEFAULTS,{colorsText:["#61BD6D","#1ABC9C","#54ACD2","#2C82C9","#9365B8","#475577","#CCCCCC","#41A85F","#00A885","#3D8EB9","#2969B0","#553982","#28324E","#000000","#F7DA64","#FBA026","#EB6B56","#E25041","#A38F84","#EFEFEF","#FFFFFF","#FAC51C","#F37934","#D14841","#B8312F","#7C706B","#D1D5D8","REMOVE"],colorsBackground:["#61BD6D","#1ABC9C","#54ACD2","#2C82C9","#9365B8","#475577","#CCCCCC","#41A85F","#00A885","#3D8EB9","#2969B0","#553982","#28324E","#000000","#F7DA64","#FBA026","#EB6B56","#E25041","#A38F84","#EFEFEF","#FFFFFF","#FAC51C","#F37934","#D14841","#B8312F","#7C706B","#D1D5D8","REMOVE"],colorsStep:7,colorsDefaultTab:"text",colorsButtons:["colorsBack","|","-"],defaultColors:{background:{init:!1,color:""},text:{init:!1,color:""}},isIE:document.documentMode||/Edge/.test(navigator.userAgent),isButton:!1,selectedElement:{color:"",bg:""}}),o.FE.PLUGINS.colors=function(o){function t(){o.opts.selectedElement.bg="",o.opts.selectedElement.color="",o.popups.hide("colors.picker")}function e(){var t='<div class="fr-buttons fr-colors-buttons">';o.opts.toolbarInline&&o.opts.colorsButtons.length>0&&(t+=o.button.buildList(o.opts.colorsButtons));var e={buttons:t+=s()+"</div>",text_colors:r("text"),background_colors:r("background")};return o.popups.create("colors.picker",e)}function s(){var t='<div class="fr-colors-tabs">';return t+='<span class="fr-colors-tab '+("background"==o.opts.colorsDefaultTab?"":"fr-selected-tab ")+'fr-command" data-param1="text" data-cmd="colorChangeSet" title="'+o.language.translate("Text")+'">'+o.language.translate("Text")+"</span>",(t+='<span class="fr-colors-tab '+("background"==o.opts.colorsDefaultTab?"fr-selected-tab ":"")+'fr-command" data-param1="background" data-cmd="colorChangeSet" title="'+o.language.translate("Background")+'">'+o.language.translate("Background")+"</span>")+"</div>"}function r(t){var e="text"==t?o.opts.colorsText:o.opts.colorsBackground,s="text"==t?"clearTextColor":"clearBackgroundColor",r="text"==t?"textColorSpectrum":"bgColorSpectrum",c="text"==t?"toggleTextSpectrum":"toggleBgSpectrum",n="text"==t?"chooseTextColor":"chooseBGColor",l='<div class="sp-container sp-light sp-alpha-enabled sp-clear-enabled sp-initial-disabled fr-color-set fr-'+t+"-color"+(o.opts.colorsDefaultTab==t||"text"!=o.opts.colorsDefaultTab&&"background"!=o.opts.colorsDefaultTab&&"text"==t?" fr-selected-set":"")+'">';l+='<div class="color-inner-row">';for(var a=0;a<e.length;a++)0!==a&&a%o.opts.colorsStep==0&&(l+="<br>"),"REMOVE"!=e[a]?l+='<span class="fr-command fr-select-color" style="background: '+e[a]+';" data-cmd="'+t+'Color" data-param1="'+e[a]+'"></span>':o.opts.isIE?l+='<span class="fr-command fr-select-color" data-cmd="'+t+'Color" data-param1="REMOVE" title="'+o.language.translate("Clear Formatting")+'"><i class="fa fa-eraser"></i></span>':l+='<span style="visibility: hidden;" class="fr-command fr-select-color" data-cmd="'+t+'Color" data-param1="REMOVE" title="'+o.language.translate("Clear Formatting")+'"><i class="fa fa-eraser"></i></span>';return l+='<div class="sp-palette-button-container sp-cf"><button type="button" class="sp-palette-toggle fr-command" data-cmd="'+c+'">less</button></div>',l+="</div>",l+='<div class="sp-picker-container"><div class="sp-top sp-cf"><div class="sp-fill"></div><div class="sp-top-inner"><div class="sp-color fr-command" data-cmd="'+r+'" style="background-color: rgb(255, 0, 0);"><div class="sp-sat"><div class="sp-val"><div class="sp-dragger" style="display: none;"></div></div></div></div><div class="sp-clear sp-clear-display fr-command" data-cmd="'+s+'" title="Clear Color Selection"></div><div class="sp-hue"><div class="sp-slider" style="display: none;"></div></div></div><div class="sp-alpha"><div class="sp-alpha-inner"><div class="sp-alpha-handle" style="display: none;"></div></div></div></div><div class="sp-input-container sp-cf"><input style="display:none;" class="sp-input" type="text" spellcheck="false" placeholder=""></div><div class="sp-initial sp-thumb sp-cf"></div><div class="sp-button-container sp-cf"><a class="sp-cancel fr-command" data-cmd="cancelAndCloseColor" href="javascript:void(0)">cancel</a><button type="button" class="sp-choose fr-command" data-cmd="'+n+'">choose</button></div></div>',l+="</div>"}function c(t){var e=o.popups.get("colors.picker"),s=$(o.selection.element()),r=$(o.selection.element()),c=s.hasClass("ssb-theme-btn");c?o.opts.button=s:(c=s.parent().hasClass("ssb-theme-btn"))&&(o.opts.button=s.parent()),o.opts.isButton=c;var n,l="";for("background"==t?(n="background-color",l=o.opts.selectedElement.bg||s.css(n)):(n="color",l=o.opts.selectedElement.color||s.css(n)),o.opts.isButton&&(l=o.opts.button.css(n)),e.find(".fr-"+t+"-color .fr-select-color").removeClass("fr-selected-color"),o.opts.isButton&&(l=o.opts.button.css(n),setTimeout(function(){d(n,l,!1)},0));s.get(0)!=o.$el.get(0)&&!o.opts.selectedElement.color&&!o.opts.isButton;){if("transparent"!=s.css("color")&&"rgba(0, 0, 0, 0)"!=s.css("color")){o.opts.selectedElement.color=s.css("color");a="";a="background"==t?o.opts.selectedElement.bg:o.opts.selectedElement.color,e.find(".fr-"+t+'-color .fr-select-color[data-param1="'+o.helpers.RGBToHex(a)+'"]').addClass("fr-selected-color");break}s=s.parent()}for(s=r;s.get(0)!=o.$el.get(0)&&!o.opts.selectedElement.bg&&!o.opts.isButton;){if("transparent"!=s.css("background-color")&&"rgba(0, 0, 0, 0)"!=s.css("background-color")){o.opts.selectedElement.bg=s.css("background-color");a="";a="background"==t?o.opts.selectedElement.bg:o.opts.selectedElement.color,e.find(".fr-"+t+'-color .fr-select-color[data-param1="'+o.helpers.RGBToHex(a)+'"]').addClass("fr-selected-color");break}s=s.parent()}if(!o.opts.isButton){var a="";a="background"==t?o.opts.selectedElement.bg:o.opts.selectedElement.color,setTimeout(function(){d(n,a,!0)},0)}}function n(){var t=$(o.selection.element());if(o.opts.isButton)o.opts.defaultColors.background.color=o.opts.button.css("background-color"),o.opts.defaultColors.text.color=o.opts.button.css("color");else{for(;t.get(0)!=o.$el.get(0)&&("transparent"==t.css("background-color")||"rgba(0, 0, 0, 0)"==t.css("background-color"));)t=t.parent();o.opts.defaultColors.text.color=t.css("color"),o.opts.defaultColors.background.color=t.css("background-color")}}function l(t,e,s){var r=o.popups.get("colors.picker");if("REMOVE"!=t){r.find("input.sp-input").val(t);var c=o.helpers.RGBToHex(t);c||o.helpers.RGBToHex("#"+t)&&(c=o.helpers.RGBToHex("#"+t),t="#"+t),o.opts.isButton?o.opts.button.css("background-color",t):s?o.format.applyStyle(" ",""):($(o.$el).find("span")&&$(o.$el).find("span").length&&$(o.$el).find("span").removeClass("ssb-bg-color-inline-block"),o.format.applyStyle("background-color",t),$(o.$el).find("span").filter(function(){var o=$(this).css("background-color");return"transparent"!=o&&"rgba(0, 0, 0, 0)"!=o}).addClass("ssb-bg-color-inline-block")),o.opts.isButton&&o.events.trigger("bgColorChange",[t]),o.opts.selectedElement.bg=t,$(".fr-command.fr-select-color[data-cmd='backgroundColor']").removeClass("fr-selected-color"),$(".fr-command.fr-select-color[data-cmd='backgroundColor'][data-param1='"+c+"']").addClass("fr-selected-color")}else r.find("input.sp-input").val(""),o.opts.isButton?o.opts.button.css("background-color",""):o.opts.isIE?$(o.selection.element()).css("background-color",""):o.format.removeStyle("background-color"),$(".fr-command.fr-select-color[data-cmd='backgroundColor']").removeClass("fr-selected-color"),o.opts.isButton&&o.events.trigger("bgColorChange",[]),setTimeout(function(){o.events.trigger("contentChanged")});e&&d("background-color",t,!1)}function a(t,e,s){var r=o.popups.get("colors.picker");if("REMOVE"!=t){r.find("input.sp-input").val(t);var c=o.helpers.RGBToHex(t);c||o.helpers.RGBToHex("#"+t)&&(c=o.helpers.RGBToHex("#"+t),t="#"+t),o.opts.isButton?$(o.selection.element()).css("color",t):s?o.format.applyStyle(" ",""):o.format.applyStyle("color",t),o.opts.selectedElement.color=t,o.opts.isButton&&o.events.trigger("txtColorChange",[t]),$(".fr-command.fr-select-color[data-cmd='textColor']").removeClass("fr-selected-color"),$(".fr-command.fr-select-color[data-cmd='textColor'][data-param1='"+c+"']").addClass("fr-selected-color")}else o.opts.isButton?o.opts.button.css("color",""):o.opts.isIE?$(o.selection.element()).css("color",""):o.format.removeStyle("color"),$(".fr-command.fr-select-color[data-cmd='textColor']").removeClass("fr-selected-color"),o.opts.isButton&&o.events.trigger("bgColorChange",[]),r.find("input.sp-input").val(""),setTimeout(function(){o.events.trigger("contentChanged")});e&&d("color",t,!1)}function i(e){e&&(l(o.opts.defaultColors.background.color||"REMOVE"),a(o.opts.defaultColors.text.color||"REMOVE")),t()}function d(t,e,s){function r(){(F<=0||B<=0||$<=0)&&i(),O=!0,b.addClass(M),w=null}function c(){O=!1,b.removeClass(M)}function n(o){d(t,!1,o)}function i(){g()}function d(t,e,s){if(g(),!A){var r=tinycolor.fromRatio({h:P,s:1,v:1});k.css("background-color",r.toHexString());var c=f();if(c){var n=c.toHexString(),i=c.toRgbString();e||("color"===t?a(i,!1,s):l(i,!1,s));var d=c.toRgb();d.a=0;var p=tinycolor(d).toRgbString(),u="linear-gradient(left, "+p+", "+n+")";o.opts.isIE?D.css("filter",tinycolor(p).toFilter({gradientType:1},n)):(D.css("background","-webkit-"+u),D.css("background","-moz-"+u),D.css("background","-ms-"+u),D.css("background","linear-gradient(to right, "+p+", "+n+")"))}}}function f(o){return tinycolor.fromRatio({h:P,s:H,v:V,a:Math.round(100*G)/100},{format:"rgb"})}function g(){var o=H,t=V;if(A)v.hide(),C.hide(),h.hide();else{v.show(),C.show(),h.show();var e=o*B,s=F-t*F;e=Math.max(-y,Math.min(B-y,e-y)),s=Math.max(-y,Math.min(F-y,s-y)),h.css({top:s+"px",left:e+"px"});var r=G*R;v.css({left:r-S/2+"px"});var c=P*$;C.css({top:c-T+"px"})}}var m=o.popups.get("colors.picker");m.find("input:focus").blur();var b="color"===t?m.find(".fr-color-set.sp-container.fr-text-color"):m.find(".fr-color-set.sp-container.fr-background-color"),h=b.find(".sp-dragger"),C=b.find(".sp-slider"),v=b.find(".sp-alpha-handle"),k=b.find(".sp-color"),E=b.find(".sp-hue"),x=b.find(".sp-alpha"),B=k.width(),F=k.height(),y=h.height(),$=(E.width(),E.height()),T=C.height(),R=x.width(),S=v.width(),D=b.find(".sp-alpha-inner"),M="sp-dragging",w=null,A=!0,O=!1,P=0,H=0,V=0,G=1;p(b.find(".sp-input"),t),u(x,function(t,e,s){G=t/R,A=!1,s.shiftKey&&(G=Math.round(10*G)/10),n(),setTimeout(function(){o.events.trigger("contentChanged")})},r,c),u(E,function(t,e){P=parseFloat(e/$),A=!1,n(),setTimeout(function(){o.events.trigger("contentChanged")})},r,c),u(k,function(t,e,s){H=parseFloat(t/B),V=parseFloat((F-e)/F),A=!1,n(),setTimeout(function(){o.events.trigger("contentChanged")})},r,c),e?(!function(o,e,s){if(tinycolor.equals(o,f()))d(t,e,s);else{var r;o?(A=!1,r=tinycolor(o).toHsv(),P=r.h%360/360,H=r.s,V=r.v,G=r.a):A=!0,d(t,e,s)}}(e,!0,s),n(s)):(A=!0,n(s))}function p(e,s){$(e).off("keypress").on("keypress",function(r){if(13==r.which){var c=$(e).val();o.selection.restore(),"color"===s?a(c,!0):l(c,!0),t()}}),$(e).off("focus").on("focus",function(t){o.selection.save()})}function u(t,e,s,r){function c(o){o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault(),o.returnValue=!1}function n(s){if(o.events.disableBlur(),i){if(o.opts.isIE&&a.documentMode<9&&!s.button)return l();var r=s.originalEvent&&s.originalEvent.touches&&s.originalEvent.touches[0],n=r&&r.pageX||s.pageX,g=r&&r.pageY||s.pageY,m=Math.max(0,Math.min(n-d.left,u)),b=Math.max(0,Math.min(g-d.top,p));f&&c(s),e.apply(t,[m,b,s])}}function l(){i&&(o.popups.get("colors.picker").find("input").removeClass("disabled"),$(a).unbind(g),$(a.body).removeClass("sp-dragging"),setTimeout(function(){r.apply(t,arguments)},0)),i=!1}e=e||function(){},s=s||function(){},r=r||function(){};var a=document,i=!1,d={},p=0,u=0,f="ontouchstart"in window,g={};g.selectstart=c,g.dragstart=c,g["touchmove mousemove"]=n,g["touchend mouseup"]=l,$(t).off("touchstart mousedown").on("touchstart mousedown",function(e){(e.which?3==e.which:2==e.button)||i||!1!==s.apply(t,arguments)&&(i=!0,p=$(t).height(),u=$(t).width(),d=$(t).offset(),$(a).bind(g),$(a.body).addClass("sp-dragging"),n(e),o.popups.get("colors.picker").find("input").addClass("disabled"),c(e))}),$(t).off("touchend mouseup mouseleave").on("touchend mouseup",l),$(a).bind("click",l)}return{showColorsPopup:function(){var t=o.$tb.find('.fr-command[data-cmd="color"]');o.opts.selectedElement.bg="",o.opts.selectedElement.color="";var s=o.popups.get("colors.picker");if(s||(s=e()),!s.hasClass("fr-active")){o.popups.setContainer("colors.picker",o.$tb),c(s.find(".fr-selected-tab").attr("data-param1"));var r=t.offset().left+t.outerWidth()/2,l=t.offset().top+(o.opts.toolbarBottom?10:t.outerHeight()-10);o.popups.show("colors.picker",r,l,t.outerHeight()),o.opts.isIE?($(".fr-popup").find(".sp-input").hide(),$(".fr-popup").find(".sp-palette-toggle").hide(),$(".fr-popup").find(".sp-picker-container").hide()):$(".sp-input").show(),n()}},hideColorsPopup:t,changeSet:function(o,t){o.hasClass("fr-selected-tab")||(o.siblings().removeClass("fr-selected-tab"),o.addClass("fr-selected-tab"),o.parents(".fr-popup").find(".fr-color-set").removeClass("fr-selected-set"),o.parents(".fr-popup").find(".fr-color-set.fr-"+t+"-color").addClass("fr-selected-set"),c(t))},background:l,text:a,back:function(){o.link.get()?o.link.back():(o.popups.hide("colors.picker"),o.toolbar.showInline())},removeColor:function(t,e){o.popups.get("colors.picker").find("input.sp-input").val(""),"text"===t?(o.opts.selectedElement.bg="",$(".fr-command.fr-select-color[data-cmd='textColor']").removeClass("fr-selected-color"),o.opts.isButton?o.opts.button.css("color",""):o.format.removeStyle("color"),o.opts.isButton&&o.events.trigger("txtColorChange",[]),setTimeout(function(){o.events.trigger("contentChanged"),i()})):($(".fr-command.fr-select-color[data-cmd='backgroundColor']").removeClass("fr-selected-color"),o.opts.selectedElement.color="",o.opts.isButton?o.opts.button.css("background-color",""):o.format.removeStyle("background-color"),o.opts.isButton&&o.events.trigger("bgColorChange",[]),setTimeout(function(){o.events.trigger("contentChanged"),i()}))},chooseColorPicker:function(e){var s=o.popups.get("colors.picker"),r=("text"===e?s.find(".fr-color-set.sp-container.fr-text-color"):s.find(".fr-color-set.sp-container.fr-background-color")).find(".sp-input").val();o.selection.restore(),"text"===e?a(r||"REMOVE"):l(r||"REMOVE"),t()},closeColorPicker:i,initializeSpectrum:d,toggleSpectrum:function(t){var e=o.popups.get("colors.picker"),s="text"===t?e.find(".fr-color-set.sp-container.fr-text-color"):$(".fr-color-set.sp-container.fr-background-color"),r=s.find(".sp-picker-container"),c=s.find(".sp-palette-toggle");r.toggle(),r.is(":visible")?(c.text("less"),s.removeClass("no-spectrum")):(c.text("more"),s.addClass("no-spectrum"))}}},o.FE.DefineIcon("colors",{NAME:"tint"}),o.FE.RegisterCommand("color",{title:"Colors",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("colors.picker")?(this.$el.find(".fr-marker")&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("colors.picker")):this.colors.showColorsPopup()},plugin:"colors"}),o.FE.RegisterCommand("textColor",{undo:!0,callback:function(o,t){this.events.disableBlur(),this.selection.restore(),this.colors.text(t,!0)}}),o.FE.RegisterCommand("backgroundColor",{undo:!0,callback:function(o,t){this.events.disableBlur(),this.selection.restore(),this.colors.background(t,!0)}}),o.FE.RegisterCommand("colorChangeSet",{undo:!1,focus:!1,callback:function(o,t){var e=this.popups.get("colors.picker").find('.fr-command[data-cmd="'+o+'"][data-param1="'+t+'"]');this.colors.changeSet(e,t)}}),o.FE.RegisterCommand("clearTextColor",{undo:!1,focus:!1,callback:function(o,t){this.popups.get("colors.picker").find('.fr-command[data-cmd="'+o+'"][data-param1="'+t+'"]');this.colors.removeColor("text",t)}}),o.FE.RegisterCommand("clearBackgroundColor",{undo:!1,focus:!1,callback:function(o,t){this.popups.get("colors.picker").find('.fr-command[data-cmd="'+o+'"][data-param1="'+t+'"]');this.colors.removeColor("background",t)}}),o.FE.RegisterCommand("chooseTextColor",{undo:!1,focus:!1,callback:function(o,t){this.colors.chooseColorPicker("text")}}),o.FE.RegisterCommand("chooseBGColor",{undo:!1,focus:!1,callback:function(o,t){this.colors.chooseColorPicker("background")}}),o.FE.RegisterCommand("cancelAndCloseColor",{undo:!1,focus:!1,callback:function(o,t){this.colors.closeColorPicker(!0)}}),o.FE.RegisterCommand("textColorSpectrum",{undo:!0,focus:!1,callback:function(o){this.colors.initializeSpectrum("text",!0,!1)}}),o.FE.RegisterCommand("bgColorSpectrum",{undo:!0,focus:!1,callback:function(o){this.colors.initializeSpectrum("background",!0,!1)}}),o.FE.RegisterCommand("toggleTextSpectrum",{undo:!1,focus:!1,callback:function(o){this.colors.toggleSpectrum("text")}}),o.FE.RegisterCommand("toggleBgSpectrum",{undo:!1,focus:!1,callback:function(o){this.colors.toggleSpectrum("background")}}),o.FE.DefineIcon("colorsBack",{NAME:"arrow-left"}),o.FE.RegisterCommand("colorsBack",{title:"Back",undo:!1,focus:!1,back:!0,refreshAfterCallback:!1,callback:function(){this.colors.back()}})});