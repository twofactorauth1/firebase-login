!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(n),n}:e(jQuery)}(function(e){e.extend(e.FE.POPUP_TEMPLATES,{"link.edit":"[_BUTTONS_]","link.insert":"[_BUTTONS_][_INPUT_LAYER_]"}),e.extend(e.FE.DEFAULTS,{linkEditButtons:["linkOpen","linkStyle","linkEdit","linkRemove"],linkInsertButtons:["linkBack","|","linkList"],linkAttributes:{},linkAutoPrefix:"http://",linkStyles:{"fr-green":"Green","fr-strong":"Thick"},linkMultipleStyles:!0,linkConvertEmailAddress:!0,linkAlwaysBlank:!1,linkAlwaysNoFollow:!1,linkList:[{text:"Froala",href:"https://froala.com",target:"_blank"},{text:"Google",href:"https://google.com",target:"_blank"},{displayText:"Facebook",href:"https://facebook.com"}],linkText:!0}),e.FE.PLUGINS.link=function(t){function n(){var n=t.image?t.image.get():null;if(!n&&t.$wp){var i=t.selection.ranges(0).commonAncestorContainer;if(i&&(i.contains&&i.contains(t.el)||!t.el.contains(i)||t.el==i)&&(i=null),i&&"A"===i.tagName)return i;var r=t.selection.element(),a=t.selection.endElement();return"A"==r.tagName||t.node.isElement(r)||(r=e(r).parentsUntil(t.$el,"a:first").get(0)),"A"==a.tagName||t.node.isElement(a)||(a=e(a).parentsUntil(t.$el,"a:first").get(0)),a&&(a.contains&&a.contains(t.el)||!t.el.contains(a)||t.el==a)&&(a=null),r&&(r.contains&&r.contains(t.el)||!t.el.contains(r)||t.el==r)&&(r=null),a&&a==r&&"A"==a.tagName?(t.browser.msie||t.helpers.isMobile())&&(t.selection.info(r).atEnd||t.selection.info(r).atStart)?null:r:null}return"A"==t.el.tagName?t.el:n&&n.get(0).parentNode&&"A"==n.get(0).parentNode.tagName?n.get(0).parentNode:void 0}function i(){var e=t.image?t.image.get():null,n=[];if(e)"A"==e.get(0).parentNode.tagName&&n.push(e.get(0).parentNode);else{var i,r,a,l;if(t.win.getSelection){var s=t.win.getSelection();if(s.getRangeAt&&s.rangeCount){l=t.doc.createRange();for(var o=0;o<s.rangeCount;++o)if(i=s.getRangeAt(o),(r=i.commonAncestorContainer)&&1!=r.nodeType&&(r=r.parentNode),r&&"a"==r.nodeName.toLowerCase())n.push(r);else{a=r.getElementsByTagName("a");for(var p=0;p<a.length;++p)l.selectNodeContents(a[p]),l.compareBoundaryPoints(i.END_TO_START,i)<1&&l.compareBoundaryPoints(i.START_TO_END,i)>-1&&n.push(a[p])}}}else if(t.doc.selection&&"Control"!=t.doc.selection.type)if(i=t.doc.selection.createRange(),"a"==(r=i.parentElement()).nodeName.toLowerCase())n.push(r);else{a=r.getElementsByTagName("a"),l=t.doc.body.createTextRange();for(var f=0;f<a.length;++f)l.moveToElementText(a[f]),l.compareEndPoints("StartToEnd",i)>-1&&l.compareEndPoints("EndToStart",i)<1&&n.push(a[f])}}return n}function r(i){l(),setTimeout(function(){if(!i||i&&(1==i.which||"mouseup"!=i.type)){var r=n(),l=t.image?t.image.get():null;if(r&&!l){if(t.image){var s=t.node.contents(r);if(1==s.length&&"IMG"==s[0].tagName){var o=t.selection.ranges(0);return 0===o.startOffset&&0===o.endOffset?e(r).before(e.FE.MARKERS):e(r).after(e.FE.MARKERS),t.selection.restore(),!1}}i&&i.stopPropagation(),a(r)}}},t.helpers.isIOS()?100:0)}function a(n){var i=t.popups.get("link.edit");i||(i=s());var r=e(n);t.popups.isVisible("link.edit")||t.popups.refresh("link.edit"),t.popups.setContainer("link.edit",t.$sc);var a=r.offset().left+e(n).outerWidth()/2,l=r.offset().top+r.outerHeight();t.popups.show("link.edit",a,l,r.outerHeight())}function l(){t.popups.hide("link.edit");var i=n();i&&e(i).removeAttr("target_self")}function s(){var e="";t.opts.linkEditButtons.length>1&&("A"==t.el.tagName&&t.opts.linkEditButtons.indexOf("linkRemove")>=0&&t.opts.linkEditButtons.splice(t.opts.linkEditButtons.indexOf("linkRemove"),1),e='<div class="fr-buttons">'+t.button.buildList(t.opts.linkEditButtons)+"</div>");var i={buttons:e},r=t.popups.create("link.edit",i);return t.$wp&&t.events.$on(t.$wp,"scroll.link-edit",function(){n()&&t.popups.isVisible("link.edit")&&a(n())}),r}function o(){}function p(){var i=t.popups.get("link.insert"),r=n();if(r){var a,l,s=e(r),o=i.find('input.fr-link-attr[type="text"]'),p=i.find('input.fr-link-attr[type="checkbox"]');for(a=0;a<o.length;a++)(l=e(o[a])).val(s.attr(l.attr("name")||""));for(p.prop("checked",!1),a=0;a<p.length;a++)l=e(p[a]),s.attr(l.attr("name"))==l.data("checked")&&l.prop("checked",!0);i.find('input.fr-link-attr[type="text"][name="text"]').val(s.text())}else i.find('input.fr-link-attr[type="text"]').val(""),i.find('input.fr-link-attr[type="checkbox"]').prop("checked",!1),i.find('input.fr-link-attr[type="text"][name="text"]').val(t.selection.text());i.find("input.fr-link-attr").trigger("change"),(t.image?t.image.get():null)?i.find('.fr-link-attr[name="text"]').parent().hide():i.find('.fr-link-attr[name="text"]').parent().show(),i.find('input[name="href"]').removeClass("fr-error")}function f(e){if(e)return t.popups.onRefresh("link.insert",p),t.popups.onHide("link.insert",o),!0;var i="";t.opts.linkInsertButtons.length>=1&&(i='<div class="fr-buttons">'+t.button.buildList(t.opts.linkInsertButtons)+"</div>");var r='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="10" height="10" viewBox="0 0 32 32"><path d="M27 4l-15 15-7-7-5 5 12 12 20-20z" fill="#FFF"></path></svg>',a="",l=0;a='<div class="fr-link-insert-layer fr-layer fr-active" id="fr-link-insert-layer-'+t.id+'">',a+='<div class="fr-input-line"><input id="fr-link-insert-layer-url-'+t.id+'" name="href" type="text" class="fr-link-attr" placeholder="URL" tabIndex="'+ ++l+'"></div>',t.opts.linkText&&(a+='<div class="fr-input-line"><input id="fr-link-insert-layer-text-'+t.id+'" name="text" type="text" class="fr-link-attr" placeholder="'+t.language.translate("Text")+'" tabIndex="'+ ++l+'"></div>');for(var s in t.opts.linkAttributes)if(t.opts.linkAttributes.hasOwnProperty(s)){var f=t.opts.linkAttributes[s];a+='<div class="fr-input-line"><input name="'+s+'" type="text" class="fr-link-attr" placeholder="'+t.language.translate(f)+'" tabIndex="'+ ++l+'"></div>'}t.opts.linkAlwaysBlank||(a+='<div class="fr-checkbox-line"><span class="fr-checkbox"><input data-cmd="updateLinkTargetBlank" name="target" class="fr-command fr-link-attr" data-checked="_blank" type="checkbox" id="fr-link-target-'+t.id+'" tabIndex="'+ ++l+'"><span>'+r+'</span></span><label class="fr-command" data-cmd="updateLinkTargetBlank" for="fr-link-target-'+t.id+'">'+t.language.translate("Open in new tab")+"</label></div>",a+='<div class="fr-checkbox-line"><span class="fr-checkbox"><input data-cmd="updateLinkTargetSelf" name="target_self" class="fr-command fr-link-attr" data-checked="_self" type="checkbox" id="fr-link-target-self'+t.id+'" tabIndex="'+ ++l+'"><span>'+r+'</span></span><label class="fr-command" data-cmd="updateLinkTargetSelf" for="fr-link-target-self'+t.id+'">'+t.language.translate("Reload page")+"</label></div>");var d={buttons:i,input_layer:a+='<div class="fr-action-buttons"><button class="fr-command fr-submit" role="button" data-cmd="linkInsert" href="#" tabIndex="'+ ++l+'" type="button">'+t.language.translate("Insert")+"</button></div></div>"},c=t.popups.create("link.insert",d);return t.$wp&&t.events.$on(t.$wp,"scroll.link-insert",function(){(t.image?t.image.get():null)&&t.popups.isVisible("link.insert")&&k(),n&&t.popups.isVisible("link.insert")&&u()}),c}function d(){if(!t.selection.isCollapsed()){t.selection.save();for(var n=t.$el.find(".fr-marker").addClass("fr-unprocessed").toArray();n.length;){var i=e(n.pop());i.removeClass("fr-unprocessed");var r=t.node.deepestParent(i.get(0));if(r){var a=i.get(0),l="",s="";do{a=a.parentNode,t.node.isBlock(a)||(l+=t.node.closeTagString(a),s=t.node.openTagString(a)+s)}while(a!=r);var o=t.node.openTagString(i.get(0))+i.html()+t.node.closeTagString(i.get(0));i.replaceWith('<span id="fr-break"></span>');var p=e(r).html();p=p.replace(/<span id="fr-break"><\/span>/g,l+o+s),e(r).html(p)}n=t.$el.find(".fr-marker.fr-unprocessed").toArray()}t.selection.restore()}}function c(a,l,s){if(void 0===s&&(s={}),!1===t.events.trigger("link.beforeInsert",[a,l,s]))return!1;var o=t.image?t.image.get():null;o||"A"==t.el.tagName?"A"==t.el.tagName&&t.$el.focus():(t.selection.restore(),t.popups.hide("link.insert"));var p=a;if(t.opts.linkConvertEmailAddress&&/^[\w._]+@[a-z\u00a1-\uffff0-9_-]+?\.[a-z\u00a1-\uffff0-9]{2,}$/i.test(a)&&!/^mailto:.*/i.test(a)&&(a="mailto:"+a),""===t.opts.linkAutoPrefix||/^(mailto|tel|sms|notes|data):.*/i.test(a)||/^data:image.*/i.test(a)||/^(https?:|ftps?:|file:|)\/\//i.test(a)||["/","{","[","#","("].indexOf((a||"")[0])<0&&(a=t.opts.linkAutoPrefix+a),a=t.helpers.sanitizeURL(a),t.opts.linkAlwaysBlank&&(s.target="_blank"),t.opts.linkAlwaysNoFollow&&(s.rel="nofollow"),s.target_self&&(s.target="_self"),delete s.target_self,"_blank"==s.target&&(s.rel?s.rel+=" noopener noreferrer":s.rel="noopener noreferrer"),l=l||"",a===t.opts.linkAutoPrefix)return t.popups.get("link.insert").find('input[name="href"]').addClass("fr-error"),t.events.trigger("link.bad",[p]),!1;var f,c=n();if(c)(f=e(c)).attr("href",a),f.removeAttr("target_self"),l.length>0&&f.text()!=l&&!o&&f.text(l),o||f.prepend(e.FE.START_MARKER).append(e.FE.END_MARKER),f.attr(s),o||t.selection.restore();else{if(o)o.wrap('<a href="'+a+'"></a>');else if(t.format.remove("a"),t.selection.isCollapsed())l=0===l.length?p:l,t.html.insert('<a href="'+a+'">'+e.FE.START_MARKER+l+e.FE.END_MARKER+"</a>"),t.selection.restore();else if(l.length>0&&l!=t.selection.text().replace(/\n/g,""))t.selection.remove(),t.html.insert('<a href="'+a+'">'+e.FE.START_MARKER+l+e.FE.END_MARKER+"</a>"),t.selection.restore();else{d(),t.format.apply("a",{href:a});var u=n();u&&e(u).prepend(e.FE.START_MARKER).append(e.FE.END_MARKER),setTimeout(function(){t.selection.clear()},500)}for(var k=i(),g=0;g<k.length;g++)(f=e(k[g])).attr(s),f.removeAttr("_moz_dirty");1==k.length&&t.$wp&&!o&&(e(k[0]).prepend(e.FE.START_MARKER).append(e.FE.END_MARKER),t.selection.restore())}o?(t.popups.get("link.insert").find("input:focus").blur(),t.image.edit(o)):r()}function u(){l();var i=n();if(i){"_self"===e(i).attr("target")&&e(i).attr("target_self","_self");var r=t.popups.get("link.insert");r||(r=f()),t.popups.isVisible("link.insert")||(t.popups.refresh("link.insert"),t.selection.save(),t.helpers.isMobile()&&(t.events.disableBlur(),t.$el.blur(),t.events.enableBlur())),t.popups.setContainer("link.insert",t.$sc);var a=(t.image?t.image.get():null)||e(i),s=a.offset().left+a.outerWidth()/2,o=a.offset().top+a.outerHeight();t.popups.show("link.insert",s,o,a.outerHeight())}}function k(){var e=t.image?t.image.get():null;if(e){var n=t.popups.get("link.insert");n||(n=f()),p(!0),t.popups.setContainer("link.insert",t.$sc);var i=e.offset().left+e.outerWidth()/2,r=e.offset().top+e.outerHeight();t.popups.show("link.insert",i,r,e.outerHeight())}}return{_init:function(){t.events.on("keyup",function(t){t.which!=e.FE.KEYCODE.ESC&&r(t)}),t.events.on("window.mouseup",r),t.helpers.isMobile()&&t.events.$on(t.$doc,"selectionchange",r),f(!0),"A"==t.el.tagName&&t.$el.addClass("fr-view"),t.events.on("toolbar.esc",function(){if(t.popups.isVisible("link.edit"))return t.events.disableBlur(),t.events.focus(),!1},!0)},remove:function(){var i=n(),r=t.image?t.image.get():null;if(!1===t.events.trigger("link.beforeRemove",[i]))return!1;r&&i?(r.unwrap(),t.image.edit(r)):i&&(t.selection.save(),e(i).replaceWith(e(i).html()),t.selection.restore(),l())},showInsertPopup:function(){var e=t.$tb.find('.fr-command[data-cmd="insertLink"]'),n=t.popups.get("link.insert");if(n||(n=f()),!n.hasClass("fr-active"))if(t.popups.refresh("link.insert"),t.popups.setContainer("link.insert",t.$tb||t.$sc),e.is(":visible")){var i=e.offset().left+e.outerWidth()/2,r=e.offset().top+(t.opts.toolbarBottom?10:e.outerHeight()-10);t.popups.show("link.insert",i,r,e.outerHeight())}else t.position.forSelection(n),t.popups.show("link.insert");n.find('input[name="href"]').removeClass("fr-error")},usePredefined:function(n){var i,r,a=t.opts.linkList[n],l=t.popups.get("link.insert"),s=l.find('input.fr-link-attr[type="text"]'),o=l.find('input.fr-link-attr[type="checkbox"]');for(r=0;r<s.length;r++)a[(i=e(s[r])).attr("name")]?i.val(a[i.attr("name")]):"text"!=i.attr("name")&&i.val("");for(r=0;r<o.length;r++)(i=e(o[r])).prop("checked",i.data("checked")==a[i.attr("name")]);t.accessibility.focusPopup(l)},insertCallback:function(){var n=t.popups.get("link.insert"),i=n.find('input.fr-link-attr[type="text"]'),r=n.find('input.fr-link-attr[type="checkbox"]'),a=i.filter('[name="href"]').val(),l=i.filter('[name="text"]').val();l=l.trim();var s,o,p={};for(o=0;o<i.length;o++)s=e(i[o]),["href","text"].indexOf(s.attr("name"))<0&&(p[s.attr("name")]=s.val());for(o=0;o<r.length;o++)(s=e(r[o])).is(":checked")?p[s.attr("name")]=s.data("checked"):p[s.attr("name")]=s.data("unchecked")||null;var f=t.helpers.scrollTop();c(a,l,p),e(t.o_win).scrollTop(f)},insert:c,update:u,get:n,allSelected:i,back:function(){(t.image?t.image.get():null)?t.image.back():(t.events.disableBlur(),t.selection.restore(),t.events.enableBlur(),n()&&t.$wp?(t.selection.restore(),l(),r()):"A"==t.el.tagName?(t.$el.focus(),r()):(t.popups.hide("link.insert"),t.toolbar.showInline()))},imageLink:k,applyStyle:function(i,a,l){void 0===l&&(l=t.opts.linkMultipleStyles),void 0===a&&(a=t.opts.linkStyles);var s=n();if(!s)return!1;if(!l){var o=Object.keys(a);o.splice(o.indexOf(i),1),e(s).removeClass(o.join(" "))}e(s).toggleClass(i),r()}}},e.FE.DefineIcon("insertLink",{NAME:"link"}),e.FE.RegisterShortcut(e.FE.KEYCODE.K,"insertLink",null,"K"),e.FE.RegisterCommand("insertLink",{title:"Insert Link",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("link.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("link.insert")):this.link.showInsertPopup()},plugin:"link"}),e.FE.DefineIcon("linkOpen",{NAME:"external-link"}),e.FE.RegisterCommand("linkOpen",{title:"Open Link",undo:!1,refresh:function(e){this.link.get()?e.removeClass("fr-hidden"):e.addClass("fr-hidden")},callback:function(){var e=this.link.get();e&&this.o_win.open(e.href)}}),e.FE.DefineIcon("linkEdit",{NAME:"edit"}),e.FE.RegisterCommand("linkEdit",{title:"Edit Link",undo:!1,refreshAfterCallback:!1,popup:!0,callback:function(){this.link.update()},refresh:function(e){this.link.get()?e.removeClass("fr-hidden"):e.addClass("fr-hidden")}}),e.FE.DefineIcon("linkRemove",{NAME:"unlink"}),e.FE.RegisterCommand("linkRemove",{title:"Unlink",callback:function(){this.link.remove()},refresh:function(e){this.link.get()?e.removeClass("fr-hidden"):e.addClass("fr-hidden")}}),e.FE.DefineIcon("linkBack",{NAME:"arrow-left"}),e.FE.RegisterCommand("linkBack",{title:"Back",undo:!1,focus:!1,back:!0,refreshAfterCallback:!1,callback:function(){this.link.back()},refresh:function(e){var t=this.link.get()&&this.doc.hasFocus();(this.image?this.image.get():null)||t||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),e.FE.DefineIcon("linkList",{NAME:"search"}),e.FE.RegisterCommand("linkList",{title:"Choose Link",type:"dropdown",focus:!1,undo:!1,refreshAfterCallback:!1,html:function(){for(var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.linkList,n=0;n<t.length;n++)e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="linkList" data-param1="'+n+'">'+(t[n].displayText||t[n].text)+"</a></li>";return e+="</ul>"},callback:function(e,t){this.link.usePredefined(t)}}),e.FE.RegisterCommand("linkInsert",{focus:!1,refreshAfterCallback:!1,callback:function(){this.link.insertCallback()},refresh:function(e){this.link.get()?e.text(this.language.translate("Update")):e.text(this.language.translate("Insert"))}}),e.FE.DefineIcon("imageLink",{NAME:"link"}),e.FE.RegisterCommand("imageLink",{title:"Insert Link",undo:!1,focus:!1,popup:!0,callback:function(){this.link.imageLink()},refresh:function(e){var t;this.link.get()?((t=e.prev()).hasClass("fr-separator")&&t.removeClass("fr-hidden"),e.addClass("fr-hidden")):((t=e.prev()).hasClass("fr-separator")&&t.addClass("fr-hidden"),e.removeClass("fr-hidden"))}}),e.FE.DefineIcon("linkStyle",{NAME:"magic"}),e.FE.RegisterCommand("linkStyle",{title:"Style",type:"dropdown",html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.linkStyles;for(var n in t)t.hasOwnProperty(n)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="linkStyle" data-param1="'+n+'">'+this.language.translate(t[n])+"</a></li>");return e+="</ul>"},callback:function(e,t){this.link.applyStyle(t)},refreshOnShow:function(t,n){var i=this.link.get();if(i){var r=e(i);n.find(".fr-command").each(function(){var t=e(this).data("param1"),n=r.hasClass(t);e(this).toggleClass("fr-active",n).attr("aria-selected",n)})}}}),e.FE.RegisterCommand("updateLinkTargetSelf",{undo:!1,focus:!1,callback:function(e,t){this.popups.get("link.insert").find('input[name="target"].fr-link-attr[type="checkbox"]').prop("checked",!1)}}),e.FE.RegisterCommand("updateLinkTargetBlank",{undo:!1,focus:!1,callback:function(e,t){this.popups.get("link.insert").find('input[name="target_self"].fr-link-attr[type="checkbox"]').prop("checked",!1)}})});