!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.POPUP_TEMPLATES,{"cellColor.picker":"[_BUTTONS_][_COLORS_]"}),a.extend(a.FE.DEFAULTS,{colorsBackground:["#61BD6D","#1ABC9C","#54ACD2","#2C82C9","#9365B8","#475577","#CCCCCC","#41A85F","#00A885","#3D8EB9","#2969B0","#553982","#28324E","#000000","#F7DA64","#FBA026","#EB6B56","#E25041","#A38F84","#EFEFEF","#FFFFFF","#FAC51C","#F37934","#D14841","#B8312F","#7C706B","#D1D5D8","REMOVE"],colorsStep:7,cellColorsDefaultTab:"background",colorsButtons:["colorsBack","|","-"],defaultCellColors:{background:{init:!1,color:""},text:{init:!1,color:""}},isIE:document.documentMode||/Edge/.test(navigator.userAgent),isButton:!1}),a.FE.PLUGINS.tableCellColors=function(a){function b(){var b=a.$tb.find('.fr-command[data-cmd="color"]'),c=a.popups.get("cellColor.picker");if(c||(c=d()),!c.hasClass("fr-active")){a.popups.setContainer("cellColor.picker",a.$tb),g(c.find(".fr-selected-tab").attr("data-param1"));var e=b.offset().left+b.outerWidth()/2,f=b.offset().top+(a.opts.toolbarBottom?10:b.outerHeight()-10);a.popups.show("cellColor.picker",e,f,b.outerHeight()),a.opts.isIE?($(".fr-popup").find(".sp-input").hide(),$(".fr-popup").find(".sp-palette-toggle").hide(),$(".fr-popup").find(".sp-picker-container").hide()):$(".sp-input").show(),h()}}function c(){a.popups.hide("cellColor.picker")}function d(){var b='<div class="fr-buttons fr-colors-buttons">';a.opts.toolbarInline&&a.opts.colorsButtons.length>0&&(b+=a.button.buildList(a.opts.colorsButtons)),b+="</div>";var c={buttons:b,colors:f("background")},d=a.popups.create("cellColor.picker",c);return d}function f(b){var c=a.opts.colorsBackground,d="clearCellBackgroundColor",e="bgColorSpectrum",f="toggleBgSpectrum",g="chooseBGColor",h='<div class="sp-container sp-light sp-alpha-enabled sp-clear-enabled sp-initial-disabled fr-color-set fr-'+b+"-color"+(a.opts.cellColorsDefaultTab==b||"text"!=a.opts.cellColorsDefaultTab&&"background"!=a.opts.cellColorsDefaultTab&&"text"==b?" fr-selected-set":"")+'">';h+='<div class="color-inner-row">';for(var i=0;i<c.length;i++)0!==i&&i%a.opts.colorsStep===0&&(h+="<br>"),h+="REMOVE"!=c[i]?'<span class="fr-command fr-select-color" style="background: '+c[i]+';" data-cmd="cellBackgroundColor" data-param1="'+c[i]+'"></span>':a.opts.isIE?'<span class="fr-command fr-select-color" data-cmd="cellBackgroundColor" data-param1="REMOVE" title="'+a.language.translate("Clear Formatting")+'"><i class="fa fa-eraser"></i></span>':'<span style="visibility: hidden;" class="fr-command fr-select-color" data-cmd="cellBackgroundColor" data-param1="REMOVE" title="'+a.language.translate("Clear Formatting")+'"><i class="fa fa-eraser"></i></span>';return h+='<div class="sp-palette-button-container sp-cf"><button type="button" class="sp-palette-toggle fr-command" data-cmd="'+f+'">less</button></div>',h+="</div>",h+='<div class="sp-picker-container"><div class="sp-top sp-cf"><div class="sp-fill"></div><div class="sp-top-inner"><div class="sp-color fr-command" data-cmd="'+e+'" style="background-color: rgb(255, 0, 0);"><div class="sp-sat"><div class="sp-val"><div class="sp-dragger" style="display: none;"></div></div></div></div><div class="sp-clear sp-clear-display fr-command" data-cmd="'+d+'" title="Clear Color Selection"></div><div class="sp-hue"><div class="sp-slider" style="display: none;"></div></div></div><div class="sp-alpha"><div class="sp-alpha-inner"><div class="sp-alpha-handle" style="display: none;"></div></div></div></div><div class="sp-input-container sp-cf"><input style="display:none;" class="sp-input" type="text" spellcheck="false" placeholder=""></div><div class="sp-initial sp-thumb sp-cf"></div><div class="sp-button-container sp-cf"><a class="sp-cancel fr-command" data-cmd="cancelColor" href="#">cancel</a><button type="button" class="sp-choose fr-command" data-cmd="'+g+'">choose</button></div></div>',h+="</div>"}function g(b){var f,c=a.popups.get("cellColor.picker");a.$el.find(".fr-selected-cell:first"),$(a.selection.element());f="background-color",c.find(".fr-selected-color").removeClass("fr-selected-color");var g=a.$el.find(".fr-selected-cell").css("background-color");setTimeout(function(){o(f,g)},0)}function h(){a.opts.defaultCellColors.background.color=a.$el.find(".fr-selected-cell").css("background-color")}function i(a,b){a.hasClass("fr-selected-tab")||(a.siblings().removeClass("fr-selected-tab"),a.addClass("fr-selected-tab"),a.parents(".fr-popup").find(".fr-color-set").removeClass("fr-selected-set"),a.parents(".fr-popup").find(".fr-color-set.fr-"+b+"-color").addClass("fr-selected-set"),g(b))}function j(b,c){var d=a.popups.get("cellColor.picker");if("REMOVE"!=b){d.find("input.sp-input").val(b);var e=a.helpers.RGBToHex(b);e||a.helpers.RGBToHex("#"+b)&&(e=a.helpers.RGBToHex("#"+b),b="#"+b),a.$el.find(".fr-selected-cell").css("background-color",b),$(".fr-command.fr-select-color[data-cmd='cellBackgroundColor']").removeClass("fr-selected-color"),$(".fr-command.fr-select-color[data-cmd='cellBackgroundColor'][data-param1='"+e+"']").addClass("fr-selected-color")}else d.find("input.sp-input").val(""),a.$el.find(".fr-selected-cell").css("background-color",""),$(".fr-command.fr-select-color[data-cmd='cellBackgroundColor']").removeClass("fr-selected-color");c&&o("background-color",b)}function k(b,c){var d=a.popups.get("cellColor.picker");d.find("input.sp-input").val(""),setTimeout(function(){a.$el.find(".fr-selected-cell").css("background-color",""),l()})}function l(b){b&&j(a.opts.defaultCellColors.background.color||"REMOVE"),c()}function m(b){var d=a.popups.get("cellColor.picker"),e="text"===b?d.find(".fr-color-set.sp-container.fr-text-color"):d.find(".fr-color-set.sp-container.fr-background-color"),f=e.find(".sp-input"),g=f.val();j(g||"REMOVE"),c()}function n(b){var c=a.popups.get("cellColor.picker"),d="text"===b?c.find(".fr-color-set.sp-container.fr-text-color"):$(".fr-color-set.sp-container.fr-background-color"),e=d.find(".sp-picker-container"),f=d.find(".sp-palette-toggle");e.toggle();var g=e.is(":visible");g?(f.text("less"),d.removeClass("no-spectrum")):(f.text("more"),d.addClass("no-spectrum"))}function o(b,c){function G(){(n<=0||m<=0||s<=0)&&J(),A=!0,e.addClass(x),y=null}function H(){A=!1,e.removeClass(x)}function I(){K(b)}function J(){N()}function K(b,c){if(N(),!z){var d=tinycolor.fromRatio({h:B,s:1,v:1});i.css("background-color",d.toHexString());var e=L();if(e){var f=e.toHexString(),g=e.toRgbString();c||j(g);var h=e.toRgb();h.a=0;var k=tinycolor(h).toRgbString(),l="linear-gradient(left, "+k+", "+f+")";a.opts.isIE?w.css("filter",tinycolor(k).toFilter({gradientType:1},f)):(w.css("background","-webkit-"+l),w.css("background","-moz-"+l),w.css("background","-ms-"+l),w.css("background","linear-gradient(to right, "+k+", "+f+")"))}}}function L(a){return tinycolor.fromRatio({h:B,s:C,v:D,a:Math.round(100*E)/100},{format:"rgb"})}function M(a,c){if(tinycolor.equals(a,L()))return void K(b,c);var d,e;a?(z=!1,d=tinycolor(a),e=d.toHsv(),B=e.h%360/360,C=e.s,D=e.v,E=e.a):z=!0,K(b,c)}function N(){var a=C,b=D;if(z)h.hide(),g.hide(),f.hide();else{h.show(),g.show(),f.show();var c=a*m,d=n-b*n;c=Math.max(-o,Math.min(m-o,c-o)),d=Math.max(-o,Math.min(n-o,d-o)),f.css({top:d+"px",left:c+"px"});var e=E*u;h.css({left:e-v/2+"px"});var i=B*s;g.css({top:i-t+"px"})}}var d=a.popups.get("cellColor.picker");a.popups.isVisible("cellColor.picker")||a.tableCellColors.showCellColorsPopup(),d.find("input:focus").blur();var e="color"===b?d.find(".fr-color-set.sp-container.fr-text-color"):d.find(".fr-color-set.sp-container.fr-background-color"),f=e.find(".sp-dragger"),g=e.find(".sp-slider"),h=e.find(".sp-alpha-handle"),i=e.find(".sp-color"),k=e.find(".sp-hue"),l=e.find(".sp-alpha"),m=i.width(),n=i.height(),o=f.height(),s=(k.width(),k.height()),t=g.height(),u=l.width(),v=h.width(),w=e.find(".sp-alpha-inner"),x="sp-dragging",y=null,z=!0,A=!1,B=0,C=0,D=0,E=1,F=e.find(".sp-input");q(F,b),r(l,function(a,b,c){E=a/u,z=!1,c.shiftKey&&(E=Math.round(10*E)/10),I()},G,H),r(k,function(a,b){B=parseFloat(b/s),z=!1,I()},G,H),r(i,function(a,b,c){C=parseFloat(a/m),D=parseFloat((n-b)/n),z=!1,I()},G,H),c?(M(c,!0),I()):(z=!0,I())}function p(){var b=a.link.get();b?a.link.back():(a.popups.hide("cellColor.picker"),a.toolbar.showInline())}function q(a,b){$(a).off("keypress").on("keypress",function(b){if(13==b.which){var d=$(a).val();j(d,!0),c()}})}function r(b,c,d,e){function m(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.returnValue=!1}function n(d){if(a.events.disableBlur(),g){if(a.opts.isIE&&f.documentMode<9&&!d.button)return p();var e=d.originalEvent&&d.originalEvent.touches&&d.originalEvent.touches[0],l=e&&e.pageX||d.pageX,n=e&&e.pageY||d.pageY,o=Math.max(0,Math.min(l-h.left,j)),q=Math.max(0,Math.min(n-h.top,i));k&&m(d),c.apply(b,[o,q,d])}}function o(c){var e=c.which?3==c.which:2==c.button;if(!e&&!g&&d.apply(b,arguments)!==!1){g=!0,i=$(b).height(),j=$(b).width(),h=$(b).offset(),$(f).bind(l),$(f.body).addClass("sp-dragging"),n(c);var k=a.popups.get("cellColor.picker");k.find("input").addClass("disabled"),m(c)}}function p(){if(g){var c=a.popups.get("cellColor.picker");c.find("input").removeClass("disabled"),$(f).unbind(l),$(f.body).removeClass("sp-dragging"),setTimeout(function(){e.apply(b,arguments)},0)}g=!1}c=c||function(){},d=d||function(){},e=e||function(){};var f=document,g=!1,h={},i=0,j=0,k="ontouchstart"in window,l={};l.selectstart=m,l.dragstart=m,l["touchmove mousemove"]=n,l["touchend mouseup"]=p,$(b).off("touchstart mousedown").on("touchstart mousedown",o),$(b).off("touchend mouseup mouseleave").on("touchend mouseup",p),$(f).bind("click",p)}return{showCellColorsPopup:b,hideCellColorsPopup:c,changeCellSet:i,background:j,back:p,removeCellColor:k,chooseCellColorPicker:m,closeCellColorPicker:l,initializeCellSpectrum:o,toggleCellSpectrum:n}},a.FE.DefineIcon("tableCellColors",{NAME:"tint"}),a.FE.RegisterCommand("tableCellColors",{title:"Cell Background",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("cellColor.picker")||this.tableCellColors.showCellColorsPopup()},plugin:"tableCellColors"}),a.FE.RegisterCommand("cellBackgroundColor",{undo:!0,callback:function(a,b){this.tableCellColors.background(b,!0)}}),a.FE.RegisterCommand("colorChangeCellSet",{undo:!1,focus:!1,callback:function(a,b){var c=this.popups.get("cellColor.picker").find('.fr-command[data-cmd="'+a+'"][data-param1="'+b+'"]');this.tableCellColors.changeCellSet(c,b)}}),a.FE.RegisterCommand("clearCellBackgroundColor",{undo:!1,focus:!1,callback:function(a,b){this.tableCellColors.removeCellColor("background",b)}}),a.FE.RegisterCommand("chooseBGColor",{undo:!1,focus:!1,callback:function(a,b){this.tableCellColors.chooseCellColorPicker("background")}}),a.FE.RegisterCommand("cancelColor",{undo:!1,focus:!1,callback:function(a,b){this.tableCellColors.closeCellColorPicker(!0)}}),a.FE.RegisterCommand("bgColorSpectrum",{undo:!0,focus:!1,callback:function(a){this.tableCellColors.initializeCellSpectrum("background",!0)}}),a.FE.DefineIcon("colorsBack",{NAME:"arrow-left"}),a.FE.RegisterCommand("colorsBack",{title:"Back",undo:!1,focus:!1,back:!0,refreshAfterCallback:!1,callback:function(){this.tableCellColors.back()}})});