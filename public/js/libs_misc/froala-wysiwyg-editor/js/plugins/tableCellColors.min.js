!function(o){"function"==typeof define&&define.amd?define(["jquery"],o):"object"==typeof module&&module.exports?module.exports=function(e,l){return void 0===l&&(l="undefined"!=typeof window?require("jquery"):require("jquery")(e)),o(l),l}:o(jQuery)}(function(o){"use strict";o.extend(o.FE.POPUP_TEMPLATES,{"cellColor.picker":"[_BUTTONS_][_COLORS_]"}),o.extend(o.FE.DEFAULTS,{colorsBackground:["#61BD6D","#1ABC9C","#54ACD2","#2C82C9","#9365B8","#475577","#CCCCCC","#41A85F","#00A885","#3D8EB9","#2969B0","#553982","#28324E","#000000","#F7DA64","#FBA026","#EB6B56","#E25041","#A38F84","#EFEFEF","#FFFFFF","#FAC51C","#F37934","#D14841","#B8312F","#7C706B","#D1D5D8","REMOVE"],colorsStep:7,cellColorsDefaultTab:"background",cellColorsButtons:["colorsBackCell","|","-"],defaultCellColors:{background:{init:!1,color:""},text:{init:!1,color:""}},isIE:document.documentMode||/Edge/.test(navigator.userAgent),isButton:!1}),o.FE.PLUGINS.tableCellColors=function(o){function e(){o.popups.hide("cellColor.picker")}function l(){var e='<div class="fr-buttons fr-colors-buttons">';o.opts.toolbarInline&&o.opts.cellColorsButtons.length>0&&(e+=o.button.buildList(o.opts.cellColorsButtons));var l={buttons:e+="</div>",colors:t("background")};return o.popups.create("cellColor.picker",l)}function t(e){var l=o.opts.colorsBackground,t='<div class="sp-container sp-light sp-alpha-enabled sp-clear-enabled sp-initial-disabled fr-color-set fr-'+e+"-color"+(o.opts.cellColorsDefaultTab==e||"text"!=o.opts.cellColorsDefaultTab&&"background"!=o.opts.cellColorsDefaultTab&&"text"==e?" fr-selected-set":"")+'">';t+='<div class="color-inner-row">';for(var r=0;r<l.length;r++)0!==r&&r%o.opts.colorsStep==0&&(t+="<br>"),"REMOVE"!=l[r]?t+='<span class="fr-command fr-select-color" style="background: '+l[r]+';" data-cmd="cellBackgroundColor" data-param1="'+l[r]+'"></span>':o.opts.isIE?t+='<span class="fr-command fr-select-color" data-cmd="cellBackgroundColor" data-param1="REMOVE" title="'+o.language.translate("Clear Formatting")+'"><i class="fa fa-eraser"></i></span>':t+='<span style="visibility: hidden;" class="fr-command fr-select-color" data-cmd="cellBackgroundColor" data-param1="REMOVE" title="'+o.language.translate("Clear Formatting")+'"><i class="fa fa-eraser"></i></span>';return t+='<div class="sp-palette-button-container sp-cf"><button type="button" class="sp-palette-toggle fr-command" data-cmd="toggleBgSpectrum">less</button></div>',t+="</div>",t+='<div class="sp-picker-container"><div class="sp-top sp-cf"><div class="sp-fill"></div><div class="sp-top-inner"><div class="sp-color fr-command" data-cmd="bgColorSpectrum" style="background-color: rgb(255, 0, 0);"><div class="sp-sat"><div class="sp-val"><div class="sp-dragger" style="display: none;"></div></div></div></div><div class="sp-clear sp-clear-display fr-command" data-cmd="clearCellBackgroundColor" title="Clear Color Selection"></div><div class="sp-hue"><div class="sp-slider" style="display: none;"></div></div></div><div class="sp-alpha"><div class="sp-alpha-inner"><div class="sp-alpha-handle" style="display: none;"></div></div></div></div><div class="sp-input-container sp-cf"><input style="display:none;" class="sp-input" type="text" spellcheck="false" placeholder=""></div><div class="sp-initial sp-thumb sp-cf"></div><div class="sp-button-container sp-cf"><a class="sp-cancel fr-command" data-cmd="cancelColor" href="#">cancel</a><button type="button" class="sp-choose fr-command" data-cmd="chooseCellBGColor">choose</button></div></div>',t+="</div>"}function r(e){var l=o.popups.get("cellColor.picker");o.$el.find(".fr-selected-cell:first"),$(o.selection.element());l.find(".fr-selected-color").removeClass("fr-selected-color");var t=o.$el.find(".fr-selected-cell").css("background-color");setTimeout(function(){i("background-color",t)},0)}function s(){o.opts.defaultCellColors.background.color=o.$el.find(".fr-selected-cell").css("background-color")}function c(e,l,t){var r=o.popups.get("cellColor.picker");if(o.popups.show("cellColor.picker"),"REMOVE"!=e){r.find("input.sp-input").val(e);var s=o.helpers.RGBToHex(e);s||o.helpers.RGBToHex("#"+e)&&(s=o.helpers.RGBToHex("#"+e),e="#"+e),o.$el.find(".fr-selected-cell").css("background-color",e),$(".fr-command.fr-select-color[data-cmd='cellBackgroundColor']").removeClass("fr-selected-color"),$(".fr-command.fr-select-color[data-cmd='cellBackgroundColor'][data-param1='"+s+"']").addClass("fr-selected-color")}else r.find("input.sp-input").val(""),o.$el.find(".fr-selected-cell").css("background-color",""),$(".fr-command.fr-select-color[data-cmd='cellBackgroundColor']").removeClass("fr-selected-color");l&&i("background-color",e),t&&n()}function n(){setTimeout(function(){o.popups.show("cellColor.picker")},0)}function a(l){l&&c(o.opts.defaultCellColors.background.color||"REMOVE",!1,!1),e()}function i(e,l){function t(){(B<=0||E<=0||F<=0)&&n(),D=!0,C.addClass(M),S=null}function r(){D=!1,C.removeClass(M)}function s(){a(e)}function n(){u()}function a(e,l){if(u(),!T){var t=tinycolor.fromRatio({h:P,s:1,v:1});b.css("background-color",t.toHexString());var r=i();if(r){var s=r.toHexString(),n=r.toRgbString();l||c(n,!1,!1);var a=r.toRgb();a.a=0;var d=tinycolor(a).toRgbString(),p="linear-gradient(left, "+d+", "+s+")";o.opts.isIE?R.css("filter",tinycolor(d).toFilter({gradientType:1},s)):(R.css("background","-webkit-"+p),R.css("background","-moz-"+p),R.css("background","-ms-"+p),R.css("background","linear-gradient(to right, "+d+", "+s+")"))}}}function i(o){return tinycolor.fromRatio({h:P,s:A,v:O,a:Math.round(100*I)/100},{format:"rgb"})}function u(){var o=A,e=O;if(T)h.hide(),m.hide(),g.hide();else{h.show(),m.show(),g.show();var l=o*E,t=B-e*B;l=Math.max(-y,Math.min(E-y,l-y)),t=Math.max(-y,Math.min(B-y,t-y)),g.css({top:t+"px",left:l+"px"});var r=I*w;h.css({left:r-x/2+"px"});var s=P*F;m.css({top:s-$+"px"})}}var f=o.popups.get("cellColor.picker");o.popups.isVisible("cellColor.picker")||o.tableCellColors.showCellColorsPopup(),f.find("input:focus").blur();var C="color"===e?f.find(".fr-color-set.sp-container.fr-text-color"):f.find(".fr-color-set.sp-container.fr-background-color"),g=C.find(".sp-dragger"),m=C.find(".sp-slider"),h=C.find(".sp-alpha-handle"),b=C.find(".sp-color"),v=C.find(".sp-hue"),k=C.find(".sp-alpha"),E=b.width(),B=b.height(),y=g.height(),F=(v.width(),v.height()),$=m.height(),w=k.width(),x=h.width(),R=C.find(".sp-alpha-inner"),M="sp-dragging",S=null,T=!0,D=!1,P=0,A=0,O=0,I=1;d(C.find(".sp-input"),e),p(k,function(e,l,t){I=e/w,T=!1,t.shiftKey&&(I=Math.round(10*I)/10),s(),setTimeout(function(){o.events.trigger("contentChanged")})},t,r),p(v,function(e,l){P=parseFloat(l/F),T=!1,s(),setTimeout(function(){o.events.trigger("contentChanged")})},t,r),p(b,function(e,l,t){A=parseFloat(e/E),O=parseFloat((B-l)/B),T=!1,s(),setTimeout(function(){o.events.trigger("contentChanged")})},t,r),l?(!function(o,l){if(tinycolor.equals(o,i()))a(e,l);else{var t;o?(T=!1,t=tinycolor(o).toHsv(),P=t.h%360/360,A=t.s,O=t.v,I=t.a):T=!0,a(e,l)}}(l,!0),s()):(T=!0,s())}function d(o,l){$(o).off("keypress").on("keypress",function(l){13==l.which&&(c($(o).val(),!0,!1),e())})}function p(e,l,t,r){function s(o){o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault(),o.returnValue=!1}function c(t){if(o.events.disableBlur(),i){if(o.opts.isIE&&a.documentMode<9&&!t.button)return n();var r=t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches[0],c=r&&r.pageX||t.pageX,C=r&&r.pageY||t.pageY,g=Math.max(0,Math.min(c-d.left,u)),m=Math.max(0,Math.min(C-d.top,p));f&&s(t),l.apply(e,[g,m,t])}}function n(){i&&(o.popups.get("cellColor.picker").find("input").removeClass("disabled"),$(a).unbind(C),$(a.body).removeClass("sp-dragging"),setTimeout(function(){r.apply(e,arguments)},0)),i=!1}l=l||function(){},t=t||function(){},r=r||function(){};var a=document,i=!1,d={},p=0,u=0,f="ontouchstart"in window,C={};C.selectstart=s,C.dragstart=s,C["touchmove mousemove"]=c,C["touchend mouseup"]=n,$(e).off("touchstart mousedown").on("touchstart mousedown",function(l){(l.which?3==l.which:2==l.button)||i||!1!==t.apply(e,arguments)&&(i=!0,p=$(e).height(),u=$(e).width(),d=$(e).offset(),$(a).bind(C),$(a.body).addClass("sp-dragging"),c(l),o.popups.get("cellColor.picker").find("input").addClass("disabled"),s(l))}),$(e).off("touchend mouseup mouseleave").on("touchend mouseup",n),$(a).bind("click",n)}return{showCellColorsPopup:function(){var e=o.$tb.find('.fr-command[data-cmd="color"]'),t=o.popups.get("cellColor.picker");if(t||(t=l()),!t.hasClass("fr-active")){o.popups.setContainer("cellColor.picker",o.$tb),r(t.find(".fr-selected-tab").attr("data-param1"));var c=e.offset().left+e.outerWidth()/2,n=e.offset().top+(o.opts.toolbarBottom?10:e.outerHeight()-10);o.popups.show("cellColor.picker",c,n,e.outerHeight()),o.opts.isIE?($(".fr-popup").find(".sp-input").hide(),$(".fr-popup").find(".sp-palette-toggle").hide(),$(".fr-popup").find(".sp-picker-container").hide()):$(".sp-input").show(),s()}},hideCellColorsPopup:e,changeCellSet:function(o,e){o.hasClass("fr-selected-tab")||(o.siblings().removeClass("fr-selected-tab"),o.addClass("fr-selected-tab"),o.parents(".fr-popup").find(".fr-color-set").removeClass("fr-selected-set"),o.parents(".fr-popup").find(".fr-color-set.fr-"+e+"-color").addClass("fr-selected-set"),r(e))},backgroundCellColor:c,colorsBackCell:function(){o.link.get()?o.link.back():(o.popups.hide("cellColor.picker"),o.toolbar.showInline())},removeCellColor:function(e,l){o.popups.get("cellColor.picker").find("input.sp-input").val(""),setTimeout(function(){o.$el.find(".fr-selected-cell").css("background-color",""),a()})},chooseCellColorPicker:function(l){var t=o.popups.get("cellColor.picker");c(("text"===l?t.find(".fr-color-set.sp-container.fr-text-color"):t.find(".fr-color-set.sp-container.fr-background-color")).find(".sp-input").val()||"REMOVE",!1,!1),e()},closeCellColorPicker:a,initializeCellSpectrum:i,toggleCellSpectrum:function(e){var l=o.popups.get("cellColor.picker"),t="text"===e?l.find(".fr-color-set.sp-container.fr-text-color"):$(".fr-color-set.sp-container.fr-background-color"),r=t.find(".sp-picker-container"),s=t.find(".sp-palette-toggle");r.toggle(),r.is(":visible")?(s.text("less"),t.removeClass("no-spectrum")):(s.text("more"),t.addClass("no-spectrum"))}}},o.FE.DefineIcon("tableCellColors",{NAME:"tint"}),o.FE.RegisterCommand("tableCellColors",{title:"Cell Background",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("cellColor.picker")||this.tableCellColors.showCellColorsPopup()},plugin:"tableCellColors"}),o.FE.RegisterCommand("cellBackgroundColor",{undo:!0,callback:function(o,e){this.tableCellColors.backgroundCellColor(e,!0,!0)}}),o.FE.RegisterCommand("colorChangeCellSet",{undo:!1,focus:!1,callback:function(o,e){var l=this.popups.get("cellColor.picker").find('.fr-command[data-cmd="'+o+'"][data-param1="'+e+'"]');this.tableCellColors.changeCellSet(l,e)}}),o.FE.RegisterCommand("clearCellBackgroundColor",{undo:!1,focus:!1,callback:function(o,e){this.tableCellColors.removeCellColor("background",e)}}),o.FE.RegisterCommand("chooseCellBGColor",{undo:!1,focus:!1,callback:function(o,e){this.tableCellColors.chooseCellColorPicker("background")}}),o.FE.RegisterCommand("cancelColor",{undo:!1,focus:!1,callback:function(o,e){this.tableCellColors.closeCellColorPicker(!0)}}),o.FE.RegisterCommand("bgColorSpectrum",{undo:!0,focus:!1,callback:function(o){this.tableCellColors.initializeCellSpectrum("background",!0)}}),o.FE.DefineIcon("colorsBackCell",{NAME:"arrow-left"}),o.FE.RegisterCommand("colorsBackCell",{title:"Back",undo:!1,focus:!1,back:!0,refreshAfterCallback:!1,callback:function(){this.tableCellColors.colorsBackCell()}})});