!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){a.extend(a.FE.POPUP_TEMPLATES,{"video.insert":"[_BUTTONS_][_BY_URL_LAYER_][_EMBED_LAYER_][_UPLOAD_LAYER_][_MEDIA_LAYER_][_PROGRESS_BAR_]","video.edit":"[_BUTTONS_]","video.size":"[_BUTTONS_][_SIZE_LAYER_]"}),a.extend(a.FE.DEFAULTS,{videoAllowedTypes:["mp4","webm","ogg"],videoDefaultAlign:"center",videoDefaultDisplay:"block",videoDefaultWidth:600,videoEditButtons:["videoReplace","videoRemove","|","videoDisplay","videoAlign","videoSize"],videoInsertButtons:["videoBack","|","videoByURL","videoEmbed","videoUpload"],videoMaxSize:52428800,videoMove:!0,videoResize:!0,videoSizeButtons:["videoBack","|"],videoSplitHTML:!1,videoTextNear:!0,videoUploadMethod:"POST",videoUploadParam:"file",videoUploadParams:{},videoUploadToS3:!1,videoUploadURL:"https://i.froala.com/upload"}),a.FE.VIDEO_PROVIDERS=[{test_regex:/^.*((youtu.be)|(youtube.com))\/((v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))?\??v?=?([^#\&\?]*).*/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:m\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/)?([0-9a-zA-Z_\-]+)(.+)?/g,url_text:"//www.youtube.com/embed/$1",html:'<iframe width="640" height="360" src="{url}?wmode=opaque" frameborder="0" allowfullscreen></iframe>',html_non_autoplay:'<iframe width="640" height="360" src="{url}?wmode=opaquerel=0" frameborder="0" allowfullscreen></iframe>'},{test_regex:/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:vimeo\.com)\/(?:channels\/[A-z]+\/|groups\/[A-z]+\/videos\/)?(.+)/g,url_text:"//player.vimeo.com/video/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>'},{test_regex:/^.+(dailymotion.com|dai.ly)\/(video|hub)?\/?([^_]+)[^#]*(#video=([^_&]+))?/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:dailymotion\.com|dai\.ly)\/(?:video|hub)?\/?(.+)/g,url_text:"//www.dailymotion.com/embed/video/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>'},{test_regex:/^.+(screen.yahoo.com)\/[^_&]+/,url_regex:"",url_text:"",html:'<iframe width="640" height="360" src="{url}?format=embed" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>'},{test_regex:/^.+(rutube.ru)\/[^_&]+/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:rutube\.ru)\/(?:video)?\/?(.+)/g,url_text:"//rutube.ru/play/embed/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>'}],a.FE.VIDEO_EMBED_REGEX=/^\W*((<iframe.*><\/iframe>)|(<embed.*>))\W*$/i,a.FE.PLUGINS.video=function(b){function o(){var a=b.popups.get("video.insert"),c=a.find(".fr-video-by-url-layer input");c.val("").trigger("change");var d=a.find(".fr-video-embed-layer textarea");d.val("").trigger("change"),d=a.find(".fr-video-upload-layer input"),d.val("").trigger("change")}function p(){var a=b.$tb.find('.fr-command[data-cmd="insertVideo"]'),c=b.popups.get("video.insert");if(c||(c=r()),B(),!c.hasClass("fr-active")){b.popups.refresh("video.insert"),b.popups.setContainer("video.insert",b.$tb);var d=a.offset().left+a.outerWidth()/2,e=a.offset().top+(b.opts.toolbarBottom?10:a.outerHeight()-10);b.popups.show("video.insert",d,e,a.outerHeight())}}function q(){var a=b.popups.get("video.edit");if(a||(a=ha()),a){b.popups.setContainer("video.edit",b.$sc),b.popups.refresh("video.edit");var c=f.find("iframe, embed, video"),d=c.offset().left+c.outerWidth()/2,e=c.offset().top+c.outerHeight();b.popups.show("video.edit",d,e,c.outerHeight())}}function r(a){if(a)return b.popups.onRefresh("video.insert",o),b.popups.onHide("image.insert",ua),!0;var c="";b.opts.videoInsertButtons.length>1&&(c='<div class="fr-buttons">'+b.button.buildList(b.opts.videoInsertButtons)+"</div>");var d="";b.opts.videoInsertButtons.indexOf("videoByURL")>=0&&(d='<div class="fr-video-by-url-layer fr-layer fr-active" id="fr-video-by-url-layer-'+b.id+'"><div class="fr-input-line"><input id="fr-video-by-url-layer-text-'+b.id+'" type="text" placeholder="http://" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoInsertByURL" tabIndex="2" role="button">'+b.language.translate("Insert")+"</button></div></div>");var e="";b.opts.videoInsertButtons.indexOf("videoEmbed")>=0&&(e='<div class="fr-video-embed-layer fr-layer" id="fr-video-embed-layer-'+b.id+'"><div class="fr-input-line"><textarea id="fr-video-embed-layer-text'+b.id+'" type="text" placeholder="'+b.language.translate("Embedded Code")+'" tabIndex="1" aria-required="true" rows="5"></textarea></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoInsertEmbed" tabIndex="2" role="button">'+b.language.translate("Insert")+"</button></div></div>");var f="";b.opts.videoInsertButtons.indexOf("videoUpload")>=0&&(f='<div class="fr-video-upload-layer fr-layer" id="fr-video-upload-layer-'+b.id+'"><strong>'+b.language.translate("Drop video")+"</strong><br>("+b.language.translate("or click")+')<div class="fr-form"><input type="file" accept="video/'+b.opts.videoAllowedTypes.join(", video/").toLowerCase()+'" tabIndex="-1" aria-labelledby="fr-video-upload-layer-'+b.id+'" role="button"></div></div>');var g="";b.opts.videoInsertButtons.indexOf("videoMediaManager")>=0&&(g='<div class="fr-video-upload-media-layer fr-layer" id="fr-video-upload-media-layer-'+b.id+'"><button type="button" class="fr-command fr-submit" data-cmd="insertVideoMedia"><i class="ti-upload"></i><span>Media Manager</span></button></div>');var h='<div class="fr-video-progress-bar-layer fr-layer"><h3 tabIndex="-1" class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-dismiss" data-cmd="videoDismissError" tabIndex="2" role="button">OK</button></div></div>',i={buttons:c,by_url_layer:d,embed_layer:e,upload_layer:f,media_layer:g,progress_bar:h},j=b.popups.create("video.insert",i);return ea(j),j}function s(a){var d,e,c=b.popups.get("video.insert");if(!f&&!b.opts.toolbarInline){var g=b.$tb.find('.fr-command[data-cmd="insertVideo"]');d=g.offset().left+g.outerWidth()/2,e=g.offset().top+(b.opts.toolbarBottom?10:g.outerHeight()-10)}b.opts.toolbarInline&&(e=c.offset().top-b.helpers.getPX(c.css("margin-top")),c.hasClass("fr-above")&&(e+=c.outerHeight())),c.find(".fr-layer").removeClass("fr-active"),c.find(".fr-"+a+"-layer").addClass("fr-active"),b.popups.show("video.insert",d,e,0),b.accessibility.focusPopup(c)}function t(a){var c=b.popups.get("video.insert");c.find(".fr-video-by-url-layer").hasClass("fr-active")&&a.addClass("fr-active").attr("aria-pressed",!0)}function u(a){var c=b.popups.get("video.insert");c.find(".fr-video-embed-layer").hasClass("fr-active")&&a.addClass("fr-active").attr("aria-pressed",!0)}function v(a){var c=b.popups.get("video.insert");c.find(".fr-video-upload-layer").hasClass("fr-active")&&a.addClass("fr-active").attr("aria-pressed",!0)}function w(a){var c=b.popups.get("video.insert");c.find(".fr-video-upload-media-layer").hasClass("fr-active")&&a.addClass("fr-active")}function x(a){b.events.focus(!0),b.selection.restore();var c=!1;f&&(ta(),c=!0),b.html.insert('<span contenteditable="false" draggable="true" class="fr-jiv fr-video">'+a+"</span>",!1,b.opts.videoSplitHTML),b.popups.hide("video.insert");var d=b.$el.find(".fr-jiv");d.removeClass("fr-jiv"),va(d,b.opts.videoDefaultDisplay,b.opts.videoDefaultAlign),d.toggleClass("fr-draggable",b.opts.videoMove),b.events.trigger(c?"video.replaced":"video.inserted",[d])}function y(){var c=a(this);b.popups.hide("video.insert"),c.removeClass("fr-uploading"),c.parent().next().is("br")&&c.parent().next().remove(),H(c.parent()),b.events.trigger("video.loaded",[c.parent()])}function z(a,c,d,e,f){b.edit.off(),C("Loading video"),c&&(a=b.helpers.sanitizeURL(a));var h=document.createElement("video");h.oncanplay=function(){var c,g;if(e){b.undo.canDo()||e.find("video").hasClass("fr-uploading")||b.undo.saveStep();var h=e.find("video").data("fr-old-src"),i=e.data("fr-replaced");e.data("fr-replaced",!1),b.$wp?(c=e.clone(),c.find("video").removeData("fr-old-src").removeClass("fr-uploading"),c.find("video").off("canplay"),h&&e.find("video").attr("src",h),e.replaceWith(c)):c=e;for(var j=c.find("video").get(0).attributes,k=0;k<j.length;k++){var l=j[k];0===l.nodeName.indexOf("data-")&&c.find("video").removeAttr(l.nodeName)}if("undefined"!=typeof d)for(g in d)d.hasOwnProperty(g)&&"link"!=g&&c.find("video").attr("data-"+g,d[g]);c.find("video").on("canplay",y),c.find("video").attr("src",a),b.edit.on(),W(),b.undo.saveStep(),b.$el.blur(),b.events.trigger(i?"video.replaced":"video.inserted",[c,f])}},h.onerror=function(){ga(g)},A("Loading video"),h.src=a}function A(a){var c=b.popups.get("video.insert");if(c||(c=r()),c.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),c.find(".fr-video-progress-bar-layer").addClass("fr-active"),c.find(".fr-buttons").hide(),f){var d=f.find("video");b.popups.setContainer("video.insert",b.$sc);var e=d.offset().left+d.width()/2,g=d.offset().top+d.height();b.popups.show("video.insert",e,g,d.outerHeight())}"undefined"==typeof a&&C("Uploading",0)}function B(a){var c=b.popups.get("video.insert");if(c&&(c.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),c.find(".fr-video-progress-bar-layer").removeClass("fr-active"),c.find(".fr-buttons").show(),a||b.$el.find("video.fr-error").length)){if(b.events.focus(),b.$el.find("video.fr-error").length&&(b.$el.find("video.fr-error").parent().remove(),b.undo.saveStep(),b.undo.run(),b.undo.dropRedo()),!b.$wp&&f){var d=f;$(!0),b.selection.setAfter(d.find("video").get(0)),b.selection.restore()}b.popups.hide("video.insert")}}function C(a,c){var d=b.popups.get("video.insert");if(d){var e=d.find(".fr-video-progress-bar-layer");e.find("h3").text(a+(c?" "+c+"%":"")),e.removeClass("fr-error"),c?(e.find("div").removeClass("fr-indeterminate"),e.find("div > span").css("width",c+"%")):e.find("div").addClass("fr-indeterminate")}}function D(a){A();var c=b.popups.get("video.insert"),d=c.find(".fr-video-progress-bar-layer");d.addClass("fr-error");var e=d.find("h3");e.text(a),b.events.disableBlur(),e.focus()}function E(c){if("undefined"==typeof c){var d=b.popups.get("video.insert");c=d.find('.fr-video-by-url-layer input[type="text"]').val()||""}var e=null;if(b.helpers.isURL(c))for(var f=0;f<a.FE.VIDEO_PROVIDERS.length;f++){var g=a.FE.VIDEO_PROVIDERS[f];if(g.test_regex.test(c)){e=c.replace(g.url_regex,g.url_text),e=g.html.replace(/\{url\}/,e);break}}e?x(e):b.events.trigger("video.linkError",[c])}function F(a,c){f=c;var d=b.opts.videoDefaultWidth;d&&"auto"!=d&&(d+="px");var e='<video width="'+d+'" controls><source src="'+a+'"></video>';e?x(e):b.events.trigger("video.linkError",[a])}function G(c){if("undefined"==typeof c){var d=b.popups.get("video.insert");c=d.find(".fr-video-embed-layer textarea").val()||""}0!==c.length&&a.FE.VIDEO_EMBED_REGEX.test(c)?x(c):b.events.trigger("video.codeError",[c])}function H(a){Z.call(a.get(0))}function I(c){try{if(b.events.trigger("video.uploaded",[c],!0)===!1)return b.edit.on(),!1;var d=a.parseJSON(c);return d.link?d:(ga(h,c),!1)}catch(a){return ga(j,c),!1}}function J(c){try{var d=a(c).find("Location").text(),e=a(c).find("Key").text();return b.events.trigger("video.uploadedToS3",[d,e,c],!0)===!1?(b.edit.on(),!1):d}catch(a){return ga(j,c),!1}}function K(a){C("Loading video");var c=this.status,d=this.response,e=this.responseXML,f=this.responseText;try{if(b.opts.videoUploadToS3)if(201==c){var g=J(e);g&&z(g,!1,[],a,d||e)}else ga(j,d||e);else if(c>=200&&c<300){var h=I(f);h&&z(h.link,!1,h,a,d||f)}else ga(i,d||f)}catch(a){ga(j,d||f)}}function L(){ga(j,this.response||this.responseText||this.responseXML)}function M(a){if(a.lengthComputable){var b=a.loaded/a.total*100|0;C("Uploading",b)}}function N(){b.edit.on(),B(!0)}function O(c,d,e){var g,f="";if(d&&"undefined"!=typeof d)for(g in d)d.hasOwnProperty(g)&&"link"!=g&&(f+=" data-"+g+'="'+d[g]+'"');var h=b.opts.videoDefaultWidth;h&&"auto"!=h&&(h+="px");var i=a('<span contenteditable="false" draggable="true" class="fr-video fr-dv'+b.opts.videoDefaultDisplay[0]+("center"!=b.opts.videoDefaultAlign?" fr-fv"+b.opts.videoDefaultAlign[0]:"")+'"><video src="'+c+'" '+f+(h?' style="width: '+h+';"':"")+'" controls>'+b.language.translate("Your browser does not support HTML5 video.")+"</video></span>");i.toggleClass("fr-draggable",b.opts.videoMove),i.find("video").on("canplay",e),b.edit.on(),b.events.focus(!0),b.selection.restore(),b.undo.saveStep(),b.opts.videoSplitHTML?b.markers.split():b.markers.insert();var j=b.$el.find(".fr-marker");return j.replaceWith(i),b.html.wrap(),b.selection.clear(),i}function P(f){if(!b.core.sameInstance(e))return!0;f.preventDefault(),f.stopPropagation();var g=f.pageX||(f.originalEvent.touches?f.originalEvent.touches[0].pageX:null),h=f.pageY||(f.originalEvent.touches?f.originalEvent.touches[0].pageY:null);return!(!g||!h)&&(b.undo.canDo()||b.undo.saveStep(),d=a(this),d.data("start-x",g),d.data("start-y",h),c.show(),b.popups.hideAll(),void aa())}function Q(a){if(!b.core.sameInstance(e))return!0;if(d){a.preventDefault();var c=a.pageX||(a.originalEvent.touches?a.originalEvent.touches[0].pageX:null),g=a.pageY||(a.originalEvent.touches?a.originalEvent.touches[0].pageY:null);if(!c||!g)return!1;var h=d.data("start-x"),i=d.data("start-y");d.data("start-x",c),d.data("start-y",g);var j=c-h,k=g-i,l=f.find("iframe, embed, video"),m=l.width(),n=l.height();(d.hasClass("fr-hnw")||d.hasClass("fr-hsw"))&&(j=0-j),(d.hasClass("fr-hnw")||d.hasClass("fr-hne"))&&(k=0-k),l.css("width",m+j),l.css("height",n+k),l.removeAttr("width"),l.removeAttr("height"),X()}}function R(a){return!b.core.sameInstance(e)||void(d&&f&&(a&&a.stopPropagation(),d=null,c.hide(),X(),q(),b.undo.saveStep()))}function S(a){return'<div class="fr-handler fr-h'+a+'"></div>'}function T(a,b,c,d){return a.pageX=b,a.pageY=b,P.call(this,a),a.pageX=a.pageX+c*Math.floor(Math.pow(1.1,d)),a.pageY=a.pageY+c*Math.floor(Math.pow(1.1,d)),Q.call(this,a),R.call(this,a),++d}function U(){var d;if(b.shared.$video_resizer?(e=b.shared.$video_resizer,c=b.shared.$vid_overlay,b.events.on("destroy",function(){e.removeClass("fr-active").appendTo(a("body"))},!0)):(b.shared.$video_resizer=a('<div class="fr-video-resizer"></div>'),e=b.shared.$video_resizer,b.events.$on(e,"mousedown",function(a){a.stopPropagation()},!0),b.opts.videoResize&&(e.append(S("nw")+S("ne")+S("sw")+S("se")),b.shared.$vid_overlay=a('<div class="fr-video-overlay"></div>'),c=b.shared.$vid_overlay,d=e.get(0).ownerDocument,a(d).find("body").append(c))),b.events.on("shared.destroy",function(){e.html("").removeData().remove(),e=null,b.opts.videoResize&&(c.remove(),c=null)},!0),b.helpers.isMobile()||b.events.$on(a(b.o_win),"resize.video",function(){$(!0)}),b.opts.videoResize){d=e.get(0).ownerDocument,b.events.$on(e,b._mousedown,".fr-handler",P),b.events.$on(a(d),b._mousemove,Q),b.events.$on(a(d.defaultView||d.parentWindow),b._mouseup,R),b.events.$on(c,"mouseleave",R);var g=1,h=null,i=0;b.events.on("keydown",function(c){if(f){var d=navigator.userAgent.indexOf("Mac OS X")!=-1?c.metaKey:c.ctrlKey,e=c.which;(e!==h||c.timeStamp-i>200)&&(g=1),(e==a.FE.KEYCODE.EQUALS||b.browser.mozilla&&e==a.FE.KEYCODE.FF_EQUALS)&&d&&!c.altKey?g=T.call(this,c,1,1,g):(e==a.FE.KEYCODE.HYPHEN||b.browser.mozilla&&e==a.FE.KEYCODE.FF_HYPHEN)&&d&&!c.altKey&&(g=T.call(this,c,2,-1,g)),h=e,i=c.timeStamp}}),b.events.on("keyup",function(){g=1})}}function W(){var e,c=Array.prototype.slice.call(b.el.querySelectorAll("video")),d=[];for(e=0;e<c.length;e++)d.push(c[e].getAttribute("src")),a(c[e]).toggleClass("fr-draggable",b.opts.videoMove),""===c[e].getAttribute("class")&&c[e].removeAttribute("class"),""===c[e].getAttribute("style")&&c[e].removeAttribute("style");if(V)for(e=0;e<V.length;e++)d.indexOf(V[e].getAttribute("src"))<0&&b.events.trigger("video.removed",[a(V[e])]);V=c}function X(){e||U(),(b.$wp||b.$sc).append(e),e.data("instance",b);var a=f.find("iframe, embed, video");e.css("top",(b.opts.iframe?a.offset().top-1:a.offset().top-b.$wp.offset().top-1)+b.$wp.scrollTop()).css("left",(b.opts.iframe?a.offset().left-1:a.offset().left-b.$wp.offset().left-1)+b.$wp.scrollLeft()).css("width",a.outerWidth()).css("height",a.height()).addClass("fr-active")}function Z(c){if(c&&"touchend"==c.type&&Y)return!0;if(c&&b.edit.isDisabled())return c.stopPropagation(),c.preventDefault(),!1;if(b.edit.isDisabled())return!1;for(var d=0;d<a.FE.INSTANCES.length;d++)a.FE.INSTANCES[d]!=b&&a.FE.INSTANCES[d].events.trigger("video.hideResizer");b.toolbar.disable(),b.helpers.isMobile()&&(b.events.disableBlur(),b.$el.blur(),b.events.enableBlur()),f=a(this),a(this).addClass("fr-active"),b.opts.iframe&&b.size.syncIframe(),Aa(),X(),q(),b.selection.clear(),b.button.bulkRefresh(),b.events.trigger("image.hideResizer")}function $(a){f&&(ba()||a===!0)&&(e.removeClass("fr-active"),b.toolbar.enable(),f.removeClass("fr-active"),f=null,aa())}function _(){b.shared.vid_exit_flag=!0}function aa(){b.shared.vid_exit_flag=!1}function ba(){return b.shared.vid_exit_flag}function ca(c,d,e){function g(){var e=a(this);e.off("canplay"),e.addClass("fr-uploading"),e.parent().next().is("br")&&e.parent().next().remove(),b.placeholder.refresh(),e.parent().is(f)||H(e.parent()),X(),A(),b.edit.off(),c.onload=function(){K.call(c,e.parent())},c.onerror=L,c.upload.onprogress=M,c.onabort=N,e.off("abortUpload").on("abortUpload",function(){4!=c.readyState&&c.abort()}),c.send(d)}var i,h=new FileReader;h.addEventListener("load",function(){for(var a=h.result,c=atob(h.result.split(",")[1]),d=[],e=0;e<c.length;e++)d.push(c.charCodeAt(e));if(a=window.URL.createObjectURL(new Blob([new Uint8Array(d)],{type:"video/mp4"})),f){f.data("fr-replaced",!0);var j=f.find("video");j.length?(j.on("canplay",g),b.edit.on(),b.undo.saveStep(),j.data("fr-old-src",j.attr("src")),j.attr("src",a)):(ta(),i=O(a,null,g))}else i=O(a,null,g)},!1),h.readAsDataURL(e)}function da(a){if("undefined"!=typeof a&&a.length>0){if(b.events.trigger("video.beforeUpload",[a])===!1)return!1;var c=a[0];if(c.size>b.opts.videoMaxSize)return ga(k),!1;if(b.opts.videoAllowedTypes.indexOf(c.type.replace(/video\//g,""))<0)return ga(l),!1;var d;if(b.drag_support.formdata&&(d=b.drag_support.formdata?new FormData:null),d){var e;if(b.opts.videoUploadToS3!==!1){d.append("key",b.opts.videoUploadToS3.keyStart+(new Date).getTime()+"-"+(c.name||"untitled")),d.append("success_action_status","201"),d.append("X-Requested-With","xhr"),d.append("Content-Type",c.type);for(e in b.opts.videoUploadToS3.params)b.opts.videoUploadToS3.params.hasOwnProperty(e)&&d.append(e,b.opts.videoUploadToS3.params[e])}for(e in b.opts.videoUploadParams)b.opts.videoUploadParams.hasOwnProperty(e)&&d.append(e,b.opts.videoUploadParams[e]);d.append(b.opts.videoUploadParam,c);var f=b.opts.videoUploadURL;b.opts.videoUploadToS3&&(f=b.opts.videoUploadToS3.uploadURL?b.opts.videoUploadToS3.uploadURL:"https://"+b.opts.videoUploadToS3.region+".amazonaws.com/"+b.opts.videoUploadToS3.bucket);var g=b.core.getXHR(f,b.opts.videoUploadMethod);ca(g,d,c)}}}function ea(c){b.events.$on(c,"dragover dragenter",".fr-video-upload-layer",function(){return a(this).addClass("fr-drop"),!1}),b.events.$on(c,"dragleave dragend",".fr-video-upload-layer",function(){return a(this).removeClass("fr-drop"),!1}),b.events.$on(c,"drop",".fr-upload-upload-layer",function(d){d.preventDefault(),d.stopPropagation(),a(this).removeClass("fr-drop");var e=d.originalEvent.dataTransfer;if(e&&e.files){var f=c.data("instance")||b;f.events.disableBlur(),f.video.upload(e.files),f.events.enableBlur()}}),b.events.$on(c,"change",'.fr-video-upload-layer input[type="file"]',function(){if(this.files){var d=c.data("instance")||b;d.events.disableBlur(),c.find("input:focus").blur(),d.events.enableBlur(),d.video.upload(this.files)}a(this).val("")})}function fa(){b.events.on("mousedown window.mousedown",_),b.events.on("window.touchmove",aa),b.events.on("mouseup window.mouseup",$),b.events.on("commands.mousedown",function(a){a.parents(".fr-toolbar").length>0&&$()}),b.events.on("blur video.hideResizer commands.undo commands.redo element.dropped",function(){$(!0)})}function ga(a,c){b.edit.on(),f&&f.find("video").addClass("fr-error"),D(b.language.translate("Something went wrong. Please try again.")),b.events.trigger("video.error",[{code:a,message:n[a]},c])}function ha(){var a="";if(b.opts.videoEditButtons.length>0){a+='<div class="fr-buttons">',a+=b.button.buildList(b.opts.videoEditButtons),a+="</div>";var c={buttons:a},d=b.popups.create("video.edit",c);return b.events.$on(b.$wp,"scroll.video-edit",function(){f&&b.popups.isVisible("video.edit")&&(b.events.disableBlur(),H(f))}),d}return!1}function ia(){if(f){var a=b.popups.get("video.size"),c=f.find("iframe, embed, video");a.find('input[name="width"]').val(c.get(0).style.width||c.attr("width")).trigger("change"),a.find('input[name="height"]').val(c.get(0).style.height||c.attr("height")).trigger("change")}}function ja(){var a=b.popups.get("video.size");a||(a=ka()),B(),b.popups.refresh("video.size"),b.popups.setContainer("video.size",b.$sc);var c=f.find("iframe, embed, video"),d=c.offset().left+c.width()/2,e=c.offset().top+c.height();b.popups.show("video.size",d,e,c.height())}function ka(a){if(a)return b.popups.onRefresh("video.size",ia),!0;var c="";c='<div class="fr-buttons">'+b.button.buildList(b.opts.videoSizeButtons)+"</div>";var d="";d='<div class="fr-video-size-layer fr-layer fr-active" id="fr-video-size-layer-'+b.id+'"><div class="fr-video-group"><div class="fr-input-line"><input id="fr-video-size-layer-width-'+b.id+'" type="text" name="width" placeholder="'+b.language.translate("Width")+'" tabIndex="1"></div><div class="fr-input-line"><input id="fr-video-size-layer-height-'+b.id+'" type="text" name="height" placeholder="'+b.language.translate("Height")+'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoSetSize" tabIndex="2" role="button">'+b.language.translate("Update")+"</button></div></div>";var e={buttons:c,size_layer:d},g=b.popups.create("video.size",e);return b.events.$on(b.$wp,"scroll",function(){f&&b.popups.isVisible("video.size")&&(b.events.disableBlur(),H(f))}),g}function la(a){if("undefined"==typeof a&&(a=f),a){if(a.hasClass("fr-fvl"))return"left";if(a.hasClass("fr-fvr"))return"right";if(a.hasClass("fr-dvb")||a.hasClass("fr-dvi"))return"center";if("block"==a.css("display")){if("left"==a.css("text-algin"))return"left";if("right"==a.css("text-align"))return"right"}else{if("left"==a.css("float"))return"left";if("right"==a.css("float"))return"right"}}return"center"}function ma(a){f.removeClass("fr-fvr fr-fvl"),!b.opts.htmlUntouched&&b.opts.useClasses?"left"==a?f.addClass("fr-fvl"):"right"==a&&f.addClass("fr-fvr"):va(f,pa(),a),X(),q()}function na(a){return!!f&&void a.find("> *:first").replaceWith(b.icon.create("video-align-"+la()))}function oa(a,b){f&&b.find('.fr-command[data-param1="'+la()+'"]').addClass("fr-active").attr("aria-selected",!0)}function pa(a){"undefined"==typeof a&&(a=f);var b=a.css("float");return a.css("float","none"),"block"==a.css("display")?(a.css("float",""),a.css("float")!=b&&a.css("float",b),"block"):(a.css("float",""),a.css("float")!=b&&a.css("float",b),"inline")}function qa(a){f.removeClass("fr-dvi fr-dvb"),!b.opts.htmlUntouched&&b.opts.useClasses?"inline"==a?f.addClass("fr-dvi"):"block"==a&&f.addClass("fr-dvb"):va(f,a,la()),X(),q()}function ra(a,b){f&&b.find('.fr-command[data-param1="'+pa()+'"]').addClass("fr-active").attr("aria-selected",!0)}function sa(){var a=b.popups.get("video.insert");a||(a=r()),b.popups.isVisible("video.insert")||(B(),b.popups.refresh("video.insert"),b.popups.setContainer("video.insert",b.$sc));var c=f.offset().left+f.width()/2,d=f.offset().top+f.height();b.popups.show("video.insert",c,d,f.outerHeight())}function ta(){if(f&&b.events.trigger("video.beforeRemove",[f])!==!1){var a=f;b.popups.hideAll(),$(!0),b.selection.setBefore(a.get(0))||b.selection.setAfter(a.get(0)),a.remove(),b.selection.restore(),b.html.fillEmptyBlocks(),b.events.trigger("video.removed",[a])}}function ua(){B()}function va(a,c,d){!b.opts.htmlUntouched&&b.opts.useClasses?(a.removeClass("fr-fvl fr-fvr fr-dvb fr-dvi"),a.addClass("fr-fv"+d[0]+" fr-dv"+c[0])):"inline"==c?(a.css({display:"inline-block"}),"center"==d?a.css({float:"none"}):"left"==d?a.css({float:"left"}):a.css({float:"right"})):(a.css({display:"block",clear:"both"}),"left"==d?a.css({textAlign:"left"}):"right"==d?a.css({textAlign:"right"}):a.css({textAlign:"center"}))}function wa(a){a.hasClass("fr-dvi")||a.hasClass("fr-dvb")||(a.addClass("fr-fi"+la(a)[0]),a.addClass("fr-di"+pa(a)[0]))}function xa(a){var b=a.hasClass("fr-dvb")?"block":a.hasClass("fr-dvi")?"inline":null,c=a.hasClass("fr-fvl")?"left":a.hasClass("fr-fvr")?"right":la(a);va(a,b,c),a.removeClass("fr-dvb fr-dvi fr-fvr fr-fvl")}function ya(){b.$el.find("video").filter(function(){return 0===a(this).parents("span.fr-video").length}).wrap('<span class="fr-video" contenteditable="false"></span>'),b.$el.find("embed, iframe").filter(function(){if(b.browser.safari&&this.getAttribute("src")&&this.setAttribute("src",this.src),a(this).parents("span.fr-video").length>0)return!1;for(var c=a(this).attr("src"),d=0;d<a.FE.VIDEO_PROVIDERS.length;d++){var e=a.FE.VIDEO_PROVIDERS[d];if(e.test_regex.test(c))return!0}return!1}).map(function(){return 0===a(this).parents("object").length?this:a(this).parents("object").get(0)}).wrap('<span class="fr-video" contenteditable="false"></span>');for(var c=b.$el.find("span.fr-video, video"),d=0;d<c.length;d++){var e=a(c[d]);!b.opts.htmlUntouched&&b.opts.useClasses?(wa(e),b.opts.videoTextNear||e.removeClass("fr-dvi").addClass("fr-dvb")):b.opts.htmlUntouched||b.opts.useClasses||xa(e)}c.toggleClass("fr-draggable",b.opts.videoMove)}function za(){fa(),b.helpers.isMobile()&&(b.events.$on(b.$el,"touchstart","span.fr-video",function(){Y=!1}),b.events.$on(b.$el,"touchmove",function(){Y=!0})),b.events.on("html.set",ya),ya(),b.events.$on(b.$el,"mousedown","span.fr-video",function(a){a.stopPropagation()}),b.events.$on(b.$el,"click touchend","span.fr-video",Z),b.events.on("keydown",function(c){var d=c.which;return!f||d!=a.FE.KEYCODE.BACKSPACE&&d!=a.FE.KEYCODE.DELETE?f&&d==a.FE.KEYCODE.ESC?($(!0),c.preventDefault(),!1):f&&d!=a.FE.KEYCODE.F10&&!b.keys.isBrowserAction(c)?(c.preventDefault(),!1):void 0:(c.preventDefault(),ta(),!1)},!0),b.events.on("toolbar.esc",function(){if(f)return b.events.disableBlur(),b.events.focus(),!1},!0),b.events.on("toolbar.focusEditor",function(){if(f)return!1},!0),b.events.on("keydown",function(){b.$el.find("span.fr-video:empty").remove()}),r(!0),ka(!0)}function Aa(){if(f){b.selection.clear();var a=b.doc.createRange();a.selectNode(f.get(0));var c=b.selection.get();c.addRange(a)}}function Ba(){f?(b.events.disableBlur(),f.trigger("click")):(b.events.disableBlur(),b.selection.restore(),b.events.enableBlur(),b.popups.hide("video.insert"),b.toolbar.showInline())}function Ca(a,c){if(f){var d=b.popups.get("video.size"),e=f.find("iframe, embed, video");e.css("width",a||d.find('input[name="width"]').val()),e.css("height",c||d.find('input[name="height"]').val()),e.get(0).style.width&&e.removeAttr("width"),e.get(0).style.height&&e.removeAttr("height"),d.find("input:focus").blur(),setTimeout(function(){f.trigger("click")},b.helpers.isAndroid()?50:0)}}function Da(){return f}var c,d,e,f,g=1,h=2,i=3,j=4,k=5,l=6,m=7,n={};n[g]="Video cannot be loaded from the passed link.",n[h]="No link in upload response.",n[i]="Error during file upload.",n[j]="Parsing response failed.",n[k]="File is too large.",n[l]="Video file type is invalid.",n[m]="Files can be uploaded only to same domain in IE 8 and IE 9.";var V,Y;return b.shared.vid_exit_flag=!1,{_init:za,showInsertPopup:p,showLayer:s,refreshByURLButton:t,refreshEmbedButton:u,refreshUploadButton:v,refreshByMedia:w,upload:da,insertByURL:E,insertByMediaAsset:F,insertEmbed:G,insert:x,align:ma,refreshAlign:na,refreshAlignOnShow:oa,display:qa,refreshDisplayOnShow:ra,remove:ta,hideProgressBar:B,showSizePopup:ja,replace:sa,back:Ba,setSize:Ca,get:Da}},a.FE.RegisterCommand("insertVideo",{title:"Insert Video",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("video.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("video.insert")):this.video.showInsertPopup()},plugin:"video"}),a.FE.DefineIcon("insertVideo",{NAME:"video-camera"}),a.FE.DefineIcon("videoByURL",{NAME:"link"}),a.FE.RegisterCommand("videoByURL",{title:"By URL",undo:!1,focus:!1,toggle:!0,callback:function(){this.video.showLayer("video-by-url")},refresh:function(a){this.video.refreshByURLButton(a)}}),a.FE.DefineIcon("videoEmbed",{NAME:"code"}),a.FE.RegisterCommand("videoEmbed",{title:"Embedded Code",undo:!1,focus:!1,toggle:!0,callback:function(){this.video.showLayer("video-embed")},refresh:function(a){this.video.refreshEmbedButton(a)}}),a.FE.DefineIcon("videoUpload",{NAME:"upload"}),a.FE.RegisterCommand("videoUpload",{title:"Upload Video",undo:!1,focus:!1,toggle:!0,callback:function(){this.video.showLayer("video-upload")},refresh:function(a){this.video.refreshUploadButton(a)}}),a.FE.RegisterCommand("videoInsertByURL",{undo:!0,focus:!0,callback:function(){this.video.insertByURL()}}),a.FE.RegisterCommand("videoInsertEmbed",{undo:!0,focus:!0,callback:function(){this.video.insertEmbed()}}),a.FE.DefineIcon("videoDisplay",{NAME:"star"}),a.FE.RegisterCommand("videoDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(a,b){this.video.display(b)},refresh:function(a){this.opts.videoTextNear||a.addClass("fr-hidden")},refreshOnShow:function(a,b){this.video.refreshDisplayOnShow(a,b)}}),a.FE.DefineIcon("video-align",{NAME:"align-left"}),a.FE.DefineIcon("video-align-left",{NAME:"align-left"}),a.FE.DefineIcon("video-align-right",{NAME:"align-right"}),a.FE.DefineIcon("video-align-center",{NAME:"align-justify"}),a.FE.DefineIcon("videoAlign",{NAME:"align-center"}),a.FE.RegisterCommand("videoAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",center:"None",right:"Align Right"},html:function(){var b='<ul class="fr-dropdown-list" role="presentation">',c=a.FE.COMMANDS.videoAlign.options;for(var d in c)c.hasOwnProperty(d)&&(b+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="videoAlign" data-param1="'+d+'" title="'+this.language.translate(c[d])+'">'+this.icon.create("video-align-"+d)+'<span class="fr-sr-only">'+this.language.translate(c[d])+"</span></a></li>");return b+="</ul>"},callback:function(a,b){this.video.align(b)},refresh:function(a){this.video.refreshAlign(a)},refreshOnShow:function(a,b){this.video.refreshAlignOnShow(a,b)}}),a.FE.DefineIcon("videoReplace",{NAME:"exchange"}),a.FE.RegisterCommand("videoReplace",{title:"Replace",undo:!1,focus:!1,popup:!0,refreshAfterCallback:!1,callback:function(){this.video.replace()}}),a.FE.DefineIcon("videoRemove",{NAME:"trash"}),a.FE.RegisterCommand("videoRemove",{title:"Remove",callback:function(){this.video.remove()}}),a.FE.DefineIcon("videoSize",{NAME:"arrows-alt"}),a.FE.RegisterCommand("videoSize",{undo:!1,focus:!1,popup:!0,title:"Change Size",callback:function(){this.video.showSizePopup()}}),a.FE.DefineIcon("videoBack",{NAME:"arrow-left"}),a.FE.RegisterCommand("videoBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.video.back()},refresh:function(a){var b=this.video.get();b||this.opts.toolbarInline?(a.removeClass("fr-hidden"),a.next(".fr-separator").removeClass("fr-hidden")):(a.addClass("fr-hidden"),a.next(".fr-separator").addClass("fr-hidden"));
}}),a.FE.RegisterCommand("videoDismissError",{title:"OK",undo:!1,callback:function(){this.video.hideProgressBar(!0)}}),a.FE.RegisterCommand("videoSetSize",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.video.setSize()}}),a.FE.RegisterCommand("insertVideoMedia",{title:"Insert Video",undo:!0,callback:function(){this.$el.find(".fr-marker")&&this.events.disableBlur(),this.selection.save();var b=this.video.get();clickandInsertVideoButton(this,b,this.video.insertByMediaAsset)}})});