/*
 * ************************************************************* *
 * Name       : Power Tour                                       *
 * Date       : June 2012                                        *
 * Owner      : CreativeMilk                                     *
 * Url        : www.creativemilk.net                             *
 * Version    : 1.2                                              *
 * Updated    : 15/11/2012                                       *
 * Developer  : Mark                                             *
 * Dependency :                                                  *
 * Lib        : jQuery 1.7+                                      *
 * Licence    : NOT free                                         *
 * http://codecanyon.net/item/power-tour-powerfull-creative-jquery-tour-plugin/3246071
 * ************************************************************* *
 */

;(function(e,t,n,r){e.fn.powerTour=function(r){r=e.extend({},e.fn.powerTour.options,r);return this.each(function(){function F(t){if(t===true){e("body").addClass("powertour-runs")}else{e("body").removeClass("powertour-runs")}}function I(t,n){var r=d[t];var i=r.highlight;var o=r.highlightElements;if(i===true&&n!=true){e(".powertour-hook-zindex").removeClass("powertour-hook-zindex");if(e.inArray(r.arrowPosition,H)==-1){e('[data-tour-id="'+s+'"][data-tour-step="'+t+'"]').parent().addClass("powertour-hook-zindex")}if(e.trim(o)&&e(o).length){e(o).addClass("powertour-hook-zindex powertour-hook-relative")}e("#powertour-overlay").fadeTo(w,E)}if(n===true||i===false){e("#powertour-overlay").fadeOut(w);e(".powertour-hook-zindex").removeClass("powertour-hook-zindex")}}function q(n,r){if(x==true){var i=d[n];var o=e(i.hookTo);var u=i.center;var a=i.arrowPosition;if(e.inArray(a,H)==-1){var f=o.find('[data-tour-id="'+s+'"][data-tour-step="'+n+'"]');if(u=="step"||o.outerHeight()>=e(t).height()){var l=f.show().offset().top-e(t).height()/2+f.outerHeight()/2}else{l=o.offset().top-e(t).height()/2+o.outerHeight()/2}e("html, body").animate({scrollTop:l},S,m)}if(r===true){e("html, body").animate({scrollTop:0},S,m)}}}function R(t){if(e.trim(t)){if(t.indexOf(":")==-1){alert("Please use the right time format (mm:ss)")}var n=t.split(":").reverse();endTime=parseInt(n[0]*1e3+n[1]*6e4)}else{endTime=6e4}return endTime}function U(n,r){function i(){function t(e,t,n){var r=(Math.floor(e/t)%n).toString();if(r.length<2){var r="0"+r}return r}mins=t(endTime,6e4,60);secs=t(endTime,1e3,60);e("#powertour-time-timer b").html(mins+":"+secs)}R(n);t.cInter=setInterval(function(){if(endTime!=0){endTime-=1e3;i()}},1e3)}function z(t,n){if(t===true){e("body").addClass("powertour-pause");var r=e("#powertour-time-timer b").text();e("#powertour-time-timer b").replaceWith("<span>"+r+"</span>")}else{e("body").removeClass("powertour-pause");var r=e("#powertour-time-timer span").text();e("#powertour-time-timer span").replaceWith("<b>"+r+"</b>")}if(n===true){e("#powertour-time-timer span").replaceWith("<b>"+d[0].time+"</b>")}}function W(t){var n=d[t];var r=n.hookTo;var i=n.cloneTo;var s=n.customClassHook;var o=n.arrowPosition;e.each(d,function(t,n){var r=n.customClassHook;if(e.trim(r)){e("."+r).removeClass(r)}});if(e.trim(s)&&e.inArray(o,H)==-1&&e.trim(r)){e(r).addClass(s)}if(e.trim(s)&&e.trim(i)&&e.inArray(o,H)==-1){e(i).addClass(s)}}function X(){if(e.trim(L).length>1){if(L.indexOf("?")!=-1){top.location.href=L+"&tour=true"}else{top.location.href=L+"?tour=true"}}}function V(){if(v=="auto"){clearTimeout(p);e("#powertour-time-ctrls, #powertour-time-timer").hide();h=0}e('[data-tour-id="'+s+'"]').fadeOut(w);W(0);q(0,true);I(0,true)}function J(){if(h>=d.length){X();V();if(typeof P=="function"){P.call(this)}}else{var n=d[h];var r=e('[data-tour-id="'+s+'"][data-tour-step="'+h+'"]');e("#powertour-time-ctrls, #powertour-time-timer").fadeIn(w);q(h,false);R(n.time);I(h,false);if(A===true){clearInterval(t.cInter);U(n.time)}e('[data-tour-id="'+s+'"]').not(r).fadeOut(w);r.fadeIn(w);if(typeof n.onShowStep=="function"){n.onShowStep.call(this)}W(h);h++;p=setTimeout(J,endTime)}}function K(t){var n=d[t];q(t,false);I(t,false);W(t);e('[data-tour-id="'+s+'"]:not([data-tour-step="'+t+'"])').fadeOut(w);e('[data-tour-id="'+s+'"][data-tour-step="'+t+'"]').fadeIn(w);if(typeof n.onShowStep=="function"){n.onShowStep.call(this)}}var i=e(this);var s=Math.floor(Math.random()*1111);var o=8;var u="50%";var a="20";var f=[];var l=r.step.length;var c="";var h=0;var p="";var d=r.step;var v=r.tourType;var m=r.easingEffect;var g=r.timeButtonOrder;var y=r.stepButtonOrder;var b=r.showTimeControls;var w=r.effectSpeed;var E=r.overlayOpacity;var S=r.travelSpeed;var x=r.animated;var T=r.timerLabel;var N=r.keyboardNavigation;var C=r.runOnLoad;var k=r.runOnLoadDelay;var L=r.exitUrl;var A=r.showTimer;var O=r.easyCancel;var M=r.onCancel;var _=r.onStop;var D=r.onStart;var P=r.onFinish;var H=new Array("sc","stl","stm","str","srm","sbr","sbm","sbl","slm");if("ontouchstart"in t||t.DocumentTouch&&n instanceof DocumentTouch){var B="click tap"}else{B="click"}e.each(d,function(t,n){if(e.inArray(n.arrowPosition,H)==-1){var r=e(n.hookTo);r.addClass("powertour-hook-relative")}else{var r=e("body")}if(e.trim(n.customClassStep)){var i=n.customClassStep}else{var i=""}if(n.width){var f=n.width}else{var f=300}var c='<div class="powertour powertour-style-basic '+i+'" style="display:none;" data-tour-id="'+s+'" data-tour-step="'+t+'">'+"<span></span>"+'<div class="powertour-inner">'+'<div class="powertour-content">No content found, check your settings!</div>'+'<footer class="powertour-footer"></footer>'+"</div>"+"</div>";r.append(c).children('[data-tour-step="'+t+'"]').css({width:f}).find(".powertour-content").html(e(n.content)).children().css({width:f-30}).show();var h=e('[data-tour-id="'+s+'"][data-tour-step="'+t+'"]');if(v!="tooltip"){if(n.prevLabel&&v!="showAll"&&t!=0){var p='<a href="javascript:void(0);" class="powertour-btn-prev"><span>'+n.prevLabel+"</span></a>"}else{var p=""}if(n.nextLabel&&v!="showAll"&&l!=t+1){var d='<a href="javascript:void(0);" class="powertour-btn-next"><span>'+n.nextLabel+"</span></a>"}else{var d=""}if(n.stopLabel){var m='<a href="javascript:void(0);" class="powertour-btn-stop"><span>'+n.stopLabel+"</span></a>"}else{var m=""}var g=y.replace(/%prev%/g,p).replace(/%next%/g,d).replace(/%stop%/g,m);if(e.trim(g)){h.find(".powertour-footer").append("<div>"+g+"</div>")}else{h.find(".powertour-footer").remove()}}else{h.find(".powertour-footer").remove()}var b=r.outerWidth();var w=r.outerHeight();var E=h.outerWidth();var S=h.outerHeight();if(n.showArrow!=true||e.inArray(n.arrowPosition,H)!=-1){h.children("span").remove();var x=0}else{h.children("span").addClass("powertour-arrow-"+n.arrowPosition);x=o}if(n.offsetY){var T=n.offsetY}else{T=0}if(n.offsetX){var N=n.offsetX}else{N=0}switch(n.arrowPosition){case"tl":h.css({left:N,top:-S-x-T});break;case"tm":h.css({left:u,marginLeft:-(E/2-N),top:-S-x-T});break;case"tr":h.css({right:N,top:-S-x-T});break;case"rt":h.css({left:b+N+x,top:T});break;case"rm":h.css({left:b+N+x,top:u,marginTop:-(S/2-T)});break;case"rb":h.css({left:b+N+x,bottom:T});break;case"bl":h.css({left:N,bottom:-S-x-T});break;case"bm":h.css({left:u,marginLeft:-(E/2-N),bottom:-S-x-T});break;case"br":h.css({right:N,bottom:-S-x-T});break;case"lt":h.css({right:b+N+x,top:T});break;case"lm":h.css({right:b+N+x,top:u,marginTop:-(S/2-T)});break;case"lb":h.css({right:b+N+x,bottom:T});break;case"sc":h.css({left:u,top:u,marginLeft:-(f/2-N),marginTop:-(S/2-T),position:"fixed"});break;case"stl":h.css({left:a-N,top:a-T,position:"fixed"});break;case"stm":h.css({left:u,marginLeft:-(f/2-N),top:a-T,position:"fixed"});break;case"str":h.css({right:a-N,top:a-T,position:"fixed"});break;case"srm":h.css({right:a-N,top:u,marginTop:-(S/2-T),position:"fixed"});break;case"sbr":h.css({right:a-N,bottom:a-T,position:"fixed"});break;case"sbm":h.css({left:u,bottom:a-T,marginLeft:-(f/2-N),position:"fixed"});break;case"sbl":h.css({left:a-N,bottom:a-T,position:"fixed"});break;case"slm":h.css({left:a-N,top:u,marginTop:-(S/2-T),position:"fixed"});break;default:h.css({right:b+N+x,top:T});break}if(n.cloneTo&&e.inArray(n.arrowPosition,H)==-1){e(n.cloneTo).addClass("powertour-hook-relative").append(e('[data-tour-id="'+s+'"][data-tour-step="'+t+'"]').clone()).children('[data-tour-id="'+s+'"][data-tour-step="'+t+'"]').attr("data-tour-step-clone",t)}if(v=="tooltip"){r.addClass("powertour-tooltip")}});if(v=="auto"){if(b===true){var j=g.replace(/%prev%/g,'<a href="#" id="powertour-time-prev"></a>').replace(/%stop%/g,'<a href="#" id="powertour-time-stop"></a>').replace(/%pause%/g,'<a href="#" id="powertour-time-pause"></a>').replace(/%play%/g,'<a href="#" id="powertour-time-play"></a>').replace(/%next%/g,'<a href="#" id="powertour-time-next"></a>');e("body").append('<div id="powertour-time-ctrls">'+j+"</div>")}if(A===true){e("body").append('<div id="powertour-time-timer">'+T+"<b>"+d[0].time+"</b></div>")}}e("body").append('<div id="powertour-overlay"></div>');var Q=decodeURIComponent((location.search.match(RegExp("[?|&]tour=(.+?)(&|$)"))||[,null])[1]);i.on(B,this,function(t){F(true);if(typeof D=="function"){D.call(this)}if(v=="auto"){J()}else if(v=="showAll"){e('[data-tour-id="'+s+'"]').fadeIn(w)}else if(v=="step"){K(0)}t.preventDefault()});if(C===true||Q=="true"){setTimeout(function(){F(true);if(typeof D=="function"){D.call(this)}if(v=="auto"){J()}else if(v=="showAll"){e('[data-tour-id="'+s+'"]').fadeIn(w)}else if(v=="step"){K(0)}},k)}if(v=="tooltip"){e(".powertour-tooltip").hover(function(){var t=e(this).children('[data-tour-id="'+s+'"]').data("tour-step");e(this).children('[data-tour-id="'+s+'"]').stop(true,true).fadeIn(w);e('[data-tour-id="'+s+'"][data-tour-step-clone="'+t+'"]').stop(true,true).fadeIn(w)},function(){e('[data-tour-id="'+s+'"]').stop(true,true).fadeOut(w)})}e("body").on(B,".powertour-btn-prev, .powertour-btn-next",function(t){var n=e(this).parents('[data-tour-id="'+s+'"]').data("tour-step");if(v=="step"){if(e(t.target).parents().hasClass("powertour-btn-prev")){K(n-1)}if(e(t.target).parents().hasClass("powertour-btn-next")){K(n+1)}}else if(v=="auto"){if(e(t.target).parents().hasClass("powertour-btn-prev")&&h>1){h=h-2;clearTimeout(p);J()}if(e(t.target).parents().hasClass("powertour-btn-next")){clearTimeout(p);J()}}t.preventDefault()});e("body").on(B,"#powertour-time-stop, #powertour-time-next, #powertour-time-prev, #powertour-time-play, #powertour-time-pause",function(t){if(e(t.target).is(e("#powertour-time-stop"))){F(false);V();if(v=="auto"){z(false,true)}if(typeof _=="function"){_.call(this)}}if(e(t.target).is(e("#powertour-time-next"))&&e(".powertour-pause").length<1){if(v=="auto"){clearTimeout(p);J()}}if(e(t.target).is(e("#powertour-time-prev"))&&e(".powertour-pause").length<1){if(h>1&&v=="auto"){h=h-2;clearTimeout(p);J()}}if(e(t.target).is(e("#powertour-time-pause"))&&e(".powertour-pause").length<1){z(true,false);clearTimeout(p)}if(e(t.target).is(e("#powertour-time-play"))&&e(".powertour-pause").length){var n=e("#powertour-time-timer span").text();z(false,false);R(n);p=setTimeout(J,endTime)}t.preventDefault()});if(O===true){e(n).on(B,this,function(t){if(e(".powertour-runs").length&&!e(t.target).is(e(" *",'[data-tour-id="'+s+'"]'))&&!e(t.target).is(e(" *",i))&&!e(t.target).is(e(i))&&!e(t.target).is(e("#powertour-time-timer, #powertour-time-timer *"))&&!e(t.target).is(e("#powertour-time-ctrls, #powertour-time-ctrls *"))&&!e(t.target).is(e(".powertour-hook-relative, .powertour-hook-relative *"))){F(false);V();if(v=="auto"){z(false,true)}if(typeof M=="function"){M.call(this)}}})}e("body").on(B,".powertour-btn-stop",function(t){F(false);V();var n=e(this).parents(".powertour").data("tour-step");if(n+1==l){if(typeof P=="function"){P.call(this)}X()}else{if(typeof _=="function"){_.call(this)}}t.preventDefault()});if(N===true){e(n).keyup(function(t){if(t.keyCode==27&&e(".powertour-runs").length){F(false);V();z(true,true);if(typeof M=="function"){M.call(this)}}});e(n).keydown(function(t){var n=e("body").find('[data-tour-id="'+s+'"]:visible').data("tour-step");if(t.keyCode==32&&e(".powertour-runs").length&&v=="auto"){t.preventDefault();if(e(".powertour-pause").length){var r=e("#powertour-time-timer span").text();z(false,false);R(r);p=setTimeout(J,endTime)}else{z(true,false);clearTimeout(p)}}if(t.keyCode==37&&e(".powertour-pause").length<1&&e(".powertour-runs").length){if(v=="auto"&&h>1){h=h-2;clearTimeout(p);J()}if(v=="step"&&n>0){var i=n-1;K(i)}}if(t.keyCode==39&&e(".powertour-pause").length<1&&e(".powertour-runs").length){if(v=="auto"){clearTimeout(p);J()}if(v=="step"&&n+1<l){var i=n+1;K(i)}}})}})};e.fn.powerTour.options={tourType:"step",overlayOpacity:.5,showTimeControls:true,showTimer:true,timeButtonOrder:"%prev% %stop% %pause% %play% %next%",stepButtonOrder:"%prev% %next% %stop%",timerLabel:"Next step in: ",effectSpeed:200,travelSpeed:400,easingEffect:"linear",easyCancel:true,animated:true,keyboardNavigation:true,runOnLoad:false,runOnLoadDelay:2e3,exitUrl:"",onStart:function(){},onFinish:function(){},onStop:function(){},onCancel:function(){},step:[{hookTo:"",content:"",cloneTo:"",width:300,arrowPosition:"rt",showArrow:true,offsetY:0,offsetX:0,prevLabel:"Prev",nextLabel:"Next",stopLabel:"Stop",center:"hook",customClassStep:"",customClassHook:"",highlight:true,highlightElements:"",time:"01:00",onShowStep:function(){}}]}})(jQuery,window,document)