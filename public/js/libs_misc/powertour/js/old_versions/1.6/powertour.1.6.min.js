/*
 * ************************************************************* *
 * Name       : Power Tour                                       *
 * Date       : June 2012                                        *
 * Owner      : CreativeMilk                                     *
 * Url        : www.creativemilk.net                             *
 * Version    : 1.6                                              *
 * Updated    : 2013-11-17 12:41:31 UTC+02:00                    *
 * Developer  : Mark                                             *
 * Dependency :                                                  *
 * Lib        : jQuery 1.7+                                      *
 * Licence    : NOT free                                         *
 * http://codecanyon.net/item/power-tour-powerfull-creative-jquery-tour-plugin/3246071
 * ************************************************************* *
 */

;(function(e,t,n,r){function s(t,n){this.obj=e(t);this.o=e.extend({},e.fn[i].defaults,n);this.arrowSize=8;this.timeouts=[];this.totalSteps=this.o.step.length;this.customClass="";this.tid="";this.id=1;this.screenPos=new Array("sc","stl","stm","str","srm","sbr","sbm","sbl","slm");this.init()}var i="powerTour";s.prototype={init:function(){function u(t){if(t===true){e("body").attr("data-tour-active","yes")}else{e("body").attr("data-tour-active","no")}}function a(t,n){var r=i.o.step[t];var s=r.highlight;var o=r.highlightElements;var u=e("body").attr("data-tour-id");if(s===true&&n!=true){e(".powertour-hook-zindex").removeClass("powertour-hook-zindex");if(e.inArray(r.arrowPosition,i.screenPos)==-1){e('[data-tour-id="'+u+'"][data-tour-step="'+t+'"]').parent().addClass("powertour-hook-zindex")}if(e.trim(o)&&e(o).length){e(o).addClass("powertour-hook-zindex powertour-hook-relative")}e("#powertour-overlay").fadeTo(i.o.effectSpeed,i.o.overlayOpacity)}if(n===true||s===false){e("#powertour-overlay").fadeOut(i.o.effectSpeed);e(".powertour-hook-zindex").removeClass("powertour-hook-zindex")}}function f(n,r){if(i.o.animated==true){var s=i.o.step[n];var o=s.hookTo;var u=s.center;var a=s.arrowPosition;var f=e("body").attr("data-tour-id");var l=e(t).height();if(e.inArray(a,i.screenPos)==-1){var c=e(o).find('.powertour[data-tour-id="'+f+'"][data-tour-step="'+n+'"]');if(u=="step"||e(o).outerHeight()>=l){var h=c.show().offset().top-l/2+c.outerHeight()/2}else{h=e(o).offset().top-l/2+e(o).outerHeight()/2}e("html, body").animate({scrollTop:h},i.o.travelSpeed,i.o.easingEffect)}if(r===true){e("html, body").animate({scrollTop:0},i.o.travelSpeed,i.o.easingEffect)}}}function l(t){if(e.trim(t)){if(t.indexOf(":")==-1){alert("Please use the right time format (mm:ss)")}var n=t.split(":").reverse();endTime=parseInt(n[0]*1e3+n[1]*6e4)}else{endTime=6e4}return endTime}function c(n,r){function i(){function n(e,t,n){var r=(Math.floor(e/t)%n).toString();if(r.length<2){var r="0"+r}return r}var t=e("body").attr("data-tour-id");mins=n(endTime,6e4,60);secs=n(endTime,1e3,60);e(".powertour-time-timer[data-tour-id="+t+"] b").html(mins+":"+secs)}l(n);t.cInter=setInterval(function(){if(endTime!=0){endTime-=1e3;i()}},1e3)}function h(n,r){var s=e("body").attr("data-tour-id");if(r===true){clearInterval(t.cInter);e(".powertour-time-timer[data-tour-id="+s+"] b").html(i.o.step[0].time)}else{if(n===true){e("body").attr("data-tour-pause","yes");var o=e(".powertour-time-timer[data-tour-id="+s+"] b").text();e(".powertour-time-timer[data-tour-id="+s+"] b").replaceWith("<span>"+o+"</span>")}else{e("body").attr("data-tour-pause","no");var o=e(".powertour-time-timer[data-tour-id="+s+"] span").text();e(".powertour-time-timer[data-tour-id="+s+"] span").replaceWith("<b>"+o+"</b>")}}}function p(t){var n=parseInt(e("body").attr("data-tour-cur"));if(t=="next"){var r=n+1}else if(t="prev"){var r=n-1}e("body").attr("data-tour-cur",r)}function d(t){var n=i.o.step[t];var r=n.hookTo;var s=n.cloneTo;var o=n.customClassHook;var u=n.arrowPosition;e.each(i.o.step,function(t,n){var r=n.customClassHook;if(e.trim(r)){e("."+r).removeClass(r)}});if(e.trim(o)&&e.inArray(u,i.screenPos)==-1&&e.trim(r)){e(r).addClass(o)}if(e.trim(o)&&e.trim(s)&&e.inArray(u,i.screenPos)==-1){e(s).addClass(o)}}function v(t){var n=e("body").attr("data-tour-id");e("body").attr("data-tour-cur",-1);if(i.o.tourType=="auto"){clearTimeout(tid);e(".powertour-time-ctrls, .powertour-time-timer").hide();e(".powertour-time-timer").find("span").replaceWith("<b></b>")}e(".powertour").fadeOut(i.o.effectSpeed);d(0);f(0,true);a(0,true);if(t==0){var s=t}else{var s=t-1}if(i.o.tourType=="auto"||i.o.tourType=="step"&&t!=r&&typeof i.o.step[s].onHideStep=="function"){i.o.step[s].onHideStep.call(this)}u(false);e("body").find('[data-tour-trigger-id="'+n+'"]').removeClass("tour-disabled")}function m(n){var s=e("body").attr("data-tour-id");if(n===true){p("prev")}else{p("next")}var o=parseInt(e("body").attr("data-tour-cur"));if(o==i.totalSteps){y();v(o);if(typeof i.o.onFinish=="function"){i.o.onFinish.call(this)}}else{if(n===true){var u=o+1}else{u=o-1}var h=i.o.step[o];var g=i.o.step[parseInt(u)];var b=e('.powertour[data-tour-id="'+s+'"][data-tour-step="'+o+'"]');if(g!=r&&typeof g.onHideStep=="function"){g.onHideStep.call(this)}e(".powertour-time-ctrls[data-tour-id="+s+"], .powertour-time-timer[data-tour-id="+s+"]").fadeIn(i.o.effectSpeed);f(o,false);l(h.time);a(o,false);if(i.o.showTimer===true){clearInterval(t.cInter);c(h.time,s)}e(".powertour").not(b).fadeOut(i.o.effectSpeed);b.fadeIn(i.o.effectSpeed);if(typeof h.onShowStep=="function"){h.onShowStep.call(this)}d(o);tid=setTimeout(m,endTime)}}function g(t,n,s){if(s===true){var o=t+1;p("prev")}else{o=t-1;p("next")}var u=i.o.step[t];var l=i.o.step[parseInt(o)];if(l!=r&&typeof l.onHideStep=="function"){l.onHideStep.call(this)}f(t,false);a(t,false);d(t);e('.powertour[data-tour-id="'+n+'"]:not([data-tour-step="'+t+'"])').fadeOut(i.o.effectSpeed);e('.powertour[data-tour-id="'+n+'"][data-tour-step="'+t+'"]').fadeIn(i.o.effectSpeed);if(typeof u.onShowStep=="function"){u.onShowStep.call(this)}}function y(){if(e.trim(i.o.exitUrl).length>1){if(i.o.exitUrl.indexOf("?")!=-1){top.location.href=i.o.exitUrl+"&tour=true"}else{top.location.href=i.o.exitUrl+"?tour=true"}}}var i=this;if("ontouchstart"in t||t.DocumentTouch&&n instanceof DocumentTouch){clickEvent="touchstart"}else{clickEvent="click"}e("body").attr("data-tour-pause","no").attr("data-tour-active","no").attr("data-tour-cur",-1);e.each(i.o.step,function(t,n){if(e.inArray(n.arrowPosition,i.screenPos)==-1){var r=e(n.hookTo);r.addClass("powertour-hook-relative").attr("data-tour-id",i.o.tourId)}else{var r=e("body")}if(e.trim(n.customClassStep)){var s=n.customClassStep}else{s=""}if(n.width){var o=n.width}else{o=300}var u='<div class="powertour powertour-style-basic '+s+'" style="display:none;" data-tour-id="'+i.o.tourId+'" data-tour-step="'+t+'">'+"<span></span>"+'<div class="powertour-inner">'+'<div class="powertour-content">No content found, check your settings!</div>'+'<footer class="powertour-footer"></footer>'+"</div>"+"</div>";r.append(u).children('[data-tour-id="'+i.o.tourId+'"][data-tour-step="'+t+'"]').css({width:o}).find(".powertour-content").html(e(n.content)).children().css({width:o-30}).show();var a=e('[data-tour-id="'+i.o.tourId+'"][data-tour-step="'+t+'"]');var f=a.find(".powertour-footer");if(i.o.tourType!="tooltip"){if(n.prevLabel&&i.o.tourType!="showAll"&&t!=0){var l='<a href="javascript:void(0);" class="powertour-btn-prev"><span>'+n.prevLabel+"</span></a>"}else{var l=""}if(n.nextLabel&&i.o.tourType!="showAll"&&i.totalSteps!=t+1){var c='<a href="javascript:void(0);" class="powertour-btn-next"><span>'+n.nextLabel+"</span></a>"}else{var c=""}if(n.stopLabel){var h='<a href="javascript:void(0);" class="powertour-btn-stop"><span>'+n.stopLabel+"</span></a>"}else{var h=""}var p=i.o.stepButtonOrder.replace(/%prev%/g,l).replace(/%next%/g,c).replace(/%stop%/g,h);if(e.trim(p)){f.append("<div>"+p+"</div>")}else{f.remove()}}else{f.remove()}var d=r.outerWidth();var v=r.outerHeight();var m=a.outerWidth();var g=a.outerHeight();if(n.showArrow!=true||e.inArray(n.arrowPosition,i.screenPos)!=-1){a.children("span").remove();var y=0}else{a.children("span").addClass("powertour-arrow-"+n.arrowPosition);y=i.arrowSize}if(n.offsetY){var b=n.offsetY}else{b=0}if(n.offsetX){var w=n.offsetX}else{w=0}switch(n.arrowPosition){case"tl":a.css({left:w,top:-g-y-b});break;case"tm":a.css({left:"50%",marginLeft:-(m/2-w),top:-g-y-b});break;case"tr":a.css({right:w,top:-g-y-b});break;case"rt":a.css({left:d+w+y,top:b});break;case"rm":a.css({left:d+w+y,top:"50%",marginTop:-(g/2-b)});break;case"rb":a.css({left:d+w+y,bottom:b});break;case"bl":a.css({left:w,bottom:-g-y-b});break;case"bm":a.css({left:"50%",marginLeft:-(m/2-w),bottom:-g-y-b});break;case"br":a.css({right:w,bottom:-g-y-b});break;case"lt":a.css({right:d+w+y,top:b});break;case"lm":a.css({right:d+w+y,top:"50%",marginTop:-(g/2-b)});break;case"lb":a.css({right:d+w+y,bottom:b});break;case"sc":a.css({left:"50%",top:"50%",marginLeft:-(o/2-w),marginTop:-(g/2-b),position:"fixed"});break;case"stl":a.css({left:20-w,top:20-b,position:"fixed"});break;case"stm":a.css({left:"50%",marginLeft:-(o/2-w),top:20-b,position:"fixed"});break;case"str":a.css({right:20-w,top:20-b,position:"fixed"});break;case"srm":a.css({right:20-w,top:"50%",marginTop:-(g/2-b),position:"fixed"});break;case"sbr":a.css({right:20-w,bottom:20-b,position:"fixed"});break;case"sbm":a.css({left:"50%",bottom:20-b,marginLeft:-(o/2-w),position:"fixed"});break;case"sbl":a.css({left:20-w,bottom:20-b,position:"fixed"});break;case"slm":a.css({left:20-w,top:"50%",marginTop:-(g/2-b),position:"fixed"});break;default:a.css({right:d+w+y,top:b});break}if(n.cloneTo&&e.inArray(n.arrowPosition,i.screenPos)==-1){e(n.cloneTo).addClass("powertour-hook-relative").append(e('[data-tour-id="'+i.o.tourId+'"][data-tour-step="'+t+'"]').clone()).children('[data-tour-id="'+i.o.tourId+'"][data-tour-step="'+t+'"]').attr("data-tour-step-clone",t)}if(i.o.tourType=="tooltip"){r.addClass("powertour-tooltip")}});i.obj.attr("data-tour-trigger-id",i.o.tourId);if(i.o.tourType=="auto"){if(i.o.showTimeControls===true){var s=i.o.timeButtonOrder.replace(/%prev%/g,'<a href="#" class="powertour-time-prev"></a>').replace(/%stop%/g,'<a href="#" class="powertour-time-stop"></a>').replace(/%pause%/g,'<a href="#" class="powertour-time-pause"></a>').replace(/%play%/g,'<a href="#" class="powertour-time-play"></a>').replace(/%next%/g,'<a href="#" class="powertour-time-next"></a>');e("body").append('<div class="powertour-time-ctrls" data-tour-id="'+i.o.tourId+'" id="powertour-time-ctrls-'+i.o.tourId+'">'+s+"</div>")}if(i.o.showTimer===true){e("body").append('<div class="powertour-time-timer" data-tour-id="'+i.o.tourId+'" id="powertour-time-timer-'+i.o.tourId+'">'+i.o.timerLabel+"<b>"+i.o.step[0].time+"</b></div>")}}if(!e("#powertour-overlay").length){e("body").append('<div id="powertour-overlay"></div>')}i.obj.on(clickEvent,function(t){if(!e(this).hasClass("tour-disabled")&&i.o.tourType!="tooltip"){e(this).addClass("tour-disabled");var n=e(this).data("tour-trigger-id");e("body").attr("data-tour-id",n);u(true);if(typeof i.o.onStart=="function"){i.o.onStart.call(this)}if(i.o.tourType=="auto"){m()}else if(i.o.tourType=="showAll"){e('.powertour[data-tour-id="'+n+'"]').fadeIn(i.o.effectSpeed)}else if(i.o.tourType=="step"){g(0,n)}}t.preventDefault()});if(i.o.runOnLoad===true||decodeURIComponent((location.search.match(RegExp("[?|&]tour=(.+?)(&|$)"))||[,null])[1])=="true"){setTimeout(function(){u(true);i.obj.addClass("tour-disabled");var t=i.obj.data("tour-trigger-id");e("body").attr("data-tour-id",t);if(typeof i.o.onStart=="function"){i.o.onStart.call(this)}if(i.o.tourType=="auto"){m()}else if(i.o.tourType=="showAll"){e('[data-tour-id="'+t+'"]').fadeIn(o.effectSpeed)}else if(i.o.tourType=="step"){g(0,t)}},i.o.runOnLoadDelay)}if(i.o.tourType=="tooltip"){e(".powertour-tooltip").hover(function(){var t=e(this).children('[data-tour-id="'+i.o.tourId+'"]').data("tour-step");e(this).children('[data-tour-id="'+i.o.tourId+'"]').stop(true,true).fadeIn(i.o.effectSpeed);e('.powertour[data-tour-id="'+i.o.tourId+'"][data-tour-step-clone="'+t+'"]').stop(true,true).fadeIn(i.o.effectSpeed)},function(){e('.powertour[data-tour-id="'+i.o.tourId+'"]').stop(true,true).fadeOut(i.o.effectSpeed)})}e("body").off(clickEvent,".powertour-btn-prev, .powertour-btn-next").on(clickEvent,".powertour-btn-prev, .powertour-btn-next",function(t){var n=e("body").attr("data-tour-id");var r=parseInt(e("body").attr("data-tour-cur"));if(i.o.tourType=="step"){if(e(t.target).parents().hasClass("powertour-btn-prev")){g(r-1,n,true)}if(e(t.target).parents().hasClass("powertour-btn-next")){g(r+1,n)}}else if(i.o.tourType=="auto"){if(e(t.target).parents().hasClass("powertour-btn-prev")){clearTimeout(tid);m(true)}if(e(t.target).parents().hasClass("powertour-btn-next")){clearTimeout(tid);m()}}t.preventDefault()});e("body").off(clickEvent,".powertour-time-stop, .powertour-time-next, .powertour-time-prev, .powertour-time-play, .powertour-time-pause").on(clickEvent,".powertour-time-stop, .powertour-time-next, .powertour-time-prev, .powertour-time-play, .powertour-time-pause",function(t){var n=e("body").attr("data-tour-id");var r=parseInt(e("body").attr("data-tour-cur"));if(e(t.target).is(e(".powertour-time-stop"))){u(false);v(r);if(i.o.tourType=="auto"){h(false,true)}if(typeof i.o.onStop=="function"){i.o.onStop.call(this)}}if(e(t.target).is(e(".powertour-time-next"))&&e("body").attr("data-tour-pause")=="no"){if(i.o.tourType=="auto"){clearTimeout(tid);m()}}if(e(t.target).is(e(".powertour-time-prev"))&&e("body").attr("data-tour-pause")=="no"){if(r>0&&i.o.tourType=="auto"){clearTimeout(tid);m(true)}}if(e(t.target).is(e(".powertour-time-pause"))&&e("body").attr("data-tour-pause")=="no"){h(true,false);clearTimeout(tid)}if(e(t.target).is(e(".powertour-time-play"))&&e("body").attr("data-tour-pause")=="yes"){var s=e(".powertour-time-timer span").text();h(false,false);l(s);tid=setTimeout(m,endTime)}t.preventDefault()});if(i.o.easyCancel===true){e(n).on(clickEvent,this,function(t){var n=e("body").attr("data-tour-id");if(e("body").attr("data-tour-active")=="yes"&&!e(t.target).is(e(" *",'.powertour[data-tour-id="'+n+'"]'))&&!e(t.target).is(e(" *","[data-tour-trigger-id]"))&&!e(t.target).is(e("[data-tour-trigger-id]"))&&!e(t.target).is(e(".powertour-time-timer, .powertour-time-timer *"))&&!e(t.target).is(e(".powertour-time-ctrls, .powertour-time-ctrls *"))&&!e(t.target).is(e(".powertour-hook-relative, .powertour-hook-relative *"))){u(false);var r=parseInt(e("body").attr("data-tour-cur"));v(r+1);if(i.o.tourType=="auto"){h(false,true)}if(typeof i.o.onCancel=="function"){i.o.onCancel.call(this)}}})}e("body").off(clickEvent,".powertour-btn-stop").on(clickEvent,".powertour-btn-stop",function(t){var n=parseInt(e("body").attr("data-tour-cur"));u(false);v(n+1);if(n+1==i.totalSteps){if(typeof i.o.onFinish=="function"){i.o.onFinish.call(this)}y()}else{if(typeof i.o.onStop=="function"){i.o.onStop.call(this)}}t.preventDefault()});if(i.o.keyboardNavigation===true){e(n).unbind("keyup").keyup(function(t){var n=e("body").attr("data-tour-id");var r=parseInt(e("body").attr("data-tour-cur"));if(t.keyCode==27&&e("body").attr("data-tour-active")=="yes"){u(false);v(r+1);if(i.o.tourType=="auto"){h(false,true)}if(typeof i.o.onCancel=="function"){i.o.onCancel.call(this)}}});e(n).unbind("keydown").on("keydown",this,function(t){var n=e("body").attr("data-tour-id");var r=parseInt(e("body").attr("data-tour-cur"));if(t.keyCode==32&&e("body").attr("data-tour-active")=="yes"&&i.o.tourType=="auto"){t.preventDefault();if(e("body").attr("data-tour-pause")=="yes"){var s=e(".powertour-time-timer span").text();h(false,false);l(s);tid=setTimeout(m,endTime)}else{h(true,false);clearTimeout(tid)}}if(t.keyCode==37&&e("body").attr("data-tour-pause")=="no"&&e("body").attr("data-tour-active")=="yes"){if(i.o.tourType=="auto"&&r>1){clearTimeout(tid);m(true)}if(i.o.tourType=="step"&&r>0){var o=r-1;g(o,n,true)}}if(t.keyCode==39&&e("body").attr("data-tour-pause")=="no"&&e("body").attr("data-tour-active")=="yes"){if(r!=i.totalSteps+1){if(i.o.tourType=="auto"){clearTimeout(tid);m()}if(i.o.tourType=="step"){var o=r+1;g(o,n)}}}})}},update:function(e){var t=this},destroy:function(t){var n=this;n.obj.addClass("tour-disabled");e("body").find('.powertour-hook-relative[data-tour-id="'+n.o.tourId+'"]').removeClass("powertour-hook-relative").end().find('.powertour[data-tour-id="'+n.o.tourId+'"], .powertour-time-ctrls[data-tour-id="'+n.o.tourId+'"], .powertour-time-timer[data-tour-id="'+n.o.tourId+'"]').remove();n.obj.removeData(i)}};e.fn[i]=function(t,n){return this.each(function(){var r=e(this);var o=r.data(i);var u=typeof t=="object"&&t;if(!o){r.data(i,o=new s(this,u))}if(typeof t=="string"){o[t](n)}})};e.fn[i].defaults={tourId:Math.floor(Math.random()*1111),tourType:"step",overlayOpacity:.5,showTimeControls:true,showTimer:true,timeButtonOrder:"%prev% %stop% %pause% %play% %next%",stepButtonOrder:"%prev% %next% %stop%",timerLabel:"Next step in: ",effectSpeed:200,travelSpeed:400,easingEffect:"linear",easyCancel:true,animated:true,keyboardNavigation:true,runOnLoad:false,runOnLoadDelay:2e3,exitUrl:"",onStart:function(){},onFinish:function(){},onStop:function(){},onCancel:function(){},step:[{hookTo:"",content:"",cloneTo:"",width:300,arrowPosition:"rt",showArrow:true,offsetY:0,offsetX:0,prevLabel:"Prev",nextLabel:"Next",stopLabel:"Stop",center:"hook",customClassStep:"",customClassHook:"",highlight:true,highlightElements:"",time:"01:00",onShowStep:function(){},onHideStep:function(){}}]}})(jQuery,window,document)