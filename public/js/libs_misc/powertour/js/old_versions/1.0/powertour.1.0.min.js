/*
 * ************************************************************* *
 * Name       : Power Tour                                       *
 * Date       : June 2012                                        *
 * Owner      : CreativeMilk                                     *
 * Url        : www.creativemilk.net                             *
 * Version    : 1.0                                              *
 * Updated    : --/--/----                                       *
 * Developer  : Mark                                             *
 * Dependency :                                                  *
 * Lib        : jQuery 1.7+                                      *
 * Licence    : NOT free                                         *
 * http://codecanyon.net/item/power-tour-powerfull-creative-jquery-tour-plugin/3246071
 * ************************************************************* *
 */

;(function(a,b,c,d){a.fn.powerTour=function(d){d=a.extend({},a.fn.powerTour.options,d);return this.each(function(){function J(b){if(b===true){a("body").addClass("powertour-runs")}else{a("body").removeClass("powertour-runs")}}function K(b,c){var d=o[b];var e=d.highlight;var g=d.highlightElements;if(e===true&&c!=true){a(".powertour-hook-zindex").removeClass("powertour-hook-zindex");if(a.inArray(d.arrowPosition,G)==-1){a('[data-tour-id="'+f+'"][data-tour-step="'+b+'"]').parent().addClass("powertour-hook-zindex")}if(a.trim(g)&&a(g).length){a(g).addClass("powertour-hook-zindex powertour-hook-relative")}a("#powertour-overlay").fadeTo(u,v)}if(c===true||e===false){a("#powertour-overlay").fadeOut(u);a(".powertour-hook-zindex").removeClass("powertour-hook-zindex")}}function L(c,d){if(x==true){var e=o[c];var g=a(e.hookTo);var h=e.center;var i=e.arrowPosition;if(a.inArray(i,G)==-1){var j=g.find('[data-tour-id="'+f+'"][data-tour-step="'+c+'"]');if(h=="step"||g.outerHeight()>=a(b).height()){var k=j.show().offset().top-a(b).height()/2+j.outerHeight()/2}else{k=g.offset().top-a(b).height()/2+g.outerHeight()/2}a("html, body").animate({scrollTop:k},w,q)}if(d===true){a("html, body").animate({scrollTop:0},w,q)}}}function M(b){if(a.trim(b)){if(b.indexOf(":")==-1){alert("Please use the right time format (mm:ss)")}var c=b.split(":").reverse();endTime=parseInt(c[0]*1e3+c[1]*6e4)}else{endTime=6e4}return endTime}function N(c,d){function e(){function b(a,b,c){var d=(Math.floor(a/b)%c).toString();if(d.length<2){var d="0"+d}return d}mins=b(endTime,6e4,60);secs=b(endTime,1e3,60);a("#powertour-time-timer b").html(mins+":"+secs)}M(c);b.cInter=setInterval(function(){if(endTime!=0){endTime-=1e3;e()}},1e3)}function O(b,c){if(b===true){a("body").addClass("powertour-pause");var d=a("#powertour-time-timer b").text();a("#powertour-time-timer b").replaceWith("<span>"+d+"</span>")}else{a("body").removeClass("powertour-pause");var d=a("#powertour-time-timer span").text();a("#powertour-time-timer span").replaceWith("<b>"+d+"</b>")}if(c===true){a("#powertour-time-timer span").replaceWith("<b>"+o[0].time+"</b>")}}function P(b){var c=o[b];var d=c.hookTo;var e=c.cloneTo;var f=c.customClassHook;var g=c.arrowPosition;a.each(o,function(b,c){var d=c.customClassHook;if(a.trim(d)){a("."+d).removeClass(d)}});if(a.trim(f)&&a.inArray(g,G)==-1&&a.trim(d)){a(d).addClass(f)}if(a.trim(f)&&a.trim(e)&&a.inArray(g,G)==-1){a(e).addClass(f)}}function Q(){if(p=="auto"){clearTimeout(n);a("#powertour-time-ctrls, #powertour-time-timer").hide();m=0}a('[data-tour-id="'+f+'"]').fadeOut(u);P(0);L(0,true);K(0,true)}function R(){if(m>=o.length){Q();if(typeof F=="function"){F.call(this)}}else{var c=o[m];var d=a('[data-tour-id="'+f+'"][data-tour-step="'+m+'"]');a("#powertour-time-ctrls, #powertour-time-timer").fadeIn(u);L(m,false);M(c.time);K(m,false);if(A===true){clearInterval(b.cInter);N(c.time)}a('[data-tour-id="'+f+'"]').not(d).fadeOut(u);d.fadeIn(u);if(typeof c.onShowStep=="function"){c.onShowStep.call(this)}P(m);m++;n=setTimeout(R,endTime)}}function S(b){var c=o[b];L(b,false);K(b,false);P(b);a('[data-tour-id="'+f+'"]:not([data-tour-step="'+b+'"])').fadeOut(u);a('[data-tour-id="'+f+'"][data-tour-step="'+b+'"]').fadeIn(u);if(typeof c.onShowStep=="function"){c.onShowStep.call(this)}}var e=a(this);var f=Math.floor(Math.random()*1111);var g=8;var h="50%";var i="20";var j=[];var k=d.step.length;var l="";var m=0;var n="";var o=d.step;var p=d.tourType;var q=d.easingEffect;var r=d.timeButtonOrder;var s=d.stepButtonOrder;var t=d.showTimeControls;var u=d.effectSpeed;var v=d.overlayOpacity;var w=d.travelSpeed;var x=d.animated;var y=d.timerLabel;var z=d.keyboardNavigation;var A=d.showTimer;var B=d.easyCancel;var C=d.onCancel;var D=d.onStop;var E=d.onStart;var F=d.onFinish;var G=new Array("sc","stl","stm","str","srm","sbr","sbm","sbl","slm");if("ontouchstart"in b||b.DocumentTouch&&c instanceof DocumentTouch){var H="click tap"}else{H="click"}a.each(o,function(b,c){if(a.inArray(c.arrowPosition,G)==-1){var d=a(c.hookTo);d.addClass("powertour-hook-relative")}else{var d=a("body")}if(a.trim(c.customClassStep)){var e=c.customClassStep}else{var e=""}if(c.width){var j=c.width}else{var j=300}var l='<div class="powertour powertour-style-basic '+e+'" style="display:none;" data-tour-id="'+f+'" data-tour-step="'+b+'">'+"<span></span>"+'<div class="powertour-inner">'+'<div class="powertour-content">No content found, check your settings!</div>'+'<footer class="powertour-footer"></footer>'+"</div>"+"</div>";d.append(l).children('[data-tour-step="'+b+'"]').css({width:j}).find(".powertour-content").html(a(c.content)).children().css({width:j-30}).show();var m=a('[data-tour-id="'+f+'"][data-tour-step="'+b+'"]');if(p!="tooltip"){if(c.prevLabel&&p!="showAll"&&b!=0){var n='<a href="javascript:void(0);" class="powertour-btn-prev"><span>'+c.prevLabel+"</span></a>"}else{var n=""}if(c.nextLabel&&p!="showAll"&&k!=b+1){var o='<a href="javascript:void(0);" class="powertour-btn-next"><span>'+c.nextLabel+"</span></a>"}else{var o=""}if(c.stopLabel){var q='<a href="javascript:void(0);" class="powertour-btn-stop"><span>'+c.stopLabel+"</span></a>"}else{var q=""}var r=s.replace(/%prev%/g,n).replace(/%next%/g,o).replace(/%stop%/g,q);if(a.trim(r)){m.find(".powertour-footer").append("<div>"+r+"</div>")}else{m.find(".powertour-footer").remove()}}else{m.find(".powertour-footer").remove()}var t=d.outerWidth();var u=d.outerHeight();var v=m.outerWidth();var w=m.outerHeight();if(c.showArrow!=true||a.inArray(c.arrowPosition,G)!=-1){m.children("span").remove();var x=0}else{m.children("span").addClass("powertour-arrow-"+c.arrowPosition);x=g}if(c.offsetY){var y=c.offsetY}else{y=0}if(c.offsetX){var z=c.offsetX}else{z=0}switch(c.arrowPosition){case"tl":m.css({left:z,top:-w-x-y});break;case"tm":m.css({left:h,marginLeft:-(v/2-z),top:-w-x-y});break;case"tr":m.css({right:z,top:-w-x-y});break;case"rt":m.css({left:t+z+x,top:y});break;case"rm":m.css({left:t+z+x,top:h,marginTop:-(w/2-y)});break;case"rb":m.css({left:t+z+x,bottom:y});break;case"bl":m.css({left:z,bottom:-w-x-y});break;case"bm":m.css({left:h,marginLeft:-(v/2-z),bottom:-w-x-y});break;case"br":m.css({right:z,bottom:-w-x-y});break;case"lt":m.css({right:t+z+x,top:y});break;case"lm":m.css({right:t+z+x,top:h,marginTop:-(w/2-y)});break;case"lb":m.css({right:t+z+x,bottom:y});break;case"sc":m.css({left:h,top:h,marginLeft:-(j/2-z),marginTop:-(w/2-y),position:"fixed"});break;case"stl":m.css({left:i-z,top:i-y,position:"fixed"});break;case"stm":m.css({left:h,marginLeft:-(j/2-z),top:i-y,position:"fixed"});break;case"str":m.css({right:i-z,top:i-y,position:"fixed"});break;case"srm":m.css({right:i-z,top:h,marginTop:-(w/2-y),position:"fixed"});break;case"sbr":m.css({right:i-z,bottom:i-y,position:"fixed"});break;case"sbm":m.css({left:h,bottom:i-y,marginLeft:-(j/2-z),position:"fixed"});break;case"sbl":m.css({left:i-z,bottom:i-y,position:"fixed"});break;case"slm":m.css({left:i-z,top:h,marginTop:-(w/2-y),position:"fixed"});break;default:m.css({right:t+z+x,top:y});break}if(c.cloneTo&&a.inArray(c.arrowPosition,G)==-1){a(c.cloneTo).addClass("powertour-hook-relative").append(a('[data-tour-id="'+f+'"][data-tour-step="'+b+'"]').clone()).children('[data-tour-id="'+f+'"][data-tour-step="'+b+'"]').attr("data-tour-step-clone",b)}if(p=="tooltip"){d.addClass("powertour-tooltip")}});if(p=="auto"){if(t===true){var I=r.replace(/%prev%/g,'<a href="#" id="powertour-time-prev"></a>').replace(/%stop%/g,'<a href="#" id="powertour-time-stop"></a>').replace(/%pause%/g,'<a href="#" id="powertour-time-pause"></a>').replace(/%play%/g,'<a href="#" id="powertour-time-play"></a>').replace(/%next%/g,'<a href="#" id="powertour-time-next"></a>');a("body").append('<div id="powertour-time-ctrls">'+I+"</div>")}if(A===true){a("body").append('<div id="powertour-time-timer">'+y+"<b>"+o[0].time+"</b></div>")}}a("body").append('<div id="powertour-overlay"></div>');e.on(H,this,function(b){J(true);if(typeof E=="function"){E.call(this)}if(p=="auto"){R()}else if(p=="showAll"){a('[data-tour-id="'+f+'"]').fadeIn(u)}else if(p=="step"){S(0)}b.preventDefault()});if(p=="tooltip"){a(".powertour-tooltip").hover(function(){var b=a(this).children('[data-tour-id="'+f+'"]').data("tour-step");a(this).children('[data-tour-id="'+f+'"]').stop(true,true).fadeIn(u);a('[data-tour-id="'+f+'"][data-tour-step-clone="'+b+'"]').stop(true,true).fadeIn(u)},function(){a('[data-tour-id="'+f+'"]').stop(true,true).fadeOut(u)})}a("body").on(H,".powertour-btn-prev, .powertour-btn-next",function(b){var c=a(this).parents('[data-tour-id="'+f+'"]').data("tour-step");if(p=="step"){if(a(b.target).parents().hasClass("powertour-btn-prev")){S(c-1)}if(a(b.target).parents().hasClass("powertour-btn-next")){S(c+1)}}else if(p=="auto"){if(a(b.target).parents().hasClass("powertour-btn-prev")&&m>1){m=m-2;clearTimeout(n);R()}if(a(b.target).parents().hasClass("powertour-btn-next")){clearTimeout(n);R()}}b.preventDefault()});a("body").on(H,"#powertour-time-stop, #powertour-time-next, #powertour-time-prev, #powertour-time-play, #powertour-time-pause",function(b){if(a(b.target).is(a("#powertour-time-stop"))){J(false);Q();if(p=="auto"){O(false,true)}if(typeof D=="function"){D.call(this)}}if(a(b.target).is(a("#powertour-time-next"))&&a(".powertour-pause").length<1){if(p=="auto"){clearTimeout(n);R()}}if(a(b.target).is(a("#powertour-time-prev"))&&a(".powertour-pause").length<1){if(m>1&&p=="auto"){m=m-2;clearTimeout(n);R()}}if(a(b.target).is(a("#powertour-time-pause"))&&a(".powertour-pause").length<1){O(true,false);clearTimeout(n)}if(a(b.target).is(a("#powertour-time-play"))&&a(".powertour-pause").length){var c=a("#powertour-time-timer span").text();O(false,false);M(c);n=setTimeout(R,endTime)}b.preventDefault()});if(B===true){a(c).on(H,this,function(b){if(a(".powertour-runs").length&&!a(b.target).is(a(" *",'[data-tour-id="'+f+'"]'))&&!a(b.target).is(a(" *",e))&&!a(b.target).is(a(e))&&!a(b.target).is(a("#powertour-time-timer, #powertour-time-timer *"))&&!a(b.target).is(a("#powertour-time-ctrls, #powertour-time-ctrls *"))&&!a(b.target).is(a(".powertour-hook-relative, .powertour-hook-relative *"))){J(false);Q();if(p=="auto"){O(false,true)}if(typeof C=="function"){C.call(this)}}})}a("body").on(H,".powertour-btn-stop",function(a){J(false);Q();if(typeof D=="function"){D.call(this)}a.preventDefault()});if(z===true){a(c).keyup(function(b){if(b.keyCode==27&&a(".powertour-runs").length){J(false);Q();O(true,true);if(typeof C=="function"){C.call(this)}}});a(c).keydown(function(b){var c=a("body").find('[data-tour-id="'+f+'"]:visible').data("tour-step");if(b.keyCode==32&&a(".powertour-runs").length&&p=="auto"){b.preventDefault();if(a(".powertour-pause").length){var d=a("#powertour-time-timer span").text();O(false,false);M(d);n=setTimeout(R,endTime)}else{O(true,false);clearTimeout(n)}}if(b.keyCode==37&&a(".powertour-pause").length<1&&a(".powertour-runs").length){if(p=="auto"&&m>1){m=m-2;clearTimeout(n);R()}if(p=="step"&&c>0){var e=c-1;S(e)}}if(b.keyCode==39&&a(".powertour-pause").length<1&&a(".powertour-runs").length){if(p=="auto"){clearTimeout(n);R()}if(p=="step"&&c+1<k){var e=c+1;S(e)}}})}})};a.fn.powerTour.options={tourType:"step",overlayOpacity:.5,showTimeControls:true,showTimer:true,timeButtonOrder:"%prev% %stop% %pause% %play% %next%",stepButtonOrder:"%prev% %next% %stop%",timerLabel:"Next step in: ",effectSpeed:200,travelSpeed:400,easingEffect:"linear",easyCancel:true,animated:true,keyboardNavigation:true,onStart:function(){},onFinish:function(){},onStop:function(){},onCancel:function(){},step:[{hookTo:"",content:"",cloneTo:"",width:300,arrowPosition:"rt",showArrow:true,offsetY:0,offsetX:0,prevLabel:"Prev",nextLabel:"Next",stopLabel:"Stop",center:"hook",customClassStep:"",customClassHook:"",highlight:true,highlightElements:"",time:"01:00",onShowStep:function(){}}]}})(jQuery,window,document)