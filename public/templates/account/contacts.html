<!--
* COPYRIGHT INDIGENOUS.IO, LLC 2014
*
* All use or reproduction of any or all of this content must be approved.
* Please contact info@indigenous.io for approval or questions.
-->

<!--
CONTACTS MAIN VIEW
-->
<script type="text/x-handlebars-template" name="contacts-main">
    <div class="pageheader row">
        <h2 class="col-xs-8"><i class="fa fa-users"></i> Customers </h2>

        <div class="col-xs-4">
            <div class="btn btn-success pull-right btn-create-contact" type="button">
                <i class="fa fa-plus"/>
                <span class="hidden-xs">Add</span>
            </div>

            <div class="btn-group pull-right" style="margin-right:8px;">
                <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown">
                    Import <span class="caret"/>
                </button>

                <ul class="dropdown-menu" role="menu">
                    <li class="btn-import-facebook"><a href="#">Import Facebook friends</a></li>
                    <li class="btn-import-gmail"><a href="#">Import Gmail contacts</a></li>
                    <li class="btn-import-linkedin"><a href="#">Import LinkedIn connections</a></li>
                </ul>
            </div>

        </div>
    </div>

    <div class="alert alert-info fade in">
        <button aria-hidden="true" data-dismiss="alert" class="close" type="button">Ã—</button>
        <h4>Customers are the people you sell to and buy from.</h4>

        <p>They include the person you met at a conference or the CEO of your best account.</p>
    </div>

    <div class="contentpanel">
        <div class="panel panel-default row">
            <div class="panel-body">
                <div class="col-sm-6">
                    <input type="text" placeholder="Search Customers" class="form-control mb15 input-lg">
                </div>
                <div class="col-sm-6 form-horizontal">
                    <div class="form-group row">
                        <select class=" form-control chosen-select input-lg">
                            <option value="">Filter Customers</option>
                            <option value="near_store">Important</option>
                            <option value="near_store">People</option>
                            <option value="near_store">Companies</option>
                            <option value="near_store">Recently Viewed</option>
                            <option value="near_store">Recently Added</option>
                            <option value="near_store">Recently Contacted</option>
                            <option value="last_acitve">Last Active</option>
                            <option value="visits"># of Visits</option>
                            <option value="purchases">Purchased</option>
                            <option value="starred">Important</option>
                            <option value="near_store">Proximity to You</option>
                        </select>
                    </div>
                </div>
            </div>

            {{> contact-paginator}}
        </div>
        <!-- panel -->

        <div class="people-list">
            <div class="row">
                {{#each contacts}}
                <div class="col-xs-12 col-sm-6">
                    <div class="people-item btn-view-contact-details contact-item" data-contactid="{{_id}}">
                        <span class="important-star tooltips" data-toggle="tooltip" data-placement="top" title="" data-original-title="Important Contact">
                            <i class="fa {{#if starred}}fa-star{{else}}fa-star-o{{/if}}"/>
                        </span>

                        <div class="media">
                            <div class="col-xs-12 col-sm-6">
                                {{#if photoSquare}}
                                    {{#isGoogleImage photoSquare}}
                                        <img src="/assets/icons/blank-user.jpg" class="img-circle media-object thumbnail batched-image-loader" data-img-src="{{photoSquare}}" data-img-loaded="false" onerror="this.src='/assets/icons/blank-user.jpg'"/>
                                    {{else}}
                                        <img class="img-circle media-object thumbnail" src="{{photoSquare}}">
                                    {{/isGoogleImage}}
                                {{else}}
                                    {{#isGoogleImage photo}}
                                        <img src="/assets/icons/blank-user.jpg" class="img-circle media-object thumbnail batched-image-loader" data-img-src="{{photo}}" data-img-loaded="false" onerror="this.src='/assets/icons/blank-user.jpg'"/>
                                    {{else}}
                                        <img class="img-circle media-object thumbnail standard" src="{{#if photo}}{{photo}}{{else}}/assets/icons/blank-user.jpg{{/if}}">
                                    {{/isGoogleImage}}
                                {{/if}}

                                <span class="name visible-xs">
                                    <h4>
                                        {{first}} {{middle}} {{last}}
                                        <span class="label label-info contact-cat pull-right hidden-xs">{{contactTypeLabel this}}</span>
                                    </h4>
                                </span>

                                <div class="clear"></div>
                                <ul class="social-list hidden-xs">
                                    <li>
                                        {{#getBestEmail this}}
                                        <a href="mailto:{{$email}}" class="tooltips" data-toggle="tooltip" data-placement="top" title="" data-original-title="Email" target="_blank"><i class="fa fa-envelope-o"></i></a>
                                        {{else}}
                                        <a href="#" class="tooltips disabled" data-toggle="tooltip" data-placement="top" title="" data-original-title="No Email Address"><i class="fa fa-envelope-o"></i></a>
                                        {{/getBestEmail}}
                                    </li>


                                    <li>
                                        {{#getFacebookId this}}
                                        <a href="https://www.facebook.com/{{$facebookId}}" class="tooltips" data-toggle="tooltip" data-placement="top" title="" data-original-title="Facebook" target="_blank"><i class="fa fa-facebook"></i></a>
                                        {{else}}
                                        <a href="#" class="tooltips disabled" data-toggle="tooltip" data-placement="top" title="" data-original-title="No Facebook Link"><i class="fa fa-facebook"></i></a>
                                        {{/getFacebookId}}
                                    </li>

                                    <li>
                                        {{#getTwitterId this}}
                                        <a href="https://twitter.com/intent/user?user_id={{$twitterId}}" class="tooltips" data-toggle="tooltip" data-placement="top" title="" data-original-title="Twitter"><i class="fa fa-twitter"></i></a>
                                        {{else}}
                                        <a href="#" class="tooltips disabled" data-toggle="tooltip" data-placement="top" title="" data-original-title="No Twitter Account"><i class="fa fa-twitter"></i></a>
                                        {{/getTwitterId}}
                                    </li>

                                    <li>
                                        {{#getLinkedInId this}}
                                        <a href="{{#if $linkedInUrl}}{{$linkedInUrl}}{{else}}http://www.linkedin.com/profile/view?id={{$linkedInId}}{{/if}}" class="tooltips" data-toggle="tooltip" data-placement="top" title="" data-original-title="LinkedIn" target="_blank"><i class="fa fa-linkedin"></i></a>
                                        {{else}}
                                        <a href="#" class="tooltips disabled" data-toggle="tooltip" data-placement="top" title="" data-original-title="No LinkedIn Account" target="_blank"><i class="fa fa-linkedin"></i></a>
                                        {{/getLinkedInId}}
                                    </li>

                                    {{#getAddress this}}
                                    <li>
                                        <a href="https://www.google.com/maps?q={{$this.address}}" class="tooltips" data-toggle="tooltip" data-placement="top" title="" data-original-title="Location" target="_blank"><i class="fa fa-map-marker"></i></a>
                                    </li>
                                    {{/getAddress}}

                                </ul>
                            </div>
                            <div class="media-body col-xs-12 col-sm-6 hidden-xs">
                                <h4 class="person-name">{{first}} {{middle}} {{last}}</h4>
                                <span class="label label-info contact-cat">{{contactTypeLabel this}}</span>

                                <div class="hidden-xs">
                                    <div class="last-active text-muted">Last Active:
                                        {{#if lastActive}}
                                            {{lastActive}} days ago
                                        {{else}}
                                            n/a
                                        {{/if}}
                                    </div>

                                    <div class="purchased text-muted">
                                        {{#if purchased}}
                                            Purchased: Yes
                                        {{else}}
                                            Purchased: n/a
                                        {{/if}}
                                    </div>

                                    <div class="emails-opened text-muted">
                                        {{#if totalEmails}}
                                            Emails Opened:
                                            {{#if emailsOpened}}
                                                {{emailsOpened}}/{{totalEmails}}
                                            {{else}}
                                                0/{{totalEmails}}
                                            {{/if}}
                                        {{else}}
                                            Emails Opened: n/a
                                        {{/if}}
                                    </div>

                                    <div class="calls-made text-muted">
                                        Calls Made:
                                        {{#if callsMade}}
                                            {{callsMade}}
                                        {{else}}
                                            n/a
                                        {{/if}}
                                    </div>

                                    <div class="customer-since text-muted">
                                        Customer since:
                                        {{#if firstPurchase}}
                                            {{formatDate fistPurchase}}
                                        {{else}}
                                            n/a
                                        {{/if}}
                                    </div>
                                </div>
                            </div>
                            <div class="pull-right">
                                <span class="visible-inline-xs">
                                type: {{contactTypeLabel this}} |
                                </span>

                                <span class="tooltips" data-toggle="tooltip" data-placement="top" title="" data-original-title="Sources where this contact information came from">sources: </span>
                                {{#each details}}
                                    <span><i class="{{iconFromSocialType type}}"/></span>
                                {{/each}}


                            </div>
                            <div class="clear clearfix"/>
                        </div>
                    </div>
                </div>
                {{else}}
                <div class="visible-xs col-xs-10">
                    <h3>No Contacts Available</h3>
                </div>

                <div class="visible-xs btn btn-success col-xs-12">Add a new contact</div>
                {{/each}}

                {{#iterateDifference min count 0}}
                <div class="col-xs-12 col-sm-6">
                    <div class="people-item btn-view-contact-details" data-contactid="{{_id}}">
                        <div class="media">
                            <div class="col-xs-12 col-sm-6">
                                <a href="view_contact.html">
                                    <img alt="" src="/assets/icons/blank-user.jpg" class="thumbnail img-circle media-object">
                                </a>

                                <div class="clear"></div>
                            </div>
                        </div>
                    </div>
                </div>
                {{/iterateDifference}}
            </div>
        </div>
    </div>
    <!--
    <div id="contacts-main-container">


        <div class="row">
            <ul class="pull-right hidden-md hidden-lg unstyled col-sm-1" style="margin-top:15px;">
                {{#eachLetter}}
                <li><a class="btn-letter" href="#">{{letter}}</a></li>
                {{/eachLetter}}
            </ul>

            <div id="contacts-list-container" class="col-sm-11 col-md-12">
                {{#each contacts}}
                <div class="col-xs-11 col-sm-6 col-md-4 contact-thumbnail">
                    <div class="inner btn-view-contact-details" data-contactid="{{_id}}">
                        <strong>{{first}} {{middle}} {{last}}</strong> <span class="visible-inline-xs"><small>
                        {{contactTypeLabel this}}
                    </small></span>

                        <div class="hidden-xs">
                            <small>{{contactTypeLabel this}}</small>
                        </div>

                        <div class="contacts-photo-container">
                            {{#if photoSquare}}
                            {{#isGoogleImage photoSquare}}
                            <img src="/assets/icons/blank-user.jpg" class="img-rounded batched-image-loader" data-img-src="{{photoSquare}}" data-img-loaded="false" onerror="this.src='/assets/icons/blank-user.jpg'"/>
                            {{else}}
                            <img class="img-rounded square" src="{{photoSquare}}">
                            {{/isGoogleImage}}
                            {{else}}
                            {{#isGoogleImage photo}}
                            <img src="/assets/icons/blank-user.jpg" class="img-rounded batched-image-loader" data-img-src="{{photo}}" data-img-loaded="false" onerror="this.src='/assets/icons/blank-user.jpg'"/>
                            {{else}}
                            <img class="img-rounded standard" src="{{#if photo}}{{photo}}{{else}}/assets/icons/blank-user.jpg{{/if}}">
                            {{/isGoogleImage}}
                            {{/if}}
                        </div>

                        <div class="hidden-xs contact-thumbnail-details">
                            <div>Last Active:</div>
                            <div>Purchased:</div>
                            <div>Emails Opened:</div>
                            <div>Calls Made:</div>
                        </div>

                        <div class="contact-thumbnail-actions hidden-xs">
                            <div class="fa fa-envelope-o" title="send-message"/>
                        </div>
                    </div>
                </div>
                {{else}}

                <div class="visible-xs col-xs-10">
                    <h3>No Records Available</h3>
                </div>

                <div class="visible-xs btn btn-primary col-xs-8">Add a new contact</div>
                {{/each}}

                {{#iterateDifference min count 0}}
                <div class="col-xs-11 col-sm-6 col-md-4 contact-thumbnail hidden-xs {{#if $last}}hidden-md hidden-lg{{/if}}">
                    <div class="inner">
                        <strong>Create new Contact</strong>

                        <div class="contacts-photo-container">
                            <img class="img-circle" src="/assets/icons/blank-user.jpg">
                        </div>

                        <div class="hidden-xs">
                            <div class="btn btn-success btn-create-contact">Add Contact</div>
                        </div>

                    </div>
                </div>
                {{/iterateDifference}}
            </div>
        </div>


        {{> contact-paginator}}
    </div>
    -->
</script>


<script type="text/x-handlebars-template" name="contact-paginator" partial="true">
    <div style="width:100%; text-align:center">
        <ul class="pagination hidden-xs letter-list">
            {{#eachLetter}}
            <li class="{{#equals currentLetter letter}}active{{/equals}}"><a class="btn-letter" href="#">{{letter}}</a></li>
            {{/eachLetter}}
        </ul>
    </div>
</script>
<!-- END CONTACTS MAIN -->


<!--
CONTACT DETAILS VIEW
-->
<script type="text/x-handlebars-template" name="contact-details-main">
    <div id="contact-details-container">
        <div class="row">
            <div class="col-md-6">
                {{> contact-details}}
            </div>

            <div class="col-md-6">
                {{> contact-activity}}
            </div>
        </div>

    </div>
</script>


<script type="text/x-handlebars-template" name="contact-details" partial="true">
    <span id="btn-back-to-contacts" class="btn-link"><i class="fa fa-angle-left"/></span>
    <span id="contact-name">{{contact.first}} {{contact.middle}} {{contact.last}}</span>

    <div id="btn-edit-contact-primary" class="btn-edit-contact btn btn-xs btn-primary hidden-xs">Edit</div>

    <div id="contact-type">
        <small>{{contactTypeLabel contact}}</small>
    </div>

    <div class="contact-photo-container">
        <img class="img-rounded" src="{{#if contact.photo}}{{contact.photo}}{{else}}/assets/icons/blank-user.jpg{{/if}}">
    </div>

    <div id="contact-summary">
        <div>Last Active:</div>
        <div>Purchased:</div>
        <div>Emails Opened:</div>
        <div>Calls Made:</div>
    </div>

    <div id="contact-information">
        <h4>Contact Information</h4>
        <hr/>

        <div id="phone-row" class="row">
            <div class="col-xs-1"><i class="icon-main fa fa-phone"/></div>
            <div class="col-xs-10">
                {{#each contact.details}}
                {{#each phones}}
                <div>
                    <a href="tel:{{number}}">{{number}}</a>
                    <small>{{phoneTypeLabel type}}</small>
                    <i class="icon-social {{iconFromSocialType ../type}}"/>
                </div>
                {{/each}}
                {{/each}}
            </div>
        </div>

        <div id="address-row" class="row">
            <div class="col-xs-1"><i class="icon-main fa fa-map-marker"/></div>
            <div class="col-xs-10">
                {{#each contact.details}}
                {{#each addresses}}
                <div class="edit-address-container" data-id="{{_id}}">
                    {{#if address}}
                    <div><strong>{{address}}</strong></div>
                    {{/if}}
                    {{#if address2}}
                    <div>{{address2}}</div>
                    {{/if}}
                    <div>
                        {{city}}
                        {{#if state}}, {{state}}{{/if}}
                        {{#if zip}}, {{zip}}{{/if}}
                        {{#if country}}, {{country}}{{/if}} <i class="icon-social {{iconFromSocialType ../type}}"/>
                    </div>

                    <div>
                        {{#if defaultShipping}}
                        <small>Shipping <i class="fa fa-check"/></small>
                        {{/if}}
                        {{#if defaultBilling}}
                        <small>Billing <i class="fa fa-check"/></small>
                        {{/if}}
                    </div>
                </div>
                {{/each}}
                {{/each}}
            </div>
        </div>

        <div id="email-row" class="row">
            <div class="col-xs-1"><i class="icon-main fa fa-envelope"/></div>
            <div class="col-xs-10">
                {{#each contact.details}}
                {{#each emails}}
                {{#if this}}
                <a href="mailto:{{this}}">{{this}}</a> <i class="icon-social {{iconFromSocialType ../../type}}"/>
                {{/if}}
                {{/each}}
                {{/each}}
            </div>
        </div>

        <div id="btn-edit-contact-mobile" class="btn-edit-contact visible-xs col-12-xs btn btn-primary">Edit Contact
        </div>
    </div>

</script>


<script type="text/x-handlebars-template" name="contact-activity" partial="true">

</script>
<!-- END CONTACT DETAILS VIEW -->


<!--
CONTACTS EDIT VIEW
-->
<script type="text/x-handlebars-template" name="contact-edit-main">
    <div id="contact-edit-container">
        <div class="row">
            <div class="col-md-6">
                <div class="hidden-xs hidden-sm">
                    <h4>
                        <small><span id="btn-back-to-contact" class="btn-link"><i class="fa fa-angle-left"/></span>
                        </small>
                        Name & Photo
                    </h4>
                    <hr/>
                </div>

                <div class="row">
                    <!-- UPDATE NAME -->
                    <div class="col-xs-12 form" role="form">
                        <div class="form-group">
                            <label class="">Contact Name</label>
                            <input id="input-fullname" type="text" class="form-control" value="{{contact.first}} {{contact.middle}} {{contact.last}}" placeholder="full name">
                            <small style="margin-left:10px;">
                                <strong>first:</strong> <code><span id="hint-first">{{contact.first}}</span></code>
                                <strong>middle:</strong> <code><span id="hint-middle">{{contact.middle}}</span></code>
                                <strong>last:</strong> <code><span id="hint-last">{{contact.last}}</span></code>
                            </small>
                        </div>

                        <div class="row">
                            <div class="form-group col-xs-6">
                                <label>Contact Type</label>
                                <select id="select-contact-type" class="form-control">
                                    {{#contactTypeOptions}}
                                    <option data-contacttype="{{data}}"
                                    {{#equals data ../contact.type}}selected{{/equals}}>{{label}}</option>
                                    {{/contactTypeOptions}}
                                </select>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- UPDATE PHOTO -->
                <div id="contact-photo-container" class="row">
                    <row>
                        <div class="col-xs-5 col-md-6">
                            <div class="hidden-xs hidden-sm">
                                <div class="btn-link btn-edit-photo">Change Photo</div>
                            </div>
                            <img id="contact-photo" class="img-responsive img-rounded hand btn-edit-photo" src="{{#if contact.photo}}{{contact.photo}}{{else}}/assets/icons/blank-user.jpg{{/if}}">
                        </div>

                        <div class="col-xs-7 col-md-6">
                            <div class="btn-edit-photo-controls hidden-md hidden-lg">
                                <div class="btn btn-primary btn-remove-photo">Remove Photo</div>
                                <div class="btn btn-primary btn-upload-photo">Upload Photo</div>
                            </div>
                        </div>
                    </row>
                </div>
            </div>

            <!-- CONTACT DETAILS -->
            <div class="col-md-6">
                <h4>Contact Information</h4>
                <hr/>

                <div id="phone-row" class="row">
                    <div class="col-xs-1"><i class="icon-main fa fa-phone"/></div>
                    <div class="col-xs-10">
                        <div id="edit-phones-container">
                            {{#each contact.details}}
                            {{#canEditContactDetails this}}
                            {{#each ../phones}}
                            {{> edit-phone}}
                            {{/each}}
                            {{else}}
                            {{#each phones}}
                            <div>
                                <a href="tel:+1{{number}}">+1 {{number}}</a>
                                <small>{{phoneTypeLabel type}}</small>
                                <i class="icon-social {{iconFromSocialType ../type}}"/>
                            </div>
                            {{/each}}
                            {{/canEditContactDetails}}
                            {{/each}}

                            <!-- ADD NEW PHONE -->
                            {{> edit-phone}}
                        </div>
                        <span style="margin-top:-15px;" class="col-xs-10"><small>e.g. (303-555-5555)</small></span>
                    </div>

                </div>

                <div id="address-row" class="row">
                    <div class="col-xs-1"><i class="icon-main fa fa-map-marker"/></div>
                    <div class="col-xs-10">
                        <div id="edit-addresses-container">
                            {{#each contact.details}}
                            {{#canEditContactDetails this}}
                            {{> edit-addresses}}
                            {{else}}
                            {{#each addresses}}
                            <div class="edit-address-container" id="{{_id}}">
                                {{#if address}}
                                <div>{{address}}</div>
                                {{/if}}
                                {{#if address2}}
                            </div>
                            {{address2}}
                        </div>
                        {{/if}}
                        <div>
                            {{city}}
                            {{#if state}}, {{state}}{{/if}}
                            {{#if zip}}, {{zip}}{{/if}}
                            {{#if country}}, {{country}}{{/if}}
                            <i class="icon-social {{iconFromSocialType ../../type}}"/>
                        </div>

                        {{> edit-default-shipping-billing}}
                    </div>
                    {{/each}}
                    {{/canEditContactDetails}}
                    {{/each}}
                </div>

                <br/>

                <div id="btn-new-address" class="btn btn-primary btn-sm">Add Address</div>
            </div>
        </div>

        <div id="email-row" class="row">
            <div class="col-xs-1"><i class="icon-main fa fa-envelope"/></div>
            <div class="col-xs-10">
                <div id="edit-emails-container">
                    {{#each contact.details}}
                    {{#canEditContactDetails this}}
                    {{#each emails}}
                    {{> edit-email}}
                    {{/each}}
                    {{else}}
                    {{#each emails}}
                    {{#if this}}
                    <a href="mailto:{{this}}">{{this}}</a> <i class="icon-social {{iconFromSocialType ../../type}}"/>
                    {{/if}}
                    {{/each}}
                    {{/canEditContactDetails}}
                    {{/each}}

                    {{> new-email-partial}}
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>

    <div class="modal fade" id="modal-change-photo" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" data-dismiss="modal">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Add or Remove Photo</h4>
                </div>

                <div class="modal-body">
                    <div class="row">
                        <div class="btn btn-primary col-xs-12 btn-remove-photo">Remove Photo</div>
                    </div>

                    <div class="row" style="margin-top:6px; margin-bottom:20px;">
                        <div id="btn-upload-photo-modal" class="btn btn-primary col-xs-12">Upload new photo</div>
                    </div>

                    <div id="upload-photo-container"/>

                    <img id="contact-photo-modal" src="{{contact.photo}}" style="max-width:100%; margin-top:20px;"/>
                </div>
            </div>
        </div>
    </div>
</script>
<!-- END CONTACT EDIT VIEW -->


<script type="text/x-handlebars-template" name="new-phone">
    {{> edit-phone}}
</script>


<script type="text/x-handlebars-template" name="edit-phone" partial="true">
    <div class="row edit-phone-container" data-id="{{_id}}" style="margin-top:8px;">
        <div class="form-group col-xs-12 col-sm-8 col-md-10">
            <div class="input-group">
                <div class="input-group-addon">+1</div>
                <input type="text" class="input-edit-phone form-control" value="{{number}}"/>

                <div class="input-group-btn">
                    <button type="button" class="btn-edit-phone-type btn btn-default dropdown-toggle" data-toggle="dropdown" data-type="{{type}}">
                        <span class="edit-phone-type-label">{{phoneTypeLabel this}}</span> <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu pull-right">
                        {{#phoneTypeOptions}}
                        <li class="li-edit-phone-type" data-type="{{data}}"><a href="#">{{label}}</a></li>
                        {{/phoneTypeOptions}}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</script>


<script type="text/x-handlebars-template" name="new-email">
    {{> new-email-partial}}
</script>


<script type="text/x-handlebars-template" name="edit-email" partial="true">
    <div class="row edit-email-container">
        <div class="form-group">
            <input type="email" class="form-control input-edit-email" placeholder="new email" value="{{this}}" data-email="{{this}}"/>
        </div>
    </div>
</script>


<script type="text/x-handlebars-template" name="new-email-partial" partial="true">
    <div class="row edit-email-container">
        <div class="form-group">
            <input type="email" class="form-control input-edit-email" placeholder="new email" value="" data-email=""/>
        </div>
    </div>
</script>


<script type="text/x-handlebars-template" name="new-address">
    {{> edit-address}}
</script>


<script type="text/x-handlebars-template" name="edit-addresses" partial="true">
    {{#each addresses}}
    {{> edit-address}}
    {{/each}}
</script>


<script type="text/x-handlebars-template" name="edit-address" partial="true">
    <div class="edit-address-container" data-id="{{_id}}">
        <div class="form form-horizontal">
            <div class="fg-address-string form-group">
                <label>Address</label>
                <input type="text" class="form-control input-address-string" value="{{displayName}}">
                <small>
                    <span class="address-display-name hidden">{{displayName}}</span>

                    <div class="btn-link btn-edit-address-fields">Modify</div>
                </small>
            </div>
            <div class="edit-address-fields hidden">
                <div class="form-group">
                    <label>Street Address</label>
                    <input type="text" class="form-control input-address input-address-field" value="{{address}}">
                </div>

                <div class="form-group">
                    <label>Suite / Apt</label>
                    <input type="text" class="form-control input-address2 input-address-field" value="{{address2}}">
                </div>

                <div class="form-group">
                    <label>City, State, Zip</label>
                    <input type="text" class="form-control input-city input-address-field" value="{{city}}">
                    <input type="text" class="form-control input-state input-address-field" value="{{state}}">
                    <input type="text" class="form-control input-zip input-address-field" value="{{zip}}">

                    <small>
                        <span class="address-display-name">{{displayName}}</span>

                        <div class="btn-link btn-cancel-edit-address-fields">Close</div>
                    </small>
                </div>
            </div>
        </div>
        {{> edit-default-shipping-billing}}
    </div>
</script>


<script type="text/x-handlebars-template" name="edit-default-shipping-billing" partial="true">
    <div class="hidden-xs hidden-sm">
        <div class="checkbox">
            <label>
                <input class="chk-default-shipping" type="checkbox" {{#if defaultShipping}}checked{{/if}}/> Default
                Shipping
            </label>
        </div>

        <div class="checkbox">
            <label>
                <input class="chk-default-billing" type="checkbox" {{#if defaultBilling}}checked{{/if}}/> Default
                Billing
            </label>
        </div>
    </div>

    <div class="hidden-md hidden-lg" style="margin-top:10px">
        <div class="btn-default-shipping btn btn-md {{#if defaultShipping}}default{{/if}}">Default Shipping
            <i class="fa fa-check"/></div>
        <div class="btn-default-billing btn btn-md {{#if defaultBilling}}default{{/if}}">Default Billing
            <i class="fa fa-check"/></div>
    </div>
</script>


<!--
HELPERS
-->
<script type="text/javascript">
    Handlebars.registerHelper("eachLetter", function (options) {
        var charCode = "A".charCodeAt();
        var str = "";
        for (var i = 0; i < 26; i++) {
            this.letter = String.fromCharCode(charCode);
            str += options.fn(this);
            charCode++;
        }
        return str;
    });


    Handlebars.registerHelper("contactTypeLabel", function (contact) {
        if (contact == null) {
            contact = this;
        }
        var contactTypes = $$.constants.contact.contact_types.dp;
        var type = _.find(contactTypes, function (type) {
            return type.data === contact.type
        });
        return type == null ? "" : type.label;
    });


    Handlebars.registerHelper("phoneTypeLabel", function (phone) {
        if (phone == null) {
            phone = this;
        }
        var phoneType = phone.hasOwnProperty("type") ? phone.type : phone;

        var phoneTypes = $$.constants.contact.phone_types.dp;
        var type = _.find(phoneTypes, function (type) {
            return type.data === phoneType
        });
        return type == null ? "mobile" : type.label;
    });


    Handlebars.registerHelper("contactTypeOptions", function (options) {
        var contactTypes = $$.constants.contact.contact_types.dp;

        var str = "";
        for (var i = 0, l = contactTypes.length; i < l; i++) {
            str += options.fn(contactTypes[i]);
        }
        return str;
    });


    Handlebars.registerHelper("phoneTypeOptions", function (options) {
        var phoneTypes = $$.constants.contact.phone_types.dp;

        var str = "";
        for (var i = 0, l = phoneTypes.length; i < l; i++) {
            str += options.fn(phoneTypes[i]);
        }
        return str;
    });


    Handlebars.registerHelper("canEditContactDetails", function (contactDetails, options) {
        if (contactDetails.type == $$.constants.contact.detail_types.LOCAL) {
            return options.fn(this);
        } else {
            return options.inverse(this);
        }
    });


    Handlebars.registerHelper("unlessHasLocalPhone", function (contact, options) {
        if (contact && contact.details != null) {
            var localDetails = _.find(contact.details, function (details) {
                return details.type === $$.constants.contact.detail_types.LOCAL
            });
            if (localDetails != null && localDetails.phones != null && localDetails.phones.length > 0) {
                return options.inverse(this);
            }
        }
        return options.fn(this);
    });


    Handlebars.registerHelper("unlessAddressIsEmpty", function (address, options) {
        if (address) {
            if (String.isNullOrEmpty(address.address) && String.isNullOrEmpty(address.address2) && String.isNullOrEmpty(address.city)
                    && String.isNullOrEmpty(address.state) && String.isNullOrEmpty(address.zip) && String.isNullOrEmpty(address.country)) {
                return options.inverse(this);
            } else {
                return options.inverse(this);
            }
        } else {
            return options.inverse(this);
        }
    });


    Handlebars.registerHelper("getBestEmail", function(contact, options) {
        if (contact.details != null && contact.details.length > 0) {
            //see if we have a google contact, that's the best source of email
            var details = _.findWhere(contact.details, { type: $$.constants.social.types.GOOGLE });
            if (details != null && details.emails != null && details.emails.length > 0) {
                this.$email = details.emails[0];
                return options.fn(this);
            }

            for(var i = 0; i < contact.details.length; i++) {
                var details = contact.details[0];
                if (details != null && details.emails != null && details.emails.length > 0) {
                    this.$email = details.emails[0];
                    return options.fn(this);
                }
            }
            return options.inverse(this);
        }
    });


    Handlebars.registerHelper("getFacebookId", function(contact, options) {
        if (contact.details != null && contact.details.length > 0) {
            //see if we have a google contact, that's the best source of email
            var details = _.findWhere(contact.details, { type: $$.constants.social.types.FACEBOOK });
            if (details != null) {
                this.$facebookId = details.socialId;
                return options.fn(this);
            }

            return options.inverse(this);
        }
    });


    Handlebars.registerHelper("getTwitterId", function(contact, options) {
        if (contact.details != null && contact.details.length > 0) {
            //see if we have a google contact, that's the best source of email
            var details = _.findWhere(contact.details, { type: $$.constants.social.types.TWITTER });
            if (details != null) {
                this.$twitterId = details.socialId;
                return options.fn(this);
            }

            return options.inverse(this);
        }
    });


    Handlebars.registerHelper("getLinkedInId", function(contact, options) {
        if (contact.details != null && contact.details.length > 0) {
            //see if we have a google contact, that's the best source of email
            var details = _.findWhere(contact.details, { type: $$.constants.social.types.LINKEDIN });
            if (details != null) {
                if (details.websites != null && details.websites.length > 0) {
                    for (var i = 0; i < details.websites.length; i++) {
                        if (details.websites[i] != null) {
                            this.$linkedInUrl = details.websites[i];
                            return options.fn(this);
                        }
                    }
                }
                this.$linkedInId = details.socialId;
                return options.fn(this);
            }

            return options.inverse(this);
        }
    });


    Handlebars.registerHelper("getAddress", function(contact, options) {
        var _address = null;
        if (contact.details != null && contact.details.length > 0) {
            for (var i = 0; i < contact.details.length; i++) {
                var details = contact.details[i];
                if (details.addresses != null && details.addresses.length > 0) {
                    for (var j = 0; j < details.addresses.length; j++) {
                        var address = details.addresses[j];
                        if (address) {
                            if (address.displayName != null) {
                                this.$address = encodeURIComponent(address.displayName);
                                return options.fn(this);
                            } else {
                                if (_address == null) {
                                    _address = address;
                                } else {
                                    if (address.address != null && address.city != null) {
                                        _address = address;
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }

        if (_address != null) {
            var addressStr = "";
            if (String.isNullOrEmpty(_address.address)) {
                addressStr += _address.address;
            }

            if (String.isNullOrEmpty(_address.city)) {
                addressStr += ", " + address.city;
            }

            if (String.isNullOrEmpty(_address.state)) {
                addressStr += ", " + address.state;
            }

            if (String.isNullOrEmpty(_address.zip)) {
                addressStr += ", " + _address.zip;
            }

            this.$address = encodeURIComponent(addressStr);
            return options.fn(this);
        }

        return options.inverse(this);
    });


    Handlebars.registerHelper("contactSources", function(contact, options) {

    });

    Handlebars.registerHelper("isGoogleImage", function (photo, options) {
        if (String.isNullOrEmpty(photo) == false && photo.indexOf("www.google.com/m8") > -1) {
            return options.fn(this);
        } else {
            return options.inverse(this);
        }
    });
</script>