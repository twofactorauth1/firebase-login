<div class="customer-detail" ng-controller="ContactDetailCtrl">
<indig-navprompt class="indig-navprompt" my-state="{{$state.$current.name}}" reset-dirty="resetDirty()" check-if-dirty="checkIfDirty()" save-page="contactSaveFn()" save-page-check="!pageSaving"></indig-navprompt>
    <section id="page-title" class="padding-top-15 padding-bottom-15">
        <div class="row">
            <div class="col-sm-8">
                <h1 class="mainTitle">{{ data.loaded ? (data.fullName || 'No Contact Name') : 'Loading..'}} </h1>
                <span class="mainDescription">{{displayCustomerTags()}}</span>
            </div>
        </div>
    </section>
    <div class="col-xs-12">
        <button ng-if="redirectToOrder" type="button" class="btn btn-primary btn-o pull-right btn btn-primary btn-o margin-top-5 margin-bottom-5 margin-left-5" ng-click="backToOrder()">
            Back to Order
        </button>
        <button type="button" class="btn btn-primary btn-o pull-right btn btn-primary btn-o margin-top-5 margin-bottom-5" ng-click="backToContacts()">
            Back to Contacts
        </button>
    </div>
    <div class="container-fluid container-fullw" ng-class="{'margin-top-20':redirectToOrder}">
        <div class="row">
            <div class="col-md-12">
                <div>
                    <tabset class="tabbable">
                        <tab heading="Contact Details" select="resizeMap()">
                            <div class="row">
                                <div class="col-md-6">
                                    <form action="#" name="form" role="form" id="form">
                                        <fieldset>
                                            <legend>
                                                Image Upload
                                            </legend>
                                            <div class="form-group center">
                                                <div flow-init flow-object="obj.flow">
                                                    <div class="user-image">
                                                        <div class="thumbnail margin-bottom-5">
                                                            <img ng-src="{{ contact.photo }}" err-src="/admin/assets/images/default-user.png">
                                                        </div>
                                                    </div>
                                                    <div class="user-image-buttons-edit">
                                                        <span class="btn btn-primary" ng-click="openMediaModal()"><i class="fa fa-pencil"></i></span>
                                                        <span class="btn btn-danger" ng-click="removePhoto()"><i class="fa fa-times"></i> </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </fieldset>
                                        <div class="form-group">
                                            <label class="">Name</label>
                                            <input id="input-fullname" class="form-control" ng-model="data.fullName" placeholder="Full name" type="text" ng-change="setFullName()">
                                            <small>
                                                <strong>First:</strong>
                                                <code>
                                                    <span id="hint-first">{{contact.first}}</span>
                                                </code>
                                                <strong>Middle:</strong>
                                                <code>
                                                    <span id="hint-middle">{{contact.middle}}</span>
                                                </code>
                                                <strong>Last:</strong>
                                                <code>
                                                    <span id="hint-last">{{contact.last}}</span>
                                                </code>
                                            </small>
                                            <span class="links cl-effect-1">
                                            <a href="" ng-click="showSplitName = true" ng-show="!showSplitName">Modify</a>
                                            </span>
                                                <span class="links cl-effect-1">
                                                <a href="" ng-click="showSplitName = false" ng-show="showSplitName">Cancel</a>
                                            </span>
                                        </div>
                                        <div class="form-group" ng-show="showSplitName">
                                            <label class="">First Name</label>
                                            <input id="input-first" class="form-control" ng-model="contact.first" placeholder="First name" type="text" ng-change="updateFullName()">
                                        </div>
                                        <div class="form-group" ng-show="showSplitName">
                                            <label class="">Middle Name</label>
                                            <input id="input-middle" class="form-control" ng-model="contact.middle" placeholder="Middle name" type="text" ng-change="updateFullName()">
                                        </div>
                                        <div class="form-group" ng-show="showSplitName">
                                            <label class="">Last Name</label>
                                            <input id="input-last" class="form-control" ng-model="contact.last" placeholder="Last name" type="text" ng-change="updateFullName()">
                                        </div>
                                        <div class="form-group">
                                            <label class="block">
                                                Gender
                                            </label>
                                            <div class="clip-radio radio-primary">
                                                <input type="radio" ng-checked="contact.gender.toLowerCase() == 'female'" id="us-female" name="gender" value="female" ng-model="contact.gender">
                                                <label for="us-female">
                                                    Female
                                                </label>
                                                <input type="radio" ng-checked="contact.gender.toLowerCase() == 'male'" id="us-male" name="gender" value="male" ng-model="contact.gender">
                                                <label for="us-male">
                                                    Male
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-group customer-tags">
                                            <label class="block">
                                                Tags
                                            </label>
                                            <ui-select tagging="tagToContact" tagging-match-to-key="label" multiple ng-model="contact.tags" theme="bootstrap" ng-disabled="disabled">
                                                <ui-select-match placeholder="Select tags...">{{$item.label}}</ui-select-match>
                                                <ui-select-choices repeat="tag in contactTags | orderBy:'label' | filter:$select.search">
                                                    {{tag.label}}
                                                </ui-select-choices>
                                            </ui-select>
                                        </div>
                                        <div>
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div>
                                                        <label class="control-label">
                                                            Email Address
                                                        </label>
                                                        <div class="form-group" ng-if="!contact.details[0].emails">
                                                            <span class="input-icon input-icon-right">
                                                                <input type="email" placeholder="Email address" class="form-control" name="email" ng-model="contact.details[0].emails[$index].email" ng-blur="updateCustomer()">
                                                                <i ng-if="showAddEmail(email)" ng-click="contactAddEmailFn()" class="ti-plus"></i>
                                                                <i ng-if="!showAddEmail(email)" ng-click="removeEmail($index)" class="ti-minus"></i>
                                                            </span>
                                                        </div>
                                                        <div class="form-group" ng-class="{ 'has-error' : form.email_{{$index}}.$invalid}" ng-repeat="email in contact.details[0].emails  track by $index">
                                                            <span class="input-icon input-icon-right">
                                                                <input type="email"  ng-pattern="formValidations.email" placeholder="Email address" class="form-control" name="email_{{$index}}" ng-model="contact.details[0].emails[$index].email" ng-blur="updateCustomer()">
                                                                <p ng-show="form.email_{{$index}}.$invalid" class="help-block">Enter a valid email.</p>
                                                                <i ng-if="showAddEmail(email)" ng-click="contactAddEmailFn()" class="ti-plus"></i>
                                                                <i ng-if="!showAddEmail(email)" ng-click="removeEmail($index)" class="ti-minus"></i>
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div ng-repeat="phone in contact.details[0].phones  track by $index">
                                                        <div class="row">
                                                            <div class="col-md-8">
                                                                <div class="form-group" ng-class="{ 'has-error' : form.phone_{{$index}}.$invalid && !form.phone_{{$index}}.$pristine}">
                                                                    <label class="control-label">
                                                                        Phone Number
                                                                    </label>
                                                                   <input type="text" placeholder="Phone number" class="form-control"  name="phone_{{$index}}" ng-model="contact.details[0].phones[$index].number" ng-blur="updateCustomer()" ind-international-tel-number form="form" phone-field="true">
                                                                   <p ng-show="form.phone_{{$index}}.$invalid && !form.phone_{{$index}}.$pristine" class="help-block">Enter a valid phone number.</p>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-4">
                                                                <div class="form-group" ng-class="{ 'has-error' : form.extension_{{$index}}.$invalid && !form.extension_{{$index}}.$pristine}">
                                                                    <label class="control-label">
                                                                        Extension
                                                                    </label>
                                                                    <input type="text" placeholder="Extension" class="form-control" ng-pattern="formValidations.extension" name="extension_{{$index}}" ng-model="contact.details[0].phones[$index].extension" ng-blur="updateCustomer()">
                                                                    <p ng-show="form.extension_{{$index}}.$invalid && !form.extension_{{$index}}.$pristine" class="help-block">Enter a valid extension.</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div ng-if="showAddPhone(phone)" class="btn btn-wide btn-o btn-primary pull-right" ng-click="addContactPhoneFn()">Add another phone</div>
                                                            <div ng-if="!showAddPhone(phone)" class="btn btn-wide btn-o btn-warning pull-right" ng-click="removePhone($index)">Remove phone</div>
                                                        </div>
                                                        <div class="clearfix"></div>
                                                    </div>
                                                    <div>
                                                        <label class="control-label">
                                                            Website URL
                                                        </label>
                                                        <div class="form-group">
                                                            <span class="input-icon input-icon-right">
                                                                <input type="text" placeholder="Website URL" class="form-control" name="website" ng-model="contact.details[0].websites[0].website" ng-blur="updateCustomer()">
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <label class="control-label">
                                                            Company Name
                                                        </label>
                                                        <div class="form-group">
                                                            <span class="input-icon input-icon-right">
                                                                <input type="text" placeholder="Company name" class="form-control" name="company" ng-model="contact.details[0].company" ng-blur="updateCustomer()">
                                                            </span>
                                                        </div>
                                                    </div>
                                                    <div ng-repeat="address in contact.details[0].addresses  track by $index"
                                                         ng-if="!($index>0 && address.displayName=='GEOIP')"
                                                         >
                                                        <div class="row">
                                                            <div class="col-md-4">
                                                                <div class="form-group" ng-class="{'has-error':errorMapData}">
                                                                    <label class="control-label">
                                                                        Address Line 1
                                                                    </label>
                                                                    <input class="form-control" placeholder="Address line 1" type="text" name="addressline1" ng-model="address.address">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-8">
                                                                <div class="form-group" ng-class="{'has-error':errorMapData}">
                                                                    <label class="control-label">
                                                                        Address Line 2
                                                                    </label>
                                                                    <input class="form-control" placeholder="Address line 2" type="text" name="addressline2" ng-model="address.address2">
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-4">
                                                                <div class="form-group" ng-class="{'has-error':errorMapData}">
                                                                    <label class="control-label">
                                                                        City
                                                                    </label>
                                                                    <input class="form-control" placeholder="Enter city" type="text" name="city" ng-model="address.city">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-8">
                                                                <div class="form-group" ng-class="{'has-error':errorMapData}">
                                                                    <label class="control-label">
                                                                        State
                                                                    </label>
                                                                    <input class="form-control" placeholder="Enter state" type="text" name="state" ng-model="address.state">
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-4">
                                                                <div class="form-group" ng-class="{'has-error':errorMapData}">
                                                                    <label class="control-label">
                                                                        Country
                                                                    </label>
                                                                    <input class="form-control" placeholder="Enter country" type="text" name="country" ng-model="address.country">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-8">
                                                                <div class="form-group" ng-class="{'has-error':errorMapData}">
                                                                    <label class="control-label">
                                                                        Zip Code
                                                                    </label>
                                                                    <input class="form-control" placeholder="Enter postcode" type="text" name="zip" ng-model="address.zip">
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <div ng-if="showAddAddress(address)" class="btn btn-wide btn-o btn-primary pull-right" ng-click="contactAddAddressFn()">Add another address</div>
                                                            <div ng-if="!showAddAddress(address)" class="btn btn-wide btn-o btn-warning pull-right" ng-click="removeAddress($index)">Remove address</div>
                                                        </div>
                                                        <div class="clearfix"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <table class="table table-condensed hidden">
                                            <thead>
                                                <tr>
                                                    <th colspan="3">Interactions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Page Views</td>
                                                    <td>18</td>
                                                </tr>
                                                <tr>
                                                    <td>Last Page View</td>
                                                    <td><a href="">/hello-there</a></td>
                                                </tr>
                                                <tr>
                                                    <td>Avg. Time on Site</td>
                                                    <td>1:21</td>
                                                </tr>
                                                <tr>
                                                    <td>Last Logged In</td>
                                                    <td>56 min</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </form>
                                </div>
                                <div class="col-md-6">
                                    <div class="col-xs-12">
                                        <button type="button" ng-disabled="saveLoading || isFormValid(form.$error, isPhoneDirty)" ng-click="contactSaveFn()" class="btn btn-primary pull-right margin-top-5 margin-bottom-5 margin-left-5" tooltip-placement="bottom" tooltip="Save this contact">
                    <i class="ti-save"></i><span> Save</span>
                </button>
                                        <button type="button" ng-click="undoContacts()" class="btn btn-primary pull-right margin-top-5 margin-bottom-5 margin-left-5" tooltip-placement="bottom" tooltip="Undo changes">
                    <i class="fa fa-undo"></i><span> Undo Changes</span>
                </button>
                                        <button type="button" ng-click='deleteContactFn(contact)' class="btn btn-primary btn-danger pull-right margin-top-5" tooltip-placement="bottom" tooltip="Delete this contact"><i class="ti-trash"></i> <span>Delete</span>
                                        </button>
                                    </div>
                                    <div class="map margin-bottom-15">
                                        <span class="text-bold">Location</span>
                                        <hr class="margin-top-5">
                                        <map zoom="10" center="{{location.lat}}, {{location.lon}}" disable-default-u-i="true" scale-control="false" pan-control="false" zoom-control="false" class="height-330" ng-if="!loadingMap && location.lat" scrollwheel="false">
                                            <marker position="{{location.lat}}, {{location.lon}}"></marker>
                                        </map>
                                        <div class="load1 csspinner height-330" ng-if="loadingMap"></div>
                                        <div class="height-330" ng-if="!loadingMap && !location.lat">
                                            <h4 class="center text-bold no-location">No Location</h4></div>
                                    </div>
                                    <div class="panel panel-white" id="notes">
                                        <div class="panel-heading border-light">
                                            <h4 class="panel-title">Contact <span class="text-bold">Notes</span></h4>
                                            <ct-paneltool class="panel-tools" tool-collapse="tool-collapse"></ct-paneltool>
                                        </div>
                                        <div class="panel-wrapper" collapse="notes" ng-init="notes=false">
                                            <div class="panel-body no-padding">
                                                <ul class="notes panel-scroll" perfect-scrollbar wheel-propagation="false" suppress-scroll-x="true">
                                                    <li ng-repeat="note in contact.notes">
                                                        <div class="col-xs-2">
                                                            <img src="{{note.user_profile_photo.url ? note.user_profile_photo.url : note.user_profile_photo ? note.user_profile_photo : '/admin/assets/images/default-user.png'}}" class="img-circle pull-left" width="32">
                                                        </div>
                                                        <div class="col-xs-10">
                                                            <span class="text-small block text-light">{{note.user.first}} {{note.user.last}} <span class="pull-right">{{note.date | date:'dd MMM yy'}}</span></span>
                                                            <span class="user-notes" ng-bind-html="note.note"></span>
                                                        </div>
                                                        <div class="clearfix"></div>
                                                    </li>
                                                 </ul>
                                            </div>
                                            <div class="panel-footer border-light">
                                                <label for="newNote"> New Note</label>
                                                <textarea id="newNote" class="form-control margin-bottom-15 autosize area-animated msd-elastic: \n;" ng-model="newNote.text"></textarea>
                                                <div class="checkbox clip-check check-success margin-top-10" ng-if="contact.details[0].emails[0].email">
                                                    <input type="checkbox" id="note-editable" ng-model="notesEmail.enable" >
                                                    <label for="note-editable">
                                                        Send New Note to Contact
                                                    </label>
                                                </div>
                                                <button type="button" ng-disabled="!(newNote.text)" class="btn btn-info btn-block btn-o btn-wide btn-scroll btn-scroll-top ti-plus" ng-click="addNote(newNote.text)">
                                                    <span>Add</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <contact-activity single-contact="true" current-page="1" num-per-page="10"></contact-activity>
                                    <div class="panel panel-white space20 hidden">
                                        <div class="panel-heading">
                                            <h4 class="panel-title">Recent Tweets</h4>
                                        </div>
                                        <div class="panel-body">
                                            <ul class="ltwt">
                                                <li class="ltwt_tweet">
                                                    <p class="ltwt_tweet_text">
                                                        <a href class="text-info">
                                                        @Shakespeare
                                                    </a> Some are born great, some achieve greatness, and some have greatness thrust upon them.
                                                    </p>
                                                    <span class="block text-light"><i class="fa fa-fw fa-clock-o"></i> 2 minuts ago</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </tab>
                        <tab ng-if="orders.length">
                            <tab-heading>
                                Orders <span class="badge">{{orders.length}}</span>
                            </tab-heading>
                            <div st-table="displayedOrders" st-safe-src="orders">
                                <div class="panel panel-transparent row margin-bottom-0">
                                    <div class="panel-body">
                                        <table class="table table-hover bg-white margin-bottom-0" ng-class="{'grid': tableView == 'grid', 'bg-white table-list-view': tableView != 'grid'}" ng-show="orders">
                                            <thead>
                                                <tr>
                                                    <th class="center column-width" st-sort="status">Status</th>
                                                    <th class="center column-width" st-sort="getters.items">Items</th>
                                                    <th class="center column-width" st-sort="getters.total">Total</th>
                                                    <th class="hidden-xs column-width" st-sort="created.date">Created</th>
                                                    <th class="hidden-xs column-width" st-sort="modified.date">Modified</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="order in displayedOrders" ng-click="viewSingleOrder(order._id)">
                                                    <td class="center"><strong>Status: </strong>
                                                        <span class="fa-stack">
                                                            <span class="fa fa-circle-thin fa-stack-2x"
                                        ng-class="{'text-warning': order.status == orderConstant.order_status.PENDING_PAYMENT,
                                                      'text-muted': order.status == orderConstant.order_status.ON_HOLD,
                                                      'text-azure': order.status == orderConstant.order_status.PAID,
                                                      'text-blue': order.status == orderConstant.order_status.PROCESSING,
                                                      'text-green': order.status == orderConstant.order_status.COMPLETED,
                                                      'text-purple': order.status == orderConstant.order_status.REFUNDED,
                                                      'text-orange': order.status == orderConstant.order_status.FAILED,
                                                      'text-red': order.status == orderConstant.order_status.CANCELLED,
                                                      }">
                                        </span>
                                        <span class="fa fa-stack-1x" tooltip-placement="top" tooltip="{{formatOrderStatus(order.status)}} "
                                           ng-class="{'fa-ellipsis-h text-warning': order.status == orderConstant.order_status.PENDING_PAYMENT,
                                                  'fa-minus text-muted': order.status == orderConstant.order_status.ON_HOLD,
                                                 'fa-money text-azure': order.status == orderConstant.order_status.PAID,
                                                  'fa-clock-o text-blue': order.status == orderConstant.order_status.PROCESSING,
                                                  'fa-check text-green': order.status == orderConstant.order_status.COMPLETED,
                                                  'fa-exchange text-purple': order.status == orderConstant.order_status.REFUNDED,
                                                  'fa-exclamation text-orange': order.status == orderConstant.order_status.FAILED,
                                                  'fa-times text-red': order.status == orderConstant.order_status.CANCELLED,
                                                  }">
                                        </span>
                                                        </span>
                                                    </td>
                                                    <td class="center"><strong>Items: </strong>{{order.line_items.length}}</td>
                                                    <td class="center"><strong>Total: </strong> {{order.total | currency}}</td>
                                                    <td class="hidden-xs"><strong>Created: </strong> {{order.created.date | date:'MMM d yy'}}</td>
                                                    <td class="hidden-xs"><strong>Modified: </strong>{{order.modified.date | date:'MMM d yy'}}</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <div class="load1 csspinner height-400" ng-show="!displayedOrders"></div>
                                    </div>
                                </div>
                            </div>
                        </tab>
                        <tab ng-if="donations.length">
                            <tab-heading>
                                Donations <span class="badge">{{donations.length}}</span>
                            </tab-heading>
                            <div st-table="displayedDonations" st-safe-src="donations">
                                <div class="panel panel-transparent row margin-bottom-0">
                                    <div class="panel-body">
                                        <table class="table table-hover bg-white margin-bottom-0" ng-class="{'grid': tableView == 'grid', 'bg-white table-list-view': tableView != 'grid'}" ng-show="donations">
                                            <thead>
                                                <tr>
                                                    <th class="center column-width" st-sort="status">Status</th>
                                                    <th class="center column-width" st-sort="getters.items">Items</th>
                                                    <th class="center column-width" st-sort="getters.total">Total</th>
                                                    <th class="hidden-xs column-width" st-sort="created.date">Created</th>
                                                    <th class="hidden-xs column-width" st-sort="modified.date">Modified</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="donation in displayedDonations" ng-click="viewSingle(donation)">
                                                    <td class="center"><strong>Status: </strong>
                                                        <span class="fa-stack">
                                                            <span class="fa fa-circle-thin fa-stack-2x"
                                        ng-class="{'text-warning': donation.status == orderConstant.order_status.PENDING_PAYMENT,
                                                      'text-muted': donation.status == orderConstant.order_status.ON_HOLD,
                                                      'text-blue': donation.status == orderConstant.order_status.PROCESSING,
                                                      'text-green': donation.status == orderConstant.order_status.COMPLETED,
                                                      'text-purple': donation.status == orderConstant.order_status.REFUNDED,
                                                      'text-orange': donation.status == orderConstant.order_status.FAILED,
                                                      'text-red': donation.status == orderConstant.order_status.CANCELLED,
                                                      }">
                                        </span>
                                        <span class="fa fa-stack-1x" tooltip-placement="top" tooltip="{{formatOrderStatus(donation.status)}} "
                                           ng-class="{'fa-ellipsis-h text-warning': donation.status == orderConstant.order_status.PENDING_PAYMENT,
                                                      'fa-minus text-muted': donation.status == orderConstant.order_status.ON_HOLD,
                                                      'fa-clock-o text-blue': donation.status == orderConstant.order_status.PROCESSING,
                                                      'fa-check text-green': donation.status == orderConstant.order_status.COMPLETED,
                                                      'fa-exchange text-purple': donation.status == orderConstant.order_status.REFUNDED,
                                                      'fa-exclamation text-orange': donation.status == orderConstant.order_status.FAILED,
                                                      'fa-times text-red': donation.status == orderConstant.order_status.CANCELLED,
                                                      }">
                                        </span>
                                                        </span>
                                                    </td>
                                                    <td class="center"><strong>Items: </strong>{{donation.line_items.length}}</td>
                                                    <td class="center"><strong>Total: </strong> {{donation.total | currency}}</td>
                                                    <td class="hidden-xs"><strong>Created: </strong> {{donation.created.date | date:'MMM d yy'}}</td>
                                                    <td class="hidden-xs"><strong>Modified: </strong>{{donation.modified.date | date:'MMM d yy'}}</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <div class="load1 csspinner height-400" ng-show="!displayedDonations"></div>
                                    </div>
                                </div>
                            </div>
                        </tab>
                    </tabset>
                </div>
            </div>
        </div>
    </div>
</div>
