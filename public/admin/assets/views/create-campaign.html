<div ng-controller="CreateCampaignCtrl" class="create-campaign">
    <!-- start: PAGE TITLE -->
    <section id="page-title" class="padding-top-15 padding-bottom-15">
        <div class="row">
            <div class="col-sm-8">
                <h1 class="mainTitle" translate="campaign.NEWCAMPAIGN"></h1>
                <span class="mainDescription" translate="campaign.DESCRIPTION">Create a new campaign to reach a group of contacts</span>
            </div>
            <div ncy-breadcrumb></div>
        </div>
    </section>
    <div class="row">
        <!-- start: WIZARD FORM -->
        <form name="CreateCampaign" id="form" novalidate>
            <div id="wizard" class="swMain">
                <!-- start: WIZARD SEPS -->
                <ul class="margin-bottom-0">
                    <li ng-click="form.goTo(1)">
                        <a href ng-class="{'selected' : currentStep >= 1, 'done' : currentStep > 1}" tooltip-placement="bottom" tooltip-html-unsafe="Enter a campaign name and select type">
                            <div class="stepNumber">
                                1
                            </div>
                            <span class="stepDesc text-small"> Details  </span>
                        </a>
                    </li>
                    <li ng-click="form.goTo(2)">
                        <a href ng-class="{'selected' : currentStep >= 2, 'done' : currentStep > 2}" tooltip-placement="bottom" tooltip-html-unsafe="Add contacts to the campaign">
                            <div class="stepNumber">
                                2
                            </div>
                            <span class="stepDesc text-small"> Contacts </span>
                        </a>
                    </li>
                    <li ng-click="form.goTo(3)">
                        <a href ng-class="{'selected' : currentStep >= 3, 'done' : currentStep > 3}" tooltip-placement="bottom" tooltip-html-unsafe="Customize the email content">
                            <div class="stepNumber">
                                3
                            </div>
                            <span class="stepDesc text-small"> Design </span>
                        </a>
                    </li>
                    <li ng-click="form.goTo(4)">
                        <a href ng-class="{'selected' : currentStep >= 4, 'done' : currentStep > 4}" tooltip-placement="bottom" tooltip-html-unsafe="Select a date/time and review">
                            <div class="stepNumber">
                                4
                            </div>
                            <span class="stepDesc text-small"> Delivery </span>
                        </a>
                    </li>
                </ul>
                <!-- end: WIZARD SEPS -->
                <!-- start: WIZARD STEP 1 -->
                <div class="container-fluid container-fullw bg-white padding-top-0 padding-bottom-0 campaign-step-wrap">
                    <div class="col-sm-12">
                        <div id="step-1" ng-show="currentStep == 1" class="campaign-step" ng-class="{'next': goingTo == 'next', 'prev': goingTo == 'prev'}">
                            <div class="row">
                                <div class="col-md-5">
                                    <div class="padding-30 center">
                                        <h2 class="StepTitle"><i class="fa fa-paper-plane fa-2x text-primary block margin-bottom-10"></i> Campaign Details</h2>
                                        <p>
                                            We need to know a few things about your campaign like what you want to name it and what kind of campaign you want to create.
                                        </p>
                                    </div>
                                </div>
                                <div class="col-md-7">
                                    <div class="clearfix margin-bottom-30"></div>
                                    <div class="form-group" ng-class="{'has-error':CreateCampaign.name.$dirty && CreateCampaign.name.$invalid}">
                                        <label>
                                            Campaign Name <span class="symbol required"></span>
                                        </label>
                                        <span class="help-block text-small text-muted">Enter a campaign name that will help you remember what the campaign is about. Will only be visible to you.</span>
                                        <input type="text" placeholder="Campaign Name" class="form-control input-lg" name="name" ng-model="newCampaignObj.name" ng-required="currentStep == 1" />
                                        <span class="error text-small block" ng-if="CreateCampaign.name.$dirty && CreateCampaign.name.$invalid">Campaign Name is required</span>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            Campaign Type <span class="symbol required"></span>
                                        </label>
                                        <span class="help-block text-small text-muted">Choose the type of campaign you want to create. Default is One Time.</span>
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <div class="panel animated no-radius text-center margin-bottom-0 cursor-pointer" ng-class="{true:'panel-light-grey pulse',false:'panel-white'}[newCampaignObj.type == 'onetime']">
                                                    <div class="panel-body" ng-class="{'bg-light-grey': hover1}" ng-mouseenter="hover1 = true" ng-mouseleave="hover1 = false" ng-click="newCampaignObj.type = 'onetime'">
                                                        <span ng-if="newCampaignObj.type == 'onetime'" class="fa fa-check-circle text-success fa-2x" style="position:absolute; top:o;right:0;margin-right:5px;margin-top:-10px;"></span>
                                                        <span class="fa-stack fa-2x"> <i class="fa fa-square fa-stack-2x text-primary"></i> <i class="fa fa-envelope fa-stack-1x fa-inverse"></i> </span>
                                                        <h3 class="StepTitle">One Time</h3>
                                                        <p class="text-small">
                                                            Send a standard one time email to a group of contacts.
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-sm-6">
                                                <div class="panel animated no-radius text-center margin-bottom-0 cursor-pointer" ng-class="{true:'panel-light-grey pulse',false:'panel-white'}[newCampaignObj.type == 'autoresponder']">
                                                    <div class="panel-body" ng-class="{'bg-light-grey': hover2}" ng-mouseenter="hover2 = true" ng-mouseleave="hover2 = false" ng-click="newCampaignObj.type = 'autoresponder'">
                                                        <span ng-if="newCampaignObj.type == 'autoresponder'" class="fa fa-check-circle text-success fa-2x" style="position:absolute; top:o;right:0;margin-right:5px;margin-top:-10px;"></span>
                                                        <span class="fa-stack fa-2x"> <i class="fa fa-square fa-stack-2x text-primary"></i> <i class="fa fa-bullhorn fa-stack-1x fa-inverse"></i> </span>
                                                        <h3 class="StepTitle">AutoResponder</h3>
                                                        <p class="text-small">
                                                            Auomatically send an email after a contact subscribes
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end: WIZARD STEP 1 -->
                        <!-- start: WIZARD STEP 2 -->
                        <div id="step-2" ng-show="currentStep == 2" class="campaign-step" ng-class="{'next': goingTo == 'next', 'prev': goingTo == 'prev'}">
                            <div class="row">
                                <div class="col-md-5">
                                    <div class="padding-30 center">
                                        <h2 class="StepTitle"><i class="fa fa-users fa-2x text-primary block margin-bottom-10"></i> Campaign Recipients</h2>
                                        <p>
                                            Who do you wants to recieve this campaign? Select the customer grouped by tags or individual customers.
                                        </p>
                                    </div>
                                    <div class="avatars center">
                                        <ul class="unstyled-list inline-list padding-left-0">
                                            <li ng-repeat="contact in recipients track by $index | limitTo: 5">
                                                <img ng-src="{{ contact.photo }}" id="customer_photo_{{contact._id}}" err-src="" err-contact="contact" class="img-thumbnail img-circle screenshot animated bounce" alt="image" width="30" height="30" tooltip-placement="top" tooltip-html-unsafe="{{contact.first}} {{contact.last}} <br> {{checkBestEmail(contact)}}">
                                            </li>
                                        </ul>
                                        <button ng-if="recipients.length > 0" class="btn btn-primary btn-wide btn-o margin-bottom-15">View Full Contact List</button>
                                    </div>
                                    <div class="margin-bottom-30 center">
                                        <span class="text-muted text-large">{{recipients.length}} / {{customers.length}} contacts selected.</span>
                                    </div>
                                </div>
                                <div class="col-md-7">
                                    <div class="clearfix margin-bottom-30"></div>
                                    <label>
                                        Select Recipients<span class="symbol required"></span>
                                    </label>
                                    <div class="panel panel-white">
                                        <div class="panel-body no-padding">
                                            <tabset>
                                                <tab heading="by Tag">
                                                    <div class="checkbox clip-check check-primary" ng-repeat="count in customerCounts track by $index">
                                                        <input type="checkbox" id="checkbox{{count.uniqueTag}}" value="{{count.matchingTag}}" ng-click="toggleSelection(count.matchingTag)" ng-checked="tagSelection.indexOf(count.matchingTag) > -1">
                                                        <label for="checkbox{{count.uniqueTag}}">
                                                            <span class="badge">{{count.numberOfTags}}</span> {{count.matchingTag}}
                                                        </label>
                                                    </div>
                                                </tab>
                                                <tab heading="by Customer">
                                                    <span>Select individuals from your customer list</span>
                                                    <ui-select multiple ng-model="selectedCustomers.individuals" theme="bootstrap" ng-disabled="disabled" close-on-select="false" style="width: 100%;max-height:250px;overflow:auto" reset-search-input="true">
                                                        <ui-select-match placeholder="Select Customers...">{{$item.first}} {{$item.last}} ({{$item.details[0].emails[0].email}})</ui-select-match>
                                                        <ui-select-choices repeat="customer._id as customer in customers | filter:$select.search">
                                                            {{customer.first}} {{customer.last}}
                                                            <small ng-if="customer.details[0].emails[0].email.length > 0">{{customer.details[0].emails[0].email}}</small>
                                                        </ui-select-choices>
                                                    </ui-select>
                                                </tab>
                                                <tab heading="by Emails">
                                                    <span>Enter emails manually seperated by a comma.</span>
                                                    <textarea class="form-control autosize area-animated msd-elastic: \n;" ng-model="selectedCustomers.newEmails"></textarea>
                                                    <span class="text-muted">Emails not currently in your list will automatically become customers.</span>
                                                </tab>
                                            </tabset>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end: WIZARD STEP 2 -->
                        <!-- start: WIZARD STEP 3 -->
                        <div id="step-3" ng-show="currentStep == 3" class="campaign-step" ng-class="{'next': goingTo == 'next', 'prev': goingTo == 'prev'}">
                            <div class="row">
                                <div class="col-md-5">
                                    <div class="padding-30 center">
                                        <h2 class="StepTitle"><i class="fa fa-envelope fa-2x text-primary block margin-bottom-10"></i> Email Design</h2>
                                        <p>
                                            Design a custom email or select an email from email templates.
                                        </p>
                                    </div>
                                </div>
                                <div class="col-md-7">
                                    <div class="panel panel-white margin-top-30 margin-bottom-0">
                                        <div class="panel-body">
                                            <div class="form-group margin-bottom-0">
                                                <label class="control-label text-bold">
                                                    From Name
                                                </label>
                                                <span>{{emailToSend.fromName}}</span>
                                            </div>
                                            <div class="form-group margin-bottom-0">
                                                <label class="control-label text-bold">
                                                    From Email
                                                </label>
                                                <span>{{emailToSend.fromEmail}}</span>
                                            </div>
                                            <div class="form-group margin-bottom-0">
                                                <label class="control-label text-bold">
                                                    Reply To
                                                </label>
                                                <span>{{emailToSend.replyTo}}</span>
                                            </div>
                                            <div class="form-group margin-bottom-0">
                                                <label class="control-label text-bold">
                                                    Subject
                                                </label>
                                                <span>{{emailToSend.subject}}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="margin-bottom-30" style="transform: translate3d(0,0,0);" ng-controller="EditorCtrl" ng-init="retrieveEmail(null, emailToSend); activateCKeditor();">
                                        <div sticky offset="0" sticky-class="editor-toolbar-wrap">
                                            <div id="editor-toolbar"></div>
                                        </div>
                                        <div class="clearfix"></div>
                                        <div ng-hide="!ckeditorLoaded" style="margin-top:55px">
                                            <div data-ng-include data-src=" 'assets/views/partials/component-loader.html' "></div>
                                        </div>
                                        <div class="loading-editor" ct-fullheight="window" data-ct-fullheight-exclusion="header" ng-hide="ckeditorLoaded">
                                            <div class="col-xs-12">
                                                <h1 class="center"><span class="fa fa-spinner fa-spin"></span><br> Loading Editor...</h1>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end: WIZARD STEP 3 -->
                        <!-- start: WIZARD STEP 4 -->
                        <div id="step-4" ng-show="currentStep == 4" class="campaign-step" ng-class="{'next': goingTo == 'next', 'prev': goingTo == 'prev'}">
                            <div class="row margin-top-30">
                                <div class="col-md-5">
                                    <div class="padding-30 center">
                                        <h2 class="StepTitle"><i class="fa fa-paper-plane fa-2x text-primary block margin-bottom-10"></i> Delivery</h2>
                                        <p>
                                            Review the campaign details, select a time to start the campaign and launch.
                                        </p>
                                    </div>
                                    <div class="list-group">
                                        <a class="list-group-item" href="#">
                                            <h5 class="list-group-item-heading">Details</h5>
                                            <p class="list-group-item-text">
                                                Adding a new <span class="text-bold">{{newCampaignObj.type}}</span> campaign titled <span class="text-bold">{{newCampaignObj.name}}</span>.
                                            </p>
                                        </a>
                                        <a class="list-group-item" href="#">
                                            <h5 class="list-group-item-heading">Recipients</h5>
                                            <p class="list-group-item-text">
                                                Sending to <span class="text-bold">{{recipients.length}}</span> contacts.
                                            </p>
                                        </a>
                                        <a class="list-group-item" href="#">
                                            <h5 class="list-group-item-heading">Design</h5>
                                            <p class="list-group-item-text">
                                                Using a new email template.
                                            </p>
                                        </a>
                                    </div>
                                    <div class="panel panel-white">
                                        <div class="panel-heading border-light">
                                            <h5 class="panel-title">When to Send?</h5>
                                        </div>
                                        <div class="panel-body">
                                            <div class="radio clip-radio radio-primary">
                                                <input type="radio" id="radio3" name="vertical" value="now" ng-model="whenToSend">
                                                <label for="radio3">
                                                    Send Now
                                                </label>
                                                <p class="text-muted margin-15" ng-if="whenToSend === 'now'">{{today }}</p>
                                            </div>
                                            <div class="radio clip-radio radio-primary">
                                                <input type="radio" id="radio4" name="vertical" value="later" ng-model="whenToSend">
                                                <label for="radio4">
                                                    Send Later
                                                </label>
                                                <p class="input-group pull-left" ng-if="whenToSend === 'later'">
                                                    <input type="text" class="form-control" datepicker-popup="dd-MMMM-yyyy" ng-model="order.created.date" is-open="opened" min-date="minDate" max-date="'2015-06-22'" datepicker-options="dateOptions" date-disabled="disabled(date, mode)" ng-required="true" close-text="Close" />
                                                    <span class="input-group-btn">
                                                    <button type="button" class="btn btn-default" ng-click="open($event)">
                                                        <i class="glyphicon glyphicon-calendar"></i>
                                                    </button> </span>
                                                </p>
                                            </div>
                                            <div class="radio clip-radio radio-primary" ng-model="whenToSend">
                                                <input type="radio" id="radio5" name="vertical" value="best">
                                                <label for="radio5">
                                                    Send Best Time
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-7">
                                    <div class="panel panel-white">
                                        <div class="panel-body">
                                            <div style="max-height:300px;overflow:hidden" class="border-around border-light">
                                                <img src="http://indigenous-screenshots.s3.amazonaws.com/account_536/1432017910483.png" class="img-responsive" />
                                            </div>
                                            <div class="clearfix"></div>
                                            <div class="form-group margin-bottom-0 margin-top-30">
                                                <label class="control-label text-bold">
                                                    From Name
                                                </label>
                                                <span>{{emailToSend.fromName}}</span>
                                            </div>
                                            <div class="form-group margin-bottom-0">
                                                <label class="control-label text-bold">
                                                    From Email
                                                </label>
                                                <span>{{emailToSend.fromEmail}}</span>
                                            </div>
                                            <div class="form-group margin-bottom-0">
                                                <label class="control-label text-bold">
                                                    Reply To
                                                </label>
                                                <span>{{emailToSend.replyTo}}</span>
                                            </div>
                                            <div class="form-group margin-bottom-0">
                                                <label class="control-label text-bold">
                                                    Subject
                                                </label>
                                                <span>{{emailToSend.subject}}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end: WIZARD STEP 4 -->
                    </div>
                </div>
                <div class="col-md-12 bg-light-grey padding-30">
                    <div class="form-group">
                        <div ng-if="currentStep > 1">
                            <button class="btn btn-primary btn-o back-step btn-wide pull-left" ng-click="form.prev(Form)">
                                <i class="fa fa-chevron-left"></i> Back
                            </button>
                        </div>
                        <div ng-if="currentStep < 4">
                            <button class="btn btn-primary btn-o next-step btn-wide pull-right" ng-click="form.next(Form)">
                                <span> Next </span> <i class="fa fa-chevron-right"></i>
                            </button>
                        </div>
                        <div ng-if="currentStep == 4">
                            <button class="btn btn-success btn-wide pull-right" ng-click="completeNewCampaign()">
                                <span> Activate Campaign </span> <i class="fa fa-clock-o"></i>
                            </button>
                            <button class="btn btn-info btn-wide pull-right margin-right-5" ng-click="sendTestCampaign()">
                                <span> Send Test </span> <i class="fa fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <!-- end: WIZARD FORM -->
</div>
