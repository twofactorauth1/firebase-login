<div ng-controller="SocialFeedCtrl" class="social-feed" ng-init="getSocialConfig()">
    <indig-onboarding min-requirements="minRequirements"></indig-onboarding>
    <!-- start: PAGE TITLE -->
    <section id="page-title" class="padding-top-15 padding-bottom-15">
        <div class="row">
            <div class="col-sm-8">
                <h1 class="mainTitle" translate="sidebar.nav.marketing.SOCIALFEED"></h1>
                <span class="mainDescription">View and Manage all social feeds.</span>
            </div>
        </div>
    </section>
    <!-- end: PAGE TITLE -->
    <!-- start: YOUR CONTENT HERE -->
    <div class="row margin-top-15">
        <div class="col-sm-9">
            <div class="submit-post-form col-xs-12">
                <div class="panel panel-white">
                    <div class="panel-body">
                        <div class="form-group margin-bottom-0" ng-class="{'has-error': noContent || duplicatePostError}">
                            <textarea placeholder="Write something..." class="form-control" ng-model="postContent" rows="4" ng-change="postContentChange()"></textarea>
                            <span class="help-block margin-bottom-0" ng-show="noContent"><span class="symbol required"></span> <span class="text-bold">Error:</span> Post Content Needed</span>
                            <span class="help-block margin-bottom-0" ng-show="duplicatePostError"><span class="symbol required"></span> <span class="text-bold">Error:</span> Duplicate Post Status</span>
                        </div>
                    </div>
                    <!-- panel-body -->
                    <div class="panel-footer padding-10">
                        <div class="col-sm-4">
                            <div class="form-horizontal">
                                <div class="form-group margin-bottom-0" ng-class="{'has-error': noPostTo}">
                                    <ui-select ng-model="selectedSocial" on-select="postToChange($select.selected)" theme="bootstrap">
                                        <ui-select-match placeholder="Select a Social Profile">
                                            <span class="fa" ng-class="{'fa-facebook': $select.selected.type == 'fb', 'fa-twitter': $select.selected.type == 'tw'}"></span>
                                            <small ng-bind-html="$select.selected.username || $select.selected.name || $select.selected.profile.name"></small>
                                        </ui-select-match>
                                        <ui-select-choices repeat="acc in trackedAccounts | filter:productionReadyAccount">
                                            <span class="fa" ng-class="{'fa-facebook': acc.type == 'fb', 'fa-twitter': acc.type == 'tw'}"></span>
                                            <small ng-bind-html="acc.username || acc.name || acc.profile.name | highlight: $select.search"></small>
                                        </ui-select-choices>
                                    </ui-select>
                                    <span class="help-block margin-bottom-0" ng-show="noPostTo"><span class="symbol required"></span> <span class="text-bold">Error:</span> No Social Profile Selected</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group margin-bottom-0">
                                <ui-select ng-model="sortBy" on-select="sortFeed($select.selected)" theme="bootstrap">
                                    <ui-select-match placeholder="Order By">
                                        <small ng-bind-html="$select.selected.label"></small>
                                    </ui-select-match>
                                    <ui-select-choices repeat="type in orderbyFilter">
                                        <small ng-bind-html="type.label | highlight: $select.search"></small>
                                    </ui-select-choices>
                                </ui-select>
                            </div>
                        </div>
                        <div class="col-sm-4 padding-right-5">
                            <div class="post-options pull-left hidden">
                                <a href="" tooltip-placement="top" tooltip-html-unsafe="Schedule"><i class="fa fa-map-marker"></i></a>
                                <a href="" tooltip-placement="top" tooltip-html-unsafe="Location"><i class="fa fa-calendar"></i></a>
                            </div>
                            <button class="btn btn-green pull-right" ng-disabled="!selectedSocial || !postContent.length > 0" ng-click="postToSocial(selectedSocial.id, postContent, selectedSocial.type) "><span><span ng-show="postingToSocial"><i class="fa fa-spinner fa-spin"></i> Submitting </span><span ng-show="!postingToSocial">Submit Post</span></span>
                            </button>
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <!-- panel-footer -->
                </div>
            </div>
            <div class="clearfix"></div>
            <div masonry id="mcontainer" load-images="true" masonry-options="{columnWidth: '.masonry-brick'}" reload-on-show class="margin-bottom-15">
                <div class="col-xs-12 col-sm-6 col-md-4 masonry-brick" ng-repeat="post in displayFeed | orderByArrayLength:orderByAttribute track by $index">
                    <facebook-post ng-if="post.type == 'fb'" post="post" action-like="showLikeModal(aPost)" action-comment="showCommentModal(aPost)"></facebook-post>
                    <twitter-feed ng-if="post.type == 'tw' && post.postType == 'tweet'" post="post" action-favorite="showFavModal(aPost)" action-reply="showTweetModal(aPost)" action-retweet="showRetweetModal(aPost)" action-direct-message="showTweetDMModal(aPost)" show-dm='isTwFollowerFn(post.from.sourceId)'></twitter-feed>
                    <twitter-follower ng-if="post.type == 'tw' && post.postType == 'follower'" post="post" action-tweet-at="showTweetModal(aFollower)" action-follow-back="showFollowModal(aFollower)" action-direct-message="showTweetDMModal(aFollower)"></twitter-follower>
                </div>
            </div>
            <div ng-show="feed.length <= 0 && isLoaded">
                <div class="panel panel-transparent">
                    <div class="panel-body">
                        <h4 class="center"><span class="fa fa-times fa-2x"></span> <br> No Posts Availiable</h4>
                    </div>
                </div>
            </div>
            <div ng-show="displayFeed.length <= 0 && feed.length > 0 && isLoaded">
                <div class="panel panel-transparent">
                    <div class="panel-body">
                        <h4 class="center"><span class="fa fa-times fa-2x"></span> <br> No Filters Checked</h4>
                    </div>
                </div>
            </div>
            <div style="height:220px" ng-show="!isLoaded && feed.length <= 0">
                <div class="panel panel-transparent">
                    <div class="panel-body">
                        <h4 class="center"><span class="fa fa-spinner fa-spin"></span> <br> Loading Feeds...</h4>
                    </div>
                </div>
            </div>
        </div>
        <div class="stream-filter col-sm-3">
            <div class="panel panel-white row">
                <div class="panel-heading border-light">
                    <h4 class="panel-title text-primary">Feeds</h4>
                    <ul class="panel-heading-tabs border-light">
                        <li>
                            <div class="pull-right">
                                <button type="button" class="btn btn-primary" ng-click="openModal('manage-feed-modal')">
                                    <span>Manage</span>
                                </button>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="panel-body">
                    <ul class="feeds">
                        <li class="hidden">
                            <div class="pull-left filter-details">
                                <h4>All Networks</h4>
                                <div class="checkbox clip-check check-primary checkbox-inline">
                                    <input type="checkbox" id="allnetworks" ng-click="filterFeed(type, $event)" ng-checked="type.open">
                                    <label for="allnetworks"></label>
                                </div>
                            </div>
                        </li>
                        <li ng-repeat="type in trackedAccounts | filter: { toggle: true }" is-disabled="true" ng-show="type.type == 'fb' || type.type == 'tw'" class="margin-bottom-5 padding-bottom-5">
                            <div class="feedTypeDetail">
                                <div class="filter-avatar pull-left padding-right-5">
                                    <span class="fa fa-{{type.type}}"></span>
                                    <img ng-src="{{type.profile.picture.data.url || type.profile.profile_image_url_https || type.image}}" class="avatar pull-left" width="50" />
                                </div>
                                <div class="pull-left filter-details">
                                    <h4 class="panel-title" ng-text-truncate="type.profile.name || type.username" ng-tt-chars-threshold="15" ng-tt-no-toggling></h4>
                                    <p><span class="fa" ng-class="{'fa-facebook-square': type.type == 'fb', 'fa-twitter-square': type.type == 'tw'}"></span> ({{feedLengths[type.id] || 0}})</p>
                                </div>
                                <div class="ckbox ckbox-default pull-right">
                                    <div class="checkbox clip-check check-primary padding-right-0">
                                        <input type="checkbox" id="checkbox-{{type.id}}" ng-model="type.checked" ng-click="filterFeed(type)">
                                        <label for="checkbox-{{type.id}}" class="margin-right-0"></label>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div ng-if="isLoaded && feedTypes.length <= 0" class="empty">
            <h4 class="center">No Feeds added..</h4>
        </div>
        <div ng-if="!isLoaded && feedTypes.length <= 0" class="empty">
            <h4 class="center"><span class="fa fa-spinner fa-spin"></span> Loading Feeds...</h4>
        </div>
        <!-- <pre>{{filters}}</pre> -->
    </div>
</div>
<!-- end: YOUR CONTENT HERE -->
<script type="text/ng-template" id="manage-feed-modal">
    <div class="modal-header">
        <button type="button" class="close" ng-click="closeModal()" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Manage Feeds</h4>
    </div>
    <div class="modal-body manage-feed no-padding">
        <div class="col-xs-12 left-panel" ng-hide='trackedAccounts.length'>
            No account available for removal.
        </div>
        <tabset class="tabbable tabs-left margin-bottom-0">
            <tab>
                <tab-heading>
                    Facebook
                </tab-heading>
                <ul class="fb-admin-pages">
                    <li ng-repeat="account in trackedAccounts | filter: {'type': 'fb'}">
                        <div class="parentaccount">
                            <img ng-src="{{account.profile.picture.data.url}}" class="thumbnail pull-left clearfix margin-bottom-10" width="50"> {{account.profile.name}}
                            <span ng-show="account.toggle" class="fa fa-minus-square pull-right text-danger" ng-click="removePageFeed(account)"></span>
                            <span ng-hide="account.toggle" class="fa fa-plus-square pull-right text-success" ng-click="addPageFeed(account)"></span>
                        </div>
                    </li>
                </ul>
            </tab>
            <tab>
                <tab-heading>
                    Twitter
                </tab-heading>
                <ul class="fb-admin-pages">
                    <li ng-repeat="account in trackedAccounts | filter: {'type': 'tw'}">
                        <div class="parentaccount">
                            <img ng-src="{{account.image}}" class="thumbnail pull-left clearfix margin-bottom-10" width="50"> {{account.username}}
                            <span ng-show="account.toggle" class="fa fa-minus-square pull-right text-danger" ng-click="removePageFeed(account)"></span>
                            <span ng-hide="account.toggle" class="fa fa-plus-square pull-right text-success" ng-click="addPageFeed(account)"></span>
                        </div>
                    </li>
                </ul>
            </tab>
        </tabset>
        <div class="clearfix"></div>
    </div>
    <!-- <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="addFeedFn()"><i class="fa fa-plus" /> Add</button>
                </div> -->
</script>
<script type="text/ng-template" id="like-unlike-modal">
    <div class="modal-header">
        <button type="button" class="close" ng-click="closeModal()" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Manage Likes</h4>
    </div>
    <div class="modal-body manage-feed nopadding bg-white">
        <ul class="fb-admin-pages">
            <li ng-repeat="account in tempTrackedAccounts | filter: {'type': 'fb', 'accountType':'adminpage'}">
                <div class="parentaccount">
                    <div class="account-avatar">
                        <img ng-src="{{account.profile.picture.data.url}}" class="img-circle pull-left clearfix"> {{account.profile.name}}
                        <span class="fa fa-{{account.type}}"></span>
                        <span ng-hide='account.liked' class="fa fa-thumbs-up pull-right" ng-click="likeFBPost(account)"></span>
                        <span ng-show='account.liked' class="fa fa-thumbs-down pull-right" ng-click="removeLikeFBPost(account)"></span>
                    </div>
                </div>
            </li>
        </ul>
        <div class="clearfix"></div>
    </div>
</script>
<script type="text/ng-template" id="fav-unfav-modal">
    <div class="modal-header">
        <button type="button" class="close" ng-click="closeModal()" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Manage Likes</h4>
    </div>
    <div class="modal-body manage-feed nopadding bg-white">
        <ul class="fb-admin-pages">
            <li ng-repeat="account in tempTrackedAccounts | filter: {'type': 'tw'}">
                <div class="parentaccount">
                    <div class="account-avatar">
                        <img ng-src="{{account.image}}" class="img-circle pull-left clearfix"> {{account.username}}
                        <span class="fa fa-{{account.type}}"></span>
                        <span ng-hide='account.favorited' class="fa fa-star pull-right" ng-click="addTwitterPostFavorites(account)"></span>
                        <span ng-show='account.favorited' class="fa fa-star pull-right" ng-click="deleteTwitterPostFavorites(account)"></span>
                    </div>
                </div>
            </li>
        </ul>
        <div class="clearfix"></div>
    </div>
</script>
<script type="text/ng-template" id="follow-modal">
    <div class="modal-header">
        <button type="button" class="close" ng-click="closeModal()" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Manage Follows</h4>
    </div>
    <div class="modal-body manage-feed nopadding bg-white">
        <ul class="fb-admin-pages">
            <li ng-repeat="account in tempTrackedAccounts | filter: {'type': 'tw'}">
                <div class="parentaccount">
                    <div class="account-avatar">
                        <img ng-src="{{account.image}}" class="img-circle pull-left clearfix"> {{account.username}}
                        <span class="fa fa-{{account.type}}"></span>
                        <!--<span ng-if="(followModalCheckmarks.indexOf(account)==-1)" class="fa fa-square-o pull-right" ng-click="followTwitterUser(account, tempPost.sourceId)"></span>-->
                        <!--<span ng-if="(followModalCheckmarks.indexOf(account)!=-1)" class="fa fa-check-square-o pull-right" ng-click="unfollowTwitterUser(account, tempPost.sourceId)"></span>-->
                        <span ng-if="!followModalCheckmarks[account.socialId]" class="fa fa-square-o pull-right" ng-click="followTwitterUser(account, tempPost.sourceId)"></span>
                        <span ng-if="followModalCheckmarks[account.socialId]" class="fa fa-check-square-o pull-right" ng-click="unfollowTwitterUser(account, tempPost.sourceId)"></span>
                    </div>
                </div>
            </li>
        </ul>
        <div class="clearfix"></div>
    </div>
</script>
<script type="text/ng-template" id="twitter-comments-modal">
    <div class="modal-header">
        <button type="button" class="close" ng-click="closeModal()" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Reply to @{{addComment.post.from.name}}</h4>
    </div>
    <div class="modal-body nopadding">
        <div class="panel panel-default panel-alt widget-messaging mb0">
            <!-- panel-body -->
            <div class="panel-footer">
                <div class=' mb15'>
                    <img alt="" ng-src="{{addCommentPage.from.profile_pic}}" class="media-object"> {{addCommentPage.from.name}}
                </div>
                <div class=' mb15'>
                    <textarea class="form-control" ng-model='addComment.comment'></textarea>
                </div>
                <div class='row'>
                    <div class='col-xs-3'>
                        <span class="pull-left">Post As:</span>
                        <img ng-src="{{addCommentAdminPage.profile_image_url}}" class="thumbnail pull-left clearfix mb0" ng-show='addCommentAdminPage.profile_image_url' />
                    </div>
                    <div class='col-xs-6'>
                        <!--<ui-select ng-model="twitterCommentProfile.selected" theme="bootstrap">-->
                            <!--<ui-select-choices repeat="account in tempTrackedAccounts">-->
                                <!--<small>account.username</small>-->
                            <!--</ui-select-choices>-->
                        <!--</ui-select>-->
                        <!--<select class='form-control mb0' ng-model='twitterCommentProfile' ng-change='setAddCommentAdminPageFn(twitterCommentProfile)'>-->
                            <!--&lt;!&ndash;<option ng-repeat="type in feedTypes" ng-show="type.type=='tw'" value="{{type.socialId}}">{{type.name}}</option>&ndash;&gt;-->
                        <!--</select>-->
                        <!--account in tempTrackedAccounts | filter: {'type': 'tw'}-->
                        <select class='form-control mb0' ng-model='addComment.socialId'>
                            <option ng-repeat="account in tempTrackedAccounts | filter: {'type': 'tw'}" value="{{account.parentSocialAccount}}">{{account.username}}</option>
                        </select>
                    </div>
                    <div class="col-xs-3">
                        <span ng-class="{'text-danger': (140 - addComment.length) <= 10}">{{140 - addComment.length}}</span>
                        <button class="btn btn-green btn-block" ng-class='{"disabled": !addComment}' data-dismiss='modal' ng-click='addTwCommentFn(addComment)'>Comment</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
</script>
<script type="text/ng-template" id="facebook-comments-modal">
    <div class="modal-header">
        <button type="button" class="close" ng-click="closeModal()" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Comments <span ng-if="visibleComments.length">({{visibleComments.length}})</span></h4>
    </div>
    <div class="modal-body no-padding bg-white">
        <div class="panel panel-white margin-bottom-0">
            <div class="panel-body no-padding">
                <ul class="comments" ng-if="visibleComments.length">
                    <li ng-repeat="comment in visibleComments | orderBy:'created':true track by $index">
                        <img ng-src="{{comment.picture}}" class="img-circle margin-right-15 pull-left" width="32">
                        <small class="pull-right">{{comment.created | timeAgoFilter}}</small>
                        <h4 class="sender">{{comment.name}}</h4>
                        <small>{{comment.comment}}</small>
                    </li>
                </ul>
                <div ng-if="!visibleComments.length">
                    <div class="margin-bottom-30"></div>
                    <h4 class="center"><span class="fa fa-comments"></span> No Comments</h4>
                    <div class="margin-bottom-30"></div>
                </div>
                <div class="clearfix"></div>
            </div>
            <!-- panel-body -->
            <div class="panel-footer">
                <div class='margin-bottom-15'>
                    <textarea class="form-control" placeholder="Enter Comment..." ng-model='$parent.addCommentinModal'></textarea>
                </div>
                <div class='row'>
                    <div class='col-xs-9'>
                        <ui-select ng-model="addCommentAdminPage" on-select="postToChange($select.selected)" theme="bootstrap">
                            <ui-select-match placeholder="Post As...">
                                <span class="fa" ng-class="{'fa-facebook': $select.selected.type == 'fb'}"></span>
                                <small ng-bind-html="$select.selected.name || $select.selected.profile.name"></small>
                            </ui-select-match>
                            <ui-select-choices repeat="type in trackedAccounts | filter: {'type': 'fb'}">
                                <span class="fa" ng-class="{'fa-facebook': type.type == 'fb'}"></span>
                                <small ng-bind-html="type.name || type.profile.name | highlight: $select.search"></small>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                    <div class="col-xs-3">
                        <button class="btn btn-green btn-block" ng-disabled="!addCommentAdminPage" ng-click='addCommentFn(addCommentinModal)'>Comment</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
</script>
<script type="text/ng-template" id="twitter-direct-message-modal">
    <div class="modal-header">
        <button type="button" class="close" ng-click="closeModal()" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Direct message to @{{addComment.post.from.name}}</h4>
    </div>
    <div class="modal-body nopadding">
        <div class="panel panel-default panel-alt widget-messaging mb0">
            <!-- panel-body -->
            <div class="panel-footer">
                <div class=' mb15'>
                    <img alt="" ng-src="{{addCommentPage.from.profile_pic}}" class="media-object"> {{addCommentPage.from.name}}
                </div>
                <div class=' mb15'>
                    <textarea class="form-control" ng-model='addComment.comment'></textarea>
                </div>
                <div class='row'>
                    <div class='col-xs-3'>
                        <span class="pull-left">Post As:</span>
                        <img ng-src="{{addCommentAdminPage.profile_image_url}}" class="thumbnail pull-left clearfix mb0" ng-show='addCommentAdminPage.profile_image_url' />
                    </div>
                    <div class='col-xs-6'>
                        <!--<ui-select ng-model="twitterCommentProfile.selected" theme="bootstrap">-->
                            <!--<ui-select-choices repeat="account in tempTrackedAccounts">-->
                                <!--<small>account.username</small>-->
                            <!--</ui-select-choices>-->
                        <!--</ui-select>-->
                        <!--<select class='form-control mb0' ng-model='twitterCommentProfile' ng-change='setAddCommentAdminPageFn(twitterCommentProfile)'>-->
                            <!--&lt;!&ndash;<option ng-repeat="type in feedTypes" ng-show="type.type=='tw'" value="{{type.socialId}}">{{type.name}}</option>&ndash;&gt;-->
                        <!--</select>-->
                        <!--account in tempTrackedAccounts | filter: {'type': 'tw'}-->
                        <select class='form-control mb0' ng-model='addComment.socialId'>
                            <option ng-repeat="account in tempTrackedAccounts | filter: {'type': 'tw'}" value="{{account.parentSocialAccount}}">{{account.username}}</option>
                        </select>
                    </div>
                    <div class="col-xs-3">
                        <span ng-class="{'text-danger': (140 - addComment.length) <= 10}">{{140 - addComment.length}}</span>
                        <button class="btn btn-green btn-block" ng-class='{"disabled": !addComment}' data-dismiss='modal' ng-click='addTwDMFn(addComment)'>Comment</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
</script>

<script type="text/ng-template" id="twitter-retweet-modal">
    <div class="modal-header">
        <button type="button" class="close" ng-click="closeModal()" aria-hidden="true">&times;</button>
        <h4 class="modal-title">Retweeting post of @{{addComment.post.from.name}}</h4>
    </div>
    <div class="modal-body nopadding">
        <div class="panel panel-default panel-alt widget-messaging mb0">
            <!-- panel-body -->
            <div class="panel-footer">
                <div class=' mb15'>
                    <img alt="" ng-src="{{addCommentPage.from.profile_pic}}" class="media-object"> {{addCommentPage.from.name}}
                </div>
                <div class=' mb15'>
                    <textarea class="form-control" readonly="readonly">{{addComment.post.message}}</textarea>
                </div>
                <div class='row'>
                    <div class='col-xs-3'>
                        <span class="pull-left">Post As:</span>
                        <img ng-src="{{addCommentAdminPage.profile_image_url}}" class="thumbnail pull-left clearfix mb0" ng-show='addCommentAdminPage.profile_image_url' />
                    </div>
                    <div class='col-xs-6'>
                        <!--<ui-select ng-model="twitterCommentProfile.selected" theme="bootstrap">-->
                            <!--<ui-select-choices repeat="account in tempTrackedAccounts">-->
                                <!--<small>account.username</small>-->
                            <!--</ui-select-choices>-->
                        <!--</ui-select>-->
                        <!--<select class='form-control mb0' ng-model='twitterCommentProfile' ng-change='setAddCommentAdminPageFn(twitterCommentProfile)'>-->
                            <!--&lt;!&ndash;<option ng-repeat="type in feedTypes" ng-show="type.type=='tw'" value="{{type.socialId}}">{{type.name}}</option>&ndash;&gt;-->
                        <!--</select>-->
                        <!--account in tempTrackedAccounts | filter: {'type': 'tw'}-->
                        <select class='form-control mb0' ng-model='addComment.socialId'>
                            <option ng-repeat="account in tempTrackedAccounts | filter: {'type': 'tw'}" value="{{account.parentSocialAccount}}">{{account.username}}</option>
                        </select>
                    </div>
                    <div class="col-xs-3">
                        <span ng-class="{'text-danger': (140 - addComment.length) <= 10}">{{140 - addComment.length}}</span>
                        <button class="btn btn-green btn-block" ng-class='{"disabled": !addComment}' data-dismiss='modal' ng-click='addRetweetFn(addComment)'>Comment</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
</script>
