angular.module("indigenous",["ngAnimate","ngCookies","ngStorage","ngSanitize","ngTouch","ui.router","ngJoyRide","ui.bootstrap","angular.filter","oc.lazyLoad","gavruk.card","cfp.loadingBar","duScroll","pascalprecht.translate","autocomplete","config","angular-parallax","google.places","ng-sortable","http-auth-interceptor"]),app.constant("APP_MEDIAQUERY",{desktopXL:1200,desktop:992,tablet:768,mobile:480}),app.constant("hoursConstant",{HOURS:["00:30 am","1:00 am","1:30 am","2:00 am","2:30 am","3:00 am","3:30 am","4:00 am","4:30 am","5:00 am","5:30 am","6:00 am","6:30 am","7:00 am","7:30 am","8:00 am","8:30 am","9:00 am","9:30 am","10:00 am","10:30 am","11:00 am","11:30 am","12:00 pm","12:30 pm","1:00 pm","1:30 pm","2:00 pm","2:30 pm","3:00 pm","3:30 pm","4:00 pm","4:30 pm","5:00 pm","5:30 pm","6:00 pm","6:30 pm","7:00 pm","7:30 pm","8:00 pm","8:30 pm","9:00 pm","9:30 pm","10:00 pm","10:30 pm","11:00 pm","11:30 pm","12:00 am"]}),app.constant("dashboardBackgrounds",{urls:["//s3-us-west-2.amazonaws.com/indigenous-admin/dohy_background_1.jpg","//s3-us-west-2.amazonaws.com/indigenous-admin/dohy_background_2.jpg","//s3-us-west-2.amazonaws.com/indigenous-admin/dohy_background_3.jpg","//s3-us-west-2.amazonaws.com/indigenous-admin/dohy_background_4.jpg","//s3-us-west-2.amazonaws.com/indigenous-admin/dohy_background_5.jpg","//s3-us-west-2.amazonaws.com/indigenous-admin/dohy_background_6.jpg","//s3-us-west-2.amazonaws.com/indigenous-admin/dohy_background_7.jpg","//s3-us-west-2.amazonaws.com/indigenous-admin/dohy_background_8.jpg","//s3-us-west-2.amazonaws.com/indigenous-admin/dohy_background_9.jpg","//s3-us-west-2.amazonaws.com/indigenous-admin/dohy_background_10.jpg","//s3-us-west-2.amazonaws.com/indigenous-admin/dohy_background_11.jpg","//s3-us-west-2.amazonaws.com/indigenous-admin/dohy_background_12.jpg","//s3-us-west-2.amazonaws.com/indigenous-admin/dohy_background_13.jpg","//s3-us-west-2.amazonaws.com/indigenous-admin/dohy_background_14.jpg","//s3-us-west-2.amazonaws.com/indigenous-admin/dohy_background_15.jpg","//s3-us-west-2.amazonaws.com/indigenous-admin/dohy_background_16.jpg","//s3-us-west-2.amazonaws.com/indigenous-admin/dohy_background_17.jpg"]}),app.constant("orderConstant",{order_status:{PENDING_PAYMENT:"pending_payment",PAID:"paid",PROCESSING:"processing",ON_HOLD:"on_hold",COMPLETED:"completed",CANCELLED:"cancelled",REFUNDED:"refunded",FAILED:"failed",dp:[{label:"Paid",data:"paid"},{label:"Pending Payment",data:"pending_payment"},{label:"Processing",data:"processing"},{label:"On Hold",data:"on_hold"},{label:"Completed",data:"completed"},{label:"Refunded",data:"refunded"},{label:"Failed",data:"failed"},{label:"Cancelled",data:"cancelled"}]},MAX_ORDER_DAYS:15}),app.constant("social",{types:{LOCAL:"lo",FACEBOOK:"fb",TWITTER:"tw",LINKEDIN:"li",GOOGLE:"go",FULL_CONTACT:"fc",dp:[{label:"Local",data:"lo"},{label:"Facebook",data:"fb"},{label:"Twitter",data:"tw"},{label:"LinkedIn",data:"li"},{label:"Google",data:"go"}]}}),app.constant("contactConstant",{contact_activity_types:{PAGE_VIEW:"PAGE_VIEW",SUBSCRIBE:"SUBSCRIBE",CONTACT_CREATED:"CONTACT_CREATED",EMAIL:"EMAIL",PHONECALL:"PHONECALL",FACEBOOK_LIKE:"FACEBOOK_LIKE",TWEET:"TWEET",FORM_SUBMISSION:"FORM_SUBMISSION",EMAIL_DELIVERED:"EMAIL_DELIVERED",EMAIL_OPENED:"EMAIL_OPENED",EMAIL_CLICKED:"EMAIL_CLICKED",EMAIL_UNSUB:"EMAIL_UNSUB",SUBSCRIPTION_PAID:"SUBSCRIPTION_PAID",SUBSCRIBE_CANCEL:"SUBSCRIBE_CANCEL",ACCOUNT_CREATED:"ACCOUNT_CREATED",dp:[{label:"Account Created",data:"ACCOUNT_CREATED"},{label:"Page View",data:"PAGE_VIEW"},{label:"Subscribe",data:"SUBSCRIBE"},{label:"Contact Created",data:"CONTACT_CREATED"},{label:"Emails",data:"EMAIL"},{label:"Phone Calls",data:"PHONECALL"},{label:"Facebook Likes",data:"FACEBOOK_LIKE"},{label:"Tweets",data:"TWEET"},{label:"Form Submission",data:"FORM_SUBMISSION"},{label:"Email Delivered",data:"EMAIL_DELIVERED"},{label:"Email Opened",data:"EMAIL_OPENED"},{label:"Email Clicked",data:"EMAIL_CLICKED"},{label:"Email UnSubscribe",data:"EMAIL_UNSUB"},{label:"Subscription Paid",data:"SUBSCRIPTION_PAID"},{label:"Subscribe Cancel",data:"SUBSCRIBE_CANCEL"},{label:"Other",data:"OTHER"}]},contact_tags:{dp:[{label:"Admin",data:"ad"},{label:"Affiliate",data:"af"},{label:"Anonymous Donor",data:"and"},{label:"Cancelled Customer",data:"cc"},{label:"Cancelled Trial Customer",data:"ct"},{label:"Cheatsheet Lead",data:"cs"},{label:"Colleague",data:"co"},{label:"Customer",data:"cu"},{label:"Expired Trial Customer",data:"ex"},{label:"Family",data:"fa"},{label:"Friend",data:"fr"},{label:"Lead",data:"ld"},{label:"Member",data:"mb"},{label:"Other",data:"ot"},{label:"Trial Customer",data:"tc"}]}}),app.constant("postConstant",{post_status:{PUBLISHED:"PUBLISHED",DRAFT:"DRAFT",FUTURE:"FUTURE",PRIVATE:"PRIVATE",dp:[{label:"Published",data:"PUBLISHED"},{label:"Draft",data:"DRAFT"},{label:"Future",data:"FUTURE"},{label:"Private",data:"PRIVATE"}]}}),app.constant("pageConstant",{page_handles:{BLOG:"blog",SINGLEPOST:"single-post"},inValidPageHandles:{home:"home",login:"login",logout:"logout",admin:"admin",redirect:"redirect",template:"template",demo:"demo",admin1:"admin1",interim:"interim",unsubscribe:"unsubscribe",forgotpassword:"forgotpassword","current-user":"current-user",signup:"signup","blog-list":"blog-list","blog-post":"blog-post"}}),app.constant("analyticsConstant",{refreshAfterTime:6e5}),app.constant("commerceConstant",{redirect_timeout_options:{defaultTimeOut:5e3,dp:[{label:1,data:1e3},{label:2,data:2e3},{label:3,data:3e3},{label:4,data:4e3},{label:5,data:5e3},{label:10,data:1e4}]}}),app.constant("productConstant",{product_types:{DIGITAL:"DIGITAL",SUBSCRIPTION:"SUBSCRIPTION",EXTERNAL:"EXTERNAL",VIRTUAL:"VIRTUAL",DONATION:"DONATION",dp:[{label:"Digital",data:"DIGITAL"},{label:"Subscription",data:"SUBSCRIPTION"},{label:"External",data:"EXTERNAL"},{label:"Virtual",data:"VIRTUAL"},{label:"Donation",data:"DONATION"}]},product_status_types:{BACKORDER:"backorder",INACTIVE:"inactive",ACTIVE:"active",AUTOINACTIVE:"auto_inactive",dp:[{label:"Backorder",data:"backorder"},{label:"Inactive",data:"inactive"},{label:"Active",data:"active"},{label:"Auto Inactive",data:"auto_inactive"}]},external_link_options:{dp:[{label:"New Window",data:"_blank"},{label:"Same Window",data:"_top"}]},external_link_view_options:{dp:[{label:"Yes",data:"true"},{label:"No",data:"false"}]}}),app.constant("accountConstant",{plan_types:{TRIAL:"NO_PLAN_ARGUMENT"}}),app.constant("userConstant",{social_types:{LOCAL:"lo",FACEBOOK:"fb",TWITTER:"tw",LINKEDIN:"li",GOOGLE:"go",FULL_CONTACT:"fc",dp:[{label:"Local",data:"lo"},{label:"Facebook",data:"fb"},{label:"Twitter",data:"tw"},{label:"LinkedIn",data:"li"},{label:"Google",data:"go"}]},credential_types:{LOCAL:"lo",FACEBOOK:"fb",TWITTER:"tw",LINKEDIN:"li",STRIPE:"st",GOOGLE:"go",FULL_CONTACT:"fc",PAYPAL:"pp"},detail_types:{LOCAL:"lo",FACEBOOK:"fb",TWITTER:"tw",LINKEDIN:"li",GOOGLE:"go",FULL_CONTACT:"fc"},contact_types:{CUSTOMER:"cu",COLLEAGUE:"co",FRIEND:"fr",MEMBER:"mb",FAMILY:"fa",ADMIN:"ad",LEAD:"ld",OTHER:"ot",NOTAG:"nt",CANCELLED_CUSTOMER:"cc",CANCELLED_TRIAL:"ct",CHEATSHEET_LEAD:"cs",EXPIRED_TRIAL:"ex",TRIAL_CUSTOMER:"tc",AFFILIATE:"af",dp:[{label:"Admin",data:"ad"},{label:"Affiliate",data:"af"},{label:"Cancelled Customer",data:"cc"},{label:"Cancelled Trial Customer",data:"ct"},{label:"Cheatsheet Lead",data:"cs"},{label:"Colleague",data:"co"},{label:"Customer",data:"cu"},{label:"Expired Trial Customer",data:"ex"},{label:"Family",data:"fa"},{label:"Friend",data:"fr"},{label:"Lead",data:"ld"},{label:"Member",data:"mb"},{label:"Other",data:"ot"},{label:"Trial Customer",data:"tc"},{label:"No Tag",data:"nt"}]},phone_types:{MOBILE:"m",HOME:"h",WORK:"w",dp:[{label:"mobile",data:"m"},{label:"home",data:"h"},{label:"work",data:"w"}]},device_types:{scale:"2net_scale",HOME:"h",WORK:"w",dp:[{label:"2net_scale",data:"2net_scale"},{label:"home",data:"h"},{label:"work",data:"w"}]},activity_types:{PHONE:"p",EMAIL:"e"},personal_profile:{PASSWORD_PLACEHOLDER:"profile_password"},admin_user:{userName:"admin@indigenous.io",emailDomain:"@indigenous.io"},campaigns:{MAX_CONTACT_LIST_COUNT:1e3}}),app.constant("mediaManagerConstant",{numberOfRowsPerPage:6,displayedPages:7}),app.constant("pagingConstant",{numberOfRowsPerPage:50,displayedPages:11}),app.constant("JS_REQUIRES",{scripts:{modernizr:["../js/libs/components-modernizr/modernizr.js"],moment:["../js/libs/moment/min/moment.min.js"],spin:"../js/libs/spin.js/spin.js",underscore:"../js/libs/underscore/underscore-min.js",stripe:"https://js.stripe.com/v2/?tmp","google-fonts":"https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js","perfect-scrollbar-plugin":["../js/libs/perfect-scrollbar/js/perfect-scrollbar.jquery.min.js","../js/libs/perfect-scrollbar/css/perfect-scrollbar.min.css"],ladda:["../js/libs/ladda/dist/ladda.min.js","../js/libs/ladda/dist/ladda-themeless.min.css"],chartjs:"../js/libs/chartjs/Chart.min.js","jquery-sparkline":"../js/libs/jquery.sparkline.build/dist/jquery.sparkline.min.js",jsVideoUrlParser:"../js/libs/js-video-url-parser/dist/jsVideoUrlParser.min.js","jquery-nestable-plugin":["../js/libs_misc/jquery-nestable/jquery.nestable.js"],"touchspin-plugin":["../js/libs/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js","../js/libs/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.css"],"bootstrap-confirmation":["../js/libs/bootstrap-confirmation/bootstrap-confirmation.js"],uuid:"../js/libs_misc/uuid.js",papaParse:"../js/libs/papaparse/papaparse.min.js",string_score:"../js/libs/string_score/string_score.min.js",dashboardCtrl:"assets/js/controllers/dashboardCtrl.js",helpTopicsCtrl:"assets/js/controllers/helpTopicsCtrl.js",newHelpTopicsCtrl:"assets/js/controllers/newHelpTopicsCtrl.js",siteAnalyticsCtrl:"assets/js/controllers/siteAnalyticsCtrl.js",customerAnalyticsCtrl:"assets/js/controllers/customerAnalyticsCtrl.js",billingCtrl:"assets/js/controllers/billingCtrl.js",socialFeedCtrl:"assets/js/controllers/socialFeedCtrl.js",contactsCtrl:"assets/js/controllers/contactsCtrl.js",contactDetailCtrl:"assets/js/controllers/contactDetailCtrl.js",customersCtrl:"assets/js/controllers/customersCtrl.js",customerDetailCtrl:"assets/js/controllers/customerDetailCtrl.js",productsCtrl:"assets/js/controllers/productsCtrl.js",productsDetailCtrl:"assets/js/controllers/productsDetailCtrl.js",iconsCtrl:"assets/js/controllers/iconsCtrl.js",vAccordionCtrl:"assets/js/controllers/vAccordionCtrl.js",laddaCtrl:"assets/js/controllers/laddaCtrl.js",profileBusinessCtrl:"assets/js/controllers/profileBusinessCtrl.js",profilePersonalCtrl:"assets/js/controllers/profilePersonalCtrl.js",templatesCtrl:"assets/js/controllers/templatesCtrl.js",manageTopicsCtrl:"assets/js/controllers/manageTopicsCtrl.js",integrationsCtrl:"assets/js/controllers/integrationsCtrl.js",orderDetailCtrl:"assets/js/controllers/orderDetailCtrl.js",orderDetailEditCtrl:"assets/js/controllers/orderDetailEditCtrl.js",settingsCtrl:"assets/js/controllers/settingsCtrl.js",emailsCtrl:"assets/js/controllers/emailsCtrl.js",campaignsCtrl:"assets/js/controllers/campaignsCtrl.js",addComponentModalCtrl:"assets/js/controllers/modals/addComponentModalCtrl.js",componentSettingsModalCtrl:"assets/js/controllers/modals/componentSettingsModalCtrl.js",ssbComponentSettingsModalCtrl:"assets/js/controllers/modals/ssbComponentSettingsModalCtrl.js",ssbPostSettingsModalCtrl:"assets/js/ssb-site-builder/ssb-components/shared/posts/ssb-post-settings.controller.js",mediaModalCtrl:"assets/js/controllers/modals/mediaModalCtrl.js",templateSettingsModalCtrl:"assets/js/controllers/modals/templateSettingsModalCtrl.js",importContactModalCtrl:"assets/js/controllers/modals/importContactModalCtrl.js",onboardingCtrl:"assets/js/controllers/onboardingCtrl.js",DOHYCtrl:"assets/js/dashboard/dashboard.controller.js",DashboardWorkstreamTileComponentController:"assets/js/dashboard/dashboard-workstream-tile/dashboard-workstream-tile.controller.js",DashboardAnalyticTileComponentController:"assets/js/dashboard/dashboard-analytic-tile/dashboard-analytic-tile.controller.js",DashboardInboxComponentController:"assets/js/dashboard/dashboard-inbox-widget/dashboard-inbox.controller.js",asideCtrl:"assets/js/controllers/asideCtrl.js",toasterCtrl:"assets/js/controllers/toasterCtrl.js",sweetAlertCtrl:"assets/js/controllers/sweetAlertCtrl.js",mapsCtrl:"assets/js/controllers/mapsCtrl.js",ordersCtrl:"assets/js/controllers/ordersCtrl.js",selectCtrl:"assets/js/controllers/selectCtrl.js",wizardCtrl:"assets/js/controllers/wizardCtrl.js",uploadCtrl:"assets/js/controllers/uploadCtrl.js",treeCtrl:"assets/js/controllers/treeCtrl.js",inboxCtrl:"assets/js/controllers/inboxCtrl.js",xeditableCtrl:"assets/js/controllers/xeditableCtrl.js",chatCtrl:"assets/js/controllers/chatCtrl.js",editTopicCtrl:"assets/js/controllers/editTopicCtrl.js",singleCustomerAnalyticsCtrl:"assets/js/controllers/singleCustomerAnalyticsCtrl.js",UsersCtrl:"assets/js/users/users.controller.js",MessagesCtrl:"assets/js/messages/messages.controller.js",BroadcastMessageEditorCtrl:"assets/js/messages/broadcast-message-editor/broadcast-message-editor.controller.js",JobsCtrl:"assets/js/jobs/jobs.controller.js",CampaignRecipientDetailsController:"assets/js/indi-email-campaign/campaign-recipient-details/campaign-recipient.controller.js",accountService:"assets/js/services/account.js",productService:"assets/js/services/product.js",paymentService:"assets/js/services/product.js",websiteService:"assets/js/services/webiste.js",userService:"assets/js/services/user.js",contactService:"assets/js/services/contact.js",customerService:"assets/js/services/customer.js",campaignService:"assets/js/services/campaign.js",toasterService:"assets/js/services/toaster.js",ImportContactService:"assets/js/services/import_contacts.js",chartAnalyticsService:"assets/js/services/chart_analytics.js",chartCommerceService:"assets/js/services/chart_commerce.js",chartEmailService:"assets/js/services/chart_email.js",commonService:"assets/js/services/common.js",socialConfigService:"assets/js/services/socialconfig.js",orderService:"assets/js/services/order.js",assetsService:"assets/js/services/assets.js",geocodeService:"assets/js/services/geocode.js",dashboardService:"assets/js/dashboard/dashboard.service.js",simpleSiteBuilderService:"assets/js/ssb-site-builder/ssb-site-builder.service.js",emailBuilderService:"assets/js/indi-email-builder/indi-email-builder.service.js",indiLoginModalService:"assets/js/indi-login-modal/indi-login-modal.service.js",siteAnalyticsService:"assets/js/site-analytics/site-analytics.service.js",analyticsWidgetStateService:"assets/js/site-analytics/analytics-widget-state-service.js",broadcastMessagesService:"assets/js/messages/messages.service.js",utilService:"assets/js/services/util.js",contactPagingService:"assets/js/services/contactPagingService.js",jobsService:"assets/js/jobs/jobs.service.js",htmlToPlaintext:"assets/js/filters/htmlToPlaintext.js",secTotime:"assets/js/filters/secTotime.js",formatText:"assets/js/filters/formatText.js",offset:"assets/js/filters/offset.js",timeAgoFilter:"assets/js/filters/timeAgoFilter.js",titleCase:"assets/js/filters/titleCase.js",orderByArrayLength:"assets/js/filters/orderByArrayLength.js",toTrusted:"assets/js/filters/to_trusted.js",generateURLforLinks:"assets/js/filters/generateURLforLinks.js",generateURLforProduct:"assets/js/filters/generateURLforProduct.js",selectedTags:"assets/js/filters/productTags.js",propsFilter:"assets/js/filters/propsFilter.js",cleanType:"assets/js/filters/cleanType.js",filterPages:"assets/js/filters/filterPages.js",sortListPages:"assets/js/filters/sortListPages.js",productTableFilter:"assets/js/filters/productTableFilter.js",filterSsbSections:"assets/js/filters/filterSsbSections.js",ssbPostFilter:"assets/js/ssb-site-builder/ssb-components/ssb-filters/ssb-post-filter.js",mediaModal:"assets/js/directives/mediadirective.js",fixedHeaderTable:"assets/js/directives/fixed-header-table.js"},modules:[{name:"config",files:["assets/js/config.js"]},{name:"angularMoment",files:["../js/libs/angular-moment/angular-moment.min.js"]},{name:"angularFilter",files:["../js/libs/angular-filter/dist/angular-filter.min.js"]},{name:"toaster",files:["../js/libs/AngularJS-Toaster/toaster.min.js","../js/libs/AngularJS-Toaster/toaster.min.css"]},{name:"skeuocard",files:["../js/libs/skeuocard/lib/js/jquery.card.js"]},{name:"angularBootstrapNavTree",files:["../js/libs/angular-bootstrap-nav-tree/dist/abn_tree_directive.js","../js/libs/angular-bootstrap-nav-tree/dist/abn_tree.css"]},{name:"angular-ladda",files:["../js/libs/angular-ladda/dist/angular-ladda.min.js"]},{name:"smart-table",files:["../js/libs/angular-smart-table/dist/smart-table.min.js"]},{name:"ui.select",files:["../js/libs_misc/angular-ui-select/dist/select.js","../js/libs_misc/angular-ui-select/dist/select.min.css","../js/libs/select2/select2.css","../js/libs/select2-bootstrap-css/select2-bootstrap.min.css","../js/libs/selectize/dist/css/selectize.bootstrap3.css"]},{name:"ui.mask",files:["../js/libs/angular-ui-utils/mask.min.js"]},{name:"ngImgCrop",files:["../js/libs/ngImgCrop/compile/minified/ng-img-crop.js","../js/libs/ngImgCrop/compile/minified/ng-img-crop.css"]},{name:"angularFileUpload",files:["../js/libs/angular-file-upload/angular-file-upload.min.js"]},{name:"infinite-scroll",files:["../js/libs/ngInfiniteScroll/build/ng-infinite-scroll.min.js"]},{name:"ngAside",files:["../js/libs/angular-aside/dist/js/angular-aside.min.js","../js/libs/angular-aside/dist/css/angular-aside.min.css"]},{name:"highcharts",files:["../js/libs/highcharts-release/adapters/standalone-framework.js","../js/libs/highcharts-release/highcharts.js","../js/libs/highcharts-ng/dist/highcharts-ng.min.js"]},{name:"highmaps",files:["../js/libs/highcharts-release/modules/funnel.js","../js/libs/highmaps-release/modules/map.js"]},{name:"highmaps-lib",files:["../js/libs_misc/highmaps/us-all.js","../js/libs_misc/highmaps/world.js"]},{name:"truncate",files:["../js/libs/angular-truncate/src/truncate.js"]},{name:"oitozero.ngSweetAlert",files:["../js/libs/angular-sweetalert-promised/SweetAlert.min.js","../js/libs_misc/sweetalert/lib/sweet-alert.js","../js/libs/sweetalert/lib/sweet-alert.css"]},{name:"monospaced.elastic",files:["../js/libs/angular-elastic/elastic.js"]},{name:"ngMap",files:["../js/libs/ngmap/build/scripts/ng-map.min.js"]},{name:"tc.chartjs",files:["../js/libs/tc-angular-chartjs/dist/tc-angular-chartjs.min.js"]},{name:"flow",files:["../js/libs/ng-flow/dist/ng-flow-standalone.min.js"]},{name:"uiSwitch",files:["../js/libs/angular-ui-switch/angular-ui-switch.min.js","../js/libs/angular-ui-switch/angular-ui-switch.min.css"]},{name:"mwl.calendar",files:["../js/libs/angular-bootstrap-calendar/dist/js/angular-bootstrap-calendar.js","../js/libs/angular-bootstrap-calendar/dist/js/angular-bootstrap-calendar-tpls.js","../js/libs/angular-bootstrap-calendar/dist/css/angular-bootstrap-calendar.min.css"]},{name:"ng-nestable",files:["../js/libs/ng-nestable/src/angular-nestable.js"]},{name:"xeditable",files:["../js/libs/angular-xeditable/dist/js/xeditable.min.js","../js/libs/angular-xeditable/dist/css/xeditable.css"]},{name:"checklist-model",files:["../js/libs/checklist-model/checklist-model.js"]},{name:"slugifier"},{name:"dateRangePicker",files:["../js/libs/angular-daterangepicker/js/angular-daterangepicker.min.js","../js/libs/bootstrap-daterangepicker/daterangepicker.js","../js/libs/bootstrap-daterangepicker/daterangepicker-bs3.css"]},{name:"angular-slider",files:["../js/libs/angularjs-slider/dist/rzslider.min.js","../js/libs/angularjs-slider/dist/rzslider.min.css"]},{name:"ngCurrency",files:["../js/libs/ng-currency/dist/ng-currency.js"]},{name:"ngSticky",files:["../js/libs/ngSticky/dist/sticky.min.js"]},{name:"ipCookie",files:["../js/libs/angular-cookie/angular-cookie.min.js"]},{name:"slick",files:["../js/libs/slick-carousel/slick/slick.min.js","../js/libs/angular-slick/dist/slick.min.js"]},{name:"jqcloud",files:["../js/libs/jqcloud2/dist/jqcloud.min.js","../js/libs/angular-jqcloud/angular-jqcloud.js","../js/libs/jqcloud2/dist/jqcloud.min.css"]},{name:"wu.masonry",files:["../js/libs/angular-masonry/angular-masonry.js","../js/libs/masonry/dist/masonry.pkgd.min.js","../js/libs/imagesloaded/imagesloaded.pkgd.min.js"]},{name:"ngTextTruncate",files:["../js/libs/ng-text-truncate/ng-text-truncate.js"]},{name:"ngTagsInput",files:["../js/libs/ng-tags-input/ng-tags-input.min.js","../js/libs/ng-tags-input/ng-tags-input.min.css","../js/libs/ng-tags-input/ng-tags-input.bootstrap.min.css"]},{name:"angular-percentage-filter",files:["../js/libs/angular-percentage-filter/percentage.js"]},{name:"googlePlaces",files:["../js/libs/angular-google-places-autocomplete/dist/autocomplete.min.css"]},{name:"angular-bootstrap-datetimepicker",files:["../js/libs/angular-bootstrap-datetimepicker/src/js/datetimepicker.js","../js/libs/angular-bootstrap-datetimepicker/src/css/datetimepicker.css"]},{name:"angularCircularNavigation",files:["../js/libs_misc/angular-circular-navigation/angular-circular-navigation.js","../js/libs_misc/angular-circular-navigation/angular-circular-navigation.css"]},{name:"bootstrap-icon-picker",files:["../js/libs/bootstrap-icon-picker/bootstrap-iconpicker/css/bootstrap-iconpicker.min.css"]},{name:"spectrum",files:["../js/libs/spectrum/spectrum.css","../js/libs/spectrum/spectrum.js","../js/libs/angular-spectrum-colorpicker/dist/angular-spectrum-colorpicker.min.js"]},{name:"angular-resizable",files:["../js/libs/angular-resizable/angular-resizable.min.js","../js/libs/angular-resizable/angular-resizable.min.css"]},{name:"angular-clipboard",files:["../js/libs/angular-clipboard/angular-clipboard.js"]},{name:"blueimp",files:["../js/libs/blueimp-gallery/css/blueimp-gallery.min.css","../js/libs/blueimp-gallery/js/jquery.blueimp-gallery.min.js"]},{name:"froala-wysiwyg-editor",files:["../js/libs/froala-wysiwyg-editor/css/froala_editor.min.css","../js/libs_misc/froala-wysiwyg-editor/css/froala_editor_overrides.css","../js/libs/froala-wysiwyg-editor/css/froala_style.min.css","../js/libs/froala-wysiwyg-editor/js/froala_editor.min.js"]},{name:"froala-wysiwyg-editor-plugins",files:["../js/libs/froala-wysiwyg-editor/js/plugins/align.min.js","../js/libs_misc/froala-wysiwyg-editor/js/plugins/colors.min.js","../js/libs_misc/froala-wysiwyg-editor/js/plugins/tableCellColors.min.js","../js/libs/froala-wysiwyg-editor/js/plugins/emoticons.min.js","../js/libs/froala-wysiwyg-editor/js/plugins/entities.min.js","../js/libs/froala-wysiwyg-editor/js/plugins/font_family.min.js","../js/libs/froala-wysiwyg-editor/js/plugins/font_size.min.js","../js/libs_misc/froala-wysiwyg-editor/js/plugins/image-manager.js","../js/libs_misc/froala-wysiwyg-editor/js/plugins/font_weight.js","../js/libs_misc/froala-wysiwyg-editor/js/plugins/letter_spacing_control.js","../js/libs/froala-wysiwyg-editor/js/plugins/inline_style.min.js","../js/libs/froala-wysiwyg-editor/js/plugins/line_breaker.min.js","../js/libs_misc/froala-wysiwyg-editor/js/plugins/link.min.js","../js/libs/froala-wysiwyg-editor/js/plugins/lists.min.js","../js/libs/froala-wysiwyg-editor/js/plugins/paragraph_format.min.js","../js/libs/froala-wysiwyg-editor/js/plugins/paragraph_style.min.js","../js/libs/froala-wysiwyg-editor/js/plugins/quote.min.js","../js/libs/froala-wysiwyg-editor/js/plugins/save.min.js","../js/libs_misc/froala-wysiwyg-editor/js/plugins/table.min.js","../js/libs/froala-wysiwyg-editor/js/plugins/url.min.js","../js/libs_misc/froala-wysiwyg-editor/js/plugins/video.min.js","../js/libs_misc/froala-wysiwyg-editor/css/plugins/colors.css","../js/libs/froala-wysiwyg-editor/css/plugins/emoticons.css","../js/libs/froala-wysiwyg-editor/css/plugins/image.css","../js/libs/froala-wysiwyg-editor/css/plugins/image_manager.css","../js/libs/froala-wysiwyg-editor/css/plugins/line_breaker.css","../js/libs/froala-wysiwyg-editor/css/plugins/table.css","../js/libs/froala-wysiwyg-editor/css/plugins/video.css","../js/libs/froala-wysiwyg-editor/js/plugins/code_view.min.js","../js/libs/froala-wysiwyg-editor/css/plugins/code_view.css","../js/libs/froala-wysiwyg-editor/js/plugins/code_beautifier.min.js"]},{name:"custom-froala-wysiwyg-editor",files:["../js/libs_misc/froala-wysiwyg-editor/js/plugins/media_manager.min.js","../js/libs_misc/froala-wysiwyg-editor/js/plugins/video_media_manager.min.js","../js/libs_misc/froala-wysiwyg-editor/js/plugins/button.js","../js/libs_misc/froala-wysiwyg-editor/js/plugins/font-awesome-icons.js","../js/libs_misc/froala-wysiwyg-editor/css/plugins/font-awesome.css","../js/libs_misc/froala-wysiwyg-editor/js/plugins/tableCellPadding.min.js","../js/libs_misc/froala-wysiwyg-editor/js/plugins/tableBorderWidth.min.js","../js/libs_misc/froala-wysiwyg-editor/config/config.js"]},{name:"videogular",files:["../js/libs_misc/videogular/videogular.js","../js/libs/videogular-controls/controls.js","../js/libs/videogular-overlay-play/overlay-play.js","../js/libs/videogular-buffering/buffering.js","../js/libs/videogular-poster/poster.js"]},{name:"indi-login-modal",files:["assets/js/indi-login-modal/indi-login-modal.controller.js","assets/js/indi-login-modal/indi-login-modal.service.js"]},{name:"deep-diff",files:["../js/libs/deep-diff/index.js"]},{name:"wait-for-images",files:["../js/libs_misc/waitForImages/dist/jquery.waitforimages.min.js"]}]}),app.constant("formValidations",{email:/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.([a-z]{2,})|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i,phone:/^\(?(\d{3})\)?[ .-]?(\d{3})[ .-]?(\d{4})$/,zip:/(^\d{5}$)|(^\d{5}-\d{4}$)/,extension:/^[0-9]*$/,contactTags:/^[a-z\d\-_\s]+$/i}),angular.module("config",[]).constant("ENV",{name:"development",stripeKey:["pk_test_EuZhZHVourE3RaRxELJaYEya","pk_test_t1GG6sNCkdjsza72g7NiPs60"],googleAnalyticsId:"ga:82461709",googleAnalyticsScope:"ga:pageviews,ga:timeOnPage,ga:exits,ga:avgTimeOnPage,ga:entranceRate,ga:entrances,ga:exitRate,ga:uniquePageviews",googleClientId:"277102651227-q4rq36pdioba0vomtmssv07ojqie046b.apps.googleusercontent.com",googleClientSecret:"sKl01ZtMha3K4BnBygiSQ82g",googleServerKey:"AIzaSyCAkloYlXlZx_---WXevaNHv03ReYpnvLs",googleBrowserKey:"AIzaSyAG5JFmULSakLVV16ztr7tobAFGiQrtvpU",facebookClientID:"622171824473460",paypalCheckoutURL:"https://www.sandbox.paypal.com/webapps/adaptivepayment/flow/pay"}),app.config(["$stateProvider","$urlRouterProvider","$controllerProvider","$compileProvider","$filterProvider","$provide","$ocLazyLoadProvider","JS_REQUIRES",function(e,t,n,a,o,i,s,r){"use strict";function c(){var e=arguments;return{deps:["$ocLazyLoad","$q",function(t,n){function a(e){if(r.modules)for(var t in r.modules)if(r.modules[t].name&&r.modules[t].name===e)return r.modules[t];return r.scripts&&r.scripts[e]}for(var o=n.when(1),i=0,s=e.length;i<s;i++)o=function(e){return"function"==typeof e?o.then(e):o.then(function(){var n=a(e);return n?t.load(n):$.error("Route resolve: Bad resource name ["+e+"]")})}(e[i]);return o}]}}app.controller=n.register,app.directive=a.directive,app.filter=o.register,app.factory=i.factory,app.service=i.service,app.constant=i.constant,app.value=i.value,s.config({debug:!1,events:!0,modules:r.modules}),t.otherwise("/dashboard"),t.rule(function(e,t){var n=t.path(),a=n.toLowerCase();n!=a&&t.replace().path(a)}),e.state("app",{url:"",templateUrl:"/admin/assets/views/app.html",resolve:c("modernizr","underscore","moment","angularMoment","uiSwitch","perfect-scrollbar-plugin","toaster","ngAside","chartjs","tc.chartjs","oitozero.ngSweetAlert","chatCtrl","smart-table","touchspin-plugin","slugifier","commonService","timeAgoFilter","angularFileUpload","ngTextTruncate","infinite-scroll","ui.select","blueimp","ngTagsInput","titleCase","bootstrap-confirmation","ladda","angular-ladda","uuid","formatText","asideCtrl","settingsCtrl","assetsService","mediaModalCtrl","xeditable","angular-percentage-filter","angular-clipboard","google-fonts","dashboardService","videogular","indi-login-modal","productTableFilter","ngCurrency","utilService","ngSticky","fixedHeaderTable"),abstract:!0}).state("app.dashboard",{url:"/_dashboard",templateUrl:"/admin/assets/views/dashboard.html",title:"Dashboard",resolve:c("dashboardCtrl","orderService","contactService","jquery-sparkline","chartAnalyticsService","userService","chartCommerceService","offset")}).state("app.website",{url:"/website",template:'<div ui-view class="fade-in-up"></div>',title:"Website"}).state("app.website.ssbSiteBuilder",{url:"/site-builder",template:'<div ui-view class=""></div>',title:"Simple Site Builder"}).state("app.website.ssbSiteBuilder.pages",{url:"/pages/",template:"<ssb-account-templates></ssb-account-templates>",title:"Choose a account template",icon:"ti-layout-media-left-alt",resolve:c("simpleSiteBuilderService")}).state("app.website.ssbSiteBuilder.editor",{url:"/pages/:pageId",template:'<ssb-site-builder class="ssb-site-builder"></ssb-site-builder>',title:"Simple Site Builder Page Editor",resolve:angular.extend({init:["$stateParams","SimpleSiteBuilderService",function(e,t){return t.getPage(e.pageId)}]},c("froala-wysiwyg-editor","froala-wysiwyg-editor-plugins","custom-froala-wysiwyg-editor","userService","htmlToPlaintext","spectrum","angular-slider","assetsService","toasterService","geocodeService","productService","paymentService","accountService","toTrusted","generateURLforLinks","truncate","ngSticky","slick","offset","jqcloud","jsVideoUrlParser","selectedTags","addComponentModalCtrl","componentSettingsModalCtrl","ssbComponentSettingsModalCtrl","googlePlaces","ngMap","campaignService","angular-resizable","wu.masonry","cleanType","filterPages","filterSsbSections","deep-diff","sortListPages","generateURLforProduct","ssbPostSettingsModalCtrl","ssbPostFilter","wait-for-images"))}).state("app.website.analytics",{url:"/site-analytics",templateUrl:"/admin/assets/views/site-analytics.html",title:"Site Analytics",icon:"ti-layout-media-left-alt",resolve:c("siteAnalyticsCtrl","highcharts","highmaps","highmaps-lib","secTotime","dateRangePicker","chartAnalyticsService","ipCookie","analyticsWidgetStateService","spectrum")}).state("app.website.pages",{url:"/pages",templateUrl:"/admin/assets/views/pages.html",title:"Pages",icon:"ti-layout-media-left-alt",resolve:c("pagesCtrl","userService")}).state("app.website.templates",{url:"/templates",templateUrl:"/admin/assets/views/templates.html",title:"Templates",icon:"ti-layout-media-left-alt",resolve:c("templatesCtrl","userService")}).state("app.contacts",{url:"/contacts",templateUrl:"/admin/assets/views/contacts.html",title:"Contacts",icon:"ti-layout-media-left-alt",resolve:c("contactsCtrl","ImportContactService","socialConfigService","contactService","papaParse","string_score","importContactModalCtrl","contactPagingService","spectrum")}).state("app.customers",{url:"/customers",templateUrl:"/admin/assets/views/customers.html",title:"Customers",icon:"ti-layout-media-left-alt",resolve:c("customersCtrl","customerService","spectrum")}).state("app.customeranalytics",{url:"/customers/analytics",templateUrl:"/admin/assets/views/customer-analytics.html",title:"Customer Analytics",icon:"ti-layout-media-left-alt",resolve:c("customerAnalyticsCtrl","customerService","userService","chartAnalyticsService","highcharts","highmaps","highmaps-lib","secTotime","dateRangePicker","ipCookie","analyticsWidgetStateService","spectrum")}).state("app.singleContact",{url:"/contacts/:contactId",templateUrl:"/admin/assets/views/contact-detail.html",title:"Single Contact",icon:"ti-layout-media-left-alt",resolve:c("contactDetailCtrl","contactService","ngMap","offset","assetsService","toasterService","orderService","spectrum")}).state("app.singleCustomer",{url:"/customers/:customerId",templateUrl:"/admin/assets/views/customer-detail.html",title:"Single Customer",icon:"ti-layout-media-left-alt",resolve:c("customerDetailCtrl","singleCustomerAnalyticsCtrl","ngMap","customerService","toasterService","userService","chartAnalyticsService","highcharts","highmaps","highmaps-lib","secTotime","dateRangePicker","ipCookie","analyticsWidgetStateService","spectrum")}).state("app.commerce",{url:"/commerce",template:'<div ui-view class="fade-in-up"></div>',title:"Commerce"}).state("app.commerce.products",{url:"/products",templateUrl:"/admin/assets/views/products.html",title:"Products",icon:"ti-layout-media-left-alt",resolve:c("productsCtrl","productService","accountService","ipCookie","spectrum")}).state("app.commerce.productsingle",{url:"/products/:productId",templateUrl:"/admin/assets/views/product-detail.html",title:"Products",icon:"ti-layout-media-left-alt",resolve:c("productsDetailCtrl","productService","dateRangePicker","bootstrap-icon-picker","campaignService","addComponentModalCtrl","componentSettingsModalCtrl","toTrusted","propsFilter","angularCircularNavigation","string_score","htmlToPlaintext","spectrum")}).state("app.commerce.orders",{url:"/orders",templateUrl:"/admin/assets/views/orders.html",title:"Orders",icon:"ti-layout-media-left-alt",resolve:c("ordersCtrl","orderService","contactService","dateRangePicker","spectrum")}).state("app.commerce.orderdetail",{url:"/orders/:orderId",templateUrl:"/admin/assets/views/order-detail.html",title:"Order Detail",icon:"ti-layout-media-left-alt",resolve:c("orderDetailCtrl","orderService","contactService","userService","spectrum")}).state("app.commerce.orderdetailedit",{url:"/orders/:orderId/edit",templateUrl:"/admin/assets/views/order-detail-edit.html",title:"Order Detail Edit",icon:"ti-layout-media-left-alt",resolve:c("orderDetailEditCtrl","orderService","contactService","userService","spectrum")}).state("app.marketing",{url:"/marketing",template:'<div ui-view class="fade-in-up"></div>',title:"Marketing"}).state("app.marketing.socialfeed",{url:"/social-feed",templateUrl:"/admin/assets/views/social-feed.html",title:"Social Feed",icon:"ti-layout-media-left-alt",resolve:c("socialFeedCtrl","socialConfigService","wu.masonry","orderByArrayLength")}).state("app.emails",{url:"/emails",templateUrl:"/admin/assets/views/emails.html",title:"Emails",icon:"ti-layout-media-left-alt",resolve:c("emailsCtrl","chartEmailService","spectrum")}).state("app.emailEditor",{url:"/emails/editor/:id",template:'<indi-email-builder class="ssb-site-builder"></indi-email-builder>',title:"Email Editor",icon:"ti-layout-media-left-alt",resolve:c("froala-wysiwyg-editor","froala-wysiwyg-editor-plugins","custom-froala-wysiwyg-editor","spectrum","angular-slider","deep-diff","sortListPages","spectrum")}).state("app.emailCampaign",{url:"/emails/campaigns/:id",template:"<indi-email-campaign></indi-email-campaign>",title:"Email Campaign",icon:"ti-layout-media-left-alt",resolve:c("froala-wysiwyg-editor","froala-wysiwyg-editor-plugins","custom-froala-wysiwyg-editor","propsFilter","CampaignRecipientDetailsController","campaignService","spectrum")}).state("app.marketing.campaigns",{url:"/campaigns",templateUrl:"/admin/assets/views/campaigns.html",title:"Campaigns",icon:"ti-layout-media-left-alt",resolve:c("campaignsCtrl","campaignService","propsFilter","spectrum")}).state("app.account",{url:"/account",template:'<div ui-view class="fade-in-up"></div>',title:"Account"}).state("app.account.profilebusiness",{url:"/profile-business",templateUrl:"/admin/assets/views/profile-business.html",title:"Profile Business",icon:"ti-layout-media-left-alt",resolve:c("profileBusinessCtrl","toasterService","assetsService","spectrum")}).state("app.account.profilepersonal",{url:"/profile-personal",templateUrl:"/admin/assets/views/profile-personal.html",title:"Profile Personal",icon:"ti-layout-media-left-alt",resolve:c("profilePersonalCtrl","toasterService","assetsService","offset","spectrum")}).state("app.account.billing",{url:"/billing",templateUrl:"/admin/assets/views/billing.html",title:"Billing",icon:"ti-layout-media-left-alt",resolve:c("billingCtrl","productService","stripe","paymentService","userService","toasterService","ipCookie","skeuocard")}).state("app.account.integrations",{url:"/integrations",templateUrl:"/admin/assets/views/integrations.html",title:"Integrations",icon:"ti-layout-media-left-alt",resolve:c("integrationsCtrl","socialConfigService","ipCookie","accountService")}).state("app.support",{url:"/support",template:'<div ui-view class="fade-in-up"></div>',title:"Support"}).state("app.support.helptopics",{url:"/help-topics",templateUrl:"/admin/assets/views/help-topics.html",title:"Help Topics",icon:"ti-layout-media-left-alt",resolve:c("helpTopicsCtrl","toTrusted","jsVideoUrlParser","spectrum")}).state("app.support.oldhelptopics",{url:"/old-help-topics",templateUrl:"/admin/assets/views/old-help-topics.html",title:"Old Help Topics",icon:"ti-layout-media-left-alt",resolve:c("oldHelpTopicsCtrl","spectrum")}).state("app.support.managetopics",{url:"/manage-topics",templateUrl:"/admin/assets/views/manage-topics.html",title:"Manage Topics",icon:"ti-layout-media-left-alt",resolve:c("manageTopicsCtrl","userService","spectrum")}).state("app.support.singletopic",{url:"/manage-topics/:id",templateUrl:"/admin/assets/views/editTopics.html",title:"Topic Single",icon:"ti-layout-media-left-alt",resolve:c("froala-wysiwyg-editor","froala-wysiwyg-editor-plugins","custom-froala-wysiwyg-editor","editTopicCtrl","userService","htmlToPlaintext","spectrum","angular-slider","assetsService","toasterService","geocodeService","productService","paymentService","accountService","toTrusted","generateURLforLinks","truncate","ngSticky","slick","offset","jqcloud","jsVideoUrlParser","selectedTags","addComponentModalCtrl","componentSettingsModalCtrl","templateSettingsModalCtrl","googlePlaces","ngMap","campaignService","angularCircularNavigation","generateURLforProduct")}).state("app.onboarding",{url:"/onboarding",templateUrl:"/admin/assets/views/onboarding.html",title:"Onboarding",icon:"ti-layout-media-left-alt",resolve:c("onboardingCtrl")}).state("app.dohy",{url:"/dashboard",templateUrl:"/admin/assets/js/dashboard/dohy.html",title:"Dashboard",icon:"ti-layout-media-left-alt",resolve:c("DOHYCtrl","dashboardService","DashboardWorkstreamTileComponentController","DashboardAnalyticTileComponentController","DashboardInboxComponentController","jsVideoUrlParser","highcharts","highmaps","highmaps-lib","spectrum")}).state("app.account.users",{url:"/users",templateUrl:"/admin/assets/js/users/users.html",title:"Users",icon:"ti-layout-media-left-alt",resolve:c("UsersCtrl","customerService")}).state("app.broadcastmessage",{url:"/customer/messages",templateUrl:"/admin/assets/js/messages/messages.html",title:"Messages",icon:"ti-layout-media-left-alt",resolve:c("MessagesCtrl","broadcastMessagesService")}).state("app.singlebroadcastmessage",{url:"/customer/messages/:id",templateUrl:"/admin/assets/js/messages/broadcast-message-editor/broadcast-message-editor.html",title:"Message Single",icon:"ti-layout-media-left-alt",resolve:c("froala-wysiwyg-editor","froala-wysiwyg-editor-plugins","custom-froala-wysiwyg-editor","spectrum","BroadcastMessageEditorCtrl","broadcastMessagesService")}).state("app.jobs",{url:"/jobs",templateUrl:"/admin/assets/js/jobs/jobs.html",title:"Jobs",icon:"ti-layout-media-left-alt",resolve:c("JobsCtrl","jobsService")}).state("login",{url:"/login",template:'<div ui-view class="fade-in-right-big smooth"></div>',abstract:!0}).state("login.signin",{url:"/signin",templateUrl:"/admin/assets/views/login_login.html"}).state("login.forgot",{url:"/forgot",templateUrl:"/admin/assets/views/login_forgot.html"}).state("login.registration",{url:"/registration",templateUrl:"/admin/assets/views/login_registration.html"}).state("login.lockscreen",{url:"/lock",templateUrl:"/admin/assets/views/login_lock_screen.html"})}]),app.controller("AsideCtrl",["$scope","$aside",function(e,t){"use strict";e.openAside=function(e){t.open({templateUrl:"/admin/assets/views/partials/settings.html",placement:e,size:"lg",backdrop:!0,controller:function(e,t){e.ok=function(e){t.close(),e.stopPropagation()},e.cancel=function(e){t.dismiss(),e.stopPropagation()}}})}}]),function(){"use strict";app.controller("BillingCtrl",["$scope","$rootScope","toaster","$modal","$location","$window","ProductService","PaymentService","UserService","$q","ToasterService","ipCookie",function(e,t,n,a,o,i,s,r,c,l,u,d){e.number=1,e.plus=function(){e.number++},e.closeModal=function(){e.modalInstance.close()},e.openModal=function(t){e.modalInstance=a.open({templateUrl:t,keyboard:!0,backdrop:"static",scope:e})},e._moment=function(t,n){10===t.toString().length&&(t*=1e3);var a=moment(t);return n&&(n.subtractNum&&n.subtractType&&(a=a.subtract(n.subtractNum,n.subtractType)),n.addNum&&n.addType&&(a="week"===e.planInterval?a.add(7,n.addType):"month"===e.planInterval?a.add(1,"months"):"year"===e.planInterval?a.add(1,"years"):a.add(n.addNum,n.addType))),a.format("MMMM Do, YYYY")},e.changeInvoice=function(t,n){if(t&&(e.selectedInvoice=t,t.lines.data.length&&(e.planInterval=_.last(t.lines.data).plan.interval)),e.selectedItemIndex=n,t&&t.discount&&t.discount.coupon){if(t.discount.coupon.amount_off)e.selectedInvoiceDiscount=(t.discount.coupon.amount_off/100).toFixed(2);else if(t.discount.coupon.percent_off&&t.subtotal){var a=t.subtotal*t.discount.coupon.percent_off/100;e.selectedInvoiceDiscount=(a/100).toFixed(2)}}else e.selectedInvoiceDiscount=null},e.updateStripeIdFn=function(t){e.currentUser.stripeId=t.billing.stripeCustomerId,e.selectPlanView="plan"},e.invoicePageChangeFn=function(t){var n=(t-1)*e.invoicePageLimit,a=n+e.invoicePageLimit;e.pagedInvoices=e.invoices.data.slice(n,a)},e.currentAccount={},e.planStatus={},e.planlist={list:[]},e.addOns={list:[]},e.selectedPlan={},e.planInterval="",e.selectedAddOns=[],e.customer_id=0,e.paymentId=0,s.getIndigenousProducts(function(t){t.forEach(function(t){var n=t.product_attributes,a=n.hasOwnProperty("stripePlans")&&n.stripePlans.length,o=_.findWhere(n.stripePlans,{active:!0});t.managedServices=t.name.contains("Managed Services"),t.name.contains("RVLVR")||(a&&o?r.getIndigenousStripePlan(o.id,function(a){n.stripePlans[0]=a,e.planlist.list.push(t)}):e.addOns.list.push(t))}),e.getAccountData()}),e.subscriptionSelected=!1,e.switchSubscriptionPlanFn=function(t){e.selectedPlan=e.planlist.list.filter(function(e){return e.product_attributes.stripePlans[0].id===t})[0],e.subscriptionSelected=null!==t,e.selectedAddOns=[]},e.$watch("selectedPlan",function(){}),e.addInvoiceItem=function(t){e.selectedAddOns.push(t)},e.removeInvoiceItem=function(t){e.selectedAddOns=_.without(e.selectedAddOns,t)},e.isSelectedAddon=function(t){return _.contains(e.selectedAddOns,t)},e.savePlanFn=function(t,n){e.account.billing.stripeCustomerId?r.postSubscribeToIndigenous(e.account.billing.stripeCustomerId,t,null,e.planStatus[t],e.selectedAddOns,n,function(t){e.cancelOldSubscriptionsFn(),e.selectedPlan=t,r.getUpcomingInvoice(e.account.billing.stripeCustomerId,function(t){e.upcomingInvoice=t}),r.getInvoicesForAccount(function(t){e.invoices=t,e.pagedInvoices=e.invoices.data.slice(0,e.invoicePageLimit)}),u.setPending("success","Subscribed to new plan."),e.getAccountData(),i.location.reload(!0)},function(t){u.clearAll(),u.show("error",t.status),e.selectedPlan.paymentProcessing=!1}):u.setPending("error","No Stripe customer ID."),e.selectPlanView="card"},e.cancelOldSubscriptionsFn=function(){e.subscriptionsCompleteList.data.forEach(function(e){r.deleteStripeSubscription(e.customer,e.id,function(e){})})},e.hasCard=!1,e.$watch("currentUser.stripeId",function(e){}),e.minRequirements=!0,e.getAccountData=function(){c.getAccount(function(n){void 0!==n.locked_sub&&!0!==n.locked_sub||u.show("warning","No Subscription"),u.processPending(),u.processHtmlPending(),e.account=n,e.selectedPlan.paymentProcessing=!1,n.billing.subscriptionId&&r.getStripeSubscription(n.billing.stripeCustomerId,n.billing.subscriptionId,function(t){e.selectedPlan=e.planlist.list.filter(function(e){return e.product_attributes.stripePlans[0].id===t.plan.id})[0]}),n.billing.stripeCustomerId&&(r.getUpcomingInvoice(n.billing.stripeCustomerId,function(t){e.upcomingInvoice=t,e.planInterval=t.lines.data[0].plan.interval}),r.getListStripeSubscriptions(n.billing.stripeCustomerId,function(t){e.subscriptionsCompleteList=t}),r.getInvoicesForAccount(function(t){e.invoices=t,e.pagedInvoices=e.invoices.data.slice(0,e.invoicePageLimit),e.showToaster=!0,u.processPending(),u.processHtmlPending()}),r.getTransactionsForAccount(function(t){e.transactions=t,e.pagedTransactions=e.transactions.data.slice(0,e.invoicePageLimit),e.showToaster=!0,u.processPending(),u.processHtmlPending()}),r.getCustomerCards(e.account.billing.stripeCustomerId,function(t){t.data.length&&(e.hasCard=!0)},function(){})),!0===n.locked_sub&&(u.show("error","No Indigenous Subscription found.  Please update your billing information."),t.$on("$stateChangeStart",function(e){e.preventDefault(),u.show("error","No Indigenous Subscription found.  Please update your billing information.")}))})}}])}(),app.controller("CalendarCtrl",["$scope","$aside","moment","SweetAlert",function(e,t,n,a){"use strict";function o(n,a){t.open({templateUrl:"calendarEvent.html",placement:"right",size:"sm",backdrop:!0,controller:function(e,t){e.$modalInstance=t,e.action=n,e.event=a,e.cancel=function(){t.dismiss("cancel")},e.deleteEvent=function(){t.close(e.event,e.event)}}}).result.then(function(t,n){e.eventDeleted(t)})}var i=new Date,s=i.getDate(),r=i.getMonth(),c=i.getFullYear();e.events=[{title:"Birthday Party",type:"home",starts_at:new Date(c,r,5,19,0),ends_at:new Date(c,r,5,22,30)},{title:"AngularJS Seminar",type:"off-site-work",starts_at:new Date(c,r,8,10,30),ends_at:new Date(c,r,9,18,30)},{title:"Event 1",type:"job",starts_at:new Date(c,r,s-5),ends_at:new Date(c,r,s-2)},{title:"Event 2",type:"cancelled",starts_at:new Date(c,r,s-3,16,0),ends_at:new Date(c,r,s-3,18,0)},{title:"This is a really long event title",type:"to-do",starts_at:new Date(c,r,s+1,19,0),ends_at:new Date(c,r,s+1,22,30)}],e.calendarView="month",e.calendarDay=new Date,e.eventClicked=function(e){o("Clicked",e)},e.addEvent=function(){e.events.push({title:"New Event",starts_at:new Date(c,r,s,10,0),ends_at:new Date(c,r,s,11,0),type:"job"}),e.eventEdited(e.events[e.events.length-1])},e.eventEdited=function(e){o("Edited",e)},e.eventDeleted=function(t){a.swal({title:"Are you sure?",text:"Your will not be able to recover this event!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel plx!",closeOnConfirm:!1,closeOnCancel:!1},function(n){n?(e.events.splice(t.$id,1),a.swal("Deleted!","Event has been deleted.","success")):a.swal("Cancelled","Event is safe :)","error")})},e.setCalendarToToday=function(){e.calendarDay=new Date},e.toggle=function(e,t,n){e.preventDefault(),e.stopPropagation(),n[t]=!n[t]}}]),function(e){app.controller("CampaignsCtrl",["$scope","$timeout","$location","toaster","$filter","$modal","CampaignService","$window","$state","AccountService","EmailCampaignService","WebsiteService",function(t,n,a,o,i,s,r,c,l,u,d,p){t.Math=c.Math,t.newCampaign={},t.itemPerPage=100,t.showPages=15;var m=function(){r.getCampaigns(function(e){n(function(){t.$apply(function(){t.campaigns=e,n(m,15e3)})})})};m(),t.tableView="list",u.getAccount(function(e){t.account=e}),p.getEmails(null,function(e){t.emails=e}),t.viewSingle=function(n,o){n.target&&e.element(n.target).hasClass("no-redirect-link")||(t.account.showhide.ssbEmail?l.go("app.emailCampaign",{id:o._id}):a.path("/marketing/campaigns/"+o._id))},t.percentCalFn=function(e,t){var n=Math.round(e/t*100*100)/100;return isNaN(n)?0:n},t.openCampaignModal=function(e){t.modalInstance=s.open({templateUrl:"new-campaign-modal",size:e,keyboard:!0,backdrop:"static",scope:t})},t.createCampaignFn=function(e){t.saveLoading=!0;var n=_.findWhere(t.emails,{_id:e.emailId}),i={name:e.name,type:"onetime",status:"DRAFT",visibility:1,startDate:"",emailSettings:{emailId:n._id,offset:"",fromEmail:n.fromEmail,fromName:n.fromName,replyTo:n.replyTo,bcc:n.bcc,subject:n.subject,vars:[],sendAt:{}},searchTags:{operation:"set",tags:[]},statistics:{emailsSent:0,emailsOpened:0,emailsClicked:0,emailsBounced:0,emailsDropped:0,participants:0,unsubscribes:0},contactTags:[]};d.checkIfDuplicateCampaign(null,i.name).then(function(e){if(e.data)return o.pop("warning","Campaign name already exists"),void(t.saveLoading=!1);d.createCampaign(i).then(function(e){t.cancel(),a.path("/emails/campaigns/"+e.data._id)}).catch(function(e){t.saveLoading=!1})})},t.cancel=function(){t.modalInstance.close()},t.downloadReport=function(e){r.downloadReport(e),o.pop("success","Please wait while report is downloading...")},t.getters={unsubscribes:function(e){return e.statistics&&e.statistics.unsubscribes?e.statistics.unsubscribes:0}}}])}(angular),app.controller("ChatCtrl",["$scope",function(e){"use strict";e.selfIdUser=50223456,e.otherIdUser=50223457,e.setOtherId=function(t){e.otherIdUser=t};var t=(new Date).setTime((new Date).getTime()-144e5);e.chat=[{user:"Peter Clark",avatar:"assets/images/avatar-1.jpg",to:"Nicole Bell",date:t,content:"Hi, Nicole",idUser:50223456,idOther:50223457},{user:"Peter Clark",avatar:"assets/images/avatar-1.jpg",to:"Nicole Bell",date:new Date(t).setTime(new Date(t).getTime()+6e4),content:"How are you?",idUser:50223456,idOther:50223457},{user:"Nicole Bell",avatar:"assets/images/avatar-2.jpg",to:"Peter Clark",date:new Date(t).setTime(new Date(t).getTime()+6e4),content:"Hi, i am good",idUser:50223457,idOther:50223456},{user:"Peter Clark",avatar:"assets/images/avatar-1.jpg",to:"Nicole Bell",date:new Date(t).setTime(new Date(t).getTime()+6e4),content:"Glad to see you ;)",idUser:50223456,idOther:50223457},{user:"Nicole Bell",avatar:"assets/images/avatar-2.jpg",to:"Peter Clark",date:new Date(t).setTime(new Date(t).getTime()+39e5),content:"What do you think about my new Dashboard?",idUser:50223457,idOther:50223456},{user:"Nicole Bell",avatar:"assets/images/avatar-2.jpg",to:"Peter Clark",date:new Date(t).setTime(new Date(t).getTime()+768e4),content:"Alo...",idUser:50223457,idOther:50223456},{user:"Nicole Bell",avatar:"assets/images/avatar-2.jpg",to:"Peter Clark",date:new Date(t).setTime(new Date(t).getTime()+768e4),content:"Are you there?",idUser:50223457,idOther:50223456},{user:"Peter Clark",avatar:"assets/images/avatar-1.jpg",to:"Nicole Bell",date:new Date(t).setTime(new Date(t).getTime()+6e4),content:"Hi, i am here",idUser:50223456,idOther:50223457},{user:"Peter Clark",avatar:"assets/images/avatar-1.jpg",to:"Nicole Bell",date:new Date(t).setTime(new Date(t).getTime()+6e4),content:"Your Dashboard is great",idUser:50223456,idOther:50223457},{user:"Nicole Bell",avatar:"assets/images/avatar-2.jpg",to:"Peter Clark",date:new Date(t).setTime(new Date(t).getTime()+138e5),content:"How does the binding and digesting work in AngularJS?, Peter? ",idUser:50223457,idOther:50223456},{user:"Peter Clark",avatar:"assets/images/avatar-1.jpg",to:"Nicole Bell",date:new Date(t).setTime(new Date(t).getTime()+1428e4),content:"oh that's your question?",idUser:50223456,idOther:50223457},{user:"Peter Clark",avatar:"assets/images/avatar-1.jpg",to:"Nicole Bell",date:new Date(t).setTime(new Date(t).getTime()+1428e4),content:"little reduntant, no?",idUser:50223456,idOther:50223457},{user:"Peter Clark",avatar:"assets/images/avatar-1.jpg",to:"Nicole Bell",date:new Date(t).setTime(new Date(t).getTime()+1428e4),content:"literally we get the question daily",idUser:50223456,idOther:50223457},{user:"Nicole Bell",avatar:"assets/images/avatar-2.jpg",to:"Peter Clark",date:new Date(t).setTime(new Date(t).getTime()+1428e4),content:"I know. I, however, am not a nerd, and want to know",idUser:50223457,idOther:50223456},{user:"Peter Clark",avatar:"assets/images/avatar-1.jpg",to:"Nicole Bell",date:new Date(t).setTime(new Date(t).getTime()+1428e4),content:"for this type of question, wouldn't it be better to try Google?",idUser:50223456,idOther:50223457},{user:"Nicole Bell",avatar:"assets/images/avatar-2.jpg",to:"Peter Clark",date:new Date(t).setTime(new Date(t).getTime()+1428e4),content:"Lucky for us :)",idUser:50223457,idOther:50223456},{user:"Steven Thompson",avatar:"assets/images/avatar-3.jpg",to:"Peter Clark",date:new Date(t).setTime(new Date(t).getTime()+6e4),content:"Hi, Peter. I'd like to start using AngularJS.",idUser:50223458,idOther:50223456},{user:"Steven Thompson",avatar:"assets/images/avatar-3.jpg",to:"Peter Clark",date:new Date(t).setTime(new Date(t).getTime()+6e4),content:"There are many differences from jquery?",idUser:50223458,idOther:50223456},{user:"Peter Clark",avatar:"assets/images/avatar-1.jpg",to:"Steven Thompson",date:new Date(t).setTime(new Date(t).getTime()+3e5),content:"Enough!",idUser:50223456,idOther:50223458},{user:"Peter Clark",avatar:"assets/images/avatar-1.jpg",to:"Steven Thompson",date:new Date(t).setTime(new Date(t).getTime()+3e5),content:"In jQuery, you design a page, and then you make it dynamic...",idUser:50223456,idOther:50223458},{user:"Peter Clark",avatar:"assets/images/avatar-1.jpg",to:"Steven Thompson",date:new Date(t).setTime(new Date(t).getTime()+3e5),content:"but in AngularJS, you must start from the ground up with your architecture in mind",idUser:50223456,idOther:50223458},{user:"Steven Thompson",avatar:"assets/images/avatar-3.jpg",to:"Peter Clark",date:new Date(t).setTime(new Date(t).getTime()+42e4),content:"ok!",idUser:50223458,idOther:50223456},{user:"Steven Thompson",avatar:"assets/images/avatar-3.jpg",to:"Peter Clark",date:new Date(t).setTime(new Date(t).getTime()+42e4),content:"could you give me some lessons?",idUser:50223458,idOther:50223456},{user:"Peter Clark",avatar:"assets/images/avatar-1.jpg",to:"Steven Thompson",date:new Date(t).setTime(new Date(t).getTime()+42e4),content:"sure!",idUser:50223456,idOther:50223458},{user:"Steven Thompson",avatar:"assets/images/avatar-3.jpg",to:"Peter Clark",date:new Date(t).setTime(new Date(t).getTime()+42e4),content:"Thanks a lot!",idUser:50223458,idOther:50223456},{user:"Ella Patterson",avatar:"assets/images/avatar-4.jpg",to:"Peter Clark",date:new Date(t).setTime(new Date(t).getTime()+1002e3),content:"Peter what can you tell me about the new marketing project?",idUser:50223459,idOther:50223456},{user:"Peter Clark",avatar:"assets/images/avatar-1.jpg",to:"Steven Thompson",date:new Date(t).setTime(new Date(t).getTime()+108e4),content:"Well, there is a lot to say. Are you free tomorrow?",idUser:50223456,idOther:50223459},{user:"Ella Patterson",avatar:"assets/images/avatar-4.jpg",to:"Peter Clark",date:new Date(t).setTime(new Date(t).getTime()+1182e3),content:"Yes",idUser:50223459,idOther:50223456},{user:"Peter Clark",avatar:"assets/images/avatar-1.jpg",to:"Steven Thompson",date:new Date(t).setTime(new Date(t).getTime()+1182e3),content:"OK, we will have a meeting tomorrow afternoon",idUser:50223456,idOther:50223459},{user:"Kenneth Ross",avatar:"assets/images/avatar-5.jpg",to:"Peter Clark",date:new Date(t).setTime(new Date(t)),content:"Mr. Clark, congratulations for your new project",idUser:50223460,idOther:50223456},{user:"Peter Clark",avatar:"assets/images/avatar-1.jpg",to:"Kenneth Ross",date:new Date(t).setTime(new Date(t)),content:"Thank You very much Mr. Ross",idUser:50223456,idOther:50223460}],e.sendMessage=function(){var t={user:"Peter Clark",avatar:"assets/images/avatar-1.jpg",date:new Date,content:e.chatMessage,idUser:e.selfIdUser,idOther:e.otherIdUser};e.chat.push(t),e.chatMessage=""}}]),function(e){"use strict";app.controller("ContactDetailCtrl",["$scope","$rootScope","$location","$modal","toaster","$stateParams","contactConstant","ContactService","CommonService","UserService","SweetAlert","$state","OrderService","formValidations","orderConstant","$window","$timeout",function(t,n,a,o,i,s,r,c,l,u,d,p,m,g,f,h,v){function b(){var e=t.$parent.currentUser.email;return(t.$parent.currentUser.first||t.$parent.currentUser.last)&&(e=t.$parent.currentUser.first+" "+t.$parent.currentUser.last),e.trim()}function y(e){var t=!1;return(e.address||e.address2||e.city||e.state||e.zip||e.country)&&(t=!0),t}t.notesEmail={enable:!1},t.openModal=function(e){t.modalInstance=o.open({templateUrl:e,keyboard:!0,backdrop:"static",scope:t})},t.openMediaModal=function(){t.showInsert=!0,t.modalInstance=o.open({templateUrl:"media-modal",controller:"MediaModalCtrl",keyboard:!0,backdrop:"static",size:"lg",resolve:{showInsert:function(){return t.showInsert},insertMedia:function(){return t.insertPhoto},isSingleSelect:function(){return!0}}})},t.closeModal=function(){t.modalInstance.close()},t.formValidations=g,t.orderConstant=f,t.ip_geo_address="",t.location={},t.loadingMap=!0,t.data={fullName:"",loaded:!1},a.search().order&&(t.redirectToOrder=!0,t.orderId=a.search().id,s.orderId=t.orderId),t.backToOrder=function(){s.orderId?a.path("/commerce/orders/"+s.orderId):h.history.back()},t.backToContacts=function(){a.url("/contacts")},t.newNote={},t.addNote=function(n){var a=moment(),o={note:n,user_id:t.currentUser._id,date:a.toISOString()},s={};t.contact.notes||(t.contact.notes=[]),t.contact.notes.push(o),t.matchUsers(t.contact),t.newNote.text="",t.contact_data=t.contact_data||{},t.contact_data.tags=t.unsetTags();var r={};t.notesEmail.enable&&(r={sendTo:t.contact.details[0].emails[0].email,fromEmail:t.$parent.currentUser.email,fromName:b(),note_value:n,enable_note:t.notesEmail.enable}),s={data_contact:t.contact_data._id,email_send:r},c.saveContact(t.contact_data,function(n){t.contact=n,t.setTags(),t.originalContact=e.copy(t.contact),i.pop("success","Notes Added."),t.notesEmail={enable:!1}}),t.notesEmail.enable&&c.addContactNote(s,function(e){t.notesEmail={enable:!1}})},u.getUsers(function(e){t.users=e,t.getContact()}),t.matchUsers=function(e){var n=e.notes;if(n&&n.length>0)return _.each(n,function(e){var n=_.find(t.users,function(t){return t._id===e.user_id});n&&n.profilePhotos&&n.profilePhotos[0]&&(e.user_profile_photo=n.profilePhotos[0])}),n},t.pushLocalNote=function(e){e.notes=t.matchUsers(e);var n=e.notes[e.notes.length-1];t.contact.notes.push(n)},t.getContact=function(){c.getContact(s.contactId,function(e,n){if(n)return i.pop("warning",n.message),void(404===n.code&&a.path("/contacts"));e.notes=t.matchUsers(e),t.contact=e,t.setTags(),t.setDefaults(),t.data.fullName=[t.contact.first,t.contact.middle,t.contact.last].join(" ").trim(),t.data.loaded=!0,t.getMapData()})},t.resizeMap=function(){t.loadingMap=!0,v(function(){t.loadingMap=!1},500)},t.displayAddressFormat=function(e){return _.filter([e.address,e.address2,e.city,e.state,e.zip],function(e){return""!==e}).join(",")},t.queryAddressFormat=function(e){var t="";return e.address&&(t+="street="+e.address+"&"),e.city&&(t+="city="+e.city+"&"),e.state&&(t+="state="+e.state+"&"),e.zip&&(t+="postalcode="+e.zip+"&"),e.country?t+="country="+e.country:t+="country=us",t},t.refreshMap=function(n){if(0!==t.contact.details.length&&t.contact.details[0].addresses&&0!==t.contact.details[0].addresses.length){var a=e.copy(t.contact.details[0].addresses[0]);a.address2="",t.ip_geo_address=t.displayAddressFormat(a),t.city=t.contact.details[0].addresses[0].city,t.loadingMap=!1}var o=!1;t.ip_geo_address&&!e.equals(t.originalContact.details[0].addresses[0],t.contact.details[0].addresses[0])?c.getGeoSearchAddress(t.ip_geo_address,function(e){void 0===e.error?(t.location.lat=parseFloat(e.lat),t.location.lon=parseFloat(e.lon),t.contact_data.details[0].addresses[0].lat=t.location.lat,t.contact_data.details[0].addresses[0].lon=t.location.lon,t.markers&&t.markers.mainMarker&&(t.markers.mainMarker.lat=parseFloat(e.lat),t.markers.mainMarker.lon=parseFloat(e.lon)),t.loadingMap=!1,o=!0):(t.loadingMap=!1,t.location.lat="",t.location.lon="",t.contact_data.details[0].addresses[0].lat="",t.contact_data.details[0].addresses[0].lon="",t.markers&&t.markers.mainMarker&&(t.markers.mainMarker.lat="",t.markers.mainMarker.lon="")),n&&n(o)}):(!t.ip_geo_address.length&&t.contact_data&&(t.location.lat="",t.location.lon="",t.contact_data.details[0].addresses[0].lat="",t.contact_data.details[0].addresses[0].lon="",t.markers&&t.markers.mainMarker&&(t.markers.mainMarker.lat="",t.markers.mainMarker.lon="")),n&&n(!0))},t.getMapData=function(){var n;t.contact.details[0].addresses.length>-1&&(n=e.copy(t.contact.details[0].addresses[0])),n?n.lat&&n.lon&&y(n)?(t.originalContact=e.copy(t.contact),t.showMap(n.lat,n.lon)):!y(n)||n.lat&&n.lon?t.originalContact=e.copy(t.contact):(n.address2="",t.convertAddressToLatLon(n,function(a){a&&(n.lat=parseFloat(a.lat),n.lon=parseFloat(a.lon),t.showMap(a.lat,a.lon)),t.originalContact=e.copy(t.contact),t.loadingMap=!1}),t.originalContact=e.copy(t.contact)):(t.loadingMap=!1,t.originalContact=e.copy(t.contact))},t.convertAddressToLatLon=function(e,n){t.displayAddressFormat(e)?c.getGeoSearchAddress(t.displayAddressFormat(e),function(e){void 0===e.error?n(e):n()}):n()},t.showMap=function(e,n){t.loadingMap=!1,t.location.lat=parseFloat(e),t.location.lon=parseFloat(n),t.markers&&t.markers.mainMarker&&(t.markers.mainMarker.lat=parseFloat(e),t.markers.mainMarker.lon=parseFloat(n))},t.contactId=s.contactId,t.modifyAddress={},t.saveLoading=!1,t.countries=r.country_codes,t.saveContactDisabled=!0,t.contact={_id:null,accountId:$$.server.accountId,devices:[{_id:l.generateUniqueAlphaNumericShort(),serial:""}],details:[{_id:l.generateUniqueAlphaNumericShort(),type:"lo",emails:[{_id:l.generateUniqueAlphaNumericShort(),email:""}],phones:[{_id:l.generateUniqueAlphaNumericShort(),type:"m",number:"",extension:"",default:!1}],addresses:[{_id:l.generateUniqueAlphaNumericShort(),address:"",address2:"",state:"",zip:"",country:"",defaultShipping:!1,defaultBilling:!1,city:"",countryCode:"",displayName:"",lat:"",lon:""}]}]},t.inValidateTags=function(){var e=!1;return t.contact_data.tags?t.contact_data.tags.length||(e=!0):e=!0,e},t.contactSaveFn=function(n,a,o){if(t.pageSaving=!0,t.saveLoading=!0,t.checkContactValidity()){if(t.unsetTags(),!n&&t.inValidateTags())return t.saveLoading=!1,a&&d.swal("Warning","Your edits were NOT saved.","error"),void i.pop("warning","Please add at least one tag.");t.refreshMap(function(s){if(s||n||(t.errorMapData=!0,i.pop("warning","Address could not be found.")),t.errorMapData=!1,t.contact_data.details)for(var r=0;r<t.contact_data.details.length;r++)if(t.contact_data.details[r].emails)for(var l=0;l<t.contact_data.details[r].emails.length;l++)t.contact_data.details[r].emails[l].email=t.contact_data.details[r].emails[l].email.toLowerCase();c.checkDuplicateEmail(t.contact_data.details[0].emails[0].email,!n,function(i){t.originalContact&&!e.equals(t.contact_data.details[0].emails[0].email,t.originalContact.details[0].emails[0].email)&&i&&i.length&&(i.length>1||i[0]._id!=t.contact_data._id)?n||(d.swal({title:"Duplicate Email",text:"Email Already exists, Do you want to continue with changes?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, save the changes!",cancelButtonText:"No, do not save the changes!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?t.saveContactChanges(n,a,o):t.saveLoading=!1}),a&&d.swal("Warning","Your edits were NOT saved.","error")):t.saveContactChanges(n,a,o)})})}else t.saveLoading=!1,n||i.pop("warning","Contact Name OR Email is required"),a&&d.swal("warning","Your edits were NOT saved.","error")},t.saveContactChanges=function(n,a,o){c.saveContact(t.contact_data,function(s){t.contact=s,t.setDefaults(),t.setTags(),t.saveLoading=!1,t.originalContact=e.copy(t.contact),n||("customerAdd"===t.currentState?i.pop("success","Contact Created."):i.pop("success","Contact Saved.")),t.pageSaving=!1,a&&(d.swal("Saved!","Your edits were saved to the page.","success"),h.location=o)})},t.checkContactValidity=function(){var n=t.data.fullName,a=_.filter(t.contact.details[0].emails,function(e){return""!==e.email});if(e.isDefined(n)&&""!==n||a.length>0)return!0},t.addDeviceFn=function(){t.contact.devices.push({_id:$$.u.idutils.generateUniqueAlphaNumericShort(),serial:""})},t.removeItem=function(e,t){t.splice(e,1)},t.contactPhoneTypeSaveFn=function(e,n){var a=null;"m"===n&&(a="mobile"),"h"===n&&(a="home"),"w"===n&&(a="work"),$("#contact-phone-type-"+e).html(a),t.contact.details[0].phones[e].type=n},t.getModifyAddressFn=function(e){return t.modifyAddress[e]},t.setModifyAddressFn=function(e,n){t.modifyAddress[e]=n},t.contactDeleteFn=function(){c.deleteContact(t.contactId,function(e){i.pop("success","Contact Deleted.",e)})},t.restoreFn=function(){t.contactId?(void 0===t.contact.type&&(t.contact.type=t.userPreferences.default_customer_type),0===t.contact.details[0].addresses.length&&(t.contact.details[0].addresses[0].city=t.userPreferences.default_customer_city,t.contact.details[0].addresses[0].state=t.userPreferences.default_customer_state,t.contact.details[0].addresses[0].country=t.userPreferences.default_customer_country,t.contact.details[0].addresses[0].zip=t.userPreferences.default_customer_zip)):(t.contact.type=t.userPreferences.default_customer_type,t.contact.details[0].addresses[0].city=t.userPreferences.default_customer_city,t.contact.details[0].addresses[0].state=t.userPreferences.default_customer_state,t.contact.details[0].addresses[0].country=t.userPreferences.default_customer_country,t.contact.details[0].addresses[0].zip=t.userPreferences.default_customer_zip)},t.savePreferencesFnWait=!1,t.savePreferencesFn=function(){t.savePreferencesFnWait||(t.savePreferencesFnWait=!0,v(function(){u.updateUserPreferences(t.userPreferences,!0,function(e){}),t.restoreFn(),t.savePreferencesFnWait=!1},1500))},t.setFullName=function(){var e=t.data.fullName.match(/\S+/g);e?e.length>=3?(t.contact.first=e[0],t.contact.middle=e[1],t.contact.last=e[2]):2===e.length?(t.contact.first=e[0],t.contact.middle="",t.contact.last=e[1]):1===e.length&&(t.contact.first=e[0],t.contact.middle="",t.contact.last=""):(t.contact.first="",t.contact.middle="",t.contact.last="")},t.insertPhoto=function(e){t.contact.photo=e.url},t.removePhoto=function(e){t.contact.photo=null},t.enableSaveBtnFn=function(){t.saveContactDisabled=!1},t.contactLabel=function(e){return c.contactLabel(e)},t.checkBestEmail=function(e){var t=c.checkBestEmail(e);return this.email=e.email,t},t.checkFacebookId=function(e){var t=c.checkFacebookId(e);return this.facebookId=e.facebookId,t},t.checkTwitterId=function(e){var t=c.checkTwitterId(e);return this.twitterId=e.twitterId,t},t.checkLinkedInId=function(e){var t=c.checkLinkedInId(e);return this.linkedInUrl=e.linkedInUrl,this.linkedInId=e.linkedInId,t},t.checkAddress=function(e){var t=c.checkAddress(e);return this.address=e.address,t},t.contactAddEmailFn=function(){t.contact.details[0].emails.push({_id:l.generateUniqueAlphaNumericShort(),email:""})},t.removeEmail=function(e){t.contact.details[0].emails.splice(e,1)},t.showAddEmail=function(e){return e._id===t.contact.details[0].emails[0]._id},t.addContactPhoneFn=function(){t.contact.details[0].phones.push({_id:l.generateUniqueAlphaNumericShort(),number:"",extension:""})},t.removePhone=function(e){t.contact.details[0].phones.splice(e,1)},t.showAddPhone=function(e){return e._id===t.contact.details[0].phones[0]._id},t.removeAddress=function(e){t.contact.details[0].addresses.splice(e,1)},t.showAddAddress=function(e){return e._id===t.contact.details[0].addresses[0]._id},t.contactAddAddressFn=function(){t.contact.details[0].addresses.push({_id:l.generateUniqueAlphaNumericShort(),address:"",address2:"",state:"",zip:"",country:"",defaultShipping:!1,defaultBilling:!1,city:"",countryCode:"",displayName:"",lat:"",lon:""})},t.setDefaults=function(){0===t.contact.details.length&&(t.contact.details[0]={}),t.contact.details[0].emails||(t.contact.details[0].emails=[]),t.contact.details[0].phones||(t.contact.details[0].phones=[]),t.contact.details[0].addresses||(t.contact.details[0].addresses=[]),t.contact.details.length&&(t.contact.details[0].emails.length||t.contactAddEmailFn(),t.contact.details[0].phones.length||t.addContactPhoneFn(),t.contact.details[0].addresses.length||t.contactAddAddressFn())},t.contact.tags||(t.contact.tags={}),c.getContactTags(function(e){t.contactTags=e}),c.listAllContactTags(function(e){c.fomatContactTags(e,function(e){t.contactTags=e})}),t.setTags=function(){var e=[],n=[];_.each(t.contact.tags,function(a){var o=_.findWhere(t.contactTags,{data:a});o?(n.push(o.label),e.push(o)):(n.push(a),e.push({data:a,label:a}))}),t.myContactTags=n.join(", "),t.contact.tags=e},t.unsetTags=function(){var n=[];t.contact_data=e.copy(t.contact),_.each(t.contact_data.tags,function(e){n.push(e.data)}),n&&(t.contact_data.tags=_.uniq(n))},m.getCustomerOrders(s.contactId,function(e){t.orders=_.filter(e,function(e){return"DONATION"!==e.line_items[0].type}),t.donations=_.filter(e,function(e){return"DONATION"==e.line_items[0].type})}),t.updateFullName=function(){t.data.fullName=[t.contact.first,t.contact.middle,t.contact.last].join(" ").trim()},t.deleteContactFn=function(n){d.swal({title:"Are you sure?",text:"Do you want to delete this contact?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, do not delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(a){a&&c.deleteContact(n._id,function(){i.pop("warning","Contact Deleted."),t.originalContact=e.copy(t.contact),p.go("app.contacts")})})},t.$back=function(){h.history.back()},t.formatOrderStatus=function(e){return m.formatOrderStatus(e)},t.checkIfDirty=function(){var n=!1;return t.newNote&&t.newNote.text&&(n=!0),t.originalContact&&!e.equals(t.originalContact,t.contact)&&(n=!0),n},t.resetDirty=function(){t.originalContact=null,t.contact=null},t.tagToContact=function(e){return c.tagToContact(e)},t.viewSingleOrder=function(e){p.go("app.commerce.orderdetail",{orderId:e})},t.undoContacts=function(){t.contact=e.copy(t.originalContact),t.getContact(),v(function(){i.pop("success","Changes undo")},2e3)},t.getters={total:function(e){return parseFloat(e.total)||0},items:function(e){return e.line_items?e.line_items.length:0}}}])}(angular),function(e){"use strict";app.controller("ContactsCtrl",["$scope","$state","toaster","$modal","$window","ContactService","SocialConfigService","userConstant","formValidations","CommonService","$timeout","SweetAlert","$location","$q","pagingConstant","ContactPagingService","UtilService",function(t,n,a,o,i,s,r,c,l,u,d,p,m,g,f,h,v){function b(){s.listAllContactTags(function(e){s.fomatContactTags(e,function(e){t.contactTags=e})})}function y(){t.getContactCount(),t.getContacts(),b()}function w(){var e,n,a=1,o=t.pagingParams.curPage,i=C();for((e=(a=Math.max(a,o-Math.abs(Math.floor(t.pagingParams.showPages/2))))+t.pagingParams.showPages)>i&&(e=i+1,a=Math.max(1,e-t.pagingParams.showPages)),t.pages=[],n=a;n<e;n++)t.pages.push(n)}function C(){return t.contacts?Math.ceil(t.contactsCount/t.pagingParams.limit):0}function S(){h.skip=t.pagingParams.skip,h.page=t.pagingParams.curPage,h.globalSearch=e.copy(t.pagingParams.globalSearch),h.fieldSearch=e.copy(t.pagingParams.fieldSearch),h.showFilter=t.pagingParams.showFilter,h.sortBy=t.pagingParams.sortBy,h.sortDir=t.pagingParams.sortDir}function k(){t.pagingParams.curPage=1,t.pagingParams.skip=0,h.skip=t.pagingParams.skip,h.page=t.pagingParams.curPage,t.pageLoading=!0}function T(){t.pagingParams.fieldSearch={}}function P(){var e=!1,n=t.pagingParams.fieldSearch;if(!_.isEmpty(n))for(var a=0;a<=Object.keys(n).length-1;a++)n[Object.keys(n)[a]]&&(e=!0);return e}t.tableView="list",t.itemPerPage=100,t.showPages=15,t.selectAllChecked=!1,t.bulkActionChoice={},t.tagsBulkAction={},t.formValidations=l,t.default_image_url="/admin/assets/images/default-user.png",t.pagingConstant=f,t.bulkActionChoices=[{data:"tags",label:"Tags"},{data:"delete",label:"Delete"}],t.numberOfPages=C,t.selectPage=function(e){e!=t.pagingParams.curPage&&(t.pagingParams.curPage=e,t.pagingParams.skip=(e-1)*t.pagingParams.limit,t.pageLoading=!0,S(),t.getContacts())},t.sortContacts=function(e,n){t.sortData.column!==n&&(t.sortData.details={}),t.sortData.column=n,t.sortData.details[n]?1===t.sortData.details[n].direction?t.sortData.details[n].direction=-1:t.sortData.details[n].direction=1:t.sortData.details[n]={direction:1,sortColum:e},t.pagingParams.sortBy=e,t.pagingParams.sortDir=t.sortData.details[n].direction,k(),S(),t.getContacts()},t.showFilteredRecords=function(){return!t.loadingFilter&&v.showFilteredRecords(t.pagingParams.globalSearch,t.pagingParams.fieldSearch)},t.loadContactsWithDefaults=y,t.pagingParams={limit:f.numberOfRowsPerPage,skip:h.skip,curPage:h.page,showPages:f.displayedPages,globalSearch:h.globalSearch,fieldSearch:h.fieldSearch,showFilter:h.showFilter,sortBy:h.sortBy,sortDir:h.sortDir},t.showFilter=function(){t.pagingParams.showFilter=!t.pagingParams.showFilter,S(),t.pagingParams.showFilter||T()},t.sortData={column:"",details:{}},t.customTagFilert=function(e){return t.contact.tags.length>0&&_.filter(t.contact.tags,function(t){return t.label===e.label}).length<1},t.getContacts=function(){s.getPagedContacts(t.pagingParams,P(),function(e){var n=e.results;t.contactsCount=e.total,_.each(n,function(e){e.bestEmail=t.checkBestEmail(e),e.hasFacebookId=t.checkFacebookId(e),e.hasTwitterId=t.checkTwitterId(e),e.hasLinkedInId=t.checkLinkedInId(e),e.hasGoogleId=t.checkGoogleId(e),e.bestAddress=t.displayAddressFormat(e),e.isSelected&&delete e.isSelected;var n=[],a="";_.each(e.tags,function(e){(a=_.findWhere(t.contactTags,{data:e}))?n.push(a.label):n.push(e)}),n&&(e.tempTags=_.uniq(n))}),t.contacts=n,w(),t.pageLoading=!1,t.contacts.length>0&&(t.minRequirements=!0),t.showContacts=!0,t.loadingFilter=!1,$("html, body").animate({scrollTop:0},600)})},t.getContactCount=function(){s.getTotalContacts(function(e){t.totalItemCount=e.count})},s.getContactTags(function(e){t.contactTags=e}),y(),t.openModal=function(n,a,i){var s={templateUrl:n,keyboard:!0,backdrop:"static",size:"md",resolve:{getContacts:function(){return t.loadContactsWithDefaults}}};a&&(s.controller=a),i&&(s.size=i),t.modalInstance=o.open(s),t.modalInstance.result.then(null,function(){e.element(".sp-container").addClass("sp-hidden")})},t.openSimpleModal=function(n){var a={templateUrl:n,scope:t,keyboard:!0,backdrop:"static"};t.modalInstance=o.open(a),t.modalInstance.result.then(null,function(){e.element(".sp-container").addClass("sp-hidden")})},t.closeModal=function(){t.modalInstance.close(),t.socailList=!1,t.groupList=!1},t.preventClick=function(e){e.stopPropagation()},t.column={photo:!0,name:!0,tags:!0,email:!0,address:!0,social:!1,unsubscribed:!0,phone:!0,created:!0,modified:!0},t.contactTagsFn=function(e){return s.contactTags(e)},t.checkBestEmail=function(e){var t=s.checkBestEmail(e);return this.email=e.email,t},t.checkFacebookId=function(e){var t=s.checkFacebookId(e);return this.facebookId=e.facebookId,t},t.checkTwitterId=function(e){var t=s.checkTwitterId(e);return this.twitterId=e.twitterId,t},t.checkLinkedInId=function(e){var t=s.checkLinkedInId(e);return this.linkedInUrl=e.linkedInUrl,this.linkedInId=e.linkedInId,t},t.checkGoogleId=function(e){var t=s.checkGoogleId(e);return this.googleUrl=e.googleUrl,this.googleId=e.googleId,t},t.checkAddress=function(e){var t=s.checkAddress(e);return this.address=e.address,t},t.displayAddressFormat=function(e){if(0!==e.details.length&&e.details[0].addresses&&0!==e.details[0].addresses.length){var t=e.details[0].addresses[0];if(t&&(t.address||t.address2||t.city||t.state||t.zip)){var n=" ",a="",o="";return(t.address||t.address2)&&(a=_.filter([t.address,t.address2],function(e){return""!==e}).join(", ")),(t.city||t.state||t.zip)&&(o=_.filter([t.city,t.state,t.zip],function(e){return""!==e}).join(", ")),o&&a&&(n=", "),a?a+n+o:o}}},t.viewSingle=function(e){m.path("/contacts/"+e._id)},t.contact={},t.contact.tags=[],t.tagToContact=function(e){return s.tagToContact(e)},t.contactPhotoOptions=[{name:"Photo",value:!0},{name:"No Photo",value:!1}],t.addContact=function(){t.saveLoading=!0;var e,n=[];if(_.each(t.contact.tags,function(e){n.push(e.data)}),n&&(n=_.uniq(n)),_.find(t.contacts,function(e){return e.bestEmail.toLowerCase()===t.contact.email.toLowerCase()}))return t.setDuplicateUser(!0),void(t.saveLoading=!1);e={first:t.contact.first,middle:t.contact.middle,last:t.contact.last,tags:n},t.contact.email&&(e.details=[],e.details.push({emails:[{_id:u.generateUniqueAlphaNumericShort(),email:t.contact.email.toLowerCase()}]})),s.saveContact(e,function(e){t.saveLoading=!1,t.fullName="",t.contact.tags=[],t.contact.email="",t.duplicateContact=!1,t.closeModal(),e.bestEmail=t.checkBestEmail(e),k(),y(),a.pop("success","Contact Successfully Added"),t.minRequirements=!0})},t.setDuplicateUser=function(e){t.duplicateContact=e},t.$watch("fullName",function(e){if(void 0!==e){var n=e.match(/\S+/g);n?n.length>=3?(t.contact.first=n[0],t.contact.middle=n[1],t.contact.last=n[2]):2===n.length?(t.contact.first=n[0],t.contact.middle="",t.contact.last=n[1]):1===n.length&&(t.contact.first=n[0],t.contact.middle="",t.contact.last=""):(t.contact.first="",t.contact.middle="",t.contact.last="")}},!0),t.importFacebookFriends=function(){s.importFacebookFriends(function(e,t){t?($("#import-contacts-modal").modal("hide"),a.pop("success","Contacts being imported.")):i.location.href="/socialconfig/facebook?redirectTo="+encodeURIComponent("/admin#/contact")})},t.importLinkedInConnections=function(){var e=!1;t.socialAccounts.forEach(function(n){n.type===c.social_types.LINKEDIN&&(e=!0,t.closeModal(),a.pop("success","Contacts import initiated."),r.importLinkedinContact(n.id,function(){t.closeModal(),a.pop("success","Contacts import complete.")}))}),!1===e&&(t.closeModal(),a.pop("warning","No linkedin account integrated."))},t.importGmailContacts=function(){var e=!1;t.socialAccounts.forEach(function(n){n.type===c.social_types.GOOGLE&&(e=!0,t.closeModal(),a.pop("success","Contacts import initiated."),r.importGoogleContact(n.id,function(){t.closeModal(),t.getContacts(),a.pop("success","Contacts import complete.")}))}),!1===e&&(t.closeModal(),a.pop("warning","No google account integrated."))},t.triggerInput=function(t){e.element(t).trigger("input")},t.filterContact={},t.clearContactFilter=function(e,n,a){t.filterContact[a]={},t.triggerInput(n)},t.clearSearchFilter=function(e,n,a){d(function(){t.pagingParams.fieldSearch[a]=null,T()},800)},t.setBulkActionChoiceFn=function(e){e&&(t.bulkActionChoice.action={data:e.toLowerCase()},t.bulkActionSelectFn())},t.bulkActionSelectFn=function(){var e=t.selectedContactsFn(),n="Do you want to delete the 1 contact?",o="Yes, delete it!",i="No, do not delete it!";e.length>1&&(n="Do you want to delete the "+e.length+" contacts?",o="Yes, delete them!",i="No, do not delete them!"),"delete"===t.bulkActionChoice.action.data?p.swal({title:"Are you sure?",text:n,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:o,cancelButtonText:i,closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n){var o=[];e.forEach(function(e){o.push(s.deleteContactPromise(e._id))}),g.all(o).then(function(e){k(),y(),t.bulkActionChoice=null,t.bulkActionChoice={},t.clearSelectionFn(),a.pop("success","Contacts Deleted.")})}else t.bulkActionChoice=null,t.bulkActionChoice={}}):t.bulkActionChoice.action&&"tags"===t.bulkActionChoice.action.data?(t.bulkActionChoice={},t.openSimpleModal("tags-bulk-action-modal")):t.bulkActionChoice.action&&"export"===t.bulkActionChoice.action.data&&(s.exportCsvContacts(_.pluck(t.selectedContactsFn(),"_id"),null),t.bulkActionChoice=null,t.bulkActionChoice={},t.clearSelectionFn(),a.pop("success","Contact export started."))},t.selectAllClickFn=function(e){e.stopPropagation(),t.selectAllChecked?t.selectAllChecked=!1:t.selectAllChecked=!0,t.displayedContacts.forEach(function(e){e.isSelected=t.selectAllChecked})},t.clearSelectionFn=function(){t.selectAllChecked=!1,t.displayedContacts.forEach(function(e){e.isSelected=t.selectAllChecked})},t.contactSelectClickFn=function(e,t){e.stopPropagation(),t.isSelected?t.isSelected=!1:t.isSelected=!0},t.selectedContactsFn=function(){var e=_.filter(t.displayedContacts,function(e){return e.isSelected});return t.exportText=e.length?"Export Selected "+e.length:"Export",e},t.tagsBulkActionClickFn=function(e){var n=_.uniq(_.pluck(t.tagsBulkAction.tags,"data"));"add"===e&&n.length<1&&t.tagsBulkAction.toReplace?p.swal({title:"Are you sure?",text:"This will remove all tags from selected contacts. Do you want to continue ? ",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(a){a&&t.bulkUpdate(e,n)}):t.bulkUpdate(e,n)},t.bulkUpdate=function(e,n){var o=[];t.selectedContactsFn().forEach(function(a){"add"===e?t.tagsBulkAction.toReplace?a.tags=n:a.tags?a.tags=a.tags.concat(n):a.tags=n:"remove"==e&&(a.tags=_.difference(a.tags,n)),a.tags=_.uniq(a.tags),delete a.isSelected,o.push(s.putContactPromise(a))}),g.all(o).then(function(e){t.tagsBulkAction={},t.clearSelectionFn(),t.closeModal(),a.pop("success","Contacts tags updated.")})},t.exportContactsFn=function(){t.selectedContactsFn().length>0?s.exportCsvContacts(_.pluck(t.selectedContactsFn(),"_id"),null):s.exportCsvContacts(null,t.pagingParams),t.clearSelectionFn(),a.pop("success","Contact export started.")},t.$watch("pagingParams.globalSearch",function(n){e.isDefined(n)&&(e.equals(n,h.fieldSearch)||(t.loadingFilter=!0,k(),S(),t.getContacts()))},!0),t.$watch("pagingParams.fieldSearch",function(n){e.isDefined(n)&&(e.equals(n,h.fieldSearch)||(t.loadingFilter=!0,k(),S(),t.getContacts()))},!0)}])}(angular),function(e){"use strict";app.controller("customerAnalyticsCtrl",["$scope","$modal","UserService","ChartAnalyticsService","$timeout","AnalyticsWidgetStateService","$interval","analyticsConstant","$rootScope","$q",function(t,n,a,o,i,s,r,c,l,u){function d(e){var n=[];if(e){var a=[];_.each(e,function(e){e["ip_geo_info.province"]&&a.push(e)}),_.each(e,function(e){var t=o.stateToAbbr(e["ip_geo_info.province"]);if(t){var a={};a.code=t,a.value=e.result,!_.find(n,function(t){return t.code===e.code})&&a.value&&n.push(a)}})}t.livePlatformLocationsData=n}function p(){window.Highcharts.charts.forEach(function(t){i(function(){e.isDefined(t)&&Object.keys(t).length&&t.reflow()},0)})}function m(){l.app.layout.isAnalyticsDashboardMode=!0,y=r(function(){t.runAnalyticsReports(),t.platformTraffic(),t.platformTrafficDetails()},t.analyticsRefreshAfterTime)}function g(){l.app.layout.isAnalyticsDashboardMode=!1,e.isDefined(y)&&(r.cancel(y),y=void 0)}function f(e,t){var n=t.toLowerCase()+"_"+e.toLowerCase()+"_legend";return n=n.replace(/ /g,"_"),s.getNamedPlateformAnalyticsWidgetState(n)}function h(e,t,n){var a=e.toLowerCase()+"_"+t.toLowerCase()+"_legend";a=a.replace(/ /g,"_"),s.setPlateformAnalyticsWidgetStates(a,n)}t.analyticsRefreshAfterTime=c.refreshAfterTime,t.analyticsOverviewConfig={},t.timeonSiteConfig={},t.trafficSourcesConfig={},t.newVsReturningConfig={},t.customerOverviewConfig={},t.analyticsOverviewConfig.title={text:""},t.timeonSiteConfig.title={text:""},t.trafficSourcesConfig.loading=!0,t.newVsReturningConfig.loading=!0,t.customerOverviewConfig.loading=!0,t.displayVisitors=!0,t.visitors=null,t.date={startDate:moment().subtract(29,"days").format(),endDate:moment().format()},t.Math=Math;var v=!1,b=0;b=window.chrome&&window.chrome.webstore||/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window["safari"]||safari.pushNotification).toString()?0:-6e4*(new Date).getTimezoneOffset(),t.$watch("selectedDate",function(){t.date.startDate=moment(t.selectedDate.startDate).format(),t.date.endDate=moment(t.selectedDate.endDate).format(),v&&(t.analyticsOverviewConfig={},t.frontrunnerSitesPageviewsConfig={},t.timeonSiteConfig={},t.trafficSourcesConfig={},t.newVsReturningConfig={},t.customerOverviewConfig={},t.analyticsOverviewConfig.title={text:""},t.timeonSiteConfig.title={text:""},t.locationData=null,t.countryLocationData=null,t.pagedformattedTopPages=null,t.trafficSourceData=null,t.userAgentData=null,t.userAgentTableData=null,t.osData=null,t.revenueConfig={},t.emailsOverviewConfig={},t.newVsReturning=null,t.device_data_loaded=!1,t.runAnalyticsReports(t.analyticsAccount)),v=!0}),t.selectedDate={startDate:moment().subtract(6,"days").startOf("day"),endDate:moment()},t.pickerOptions={startDate:moment().subtract(6,"days").toDate(),endDate:moment().toDate(),format:"YYYY-MM-DD",opens:"left",ranges:{Today:[moment().startOf("day"),moment()],Yesterday:[moment().subtract(1,"days").startOf("day"),moment().subtract(1,"days").endOf("day")],"Last 7 Days":[moment().subtract(6,"days").startOf("day"),moment().endOf("day")],"Last 30 Days":[moment().subtract(29,"days").startOf("day"),moment().endOf("day")],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}},a.getAccount(function(e){t.analyticsAccount=e,t.runAnalyticsReports(),t.platformTraffic(),t.platformTrafficDetails()}),t.$watch("livePlatformLocationsData",function(t,n){e.isDefined(t)&&!e.equals(t,n)&&i(function(){var n=e.copy(t);o.visitorLocationsPlatform(n,Highcharts.maps["countries/us/us-all"],[],Highcharts.maps["custom/world"])},200)}),t.platformTraffic=function(){o.getPlatformTraffic(function(e){var n=_.pluck(e,"count"),a=e[0].locations,s=o.liveTraffic(n);d(a),t.livePlatformTraffic=e,t.livePlatformTrafficConfig=s,i(t.updatePlatformTraffic,15e3)})},t.platformTrafficDetails=function(){o.getPlatformTrafficDetails(function(e){t.liveVisitorDetails=e,e&&e.length&&t.setActiveVisitorIndex(0,!0),i(t.updatePlatformTrafficDetails,15e3)})},t.setActiveVisitorIndex=function(e,n){if(n&&t.activeVisitorDetail){var a=_.findWhere(t.liveVisitorDetails,{_id:t.activeVisitorDetail._id});if(a){var o=_.findIndex(t.liveVisitorDetails,a);o>-1?(t.selectedVisitorIndex=o,t.activeVisitorDetail=t.liveVisitorDetails[o]):(t.selectedVisitorIndex=e,t.activeVisitorDetail=t.liveVisitorDetails[e])}else t.selectedVisitorIndex=e,t.activeVisitorDetail=t.liveVisitorDetails[e]}else t.selectedVisitorIndex=e,t.activeVisitorDetail=t.liveVisitorDetails[e]},t.updatePlatformTraffic=function(){o.getPlatformTraffic(function(e){var n=$("#live-platform-traffic-chart").highcharts();n&&n.series[0].setData(_.pluck(e,"count"),!0),d(e[0].locations),t.livePlatformTraffic=e,i(t.updatePlatformTraffic,15e3)})},t.updatePlatformTrafficDetails=function(){o.getPlatformTrafficDetails(function(e){t.liveVisitorDetails=e,e&&e.length&&t.setActiveVisitorIndex(0,!0),i(t.updatePlatformTrafficDetails,15e3)})},t.convertUtcToLocal=function(e){if(e)return moment.utc(e).local().format("YYYY-MM-DD HH:mm:ss")},t.runAnalyticsReports=function(){moment(t.date.endDate).diff(moment(t.date.startDate),"days")<=7?o.setGraunularity("hours"):o.setGraunularity("days");var n=u.defer();o.getVisitorOverviewChartData(t.date,t.analyticsAccount,!0,!1,function(e,a,i,s,r,c){var l=[],u=0,d=0;_.each(a.currentMonth,function(e){var t=[],n=e.value||0;u+=n,t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(n),l.push(t)}),t.pageviews=u,t.pageviewsData=l,_.each(a.previousMonth,function(e){var t=e.value||0;d+=t}),t.pageviewsPreviousData=d;var p,m=o.calculatePercentChange(d,u),g=[],v=0,y=0;t.pageviewsPercent=m,_.each(s.currentMonth,function(e){var t=[],n=e.total||e.value||0;v+=n,t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(n),g.push(t)}),t.sessions=v,t.sessionsData=g,_.each(s.previousMonth,function(e){var t=e.total||e.value||0;y+=t}),p=o.calculatePercentChange(y,v),t.sessionsPercent=p,t.visitorDataReport(i.currentMonth,i.previousMonth);var w=[];if(_.each(r,function(e){var t=[],n=e.total||0;t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(n),w.push(t)}),t.dauData=w,c){var C=[];_.each(c,function(e){var t=[];t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(e.total),C.push(t)}),t.fourOfours=C}o.analyticsOverview(t.pageviewsData,t.sessionsData,t.visitorsData,t.dauData,t.fourOfours,f,h,function(e){t.analyticsOverviewConfig=e,t.analyticsOverviewConfig.loading=!1,n.resolve()})}),u.all(n).then(function(){o.getPageAnalyticsChartData(t.date,t.analyticsAccount,!0,!1,function(n){var a,i=[];_.each(n,function(e){var t={};e["url.path"]&&(t.page=e["url.path"],t.accountId=e.id,t.pageviews=e.pageviews,t.avgTime=Math.abs(e.avgTimeOnPage)/1e3,t.uniquePageviews=e.uniquePageviews),t&&i.push(t)}),a=i,t.formattedTopPages=_.reject(i,function(t){return!e.isDefined(t.page)}),t.pagedformattedTopPages=_.reject(a,function(t){return!e.isDefined(t.page)});var s=_.first(_.sortBy(t.pagedformattedTopPages,function(e){return-e.pageviews}),5),r=_.map(s,function(e){return e.accountId});o.getFrontrunnerSitesPageviews(t.date,t.analyticsAccount,r,function(e){var n=_.object(_.map(e,function(e,t){var n=_.find(s,function(e){return e.accountId==t});if(n)return[n.page,e]})),a=[];Object.keys(n).forEach(function(e){var t,o=[];_.each(n[e],function(e){var t=[],n=e.value||0;t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(n),o.push(t)}),t={name:e,data:o},a.push(t)}),o.frontrunnerSitesPageviews(n,a,function(e){t.frontrunnerSitesPageviewsConfig=e})})}),o.getVisitorLocationsChartData(t.date,t.analyticsAccount,!0,!1,function(e,n,a){var i=[],s=[],r=[],c=[];_.each(n,function(e){e["ip_geo_info.province"]&&r.push(e)}),t.mostPopularState=_.max(r,function(e){return e.result}),_.each(n,function(e){var t=o.stateToAbbr(e["ip_geo_info.province"]);if(t){var n={};n.code=t,n.value=e.result,!_.find(i,function(t){return t.code===e.code})&&n.value&&i.push(n)}}),_.each(a,function(e){e["ip_geo_info.country"]&&"Unknown"!=e["ip_geo_info.country"]&&c.push(e)}),t.mostPopularCountry=_.max(c,function(e){return e.result}),_.each(a,function(e){var t=o.countryToAbbr(e["ip_geo_info.country"]);if(t&&"Unknown"!=t){var n={};n.code=t,n.value=e.result,!_.find(s,function(t){return t.code===e.code})&&n.value&&s.push(n)}}),t.locationData=i,t.locationLabel="States",t.locationsLength=i.length,t.mostPopularLabel=t.mostPopularState["ip_geo_info.province"],t.countryLocationData=s,t.locationLabelCountry="Countries",t.locationsLengthCountry=t.countryLocationData.length,t.mostPopularLabelCountry=t.mostPopularCountry["ip_geo_info.country"],t.renderVisitorCharts()}),o.getContentInteractionAndTrafficeSourcesChartData(t.date,t.analyticsAccount,!0,!1,function(e,n,a){var i,s=n,r=0;s.currentMonthAverage&&(r=s.currentMonthAverage/1e3),i=o.secToTime(r),null===s.previousMonthAverage&&(s.previousMonthAverage=0),t.visitDuration=i;var c=s.previousMonthAverage,l=o.calculatePercentChange(c,s.currentMonthAverage);t.visitDurationPercent=l,t.contentInteractionsReportData(s.nonBounceAvg,s.bounceAvg,s.previousMonthBounceCount),a&&(t.trafficSourceData=o.mergeLiveTrafficData(a))}),o.getDeviceNewReturningChartData(t.date,t.analyticsAccount,!0,!1,function(e,n,a){var i=0,s=0;_.each(n.result,function(e){var t=e["user_agent.device"];"desktop"===t?i=e.result:"mobile"===t&&(s=e.result)}),t.desktop=i,t.mobile=s,t.device_data_loaded=!0;var r=["New"],c=["Returning"];_.each(a,function(e){"new"===e._id?r.push(e.count):"returning"===e._id&&c.push(e.count)}),r.length<2&&(r.push(0),c.push(0)),a=[r,c],t.newVsReturning=a,o.newVsReturning(t.newVsReturning,function(e){t.newVsReturningConfig=e,t.newVsReturningConfig.loading=!1})}),o.getUserAgentsAndOSChartData(t.date,t.analyticsAccount,!0,!1,function(e,n,a){var i=[],s={},r=0;_.each(n,function(e){var t=e._id.browserName,n=e.count;s[t]?s[t]+=n:s[t]=n,r+=n}),t.browserTotal=r,i=i.concat(_.pairs(s)),i=_.sortBy(i,function(e){return e[1]}),t.userAgentData=i;var c=i.length-1,l=0;i&&i.length>0?(t.topBrowser=i[c][0],l=Math.round(i[c][1]/r*100),t.browserPercent=l):(t.topBrowser="--",t.browserPercent="--"),o.userAgentChart(i,function(e){t.userAgentConfig=e,t.userAgentConfig.loading=!1}),t.userAgentTableData=i.reverse();var u=[],d={},p=0;_.each(a,function(e){var t=e._id.osName;"undefined"!==t&&void 0!==t||(t="Unknown");var n=e.count;d[t]?d[t]+=n:d[t]=n,p+=n}),u=u.concat(_.pairs(d)),u=_.sortBy(u,function(e){return e[1]}),t.osData=u,t.topOS="__";var m=0;if(t.osPercent="_",u&&u.length>0){var g=u.length-1;t.topOS=u[g],m=Math.floor(u[g][1]/p*100),t.osPercent=m}o.osChart(u,function(e){t.osConfig=e,t.osConfig.loading=!1})}),o.getRevenueChartData(t.date,t.analyticsAccount,!0,!1,function(e,n){var a={xData:[],amountData:[],orderData:[]},i=0,s=0;_.each(n.currentMonth,function(e){a.xData.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b);var t=e.total||0,n=e.count||0;a.amountData.push(t),a.orderData.push(n),i+=t,s+=n}),t.revenueData=a,t.revenue=parseFloat(i).toFixed(2),t.orderCount=s;var r=0,c=0;_.each(n.prevMonth,function(e){var t=e.total||0;r+=t;var n=e.count||0;c+=n}),t.revenuePreviousData=r;var l=o.calculatePercentChange(r,i);t.revenuePercent=l;var u=o.calculatePercentChange(c,s);t.ordersPercent=u,o.revenueOverview(t.revenueData,function(e){t.revenueConfig=e,t.revenueConfig.loading=!1})}),o.getEmailChartData(t.date,t.analyticsAccount,!0,!1,function(e,n){var a=[],i=0;_.each(n.emails,function(e){var t=[],n=e.total||0;t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(n),i+=n,a.push(t)});var s=[];_.each(n.campaigns,function(e){var t=[],n=e.total||0;t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(n),s.push(t)});var r=[],c=0;_.each(n.opens,function(e){var t=[],n=e.total||0;t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(n),c+=n,r.push(t)});var l=[],u=0;_.each(n.clicks,function(e){var t=[],n=e.total||0;t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(n),u+=n,l.push(t)}),o.emailsOverview(a,s,r,l,function(e){t.emailsOverviewConfig=e,t.emailsOverviewConfig.loading=!1,t.totalEmails=i,t.totalOpens=c,t.totalClicks=u}),t.displayVisitors=t.visitors>0})})},t.visitorDataReport=function(e,n){var a=[],i=0;_.each(e,function(e){var t=[],n=e.value||0;i+=n,t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(n),a.push(t)}),t.visitorsData=a;var s=0;_.each(n,function(e){var t=e.value||0;s+=t});var r=o.calculatePercentChange(s,i);t.visitors=i,t.visitorsPercent=r},t.contentInteractionsReportData=function(e,n,a){var i=[];_.each(e,function(e){var t=[],n=e.count||e.value||0;t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(n),i.push(t)}),t.avgSessionData=i;var s=[],r=0;_.each(n,function(e){var t=[],n=e.count||e.value||0;r+=n,t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(n),s.push(t)}),t.bouncesData=s,o.timeOnSite(t.avgSessionData,t.bouncesData,function(e){t.timeonSiteConfig=e,t.timeonSiteConfig.loading=!1});var c=o.calculatePercentChange(a,r);t.bounces=r,t.bouncesPercent=c},t.renderVisitorCharts=function(){$("#visitor_locations").length?(i(function(){var n=e.copy(t.locationData),a=e.copy(t.countryLocationData);o.visitorLocations(n,Highcharts.maps["countries/us/us-all"],a,Highcharts.maps["custom/world"]),o.visitorLocationsGlobal(n,Highcharts.maps["countries/us/us-all"],a,Highcharts.maps["custom/world"])},200),t.displayVisitors):i(function(){t.renderVisitorCharts()},100)},t.renderAnalyticsCharts=function(){$("#visitor_locations").length?(i(function(){var n=e.copy(t.locationData),a=e.copy(t.countryLocationData);o.visitorLocations(n,Highcharts.maps["countries/us/us-all"],a,Highcharts.maps["custom/world"]),o.visitorLocationsGlobal(n,Highcharts.maps["countries/us/us-all"],a,Highcharts.maps["custom/world"])},200),t.displayVisitors):i(function(){t.renderAnalyticsCharts()},100)},t.displayDatePicker=function(){i(function(){e.element(".deshboard-date-picker").click()},0)},t.$watch("overview",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(s.setPlateformAnalyticsWidgetStates("overview",n),p())}),t.$watch("frontrunnerSite",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(s.setPlateformAnalyticsWidgetStates("frontrunnerSite",n),p())}),t.$watch("locations",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(s.setPlateformAnalyticsWidgetStates("locations",n),p())}),t.$watch("locationsGlobal",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(s.setPlateformAnalyticsWidgetStates("locationsGlobal",n),p())}),t.$watch("interactions",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(s.setPlateformAnalyticsWidgetStates("interactions",n),p())}),t.$watch("device",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(s.setPlateformAnalyticsWidgetStates("device",n),p())}),t.$watch("newVReturning",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(s.setPlateformAnalyticsWidgetStates("newVReturning",n),p())}),t.$watch("trafficSources",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(s.setPlateformAnalyticsWidgetStates("trafficSources",n),p())}),t.$watch("pageanalytics",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(s.setPlateformAnalyticsWidgetStates("pageanalytics",n),p())}),t.$watch("ua",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(s.setPlateformAnalyticsWidgetStates("ua",n),p())}),t.$watch("userAgentsTable",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(s.setPlateformAnalyticsWidgetStates("userAgentsTable",n),p())}),t.$watch("rev",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(s.setPlateformAnalyticsWidgetStates("rev",n),p())}),t.$watch("os",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(s.setPlateformAnalyticsWidgetStates("os",n),p())}),t.$watch("campaigns",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(s.setPlateformAnalyticsWidgetStates("campaigns",n),p())}),t.$watch("frontrunnerSite",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(s.setPlateformAnalyticsWidgetStates("frontrunnerSite",n),p())}),t.setAnalyticsWidgetStates=function(){s.getPlateformAnalyticsWidgetStates(),i(function(){t.overview=s.plateformAnalyticsWidgetStateConfig.overview,t.locations=s.plateformAnalyticsWidgetStateConfig.locations,t.locationsGlobal=s.siteAnalyticsWidgetStateConfig.locationsGlobal,t.interactions=s.plateformAnalyticsWidgetStateConfig.interactions,t.device=s.plateformAnalyticsWidgetStateConfig.device,t.newVReturning=s.plateformAnalyticsWidgetStateConfig.newVReturning,t.trafficSources=s.plateformAnalyticsWidgetStateConfig.trafficSources,t.pageanalytics=s.plateformAnalyticsWidgetStateConfig.pageanalytics,t.ua=s.plateformAnalyticsWidgetStateConfig.ua,t.userAgentsTable=s.plateformAnalyticsWidgetStateConfig.userAgentsTable,t.rev=s.plateformAnalyticsWidgetStateConfig.rev,t.os=s.plateformAnalyticsWidgetStateConfig.os,t.campaigns=s.plateformAnalyticsWidgetStateConfig.campaigns,t.frontrunnerSite=s.plateformAnalyticsWidgetStateConfig.frontrunnerSite,t.dataLoaded=!0,p()},0)},t.uiState={dashboardMode:!1},t.$watch("uiState.dashboardMode",function(t){e.isDefined(t)&&(t?m():g())});var y;t.$watchGroup(["app.layout.isAnalyticsDashboardMode","app.layout.isSidebarClosed"],function(t,n){(e.isDefined(t)||e.isDefined(n))&&p()})}])}(angular),function(e){"use strict";app.controller("CustomerDetailCtrl",["$scope","$rootScope","$location","$modal","toaster","$stateParams","CustomerService","ContactService","SweetAlert","$state","$window","$timeout","formValidations","UserService",function(t,n,a,o,i,s,r,c,l,u,d,p,m,g){function f(e){var t=!1;return(e.address||e.address2||e.city||e.state||e.zip||e.country)&&(t=!0),t}function h(e){r.updateCustomerTemplateAccount(t.customer,e,function(e,t){e?i.pop("warning",e.message):i.pop("success","Account template updated.")})}t.isDomainChanged=!1,t.cancelaccount={cancelNow:!1},t.dataloaded=!1,t.searchUsers=[],t.isAdmin=!0,t.updateUsers=function(e){t.searchUsers=[];var n;g.getUsersForAutocomplete(e).then(function(e){t.searchUsers=[],e.forEach(function(e){t.searchUsers.push(e.username+","+e.first+" "+e.last)})}),n=e.split(","),t.newuser.username=n[0]},t.selectUser=function(e){var n=e.split(",");t.newuser.username=n[0]},t.getCustomer=function(){r.getCustomer(s.customerId,function(n,o){if(n)return i.pop("warning",n.message),void(404===n.code&&a.path("/customers"));if(t.customer=o,t.data.subdomain=o.subdomain,t.getMapData(),o.ownerUser&&(t.primaryUser=_.find(o.users,function(e){return e._id===o.ownerUser})),!o.trialDaysRemaining){var s=moment(o.billing.signupDate).add(o.billing.trialLength,"days");o.trialDaysRemaining=s.diff(moment(),"days")}t.matchUsers(o),t.originalCustomer=e.copy(t.customer),t.subdomainURL=t.generateSubdomainURL(t.data.subdomain),t.dataloaded=!0})},t.checkNameServerChanged=function(){t.isDomainChanged=t.originalCustomer&&t.customer&&!e.equals(t.originalCustomer.customDomain,t.customer.customDomain)},t.getMapData=function(){var e;t.customer.business&&t.customer.business.addresses&&t.customer.business.addresses[0]&&(e=t.customer.business.addresses[0]),e?e.lat&&e.lon&&f(e)?t.showMap(e.lat,e.lon):(e.address2="",t.convertAddressToLatLon(e,function(n){n&&(e.lat=parseFloat(n.lat),e.lon=parseFloat(n.lon),t.showMap(n.lat,n.lon)),t.loadingMap=!1})):t.loadingMap=!1},t.convertAddressToLatLon=function(e,n){t.displayAddressFormat(e)?c.getGeoSearchAddress(t.queryAddressFormat(e),function(e){void 0===e.error?n(e):n()}):n()},t.generateSubdomainURL=function(e){return a.protocol()+"://"+location.host.replace("main",e)},t.displayAddressFormat=function(e){return _.filter([e.address,e.address2,e.city,e.state,e.zip],function(e){return""!==e}).join(",")},t.queryAddressFormat=function(e){var t="";return e.city&&(t+="city="+e.city+"&"),e.state&&(t+="state="+e.state+"&"),!e.zip||e.city||e.state||(t+="postalcode="+e.zip+"&"),e.country&&"United States"!==e.country?t+="country="+e.country:t+="country=us",t},t.showMap=function(e,n){t.location.lat=parseFloat(e),t.location.lon=parseFloat(n),t.loadingMap=!1,t.markers&&t.markers.mainMarker&&(t.markers.mainMarker.lat=parseFloat(e),t.markers.mainMarker.lon=parseFloat(n))},t.$back=function(){d.history.back()},t.backToCustomers=function(){a.path("/customers")},t.editTrialDays=function(){r.extendTrial(t.customer._id,t.newTrialLength,function(e,n){if(e)i.pop("warning",e.message);else{var a=moment(n.billing.signupDate).add(n.billing.trialLength,"days");t.customer.trialDaysRemaining=a.diff(moment(),"days"),t.customer.locked_sub=n.locked_sub,t.customer.billing.trialLength=n.billing.trialLength,t.closeModal()}})},t.generateInsightReport=function(){r.generateInsightReport(t.customer._id,function(e,t){e?i.pop("warning",e.message):i.pop("info","Report Sent")})},t.openCancelAccountModal=function(){t.openSimpleModal("cancel-account-modal")},t.cancelAccountSub=function(){l.swal({title:"Are you sure?",text:"Cancel this account's subscription",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",noActionButtonText:"Cancel",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?r.cancelAccountSubscription(t.customer._id,t.cancelaccount.reason,t.cancelaccount.cancelNow,function(e,n){t.closeModal(),e?i.pop("warning",e.message):i.pop("success","Account subscription cancelled.")}):t.closeModal()})},t.makeEvergreen=function(){r.makeEvergreen(t.customer._id,function(e,t){e?i.pop("warning",e.message):i.pop("success","Account converted to Evergreen.  If there is currently a Stripe Subscription, please manually cancel.")})},t.updateCustomerTemplateAccount=function(e){var n=e?"Set this customer as template account":"Unset this customer as template account";l.swal({title:"Are you sure?",text:n,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",noActionButtonText:"Cancel",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?h(e):t.customer.isTemplateAccount=!e})},t.updateCustomerReceiveInsights=function(e){r.updateCustomerReceiveInsights(t.customer,e,function(e,t){e?i.pop("warning",e.message):i.pop("success","Insights preferences saved.")})},t.updateCustomerUserScripts=function(e){t.customer.showhide.userScripts=e,r.updateCustomerShowHide(t.customer,function(e,t){e?i.pop("warning",e.message):i.pop("success","UserScripts updated.")})},t.updateCustomerHTML=function(e){t.customer.showhide.editHTML=e,r.updateCustomerShowHide(t.customer,function(e,t){e?i.pop("warning",e.message):i.pop("success","Edit HTML updated.")})},t.saveTemplateAccount=function(){h(!1)},t.addNewUser=function(){g.findUserByUsername(t.newuser.username,function(e,n){e?i.pop("warning",e.message):n?r.addUserToAccountTo(t.customer._id,n._id,function(e,n){e?i.pop("warning",e.message):(t.customer.users.push(n),t.closeModal())}):r.addNewUser(t.customer._id,t.newuser.username,t.newuser.password,function(e,n){e?i.pop("warning",e.message):(t.customer.users.push(n),t.closeModal())})})},t.removeUserFromAccount=function(e){r.removeUserFromAccount(t.customer._id,e,function(n,a){n?i.pop("warning",n.message):t.customer.users=_.filter(t.customer.users,function(t){if(t._id!==e)return!0})})},t.excludeUserFromCustomerView=function(e,n,a){n?l.swal({title:"Are you sure?",text:"Exclude user from customer view",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(o){o?(t.saveUser=!0,r.excludeUserFromCustomerView(e,n,function(e,n){e?i.pop("warning",e.message):i.pop("success","User excluded from customer view."),t.saveUser=!1})):a.excludeFromCustomerView=!1}):(t.saveUser=!0,r.excludeUserFromCustomerView(e,n,function(e,n){e?i.pop("warning",e.message):i.pop("success","User included to customer view."),t.saveUser=!1}))},t.openEditUserModal=function(e){t.currentUserId=e,t.openSimpleModal("edit-password-modal")},t.closeEditUserModal=function(){t.currentUserId=null,t.closeModal()},t.checkPasswordLength=function(){t.passwordInValid=!1,t.edituser&&t.edituser.password1&&t.edituser.password1.length<6?t.passwordInValid=!0:t.passwordInValid=!1},t.setUserPassword=function(e){t.checkPasswordLength(),t.passwordInValid||r.setUserPassword(e,t.edituser.password1,function(e,n){e?i.pop("warning",e.message):(i.pop("info","Successfully changed password"),t.closeEditUserModal())})},t.getNameServers=function(e){t.showNameServer=!0,e?r.viewNameServers(e,function(e,n){e?i.pop("warning",e.message):t.nameservers=n}):i.pop("info","No custom domain to lookup.")},t.addCustomDomain=function(){var n=t.customer.customDomain,a=t.customer._id;r.addDomainToAccount(n,a,function(n,a){n?i.pop("warning",n.message):t.nameservers=a.nameServers,t.originalCustomer=e.copy(t.customer),t.checkNameServerChanged(),t.closeModal()})},t.openSimpleModal=function(n){var a={templateUrl:n,scope:t,keyboard:!0,backdrop:"static"};t.modalInstance=o.open(a),t.modalInstance.result.then(null,function(){e.element(".sp-container").addClass("sp-hidden")})},t.closeModal=function(){t.modalInstance.close(),t.socailList=!1,t.groupList=!1},t.$watch("customer.billing.trialLength",function(e){t.customer&&t.customer.billing&&(t.currentTrialExpiration=moment(t.customer.billing.signupDate).add(e,"days").format("MM/DD/YYYY"))}),t.$watch("newTrialLength",function(e){t.customer&&t.customer.billing&&(t.newTrialExpiration=moment(t.customer.billing.signupDate).add(e,"days").format("MM/DD/YYYY"))}),t.ip_geo_address="",t.location={},t.loadingMap=!0,t.data={subdomain:""},t.newNote={},t.addNote=function(e){r.addCustomerNotes(t.customer._id,e,function(e){e&&e._id&&(i.pop("success","Notes Added."),t.matchUsers(e),t.newNote={})})},t.matchUsers=function(e){var n=e.notes;n&&n.length>0&&t.users&&t.users.length&&(_.each(n,function(e){var n=_.find(t.users,function(t){return t._id===e.user_id});n&&(e.user=n,n.profilePhotos&&n.profilePhotos[0]&&(e.user_profile_photo=n.profilePhotos[0]))}),t.customerNotes=n)},t.resizeAnalytics=function(){p(function(){t.$broadcast("$renderSingleCustomerAnalytics")},0)},t._moment=function(e,n,a){t.planInterval="",e.lines.data.length&&(t.planInterval=_.last(e.lines.data).plan.interval),10===n.toString().length&&(n*=1e3);var o=moment(n);return a&&(a.subtractNum&&a.subtractType&&(o=o.subtract(a.subtractNum,a.subtractType)),a.addNum&&a.addType&&(o="week"===t.planInterval?o.add(7,a.addType):"month"===t.planInterval?o.add(1,"months"):"year"===t.planInterval?o.add(1,"years"):o.add(a.addNum,a.addType))),o.format("M/D/YY")},t.openMediaModal=function(){t.showInsert=!0,t.modalInstance=o.open({templateUrl:"media-modal",controller:"MediaModalCtrl",keyboard:!0,backdrop:"static",size:"lg",resolve:{showInsert:function(){return t.showInsert},insertMedia:function(){return t.updateImage},isSingleSelect:function(){return!0}}})},t.updateImage=function(e){t.customer.templateImageUrl=e.url},t.removeTemplateImage=function(){t.customer.templateImageUrl=null},t.checkIfValidUserName=function(e){return m.email.test(e)},g.getUsers(function(e){t.users=e,t.getCustomer()})}])}(angular),function(e){app.controller("CustomersCtrl",["$scope","$state","toaster","$modal","$window","CustomerService","$timeout","SweetAlert","$location","$q",function(t,n,a,o,i,s,r,c,l,u){t.tableView="list",t.itemPerPage=100,t.showPages=15,t.selectAllChecked=!1,t.bulkActionChoice={},t.tagsBulkAction={},n.current.sort||(t.order="reverse"),t.default_image_url="/admin/assets/images/default-user.png",t.bulkActionChoices=[{data:"tags",label:"Tags"},{data:"delete",label:"Delete"}],t.getCustomers=function(){s.loadAllCustomers(function(e){t.customers=e.results,t.showCustomers=!0})},t.getCustomers(),t.viewSingle=function(e){var a=t.getSortOrder();n.current.sort=a.sort,l.path("/customers/"+e._id)},t.getters={created:function(e){return e.created.date||-1},modified:function(e){return e.modified.date},trialDays:function(e){var t="N/A";return e.billing&&"NO_PLAN_ARGUMENT"==e.billing.plan&&(t=e.trialDaysRemaining),e.billing&&"NO_PLAN_ARGUMENT"!=e.billing.plan&&(t="N/A"),t}},t.filterCustomers=function(){t.showFilter=!t.showFilter},t.column={_id:!0,subdomain:!0,customDomain:!0,signupDate:!0,trialDays:!0,plan:!0,phone:!0,created:!0,modified:!0},t.selectAllClickFn=function(e){e.stopPropagation(),t.selectAllChecked?t.selectAllChecked=!1:t.selectAllChecked=!0,t.displayedCustomers.forEach(function(e,n){e.isSelected=t.selectAllChecked})},t.customerSelectClickFn=function(e,t){e.stopPropagation(),t.isSelected?t.isSelected=!1:t.isSelected=!0},t.clearSelectionFn=function(){t.selectAllChecked=!1,t.displayedCustomers.forEach(function(e,n){e.isSelected=t.selectAllChecked})},t.openSimpleModal=function(n){var a={templateUrl:n,scope:t,keyboard:!0,backdrop:"static"};t.modalInstance=o.open(a),t.modalInstance.result.then(null,function(){e.element(".sp-container").addClass("sp-hidden")})},t.closeModal=function(){t.modalInstance.close(),t.socailList=!1,t.groupList=!1},t.addCustomer=function(){var e=t.orgId,n=t.subdomain,o=t.username,i=t.password;s.addNewCustomer(e,n,o,i,function(e,n){e?a.pop("warning",e.message):(t.closeModal(),s.refreshCustomers(function(e){t.customers=e.results,t.showCustomers=!0}))})}}])}(angular),app.controller("DashboardCtrl",["$scope","OrderService","ContactService","ChartAnalyticsService","UserService","ChartCommerceService","$modal","$filter","contactConstant","$state",function(e,t,n,a,o,i,s,r,c,l){e.accountHideDohy=!1,o.getAccount(function(t){!0===t.showhide.dohy?l.go("app.dohy"):(e.analyticsAccount=t,e.runVisitorsReport(),e.runNetRevenueReport(),e.accountHideDohy=!0)}),e.getActivityName=function(e){var t=_.findWhere(c.contact_activity_types.dp,{data:e});if(t)return t.label},e.curPage=0,e.pageSize=1e3,e.numberOfPages=function(){return e.activities?Math.ceil(e.activities.length/e.pageSize):0},e.changePage=function(t){e.curPage=e.curPage+t},e.isSameDateAs=function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()},e.getDaysThisMonth=function(){var e=new Date,t=e.getDate(),n=[],a=0;for(a;a<=t;a++)n[a]=new Date(e.getFullYear(),e.getMonth(),a+1);return n},n.getContacts(function(t){n.getAllContactActivities(function(n){e.activities=n.results,_.each(e.activities,function(e){var n=_.findWhere(t,{_id:e.contactId});e.contact=n})})}),t.getOrders(function(t){e.orders=t,e.ordersThisMonth=[];var n=[];_.each(e.getDaysThisMonth(),function(a){var o=0;_.each(t,function(t){t.created.date&&e.isSameDateAs(new Date(t.created.date),new Date(a))&&(e.ordersThisMonth.push(t),o+=1)}),n.push(o)}),e.analyticsOrders=n}),e.getCompletedOrders=function(){var t=[];return _.each(e.ordersThisMonth,function(e){"completed"===e.status&&t.push(e)}),t.length},e.lastContactDate=function(){if(e.contactsThisMonth&&e.contactsThisMonth[e.contactsThisMonth.length-1]&&e.contactsThisMonth[e.contactsThisMonth.length-1].created)return e.contactsThisMonth[e.contactsThisMonth.length-1].created.date},e.contactNames=[],n.getContacts(function(t){e.contacts=t,e.contactsThisMonth=[];var n=[];_.each(e.getDaysThisMonth(),function(a){var o=0;_.each(t,function(t){t.created.date&&e.isSameDateAs(new Date(t.created.date),new Date(a))&&(e.contactsThisMonth.push(t),o+=1)}),n.push(o)}),_.each(t,function(t){(t.first||t.last)&&e.contactNames.push(t.first+" "+t.last)}),e.analyticsContacts=n}),e.getContactLeads=function(){var t=[];return _.each(e.contactsThisMonth,function(e){e.tags&&e.tags.length>0&&e.tags.indexOf("ld")>-1&&t.push(e)}),t.length},e.lastOrderDate=function(){if(e.ordersThisMonth&&e.ordersThisMonth[e.ordersThisMonth.length-1]&&e.ordersThisMonth[e.ordersThisMonth.length-1].created)return e.ordersThisMonth[e.ordersThisMonth.length-1].created.date},e.date={startDate:moment().subtract(29,"days").utc().format("YYYY-MM-DDTHH:mm:ss")+"Z",endDate:moment().utc().format("YYYY-MM-DDTHH:mm:ss")+"Z"},e.analyticsVisitors=[],e.runVisitorsReport=function(){a.visitorsReport(e.date,e.analyticsAccount,function(t){var n=t[0].result,a=t[1].result;e.visitorsThisMonth=0,e.totalNewVisitors=0,e.totalReturningVisitors=0,e.lastVisitorDate=null,t[2].result[0]&&(e.lastVisitorDate=t[2].result[0].keen.created_at);var o=[];_.each(e.getDaysThisMonth(),function(t){var i=0;_.each(n,function(n,o){e.isSameDateAs(new Date(n.timeframe.start),new Date(t))&&(e.visitorsThisMonth+=n.value+a[o].value,i+=n.value+a[o].value,e.totalNewVisitors+=a[o].value,e.totalReturningVisitors+=n.value)}),o.push(i)}),e.$apply(function(){e.analyticsVisitors=o})})},e.runNetRevenueReport=function(){i.runNetRevenuReport(function(t){var n=t[0].result;e.charges=t[1].result,t[2].result.length>0&&(e.lastChargeDate=t[2].result[0].keen.created_at),e.revenueThisMonth=0;var a=[];_.each(e.getDaysThisMonth(),function(t){var o=0;_.each(n,function(n){e.isSameDateAs(new Date(n.timeframe.start),new Date(t))&&(e.revenueThisMonth+=n.value/100,o+=n.value/100)}),a.push(o)}),e.$apply(function(){e.analyticsRevenue=a})})},e.openModal=function(t){e.modalInstance=s.open({templateUrl:t,keyboard:!0,backdrop:"static",scope:e})},e.closeModal=function(){e.modalInstance.close()},e.newActivity={start:new Date,end:new Date},e.activityTypes=[],c.contact_activity_types.dp.forEach(function(t,n){e.activityTypes.push(t.label)}),e.updateActivityTypeFn=function(t){var n=_.findWhere(c.contact_activity_types.dp,{label:t});n&&(e.newActivity.activityType=n.data)},e.updateContactNameFn=function(t){var n=t.split(" "),a=_.findWhere(e.contacts,{first:n[0],last:n[1]});a&&(e.newActivity.contactId=a._id)},e.addActivityFn=function(){angular.element("#activity_type .error").html(""),angular.element("#activity_type .error").removeClass("has-error");var t=angular.element("#activity_type input").val(),a=_.findWhere(c.contact_activity_types.dp,{label:t});if(!t||!t.trim())return angular.element("#activity_type .error").html("Activity Type Required"),void angular.element("#activity_type .error").addClass("has-error");e.newActivity.activityType=a?a.data:t,n.postContactActivity(e.newActivity,function(t){var n=_.findWhere(e.contacts,{_id:t.contactId});t.contact=n,e.activities.push(t),e.activities=_.sortBy(e.activities,function(e){return e.start}).reverse(),e.newActivity={start:new Date,end:new Date},angular.isDefined(e.activity_type)||(e.activity_type=""),e.activities=r("filter")(e.activities,{activityType:e.activity_type}),e.total=e.activities.length,e.closeModal("addActivityModal")})}}]),function(e){app.controller("EditTopicCtrl",["$scope","$state","$document","$rootScope","$interval","$timeout","toaster","$modal","$filter","$location","WebsiteService","SweetAlert","hoursConstant","GeocodeService","ProductService","AccountService","postConstant","formValidations","$window",function(t,n,a,o,i,s,r,c,l,u,d,p,m,g,f,h,v,b,y){t.formValidations=b,t.defaultSpacings={pt:0,pb:0,pl:0,pr:0,mt:0,mb:0,mr:"auto",ml:"auto",mw:"100%",usePage:!1},t.duplicate=!1,t.circleOptions={isOpen:!1,toggleOnClick:!1,background:"#FDB94E",size:"big",button:{content:"",cssClass:"fa fa-edit fa-2x",background:"#efa022",color:"#fff",size:"big"},items:[{type:"design",content:'<span class="fa fa-paint-brush"></span> Design',cssClass:"",onclick:function(e,n,a,o){t.openModal("component-settings-modal","ComponentSettingsModalCtrl",parseInt(o,10))}},{type:"clone",content:'<span class="fa fa-clone"></span> Clone',cssClass:"",onclick:function(e,n,a,o){t.duplicateComponent(parseInt(o,10))}},{type:"up",content:'<span class="fa fa-chevron-up"></span> Up',cssClass:"",onclick:function(e,n,a,o){t.singleReorder("up",a,parseInt(o,10))}},{type:"down",content:'<span class="fa fa-chevron-down"></span> Down',cssClass:"",onclick:function(e,n,a,o){t.singleReorder("down",a,parseInt(o,10))}},{type:"add",content:'<span class="fa fa-plus"></span> Add',cssClass:"",onclick:function(e,n,a,o){t.openModal("add-component-modal","AddComponentModalCtrl",parseInt(o,10))}},{type:"delete",content:'<span class="fa fa-times"></span> Delete',cssClass:"",onclick:function(e,n,a,o){t.deleteComponent(parseInt(o,10))}},{empty:!0},{empty:!0},{empty:!0},{empty:!0},{empty:!0},{empty:!0}]},t.changesConfirmed=!1,t.cancelChanges=!1,t.setDirty=function(e){t.isDirty.dirty=e,e&&(t.changesConfirmed=!1)},t.editorLoaded=!1,t.activeEditor=null,t.preDragging=!1,t.preDrag=function(e){"enter"===e&&(t.preDragging=!0),"leave"===e&&(t.preDragging=!1)},t.singleReorder=function(n,a,o){t.setDirty(!0),"down"===n&&(t.components.splice(o,1),t.components.splice(o+1,0,a),t.scrollToComponent(o+1)),"up"===n&&(t.components.splice(o,1),t.components.splice(o-1,0,a),t.scrollToComponent(o-1)),s(function(){e.element(y).trigger("resize")},0)},t.scrollToComponent=function(e){s(function(){var n=t.components[e]&&(t.components[e].anchor||t.components[e]._id),o=document.getElementById(n);o&&a.scrollToElementAnimated(o,175,1e3)},500)},t.redirectAfterSave=function(e,n){e&&(p.swal("Saved!","Your edits were saved to the page.","success"),s(function(){t.duplicate?u.path(e):y.location=e},500),n&&y.location.reload())},t.redirectWithoutSave=function(e,n,a){t.changesConfirmed=!0,t.originalPage=null,t.originalPost=null,t.cancelChanges=!0,e&&(n&&p.swal("Cancelled","Your edits were NOT saved.","error"),y.location=e,a&&y.location.reload())},t.isEditing=!0,t.isDirty={},t.savePage=function(n,a){t.saveLoading=!0,t.setDirty(!1),t.changesConfirmed=!0,t.topic.handle=l("slugify")(t.topic.title),d.updateTopic(t.topic,function(o,i){t.saveLoading=!1,i?i.message?r.pop("error",i.message):r.pop("error","Error while updating topic"):(r.pop("success","Topic Saved","The "+t.topic.title+" topic was saved successfully."),s(function(){t.originalTopic=e.copy(t.topic)},1e3),t.redirectAfterSave(n,a))})},t.cancelPage=function(){t.checkForSaveBeforeLeave()},e.element("body").on("click",".component a",function(t){e.element(this).hasClass("clickable-link")||(t.preventDefault(),t.stopPropagation())}),t.retrieveTopic=function(n){t.topicActive=!0,d.getTopics(function(a){t.allTopics=a,t.topic=_.find(a,function(e){return e._id===n}),t.components=t.topic.components,s(function(){t.originalTopic=e.copy(t.topic),t.editorLoaded=!0},500)})},u.search().topic_id&&(t.isTopic=!0,t.retrieveTopic(u.search().topic_id)),y.clickandInsertImageButton=function(e,n){e?(t.showInsert=!0,t.activeEditor=e,t.activeEditor.img=n):t.activeEditor?t.showInsert=!0:t.showInsert=!1,t.clickImageButton(e,!1)},t.setEditingComponent=function(e){t.components&&(t.componentEditing=t.components[e])},t.addImageFromMedia=function(e,n,a){t.imageChange=!0,t.showInsert=!0,t.updateImage=a,t.componentImageIndex=n,t.componentEditing=_.findWhere(t.components,{_id:e}),t.openModal("media-modal","MediaModalCtrl",null,"lg")},t.addImageToThumbnail=function(e,n,a,o,i){t.imageChange=!0,t.showInsert=!0,t.updateImage=a,t.componentImageIndex=n,o&&i&&(t.componentImageIndex=parseInt(o,10)*parseInt(i,10)+parseInt(n,10)),t.componentEditing=_.findWhere(t.components,{_id:e}),t.openModal("media-modal","MediaModalCtrl",null,"lg")},t.clickImageButton=function(e,n){t.insertMediaImage=!0,t.showInsert=!0,t.openModal("media-modal","MediaModalCtrl",null,"lg")},t.addFroalaEditorImage=function(e,n,a){d.isImage(e).then(function(n){s(function(){t.activeEditor.image.insert(e,!1,null,t.activeEditor.img)},0)})},t.thumbnailSlider={},t.testimonialSlider={},t.contactMap={},t.blogControl={},t.postControl={},t.websiteLinks={},t.insertMedia=function(n){if(t.imageChange){t.imageChange=!1;var a=t.componentEditing.type;if("image-text"===a)t.componentEditing.imgurl=n.url;else if("feature-list"===a){var o=e.element(t.componentArrTarget).closest(".single-feature").data("index");t.componentEditing.features[o].imgurl=n.url}else"simple-form"===a?t.componentEditing.imgurl=n.url:"image-gallery"===a?t.updateImage?t.componentEditing.images[t.componentImageIndex].url=n.url:(t.componentEditing.images.splice(t.componentImageIndex+1,0,{url:n.url}),t.updateImage=!1):"thumbnail-slider"===a?(t.updateImage?t.componentEditing.thumbnailCollection[t.componentImageIndex].url=n.url:(t.componentEditing.thumbnailCollection.splice(t.componentImageIndex+1,0,{url:n.url}),t.updateImage=!1),t.thumbnailSlider.refreshSlider()):"meet-team"===a&&(t.componentEditing.teamMembers[t.componentImageIndex].profilepic=n.url)}else{if(t.changeblobImage)return t.changeblobImage=!1,void(t.blog_post.featured_image=n.url);if(t.postImage&&!t.componentEditing)return t.postImage=!1,t.postImageUrl=n.url,void r.pop("success","Post Image added successfully");if(t.profilepic&&!t.componentEditing)return t.profilepic=!1,void(t.customerAccount.photo=n.url);if(t.insertMediaImage)return t.insertMediaImage=!1,void t.addFroalaEditorImage(n.url,t.inlineInput,t.isEditMode);if(t.logoImage&&t.componentEditing)t.logoImage=!1,t.componentEditing.logourl=n.url;else if(t.imgThumbnail&&t.componentEditing)t.imgThumbnail=!1,t.componentEditing.thumbnailCollection.push({url:n.url});else if(t.componentEditing.bg.img)return t.componentEditing.bg.img.url=n.url,void s(function(){e.window.trigger("resize")},0)}},t.closeModal=function(){s(function(){t.modalInstance.close(),e.element(".modal-backdrop").remove()})},t.openSimpleModal=function(n,a){var o={templateUrl:n,keyboard:!0,scope:t,size:a||"md"};t.modalInstance=c.open(o),t.modalInstance.result.then(null,function(){e.element(".sp-container").addClass("sp-hidden")})},t.openModal=function(n,a,o,i){var s={templateUrl:n,keyboard:!0,backdrop:"static",size:"md",resolve:{components:function(){return t.components||(t.components=[]),t.components}}};a&&(s.controller=a,s.resolve.contactMap=function(){return t.contactMap},s.resolve.website=function(){return t.website},s.resolve.blog=function(){return null},s.resolve.isDirty=function(){return t.isDirty},s.resolve.isSinglePost=function(){return!1},s.resolve.showInsert=function(){return t.showInsert},s.resolve.insertMedia=function(){return t.insertMedia},s.resolve.openParentModal=function(){return t.openModal},s.resolve.blogImage=function(){return null},s.resolve.accountShowHide=function(){return t.$parent.account.showhide},s.resolve.isEmail=function(){return t.isEmail},s.resolve.testimonialSlider=function(){return t.testimonialSlider},s.resolve.websiteLinks=function(){return t.websiteLinks},s.resolve.isSingleSelect=function(){return!0}),e.isDefined(o)&&null!==o&&o>=0&&(t.setEditingComponent(o),s.resolve.clickedIndex=function(){return o},s.resolve.pageHandle=function(){return t.page?t.page.handle:null}),i&&(s.size="lg"),t.modalInstance=c.open(s),t.modalInstance.result.then(null,function(){e.element(".sp-container").addClass("sp-hidden")})},t.openSettingsModal=function(){t.openSimpleModal("topic-settings-modal")},t.topicCategories=["Account","Billing","Contacts","Campaigns","Dashboard","Emails","Getting Started","Integrations","Orders","Posts","Products","Profile","Site Analytics","Social Feed","Website"],t.deleteTopic=function(){e.element(".modal.in").hide(),p.swal({title:"Are you sure?",text:"Do you want to delete this topic",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete topic!",cancelButtonText:"No, do not delete topic!",closeOnConfirm:!1,closeOnCancel:!0},function(n){if(n){p.swal("Saved!","Topic is deleted.","success");var a=t.topic.title;d.deleteTopic(t.topic,function(e){r.pop("success","Topic Deleted","The "+a+" topic was deleted successfully."),t.closeModal(),s(function(){u.url("/support/manage-topics")},500)})}else e.element(".modal.in").show()})},t.openDuplicateModal=function(){t.currentTopic=e.copy(t.topic),t.newTopic={},t.newTopic.title=t.currentTopic.title+" copy",t.newTopic.category=t.currentTopic.category,t.newTopic.components=t.currentTopic.components,t.openSimpleModal("topic-duplicate-modal")},t.$watch("isDirty.confirmed",function(e,t){}),t.checkIfDirty=function(){if(t.topic&&t.originalTopic&&!e.equals(t.topic,t.originalTopic))return!0},t.resetDirty=function(){t.originalTopic=null,t.topic=null};var w=function(e,n){t.originalPage&&t.originalPage.components&&t.components&&t.originalPage.components.length!==t.components.length&&t.setDirty(!0);n("/admin/#/support/manage-topics")},C=function(e,n){w(0,function(e){t.isDirty.dirty?p.swal({title:"Are you sure?",text:"You have unsaved data that will be lost",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, save changes!",cancelButtonText:"No, do not save changes!",closeOnConfirm:!1,closeOnCancel:!0},function(a){a?(t.redirect=!0,t.savePage(e,n),t.setDirty(!1)):t.redirectWithoutSave(e,!0,n)}):t.redirectWithoutSave(e,!1,n)})};t.checkForSaveBeforeLeave=function(e,n){t.changesConfirmed=!0,C(0,n)},t.viewTopic=function(e){u.path("/support/help-topics").search({topic:e})},t.deleteComponent=function(n){p.swal({title:"Are you sure?",text:"Do you want to delete this component?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, do not delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var o=t.components[n].type;t.components.splice(n,1),r.pop("success","Component Deleted","The "+o+" component was deleted successfully."),s(function(){t.scrollToComponent(n),e.element(y).trigger("resize")},1e3)}})},t.duplicateComponent=function(n){var o=t.components[n],i=e.copy(o),c=Math.uuid();i._id=c,i.anchor=c,t.components.splice(n+1,0,i),s(function(){var e=document.getElementById(i._id);a.scrollToElementAnimated(e,175,1e3)},500),r.pop("success","Component Added","The "+i.type+" component was added successfully.")},t.barConfig={animation:0,handle:".reorder",draggable:".fragment",ghostClass:"sortable-ghost",scroll:!0,scrollSensitivity:200,scrollSpeed:20,onSort:function(e){t.scrollToComponent(e.newIndex)},onStart:function(e){t.dragging=!0},onEnd:function(e){t.dragging=!1}},t.$on("focusEditor",function(e,n){t.activeEditor=n.editor,t.activeEditor.img=null}),t.$on("activeEditor",function(e,n){n.editor&&(t.activeEditor=n.editor),n.editorImage&&(t.activeEditor.img=n.editorImage)}),t.createDuplicateTopic=function(e){if(t.saveLoading=!0,t.newTopic.handle=l("slugify")(e.title),_.findWhere(t.allTopics,{handle:t.newTopic.handle}))return r.pop("error","Topic Title "+e.title,"Already exists"),void(t.saveLoading=!1);d.createDuplicateTopic(e,function(n){t.duplicate=!0,t.closeModal(),t.topic=n,t.saveLoading=!1,r.pop("success","Topic Saved","The "+e.title+" topic was created successfully."),u.url("/support/manage-topics/").search({topic_id:n._id})})}}])}(angular),function(e){app.controller("EmailsCtrl",["$scope","$timeout","$location","toaster","$modal","WebsiteService","CommonService","AccountService","formValidations","$q","$state",function(t,n,a,o,i,s,r,c,l,u,d){t.setDefaults=function(){t.newEmail={title:"New Email Title",subject:"New Email Subject"}},t.formValidations=l,t.setDefaults(),s.getEmails(!1,function(a){n(function(){t.$apply(function(){t.emails=e.copy(a);var n=[s.getAccountEmailStatsPromise()];u.all(n).then(function(e){e.forEach(function(e,n){var a=e.data;_.each(a,function(e){var n=_.find(t.emails,function(t){return e._id==t._id});n&&(n.stats=e)})}),_.each(t.emails,function(e){e.stats||(e.stats={opens:0,clicks:0,sends:0})})})})})}),c.getAccount(function(n){t.account=n,n.business.name&&(t.newEmail.fromName=n.business.name),n.business.emails[0].email&&(t.newEmail.fromEmail=n.business.emails[0].email,t.newEmail.replyTo=n.business.emails[0].email),t.newEmailOriginal=e.copy(t.newEmail)}),t.order="reverse",t.default_image_url="/admin/assets/images/default-page.jpg",t.filterTemplateScreenShots=function(e){_.each(e,function(e){e&&(e.hasScreenshot=!1,e.previewUrl&&($("#template_screenshot_"+e._id).attr("src")===t.default_image_url?e.hasScreenshot=!1:e.hasScreenshot=!0))})},t.filterTemplates=function(){t.showFilter=!t.showFilter,t.filterTemplateScreenShots(t.emails)},t.createNewEmail=function(a){var i={title:a.title,type:"email",subject:a.subject,fromName:a.fromName,fromEmail:a.fromEmail,replyTo:a.replyTo,components:[{type:"email-header",version:1,txtcolor:"#888888",logo:t.account.business.logo?'<h2><img src="'+t.account.business.logo+'" /></h2>':"<h2>Logo Here</h2>",bg:{img:{url:"",width:null,height:null,parallax:!1,blur:!1},color:""},visibility:!0},{type:"email-1-col",version:1,txtcolor:"#888888",title:'<h2 style="text-align:center;color:#58585b;">One Column Layout Section</h2>',text:'<p style="text-align:center;">This is a single column content section.</p>',bg:{img:{url:"",width:null,height:null,parallax:!1,blur:!1},color:""},visibility:!0},{type:"email-2-col",version:1,txtcolor:"#888888",title:'<h2 style="text-align:center;color:#58585b;">Two Column Layout Section</h2>',text1:'<p style="text-align:center;">This is column 1.</p>',text2:'<p style="text-align:center;">This is column 2.</p>',bg:{img:{url:"",width:null,height:null,parallax:!1,blur:!1},color:""},visibility:!0},{type:"email-3-col",version:1,txtcolor:"#888888",title:'<h2 style="text-align:center;color:#58585b;">Three Column Layout Section</h2>',text1:'<p style="text-align:center;">This is column 1.</p>',text2:'<p style="text-align:center;">This is column 2.</p>',text3:'<p style="text-align:center;">This is column 3.</p>',bg:{img:{url:"",width:null,height:null,parallax:!1,blur:!1},color:""},visibility:!0},{type:"email-footer",version:1,txtcolor:"#888888",text:"This is an email footer.",bg:{img:{url:"",width:null,height:null,parallax:!1,blur:!1},color:""},visibility:!0}]};i.components.forEach(function(e,t){var n=r.getUUID();i.components[t]._id=n,i.components[t].anchor=n}),t.account.business.logo&&(i.components[0].logo='<img src="'+t.account.business.logo+'"/>'),s.createEmail(i,function(a,i){a&&!i?(o.pop("success","Email Created","The "+a.title+" email was created successfully."),t.emails.unshift(a),t.displayedEmails.unshift(a),t.newEmailOriginal=e.copy(t.newEmail),t.closeModal(),n(function(){t.viewSingle(a)},0)):i&&o.pop("error","Error creating Email",i.message)})},t.openModal=function(e){t.modalInstance=i.open({templateUrl:e,keyboard:!0,backdrop:"static",scope:t})},t.closeModal=function(){t.modalInstance.close()},t.getters={components:function(e){return e.length},created:function(e){return e.created.date},modified:function(e){return e.modified.date}},t.setTemplateDetails=function(e){t.templateDetails=!0,t.selectedTemplate=e},t.resetTemplateDetails=function(){t.templateDetails=!1,t.selectedTemplate=null,t.showChangeURL=!1},t.viewSingle=function(e){t.account.showhide.ssbEmail?d.go("app.emailEditor",{id:e._id}):a.path("/editor").search({email:e._id})},t.filterScreenshot={},t.pageScreenshotOptions=[{name:"Screenshot",value:!0},{name:"No Screenshot",value:!1}],t.triggerInput=function(t){e.element(t).trigger("input")},t.clearFilter=function(e,n){t.filterScreenshot={},t.triggerInput(n)}}])}(angular),angular,app.controller("HelpTopicsCtrl",["$rootScope","$scope","WebsiteService","$location","$sce","$filter",function(e,t,n,a,o,i){t.searchTextValue={},t.searchTextValueBy="$",t.loaded=!1,t.panesByCat={account:[],billing:[],contacts:[],campaigns:[],dashboard:[],emails:[],faqs:[],integrations:[],orders:[],posts:[],products:[],profile:[],"site-analytics":[],"social-feed":[],website:[]},e.$on("$locationChangeSuccess",function(e,n,o){if(a.search().title){i=_.find(t.topics,function(e){return e.handle===a.search().title});t.viewSingle(i)}else if(a.search().topic){var i=_.find(t.topics,function(e){return e._id===a.search().topic});t.viewSingle(i)}else t.loaded=!1,t.showTopics()}),t.isMoreThan50Char=function(e){if(e.length>50)return!0},n.getTopics(function(e){if(t.topics=e,_.each(t.topics,function(e){e.isPublic&&t.panesByCat[e.category.toLowerCase().replace(" ","-")].push(e)}),t.topicsLoaded=!0,a.search().title){n=_.find(t.topics,function(e){return e.handle===a.search().title});t.viewSingle(n)}if(a.search().topic){var n=_.find(t.topics,function(e){return e._id===a.search().topic});t.viewSingle(n)}}),t.updateTopic=function(e){e.handle=i("slugify")(e.title),n.updateTopic(e,function(e){})},t.isViewed=function(e){e.statistics.views=e.statistics.views+1,t.updateTopic(e)},t.isHelpful=function(e){t.topicRated=!0,t.showThanks=!0,e.statistics.helpful=e.statistics.helpful+1,t.updateTopic(e)},t.notHelpful=function(e){Intercom("showNewMessage"," "+e.title+" The help topic did not answer my issue."),t.topicRated=!0,t.showSupport=!0,e.statistics.nothelpful=e.statistics.nothelpful+1,t.updateTopic(e)},t.singleTopic={},t.viewSingle=function(e){e&&(t.loaded||t.isViewed(e),t.loaded=!0,t.singleTopic=e,t.showSingle=!0,a.path("/support/help-topics").search({title:e.handle}))},t.flvVideoUrl=function(e,t){var n=urlParser.parse(t),a="";return a=n?e+n.id+"?showinfo=0&rel=0&hd=1":e,o.trustAsResourceUrl(a)},t.showTopics=function(){a.search("topic",null),t.showSingle=!1,t.singleTopic="",t.topicRated=!1,t.showSupport=!1,t.showThanks=!1}}]),app.controller("IconsCtrl",["$scope",function(e){e.icons=[{type:"fontawesome",name:"Font Awesome",version:"4.2",prefix:"fa",sections:[{title:"40 New Icons in 4.2",icons:["fa-angellist","fa-area-chart","fa-at","fa-bell-slash","fa-bell-slash-o","fa-bicycle","fa-binoculars","fa-birthday-cake","fa-bus","fa-calculator","fa-cc","fa-cc-amex","fa-cc-discover","fa-cc-mastercard","fa-cc-paypal","fa-cc-stripe","fa-cc-visa","fa-copyright","fa-eyedropper","fa-futbol-o","fa-google-wallet","fa-ils","fa-ioxhost","fa-lastfm","fa-lastfm-square","fa-line-chart","fa-meanpath","fa-newspaper-o","fa-paint-brush","fa-paypal","fa-pie-chart","fa-plug","fa-shekel","fa-sheqel","fa-slideshare","fa-soccer-ball-o","fa-toggle-off","fa-toggle-on","fa-trash","fa-tty","fa-twitch","fa-wifi","fa-yelp"]},{title:"Web Application Icons",icons:["fa-adjust","fa-anchor","fa-archive","fa-arrows","fa-arrows-h","fa-arrows-v","fa-asterisk","fa-ban","fa-bar-chart-o","fa-barcode","fa-bars","fa-beer","fa-bell","fa-bell-o","fa-bolt","fa-book","fa-bookmark","fa-bookmark-o","fa-briefcase","fa-bug","fa-building-o","fa-bullhorn","fa-bullseye","fa-calendar","fa-calendar-o","fa-camera","fa-camera-retro","fa-caret-square-o-down","fa-caret-square-o-left","fa-caret-square-o-right","fa-caret-square-o-up","fa-certificate","fa-check","fa-check-circle","fa-check-circle-o","fa-check-square","fa-check-square-o","fa-circle","fa-circle-o","fa-clock-o","fa-cloud","fa-cloud-download","fa-cloud-upload","fa-code","fa-code-fork","fa-coffee","fa-cog","fa-cogs","fa-comment","fa-comment-o","fa-comments","fa-comments-o","fa-compass","fa-credit-card","fa-crop","fa-crosshairs","fa-cutlery","fa-dashboard","fa-desktop","fa-dot-circle-o","fa-download","fa-edit","fa-ellipsis-h","fa-ellipsis-v","fa-envelope","fa-envelope-o","fa-eraser","fa-exchange","fa-exclamation","fa-exclamation-circle","fa-exclamation-triangle","fa-external-link","fa-external-link-square","fa-eye","fa-eye-slash","fa-female","fa-fighter-jet","fa-film","fa-filter","fa-fire","fa-fire-extinguisher","fa-flag","fa-flag-checkered","fa-flag-o","fa-flash","fa-flask","fa-folder","fa-folder-o","fa-folder-open","fa-folder-open-o","fa-frown-o","fa-gamepad","fa-gavel","fa-gear","fa-gears","fa-gift","fa-glass","fa-globe","fa-group","fa-hdd-o","fa-headphones","fa-heart","fa-heart-o","fa-home","fa-inbox","fa-info","fa-info-circle","fa-key","fa-keyboard-o","fa-laptop","fa-leaf","fa-legal","fa-lemon-o","fa-level-down","fa-level-up","fa-lightbulb-o","fa-location-arrow","fa-lock","fa-magic","fa-magnet","fa-mail-forward","fa-mail-reply","fa-mail-reply-all","fa-male","fa-map-marker","fa-meh-o","fa-microphone","fa-microphone-slash","fa-minus","fa-minus-circle","fa-minus-square","fa-minus-square-o","fa-mobile","fa-mobile-phone","fa-money","fa-moon-o","fa-music","fa-pencil","fa-pencil-square","fa-pencil-square-o","fa-phone","fa-phone-square","fa-picture-o","fa-plane","fa-plus","fa-plus-circle","fa-plus-square","fa-plus-square-o","fa-power-off","fa-print","fa-puzzle-piece","fa-qrcode","fa-question","fa-question-circle","fa-quote-left","fa-quote-right","fa-random","fa-refresh","fa-reply","fa-reply-all","fa-retweet","fa-road","fa-rocket","fa-rss","fa-rss-square","fa-search","fa-search-minus","fa-search-plus","fa-share","fa-share-square","fa-share-square-o","fa-shield","fa-shopping-cart","fa-sign-in","fa-sign-out","fa-signal","fa-sitemap","fa-smile-o","fa-sort","fa-sort-alpha-asc","fa-sort-alpha-desc","fa-sort-amount-asc","fa-sort-amount-desc","fa-sort-asc","fa-sort-desc","fa-sort-down","fa-sort-numeric-asc","fa-sort-numeric-desc","fa-sort-up","fa-spinner","fa-square","fa-square-o","fa-star","fa-star-half","fa-star-half-empty","fa-star-half-full","fa-star-half-o","fa-star-o","fa-subscript","fa-suitcase","fa-sun-o","fa-superscript","fa-tablet","fa-tachometer","fa-tag","fa-tags","fa-tasks","fa-terminal","fa-thumb-tack","fa-thumbs-down","fa-thumbs-o-down","fa-thumbs-o-up","fa-thumbs-up","fa-ticket","fa-times","fa-times-circle","fa-times-circle-o","fa-tint","fa-toggle-down","fa-toggle-left","fa-toggle-right","fa-toggle-up","fa-trash-o","fa-trophy","fa-truck","fa-umbrella","fa-unlock","fa-unlock-alt","fa-unsorted","fa-upload","fa-user","fa-users","fa-video-camera","fa-volume-down","fa-volume-off","fa-volume-up","fa-warning","fa-wheelchair","fa-wrench"]},{title:"Form Control Icons",icons:["fa-check-square","fa-check-square-o","fa-circle","fa-circle-o","fa-dot-circle-o","fa-minus-square","fa-minus-square-o","fa-plus-square","fa-plus-square-o","fa-square","fa-square-o"]},{title:"Currency Icons",icons:["fa-bitcoin","fa-btc","fa-cny","fa-dollar","fa-eur","fa-euro","fa-gbp","fa-inr","fa-jpy","fa-krw","fa-money","fa-rmb","fa-rouble","fa-rub","fa-ruble","fa-rupee","fa-try","fa-turkish-lira","fa-usd","fa-won","fa-yen"]},{title:"Text Editor Icons",icons:["fa-align-center","fa-align-justify","fa-align-left","fa-align-right","fa-bold","fa-chain","fa-chain-broken","fa-clipboard","fa-columns","fa-copy","fa-cut","fa-dedent","fa-eraser","fa-file","fa-file-o","fa-file-text","fa-file-text-o","fa-files-o","fa-floppy-o","fa-font","fa-indent","fa-italic","fa-link","fa-list","fa-list-alt","fa-list-ol","fa-list-ul","fa-outdent","fa-paperclip","fa-paste","fa-repeat","fa-rotate-left","fa-rotate-right","fa-save","fa-scissors","fa-strikethrough","fa-table","fa-text-height","fa-text-width","fa-th","fa-th-large","fa-th-list","fa-underline","fa-undo","fa-unlink"]},{title:"Directional Icons",icons:["fa-angle-double-down","fa-angle-double-left","fa-angle-double-right","fa-angle-double-up","fa-angle-down","fa-angle-left","fa-angle-right","fa-angle-up","fa-arrow-circle-down","fa-arrow-circle-left","fa-arrow-circle-o-down","fa-arrow-circle-o-left","fa-arrow-circle-o-right","fa-arrow-circle-o-up","fa-arrow-circle-right","fa-arrow-circle-up","fa-arrow-down","fa-arrow-left","fa-arrow-right","fa-arrow-up","fa-arrows","fa-arrows-alt","fa-arrows-h","fa-arrows-v","fa-caret-down","fa-caret-left","fa-caret-right","fa-caret-square-o-down","fa-caret-square-o-left","fa-caret-square-o-right","fa-caret-square-o-up","fa-caret-up","fa-chevron-circle-down","fa-chevron-circle-left","fa-chevron-circle-right","fa-chevron-circle-up","fa-chevron-down","fa-chevron-left","fa-chevron-right","fa-chevron-up","fa-hand-o-down","fa-hand-o-left","fa-hand-o-right","fa-hand-o-up","fa-long-arrow-down","fa-long-arrow-left","fa-long-arrow-right","fa-long-arrow-up","fa-toggle-down","fa-toggle-left","fa-toggle-right","fa-toggle-up"]},{title:"Video Player Icons",icons:["fa-arrows-alt","fa-backward","fa-compress","fa-eject","fa-expand","fa-fast-backward","fa-fast-forward","fa-forward","fa-pause","fa-play","fa-play-circle","fa-play-circle-o","fa-step-backward","fa-step-forward","fa-stop","fa-youtube-play"]},{title:"Brand Icons",icons:["fa-adn","fa-android","fa-apple","fa-bitbucket","fa-bitbucket-square","fa-bitcoin","fa-btc","fa-css3","fa-dribbble","fa-dropbox","fa-facebook","fa-facebook-square","fa-flickr","fa-foursquare","fa-github","fa-github-alt","fa-github-square","fa-gittip","fa-google-plus","fa-google-plus-square","fa-html5","fa-instagram","fa-linkedin","fa-linkedin-square","fa-linux","fa-maxcdn","fa-pagelines","fa-pinterest","fa-pinterest-square","fa-renren","fa-skype","fa-stack-exchange","fa-stack-overflow","fa-trello","fa-tumblr","fa-tumblr-square","fa-twitter","fa-twitter-square","fa-vimeo-square","fa-vk","fa-weibo","fa-windows","fa-xing","fa-xing-square","fa-youtube","fa-youtube-play","fa-youtube-squar"]},{title:"Medical Icons",icons:["fa-ambulance","fa-h-square","fa-hospital-o","fa-medkit","fa-plus-square","fa-stethoscope","fa-user-md","fa-wheelchair"]}]},{type:"themify",name:"Themify Icons",version:"",prefix:"",sections:[{title:"Arrows & Direction Icons",icons:["ti-arrow-up","ti-arrow-right","ti-arrow-left","ti-arrow-down","ti-arrows-vertical","ti-arrows-horizontal","ti-angle-up","ti-angle-right","ti-angle-left","ti-angle-down","ti-angle-double-up","ti-angle-double-right","ti-angle-double-left","ti-angle-double-down","ti-move","ti-fullscreen","ti-arrow-top-right","ti-arrow-top-left","ti-arrow-circle-up","ti-arrow-circle-right","ti-arrow-circle-left","ti-arrow-circle-down","ti-arrows-corner","ti-split-v","ti-split-v-alt","ti-split-h","ti-hand-point-up","ti-hand-point-right","ti-hand-point-left","ti-hand-point-down","ti-back-right","ti-back-left","ti-exchange-vertical"]},{title:"Web App Icons",icons:["ti-wand","ti-save","ti-save-alt","ti-direction","ti-direction-alt","ti-user","ti-link","ti-unlink","ti-trash","ti-target","ti-tag","ti-desktop","ti-tablet","ti-mobile","ti-email","ti-star","ti-spray","ti-signal","ti-shopping-cart","ti-shopping-cart-full","ti-settings","ti-search","ti-zoom-in","ti-zoom-out","ti-cut","ti-ruler","ti-ruler-alt-2","ti-ruler-pencil","ti-ruler-alt","ti-bookmark","ti-bookmark-alt","ti-reload","ti-plus","ti-minus","ti-close","ti-pin","ti-pencil","ti-pencil-alt","ti-paint-roller","ti-paint-bucket","ti-na","ti-medall","ti-medall-alt","ti-marker","ti-marker-alt","ti-lock","ti-unlock","ti-location-arrow","ti-layout","ti-layers","ti-layers-alt","ti-key","ti-image","ti-heart","ti-heart-broken","ti-hand-stop","ti-hand-open","ti-hand-drag","ti-flag","ti-flag-alt","ti-flag-alt-2","ti-eye","ti-import","ti-export","ti-cup","ti-crown","ti-comments","ti-comment","ti-comment-alt","ti-thought","ti-clip","ti-check","ti-check-box","ti-camera","ti-announcement","ti-brush","ti-brush-alt","ti-palette","ti-briefcase","ti-bolt","ti-bolt-alt","ti-blackboard","ti-bag","ti-world","ti-wheelchair","ti-car","ti-truck","ti-timer","ti-ticket","ti-thumb-up","ti-thumb-down","ti-stats-up","ti-stats-down","ti-shine","ti-shift-right","ti-shift-left","ti-shift-right-alt","ti-shift-left-alt","ti-shield","ti-notepad","ti-server","ti-pulse","ti-printer","ti-power-off","ti-plug","ti-pie-chart","ti-panel","ti-package","ti-music","ti-music-alt","ti-mouse","ti-mouse-alt","ti-money","ti-microphone","ti-menu","ti-menu-alt","ti-map","ti-map-alt","ti-location-pin","ti-light-bulb","ti-info","ti-infinite","ti-id-badge","ti-hummer","ti-home","ti-help","ti-headphone","ti-harddrives","ti-harddrive","ti-gift","ti-game","ti-filter","ti-files","ti-file","ti-zip","ti-folder","ti-envelope","ti-dashboard","ti-cloud","ti-cloud-up","ti-cloud-down","ti-clipboard","ti-calendar","ti-book","ti-bell","ti-basketball","ti-bar-chart","ti-bar-chart-alt","ti-archive","ti-anchor","ti-alert","ti-alarm-clock","ti-agenda","ti-write","ti-wallet","ti-video-clapper","ti-video-camera","ti-vector","ti-support","ti-stamp","ti-slice","ti-shortcode","ti-receipt","ti-pin2","ti-pin-alt","ti-pencil-alt2","ti-eraser","ti-more","ti-more-alt","ti-microphone-alt","ti-magnet","ti-line-double","ti-line-dotted","ti-line-dashed","ti-ink-pen","ti-info-alt","ti-help-alt","ti-headphone-alt","ti-gallery","ti-face-smile","ti-face-sad","ti-credit-card","ti-comments-smiley","ti-time","ti-share","ti-share-alt","ti-rocket","ti-new-window","ti-rss","ti-rss-alt"]},{title:"Control Icons",icons:["ti-control-stop","ti-control-shuffle","ti-control-play","ti-control-pause","ti-control-forward","ti-control-backward","ti-volume","ti-control-skip-forward","ti-control-skip-backward","ti-control-record","ti-control-eject"]},{title:"Text Editor",icons:["ti-paragraph","ti-uppercase","ti-underline","ti-text","ti-Italic","ti-smallcap","ti-list","ti-list-ol","ti-align-right","ti-align-left","ti-align-justify","ti-align-center","ti-quote-right","ti-quote-left"]},{title:"Layout Icons",icons:["ti-layout-width-full","ti-layout-width-default","ti-layout-width-default-alt","ti-layout-tab","ti-layout-tab-window","ti-layout-tab-v","ti-layout-tab-min","ti-layout-slider","ti-layout-slider-alt","ti-layout-sidebar-right","ti-layout-sidebar-none","ti-layout-sidebar-left","ti-layout-placeholder","ti-layout-menu","ti-layout-menu-v","ti-layout-menu-separated","ti-layout-menu-full","ti-layout-media-right","ti-layout-media-right-alt","ti-layout-media-overlay","ti-layout-media-overlay-alt","ti-layout-media-overlay-alt-2","ti-layout-media-left","ti-layout-media-left-alt","ti-layout-media-center","ti-layout-media-center-alt","ti-layout-list-thumb","ti-layout-list-thumb-alt","ti-layout-list-post","ti-layout-list-large-image","ti-layout-line-solid","ti-layout-grid4","ti-layout-grid3","ti-layout-grid2","ti-layout-grid2-thumb","ti-layout-cta-right","ti-layout-cta-left","ti-layout-cta-center","ti-layout-cta-btn-right","ti-layout-cta-btn-left","ti-layout-column4","ti-layout-column3","ti-layout-column2","ti-layout-accordion-separated","ti-layout-accordion-merged","ti-layout-accordion-list","ti-widgetized","ti-widget","ti-widget-alt","ti-view-list","ti-view-list-alt","ti-view-grid","ti-upload","ti-download","ti-loop","ti-layout-sidebar-2","ti-layout-grid4-alt","ti-layout-grid3-alt","ti-layout-grid2-alt","ti-layout-column4-alt","ti-layout-column3-alt","ti-layout-column2-alt"]},{title:"Brand Icons",icons:["ti-flickr","ti-flickr-alt","ti-instagram","ti-google","ti-github","ti-facebook","ti-dropbox","ti-dropbox-alt","ti-dribbble","ti-apple","ti-android","ti-yahoo","ti-trello","ti-stack-overflow","ti-soundcloud","ti-sharethis","ti-sharethis-alt","ti-reddit","ti-microsoft","ti-microsoft-alt","ti-linux","ti-jsfiddle","ti-joomla","ti-html5","ti-css3","ti-drupal","ti-wordpress","ti-tumblr","ti-tumblr-alt","ti-skype","ti-youtube","ti-vimeo","ti-vimeo-alt","ti-twitter","ti-twitter-alt","ti-linkedin","ti-pinterest","ti-pinterest-alt","ti-themify-logo","ti-themify-favicon","ti-themify-favicon-alt"]}]}]}]),function(e){app.controller("IntegrationsCtrl",["$scope","$rootScope","SocialConfigService","AccountService","userConstant","SweetAlert","ipCookie","toaster","$location","$state","$window","$timeout",function(t,n,a,o,i,s,r,c,l,u,d,p){t.credentialTypes=i.credential_types,t.getAccount=function(){o.getAccount(function(n){t.account=n;var o=e.copy(n),i=_.find(o.credentials,function(e){return"stripe"===e.type}),s=n&&n.commerceSettings&&n.commerceSettings.paypal;t.socialAccounts=null,a.getAllSocialConfig(function(e){if(i&&(i.accountType="account",i.id=Math.uuid(8),i.type="st"),_.each(e.socialAccounts,function(e){"fb"===e.type?a.getFBProfile(e.id,function(t){e.profile=t}):"stripe"===e.type&&(e.type="st")}),_.find(e.socialAccounts,function(e){return"st"===e.type})||i&&e.socialAccounts.push(i),s){var n={};n.type=t.credentialTypes.PAYPAL,e.socialAccounts.push(n)}p(function(){t.socialAccounts=e.socialAccounts,t.checkForIntegration()},0)})})},t.checkForIntegration=function(){var e=r("socialAccount");if(e)if("/account/integrations"!==e.redirectTo){var n=e.redirectTo;l.path(n)}else{var a=_.where(t.socialAccounts,{type:e.type});a.length;e.accountsCount!=a.length&&(t.minRequirements=!0,c.pop("success","Integrated Successfully",e.socialAccount+" has been added."))}r.remove("socialAccount",{path:"/"})},t.getAccount(),t.socialFilter=function(e){return"adminpage"!==e.accountType},t.disconnectSocial=function(e,n){var i="Do you want to disconnect this social network?";e.type===t.credentialTypes.PAYPAL&&(i="Do you want to disconnect Paypal?"),s.swal({title:"Are you sure?",text:i,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, disconnect it!",cancelButtonText:"No, do not disconnect it!",closeOnConfirm:!0,closeOnCancel:!0},function(i){i&&(e.loading=!0,e.type===t.credentialTypes.STRIPE?(t.account.credentials=_.without(t.account.credentials,_.findWhere(t.account.credentials,{accessToken:e.accessToken})),o.updateAccount(t.account,function(e){t.socialAccounts.splice(n,1),t.account=e})):e.type===t.credentialTypes.PAYPAL?(t.account.commerceSettings||(t.account.commerceSettings={}),t.account.commerceSettings.paypal=!1,o.updateAccount(t.account,function(e){t.socialAccounts.splice(n,1),t.account=e})):a.deleteSocialConfigEntry(e.id,function(){a.getAllSocialConfig(function(e){t.socialAccounts.splice(n,1)})}))})},t.currentHost=d.location.host,t.redirectUrl="/admin/account/integrations",t.socailRedirect=function(e,n){var a=_.where(t.socialAccounts,{type:n}).length,o=r("socialAccount"),i=new Date;if(i.setMinutes(i.getMinutes()+10),void 0===o)r("socialAccount",s={socialAccount:e,redirectTo:"/account/integrations",accountsCount:a,type:n},{expires:i,path:"/"});else{r.remove("socialAccount",{path:"/"});var s={socialAccount:e,redirectTo:"/account/integrations",accountsCount:a,type:n};r("socialAccount",s,{expires:i,path:"/",redirectTo:"/account/integrations"})}var c="/redirect/?next="+t.currentHost+"/socialconfig/"+e.toLowerCase()+"?redirectTo="+t.redirectUrl+"&socialNetwork="+e;"Stripe"===e&&(c="/redirect/?next="+t.currentHost+"/stripe/connect/"),"Paypal"===e&&(c="/admin/#/support/help-topics?title=adding-paypal-as-an-payment-option"),d.location=c},n.$on("$refreshSocialAccounts",function(e,n){t.getAccount()})}])}(angular),app.controller("LaddaCtrl",["$scope","$timeout",function(e,t){e.ldloading={},e.clickBtn=function(n){e.ldloading[n.replace("-","_")]=!0,t(function(){e.ldloading[n.replace("-","_")]=!1},2e3)},e.clickProgressBtn=function(n){e.ldloading[n.replace("-","_")+"_progress"]=!0,t(function(){e.ldloading[n.replace("-","_")+"_progress"]=.1},500),t(function(){e.ldloading[n.replace("-","_")+"_progress"]+=.1},1e3),t(function(){e.ldloading[n.replace("-","_")+"_progress"]+=.1},1500),t(function(){e.ldloading[n.replace("-","_")+"_progress"]=!1},2e3)}}]),app.controller("AppCtrl",["$rootScope","$scope","$state","$translate","$window","$document","$timeout","$modal","cfpLoadingBar","UserService","AccountService","accountConstant",function(e,t,n,a,o,i,s,r,c,l,u,d){u.getAccount(function(a){t.account=a,e.account=a,u.setMainAccount(t.account),a.showhide.dohy&&"app.dashboard"===n.current.name&&n.go("app.dohy"),a.locked_sub&&!n.includes("app.account.billing")&&n.go("app.account.billing"),a.firstLogin&&(a.firstLogin=!1,u.updateAccount(a,function(){}))});var p=["app.onboarding"];e.$on("$stateChangeSuccess",function(e,a,o){p.indexOf(n.current.name)>-1?t.hideSidebar=!0:t.hideSidebar=!1});var m=$(o);e.$on("$stateChangeStart",function(a,o,i,s,r){e.app.layout.isMinimalAdminChrome=!1,e.app.layout.isAnalyticsDashboardMode=!1,t.account&&t.account.locked_sub&&n.includes("app.account.billing")?c.complete():c.start()}),e.$on("$stateChangeSuccess",function(t,a,o,s,r){t.targetScope.$watch("$viewContentLoaded",function(){c.complete()}),i.scrollTo(0,0),angular.element(".email-reader").length&&angular.element(".email-reader").animate({scrollTop:0},0),e.currTitle=n.current.title}),e.$on("$stateNotFound",function(e,t,n,a){}),e.pageTitle=function(){return e.app.name+" - "+(e.currTitle||e.app.description)},t.toTheTop=function(){i.scrollTopAnimated(0,600)},t.language={listIsOpen:!1,available:{en:"English",it_IT:"Italiano",de_DE:"Deutsch"},init:function(){var e=a.proposedLanguage()||a.use(),n=a.preferredLanguage();t.language.selected=t.language.available[e||n]},set:function(e,n){a.use(e),t.language.selected=t.language.available[e],t.language.listIsOpen=!t.language.listIsOpen}},t.language.init();var g=function(){var e=window,t="inner";return"innerWidth"in window||(t="client",e=document.documentElement||document.body),{width:e[t+"Width"],height:e[t+"Height"]}};t.getWindowDimensions=function(){return{h:g().height,w:g().width}},t.$watch(t.getWindowDimensions,function(e,n){t.windowHeight=e.h,t.windowWidth=e.w,e.w>=992?t.isLargeDevice=!0:t.isLargeDevice=!1,e.w<992?t.isSmallDevice=!0:t.isSmallDevice=!1,e.w<=768?t.isMobileDevice=!0:t.isMobileDevice=!1},!0),m.on("resize",function(){}),l.getUser(function(e){t.currentUser=e}),t.openTopBarMediaModal=function(){"app.website.ssbSiteBuilder.editor"!==n.current.name&&"app.emailEditor"!==n.current.name?t.modalInstance=r.open({templateUrl:"media-modal",controller:"MediaModalCtrl",size:"lg",keyboard:!0,backdrop:"static",resolve:{showInsert:function(){},insertMedia:function(){},isSingleSelect:function(){return!0}}}):clickandInsertImageButton()}}]),function(e){"use strict";app.controller("ManageTopicsCtrl",["$scope","$location","toaster","$filter","$modal","WebsiteService",function(t,n,a,o,i,s){s.getTopics(function(e){t.topics=e}),t.topicCategories=["Emails","Getting Started","Integrations","Orders","Posts","Products","Profile","Site Analytics","Social Feed","Websites"],t.openModal=function(e){t.modalInstance=i.open({templateUrl:e,keyboard:!0,backdrop:"static",scope:t})},t.closeModal=function(){t.modalInstance.close()},t.getters={components:function(e){return e.length},created:function(e){return e.created.date},updated:function(e){return e.updated.date}},t.resetTemplateDetails=function(){t.templateDetails=!1,t.selectedTemplate=null,t.showChangeURL=!1},t.validateCreatePage=function(e,n){t.createPageValidated=!1,e&&(""===e.handle?t.handleError=!0:(t.handleError=!1,n||(e.handle=o("slugify")(e.title))),""===e.title?t.titleError=!0:t.titleError=!1,e&&e.title&&""!==e.title&&e.handle&&""!==e.handle&&(t.createPageValidated=!0))},t.createTopic=function(e,n){e.handle=o("slugify")(e.title),s.createTopic(e,function(n){a.pop("success","Topic Created","The "+n.title+" topic was created successfully."),t.closeModal(),t.topics.unshift(n),t.displayedTopics.unshift(n),e.title="",e.category=""})},t.viewSingle=function(e){n.path("/support/manage-topics/").search({topic_id:e._id})},t.filterScreenshot={},t.pageScreenshotOptions=[{name:"Screenshot",value:!0},{name:"No Screenshot",value:!1}],t.triggerInput=function(t){e.element(t).trigger("input")},t.clearFilter=function(e,n){t.filterScreenshot={},t.triggerInput(n)}}])}(angular),app.controller("MapCoordinatesCtrl",["$scope","$compile",function(e,t){function n(e,t,n){return null!=t&&(e=Math.max(e,t)),null!=n&&(e=Math.min(e,n)),e}function a(e){return e*(Math.PI/180)}function o(e){return e/(Math.PI/180)}function i(){this.pixelOrigin_=new google.maps.Point(s/2,s/2),this.pixelsPerLonDegree_=s/360,this.pixelsPerLonRadian_=s/(2*Math.PI)}var s=256;i.prototype.fromLatLngToPoint=function(e,t){var o=this,i=t||new google.maps.Point(0,0),s=o.pixelOrigin_;i.x=s.x+e.lng()*o.pixelsPerLonDegree_;var r=n(Math.sin(a(e.lat())),-.9999,.9999);return i.y=s.y+.5*Math.log((1+r)/(1-r))*-o.pixelsPerLonRadian_,i},i.prototype.fromPointToLatLng=function(e){var t=this,n=t.pixelOrigin_,a=(e.x-n.x)/t.pixelsPerLonDegree_,i=(e.y-n.y)/-t.pixelsPerLonRadian_,s=o(2*Math.atan(Math.exp(i))-Math.PI/2);return new google.maps.LatLng(s,a)},e.$on("mapInitialized",function(t,n){var a=1<<n.getZoom(),o=new i;e.chicago=n.getCenter(),e.worldCoordinate=o.fromLatLngToPoint(e.chicago),e.pixelCoordinate=new google.maps.Point(e.worldCoordinate.x*a,e.worldCoordinate.y*a),e.tileCoordinate=new google.maps.Point(Math.floor(e.pixelCoordinate.x/s),Math.floor(e.pixelCoordinate.y/s))})}]),app.controller("EventSimpleCtrl",["$scope","$timeout",function(e,t){var n,a;e.$on("mapInitialized",function(e,t){n=(a=t).markers[0]}),e.centerChanged=function(e){t(function(){a.panTo(n.getPosition())},3e3)},e.click=function(e){a.setZoom(8),a.setCenter(n.getPosition())}}]),app.controller("EventPropertiesCtrl",["$scope",function(e){e.$on("mapInitialized",function(t,n){var a=n.infoWindows[1];e.zoomChanged=function(e){a.setContent("Zoom: "+n.getZoom()),n.setCenter(a.getPosition())}})}]),app.controller("ControlCustomStateCtrl",["$scope",function(e){e.home=new google.maps.LatLng(41.850033,-87.6500523),e.goHome=function(){e.map.setCenter(e.home)},e.setHome=function(){e.home=e.map.getCenter()}}]),app.controller("AddComponentModalCtrl",["$scope","$document","$modalInstance","$timeout","WebsiteService","toaster","components","clickedIndex","isEmail","pageHandle",function(e,t,n,a,o,i,s,r,c,l){e.components=s,e.clickedIndex=r,e.saveLoading=!1,e.isEmail=c,e.pageHandle=l,e.saveLoading=!1,e.addComponent=function(n){if(!e.saveLoading){e.saveLoading=!0;var s=null;if(("footer"===n.type||"navigation"===n.type||"single-post"===n.type||"blog-teaser"===n.type||"blog"===n.type)&&(s=_.findWhere(e.components,{type:n.type})))return i.pop("error",s.type+" component already exists"),void(e.saveLoading=!1);o.getComponent(n,n.version||1,function(o){var s=e.clickedIndex+1;o&&(e.closeModal(),e.components.splice(s,0,o),a(function(){var e=document.getElementById(o._id);e&&(t.scrollToElementAnimated(e,175,1e3),$(window).trigger("resize"))},500),i.pop("success","Component Added","The "+o.type+" component was added successfully."),"simple-form"===n.type&&e.setDefaultAutoresponderEmail(s))})}},e.setDefaultAutoresponderEmail=function(t){var n=e.components[t-1];o.getEmails(!0,function(e){if(!n.emailId){var t=_.find(e,function(e){return"welcome-aboard"===e.handle});t&&(n.emailId=t._id)}})},e.closeModal=function(){a(function(){n.close(),angular.element(".modal-backdrop").remove()})},e.componentTypes=[{title:"Blog",type:"blog",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/blog.png",filter:"blog",description:"Use this component for your main blog page which displays all your posts with a sidebar of categories, tags, recent posts, and posts by author.",enabled:!0},{title:"Blog Teaser",type:"blog-teaser",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/blog-teaser.png",filter:"blog",description:"The Blog Teaser is perfect to showcase a few of your posts with a link to your full blog page.",enabled:!0},{title:"Masthead",type:"masthead",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/masthead.jpg",filter:"misc",description:"Introduce your business with this component on the top of your home page.",enabled:!0},{title:"Feature List",type:"feature-list",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/feature-list.jpg",filter:"features",description:"Showcase what your business offers with a feature list.",enabled:!0},{title:"Contact Us",type:"contact-us",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/contact-us.jpg",filter:"contact",description:"Let your visitors where your located, how to contact you, and what your business hours are.",enabled:!0},{title:"Coming Soon",type:"coming-soon",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/coming-soon.jpg",filter:"misc",description:"Even if your site isn't ready you can use this component to let your visitors know you will be availiable soon.",enabled:!0},{title:"Feature block",type:"feature-block",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/feature-block.jpg",filter:"features",description:"Use this component to show one important feature or maybe a quote.",enabled:!0},{title:"Footer",type:"footer",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/footer.png",filter:"misc",description:"Use this component to show footer on your page.",enabled:!1},{title:"Image Gallery",type:"image-gallery",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/gallery.jpg",filter:"images",description:"Display your images in this image gallery component with fullscreen large view.",enabled:!0},{title:"Image Text",version:1,type:"image-text",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/image-text.jpg",filter:"images",description:"Show an image next to a block of text on the right or the left.",enabled:!0},{title:"Meet Team",type:"meet-team",icon:"fa fa-users",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/meet-team.png",filter:"team",description:"Let your visitors know about the team behind your business. Show profile image, position, bio, and social links for each member.",enabled:!0},{title:"Navigation 1",type:"navigation",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/navbar-v1.jpg",filter:"navigation",description:"A simple navigation bar with the logo on the left and nav links on the right. Perfect for horizontal logos.",version:1,enabled:!0},{title:"Navigation 2",type:"navigation",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/nav-v2-preview.png",filter:"navigation",description:"If your logo is horizontal or square, this navigation will showcase your logo perfectly with addtional space for more links.",version:2,enabled:!0},{title:"Navigation 3",type:"navigation",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/nav-v3-preview.png",filter:"navigation",description:"This navigation features a large block navigation links for a modern feel.",version:3,enabled:!0},{title:"Products",type:"products",icon:"fa fa-money",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/products.png",filter:"products",description:"Use this as the main products page to start selling. It comes together with a cart and checkout built in.",enabled:!0},{title:"Pricing Tables",type:"pricing-tables",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/pricing-tables.png",filter:"text",description:"Subscription product types with multiple options are best when shown in a pricing table to help the visitor decide which one is best for them.",enabled:!0},{title:"Simple form",type:"simple-form",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/simple-form.jpg",filter:"forms",description:"Automatically create contacts in the backend when a visitor submits this form. Add first name, last name, email, or phone number fields.",enabled:!0},{title:"Single Post",type:"single-post",icon:"custom single-post",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/45274f46-0a21-11e5-83dc-0aee4119203c.png",filter:"blog",description:"Used for single post design. This is a mandatory page used to show single posts. This will apply to all posts.",enabled:!0},{title:"Social",type:"social-link",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/social-links.jpg",filter:"social",description:"Let your visitors know where else to find you on your social networks. Choose from 18 different networks.",enabled:!0},{title:"Video",type:"video",icon:"fa fa-video",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/video.png",filter:"video",description:"Showcase a video from Youtube, Vimeo, or an uploaded one. You can simply add the url your video is currently located.",enabled:!0},{title:"Text Block",type:"text-only",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/text-block.jpg",filter:"text",description:"A full width component for a large volume of text. You can also add images within the text.",enabled:!0},{title:"Thumbnail Slider",type:"thumbnail-slider",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/thumbnail.png",filter:"images",description:"Perfect for sponsor or client logos you have worked with in the past. Works best with logos that have a transparent background. ",enabled:!0},{title:"Top Bar",type:"top-bar",icon:"fa fa-info",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/top-bar.png",filter:"contact",description:"Show your social networks, phone number, business hours, or email right on top that provides visitors important info quickly.",enabled:!0},{title:"Testimonials",type:"testimonials",icon:"fa fa-info",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/45263570-0a21-11e5-87dd-b37fd2717aeb.png",filter:"text",description:"A component to showcase your testimonials.",enabled:!0}],e.isEmail?e.componentTypes=[{title:"Header",type:"email-header",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/blog.png",filter:"email",description:"Use this component for email header section.",enabled:!0},{title:"Content 1 Column",type:"email-1-col",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/blog.png",filter:"layout",description:"Use this component for single column content.",enabled:!0},{title:"Content 2 Column",type:"email-2-col",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/blog.png",filter:"layout",description:"Use this component for 2 column content.",enabled:!0},{title:"Content 3 Column",type:"email-3-col",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/blog.png",filter:"layout",description:"Use this component for 3 column content.",enabled:!0},{title:"Social Links",type:"email-social",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/blog.png",filter:"social",description:"Use this component for social links.",enabled:!0},{title:"Horizontal Rule",type:"email-hr",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/blog.png",filter:"layout",description:"Use this component to insert a horizontal rule between components.",enabled:!0},{title:"Footer",type:"email-footer",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/blog-teaser.png",filter:"email",description:"A footer for your email.",enabled:!0}]:(_.findWhere(e.components,{type:"footer"})||(_.findWhere(e.componentTypes,{type:"footer"}).enabled=!0),"single-post"==e.pageHandle&&(_.findWhere(e.components,{type:"single-post"})||(_.findWhere(e.componentTypes,{type:"single-post"}).enabled=!0)));var u;e.enabledComponentTypes=_.where(e.componentTypes,{enabled:!0}),e.componentFilters=_.without(_.uniq(_.pluck(_.sortBy(e.enabledComponentTypes,"filter"),"filter")),"misc"),_.each(e.componentFilters,function(t,n){u=t.charAt(0).toUpperCase()+t.substring(1).toLowerCase(),e.componentFilters[n]={capitalized:u,lowercase:t},u=null}),e.componentFilters.unshift({capitalized:"All",lowercase:"all"}),e.isEmail||e.componentFilters.push({capitalized:"Misc",lowercase:"misc"}),e.setFilterType=function(t){e.typefilter=t}}]),app.controller("ComponentSettingsModalCtrl",["$scope","$rootScope","$modalInstance","$http","$timeout","$q","$compile","$filter","WebsiteService","ContactService","ProductService","GeocodeService","toaster","hoursConstant","components","clickedIndex","contactMap","website","blog","isDirty","isSinglePost","openParentModal","showInsert","blogImage","accountShowHide","CampaignService","testimonialSlider","websiteLinks","isEmail",function(e,t,n,a,o,i,s,r,c,l,u,d,p,m,g,f,h,v,b,y,w,C,S,k,T,P,D,A,x){function I(e){return e?String(e).replace(/<br \/>/gm," ").replace(/<[^>]+>/gm,""):""}function E(){e.componentEditing.bg||(e.componentEditing.bg={}),e.componentEditing.bg&&!angular.isDefined(e.componentEditing.bg.opacity)&&(e.componentEditing.bg.opacity=1),e.componentEditing.bg&&e.componentEditing.bg.img&&!angular.isDefined(e.componentEditing.bg.img.overlayopacity)&&(e.componentEditing.bg.img.overlayopacity=1)}e.blog={},e.components=g,e.openParentModal=C,e.clickedIndex=f,e.componentEditing=g[f],e.contactMap=h,e.website=v,e.blog.post=b,e.isDirty=y,e.isSinglePost=w,e.showInsert=S,e.originalBlog=angular.copy(e.blog.post),e.place={},e.place.address=null,e.errorMapData=!1,e.checkIfAddess=!1,e.blogImage=k,e.isEmail=x,e.testimonialSlider=D,e.emailLoaded=!1,e.websiteLinks=A,c.getPages(function(t){var n=angular.fromJson(t),a=[];if(_.each(n,function(e){a.push(e)}),e.allPages=a,!T.blog){var o=_.findWhere(e.allPages,{handle:"blog"});if(o){var i=_.indexOf(e.allPages,o);e.allPages.splice(i,1)}}e.filterdedPages=r("orderBy")(e.allPages,"title",!1)}),c.getEmails(!0,function(t){if(o(function(){e.emailLoaded=!0},0),e.emails=t,"simple-form"===e.componentEditing.type&&!e.componentEditing.emailId){var n=_.find(t,function(e){return"welcome-aboard"===e.handle});n&&(e.componentEditing.emailId=n._id)}}),P.getCampaigns(function(t){e.campaigns=t}),e.availableProductTags=[],u.getProducts(function(t){e.products=t,_.each(t,function(t){"active"===t.status&&t.tags&&t.tags.length>0&&_.each(t.tags,function(t){-1===e.availableProductTags.indexOf(t)&&e.availableProductTags.push(t)})}),e.availableProductTagsString=e.availableProductTags.join(",")}),e.getAllContactTags=function(){l.getContactTags(function(t){e.contactTags=t,e.setTags(t)}),l.getContacts(function(t){l.getAllContactTags(t,function(t){e.contactTags=t,e.setTags(t)})})},e.setTags=function(t){_.each(e.componentEditing.tags,function(n,a){var o=_.findWhere(e.contactTags,{data:n});o?t.push(o):t.push({data:n,label:n})}),e.contactTags=_.uniq(t,function(e){return e.label})},e.testOptions={min:5,max:100,step:5,precision:2,orientation:"horizontal",handle:"round",tooltip:"show",tooltipseparator:":",tooltipsplit:!1,enabled:!0,naturalarrowkeys:!1,range:!1,ngDisabled:!1,reversed:!1},e.sliderValue=1,e.addBackground=function(){e.$parent.showInsert=!0,e.openParentModal("media-modal","MediaModalCtrl",null,"lg")},e.addFeaturedPost=function(){e.$parent.showInsert=!0,e.blogImage.featured_image=!0,e.openParentModal("media-modal","MediaModalCtrl",null,"lg")},e.originalWebsite=angular.copy(e.website),e.revertComponent=function(){"navigation"===e.componentEditing.type&&(e.website.linkLists=e.originalWebsite.linkLists),e.blog.post&&e.originalBlog&&(e.blog.post.featured_image=e.originalBlog.featured_image,e.blog.post.post_excerpt=e.originalBlog.post_excerpt),e.components[f]=e.originalComponent,o(function(){$(window).trigger("resize")},0),e.closeModal()},e.spectrum={options:{showPalette:!0,clickoutFiresChange:!0,showInput:!0,showButtons:!1,allowEmpty:!0,hideAfterPaletteSelect:!1,showPaletteOnly:!0,togglePaletteOnly:!0,togglePaletteMoreText:"more",togglePaletteLessText:"less",preferredFormat:"hex",appendTo:"body",palette:[["#C91F37","#DC3023","#9D2933","#CF000F","#E68364","#F22613","#CF3A24","#C3272B","#8F1D21","#D24D57"],["#f47998","#F47983","#DB5A6B","#C93756","#FCC9B9","#FFB3A7","#F62459","#F58F84","#875F9A","#5D3F6A"],["#89729E","#763568","#8D608C","#A87CA0","#5B3256","#BF55EC","#8E44AD","#9B59B6","#BE90D4","#4D8FAC"],["#5D8CAE","#22A7F0","#19B5FE","#59ABE3","#48929B","#317589","#89C4F4","#4B77BE","#1F4788","#003171"],["#044F67","#264348","#7A942E","#8DB255","#5B8930","#6B9362","#407A52","#006442","#87D37C","#26A65B"],["#26C281","#049372","#2ABB9B","#16A085","#36D7B7","#03A678","#4DAF7C","#D9B611","#F3C13A","#F7CA18"],["#E2B13C","#A17917","#F5D76E","#F4D03F","#FFA400","#E08A1E","#FFB61E","#FAA945","#FFA631","#FFB94E"],["#E29C45","#F9690E","#CA6924","#F5AB35","#BFBFBF","#F2F1EF","#BDC3C7","#ECF0F1","#D2D7D3","#757D75"],["#EEEEEE","#ABB7B7","#6C7A89","#95A5A6"]]}},e.componentTypes=[{title:"Blog",type:"blog",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/blog.png",filter:"blog",description:"Use this component for your main blog pages which displays all your posts with a sidebar of categories, tags, recent posts, and posts by author.",enabled:!0},{title:"Blog Teaser",type:"blog-teaser",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/blog-teaser.png",filter:"blog",description:"The Blog Teaser is perfect to showcase a few of your posts with a link to you full blog page.",enabled:!0},{title:"Masthead",type:"masthead",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/masthead.jpg",filter:"misc",description:"Introduce your business with this component on the top of your home page.",enabled:!0},{title:"Feature List",type:"feature-list",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/feature-list.jpg",filter:"features",description:"Showcase what your business offers with a feature list.",enabled:!0},{title:"Contact Us",type:"contact-us",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/contact-us.jpg",filter:"contact",description:"Let your visitors where your located, how to contact you, and what your business hours are.",enabled:!0},{title:"Coming Soon",type:"coming-soon",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/coming-soon.jpg",filter:"misc",description:"Even if your site isn't ready you can use this component to let your visitors know you will be availiable soon.",enabled:!0},{title:"Feature block",type:"feature-block",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/feature-block.jpg",filter:"features",description:"Use this component to show one important feature or maybe a quote.",enabled:!0},{title:"Image Gallery",type:"image-gallery",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/gallery.jpg",filter:"images",description:"Display your images in this image gallery component with fullscreen large view.",enabled:!0},{title:"Image Text",version:1,type:"image-text",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/image-text.jpg",filter:"images",description:"Show an image next to a block of text on the right or the left.",enabled:!0},{title:"Meet Team",type:"meet-team",icon:"fa fa-users",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/meet-team.png",filter:"team",description:"Let your visitors know about the team behind your business. Show profile image, position, bio, and social links for each member.",enabled:!0},{title:"Navigation 1",type:"navigation",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/navbar-v1.jpg",filter:"navigation",description:"A simple navigation bar with the logo on the left and nav links on the right. Perfect for horizontal logos.",version:1,enabled:!0},{title:"Navigation 2",type:"navigation",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/nav-v2-preview.png",filter:"navigation",description:"If your logo is horizontal or square, this navigation will showcase your logo perfectly with addtional space for more links.",version:2,enabled:!0},{title:"Navigation 3",type:"navigation",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/nav-v3-preview.png",filter:"navigation",description:"This navigation features a large block navigation links for a modern feel.",version:3,enabled:!0},{title:"Products",type:"products",icon:"fa fa-money",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/products.png",filter:"products",description:"Use this as the main products page to start selling. It comes together with a cart and checkout built in.",enabled:!0},{title:"Pricing Tables",type:"pricing-tables",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/pricing-tables.png",filter:"products",description:"Subscription product types with multiple options are best when shown in a pricing table to help the visitor decide which one is best for them.",enabled:!0},{title:"Simple form",type:"simple-form",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/simple-form.jpg",filter:"forms",description:"Automatically create contacts in the backend when a visitor submits this form. Add first name, last name, email, or phone number fields.",enabled:!0},{title:"Single Post",type:"single-post",icon:"custom single-post",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/45274f46-0a21-11e5-83dc-0aee4119203c.png",filter:"blog",description:"Used for single post design. This is a mandatory page used to show single posts. This will apply to all posts.",enabled:!1},{title:"Social",type:"social-link",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/social-links.jpg",filter:"social",description:"Let your visitors know where else to find you on your social networks. Choose from 18 different networks.",enabled:!0},{title:"Video",type:"video",icon:"fa fa-video",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/video.png",filter:"video",description:"Showcase a video from Youtube, Vimeo, or an uploaded one. You can simply add the url your video is currently located.",enabled:!0},{title:"Text Block",type:"text-only",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/text-block.jpg",filter:"text",description:"A full width component for a large volume of text. You can also add images within the text.",enabled:!0},{title:"Thumbnail Slider",type:"thumbnail-slider",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/thumbnail.png",filter:"images",description:"Perfect for sponsor or client logos you have worked with in the past. Works best with logos that have a transparent background. ",enabled:!0},{title:"Top Bar",type:"top-bar",icon:"fa fa-info",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/top-bar.png",filter:"contact",description:"Show your social networks, phone number, business hours, or email right on top that provides visitors important info quickly.",enabled:!0},{title:"Testimonials",type:"testimonials",icon:"fa fa-info",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/45263570-0a21-11e5-87dd-b37fd2717aeb.png",filter:"text",description:"A component to showcase your testimonials.",enabled:!0},{title:"Footer",type:"footer",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/footer.png",filter:"misc",description:"Use this component to show footer on your page.",enabled:!1}],e.componentOpacityValues=[{label:10,value:.1},{label:20,value:.2},{label:30,value:.3},{label:40,value:.4},{label:50,value:.5},{label:60,value:.6},{label:70,value:.7},{label:80,value:.8},{label:90,value:.9},{label:100,value:1}],e.removeImage=function(t){e.componentEditing&&e.componentEditing.bg&&e.componentEditing.bg.img&&(!1===e.componentEditing.bg.img.show&&!0===t||!1===t)&&(!1===t&&(e.componentEditing.bg.img.url=null),e.componentEditing.bg.img.blur=!1,e.componentEditing.bg.img.parallax=!1,e.componentEditing.bg.img.overlay=!1,e.componentEditing.bg.img.undernav=!1,e.componentEditing.bg.img.fullscreen=!1)},e.closeModal=function(){o(function(){e.$apply(function(){"contact-us"===e.componentEditing.type?e.validateGeoAddress(function(){e.errorMapData&&(e.componentEditing.location=e.originalComponent.location),e.contactHoursInvalid&&(e.componentEditing.hours=e.originalComponent.hours),n.close(),angular.element(".modal-backdrop").remove()}):(n.close(),angular.element(".modal-backdrop").remove())})})},e.$watch("newLink.linkPage",function(t){t&&(e.currentPage=_.find(e.filterdedPages,function(e){return e.handle===t}))}),e.initializeEditLinks=function(t,n){t.page&&(n&&(t.data=null),e.currentPage=_.find(e.filterdedPages,function(e){return e.handle===t.page}))},e.initializeLinks=function(t){e.addLink=t,e.newLink={linkUrl:null,linkTitle:null,linkType:null}},e.addSubLink=function(e){},e.setLinkUrl=function(){e.newLink.linkTitle=angular.element("#linkSection option:selected").html()},e.setLinkTitle=function(t,n,a){var o=_.first(angular.copy(e.components),[n+1]),i=_.filter(o,function(e){return e.type===t});return i.length>1?t.replace("-"," ")+"-"+(i.length-1):t.replace("-"," ")},e.numberOfProductOptions=[{name:"All",value:0},{name:"1",value:1},{name:"2",value:2},{name:"3",value:3},{name:"4",value:4},{name:"5",value:5},{name:"10",value:10},{name:"15",value:15},{name:"20",value:20}],e.deleteLinkFromNav=function(t){e.componentEditing.customnav?e.componentEditing.linkLists.forEach(function(n){"head-menu"===n.handle&&(n.links.splice(t,1),o(function(){e.$apply(function(){e.updateLinkList()})},500))}):e.website.linkLists.forEach(function(n){"head-menu"===n.handle&&(n.links.splice(t,1),o(function(){e.$apply(function(){e.updateLinkList()})},500))})},e.checkDuplicateLinkTitle=function(t,n,a){var o=!1,i=null;if(e.componentEditing.linkLists&&e.componentEditing.linkLists.forEach(function(e,t){"head-menu"===e.handle&&(i=e)}),!n&&e.website.linkLists&&e.website.linkLists.forEach(function(e,t){"head-menu"===e.handle&&(i=e)}),i){var s=_.filter(i.links,function(e){return e.label.toLowerCase()==t.toLowerCase()});!a&&s.length&&(o=!0),a&&s.length>1&&(o=!0)}return o&&(a&&(e.website.linkLists=angular.copy(e.originalLinkList),e.componentEditing.linkLists=angular.copy(e.originalCustomLinkList)),p.pop("warning","Link title already exists.")),a&&!o&&e.updateLinkList(),o},e.addLinkToNav=function(){if(e.newLink&&e.newLink.linkTitle&&e.newLink.linkUrl){if(e.checkDuplicateLinkTitle(e.newLink.linkTitle,e.componentEditing.customnav))return;e.componentEditing.customnav?(e.componentEditing.linkLists||(e.componentEditing.linkLists=[],e.componentEditing.linkLists.push({name:"Head Menu",handle:"head-menu",links:[]})),e.componentEditing.linkLists.forEach(function(t,n){"head-menu"===t.handle&&(t.links.push({label:e.newLink.linkTitle,type:"link",linkTo:{data:e.newLink.linkUrl,type:e.newLink.linkType,page:e.newLink.linkPage}}),e.initializeLinks(!1))})):e.website.linkLists.forEach(function(t,n){"head-menu"===t.handle&&(t.links.push({label:e.newLink.linkTitle,type:"link",linkTo:{data:e.newLink.linkUrl,type:e.newLink.linkType,page:e.newLink.linkPage}}),e.initializeLinks(!1))})}o(function(){e.$apply(function(){e.updateLinkList()})},500)},e.updateLinkList=function(t){var n=[],a=angular.element(".head-menu-links");_.each(a,function(e){var t=e.attributes["data-label"].value;t&&n.push(t)}),n.length?e.componentEditing.customnav?e.componentEditing.linkLists.forEach(function(t,o){if("head-menu"===t.handle){var i=[];_.each(a,function(e,a){if(t){var o=_.findWhere(t.links,{label:n[a]});i.push(o)}}),i.length&&(e.componentEditing.linkLists[o].links=i)}}):e.website.linkLists.forEach(function(t,o){if("head-menu"===t.handle){var i=[];_.each(a,function(e,a){if(t){var o=_.findWhere(t.links,{label:n[a]});i.push(o)}}),i.length&&(e.website.linkLists[o].links=i,e.websiteLinks&&e.websiteLinks.refreshWebsiteLinks&&e.websiteLinks.refreshWebsiteLinks(e.website.linkLists))}}):e.componentEditing.customnav?e.website.linkLists.forEach(function(t,n){"head-menu"===t.handle&&(e.componentEditing.linkLists[n].links=[])}):e.website.linkLists.forEach(function(t,n){"head-menu"===t.handle&&(e.website.linkLists[n].links=[])}),e.originalLinkList=angular.copy(e.website.linkLists),e.originalCustomLinkList=angular.copy(e.componentEditing.linkLists)},e.refreshSlider=function(){o(function(){t.$broadcast("rzSliderForceRender")},0)},e.setLatLon=function(t,n){e.componentEditing.location.lat=t,e.componentEditing.location.lon=n},e.updateContactUsAddress=function(){angular.equals(e.originalContactMap,e.componentEditing.location)||(e.locationAddress=null,e.setLatLon(),e.validateGeoAddress())},e.validateGeoAddress=function(t){d.validateAddress(e.componentEditing.location,e.locationAddress,function(n,a){n&&1===a.length?o(function(){e.$apply(function(){e.setLatLon(a[0].geometry.location.lat(),a[0].geometry.location.lng()),e.errorMapData=!1,angular.copy(e.componentEditing.location,e.originalContactMap),e.contactMap.refreshMap()})},0):o(function(){e.$apply(function(){e.errorMapData=!0,angular.copy(e.componentEditing.location,e.originalContactMap)})},0),t&&t()})},e.saveComponent=function(){e.isDirty.dirty=!0,o(function(){$(window).trigger("resize")},0)},e.saveContactComponent=function(t){t?(e.contactMap.refreshMap(),e.place.address=d.stringifyAddress(e.componentEditing.location)):e.contactMap.refreshHours(),e.isDirty.dirty=!0},e.saveTestimonialComponent=function(){e.isDirty.dirty=!0,e.testimonialSlider.refreshSlider()},e.saveComponentChanges=function(){e.isDirty.dirty=!0,o(function(){$(window).trigger("resize")},0)},e.spacingArr=[{name:"Top",category:"padding",value:"paddingTop",icon:"long-arrow-up"},{name:"Bottom",category:"padding",value:"paddingBottom",icon:"long-arrow-down"},{name:"Right",category:"padding",value:"paddingRight",icon:"long-arrow-right"},{name:"Left",category:"padding",value:"paddingLeft",icon:"long-arrow-left"},{name:"Top",category:"margin",value:"marginTop",icon:"long-arrow-up"},{name:"Bottom",category:"margin",value:"marginBottom",icon:"long-arrow-down"},{name:"Right",category:"margin",value:"marginRight",icon:"long-arrow-right"},{name:"Left",category:"margin",value:"marginLeft",icon:"long-arrow-left"}],e.resolutions=[320,360,480,720,768,960,1024,1280,1360,1366,1440,1600,1680,1920,"100%"],e.editComponent=function(){if(e.componentEditing){var a;if(!e.componentEditing.spacing){var i,s=50;"contact-us"!==e.componentEditing.type&&"navigation"!==e.componentEditing.type||(i=s=0),e.componentEditing.spacing={pt:i,pb:s,pl:0,pr:0,mt:0,mb:0,mr:"auto",ml:"auto",mw:"100%",usePage:!1}}E(),"simple-form"===e.componentEditing.type&&e.getAllContactTags(),"navigation"===e.componentEditing.type?(a=_.findWhere(e.componentTypes,{type:e.componentEditing.type,version:parseInt(e.componentEditing.version,10)}),e.originalLinkList=angular.copy(e.website.linkLists),e.originalCustomLinkList=angular.copy(e.componentEditing.linkLists)):a=_.findWhere(e.componentTypes,{type:e.componentEditing.type}),a&&a.icon&&(e.componentEditing.icon=a.icon),a&&a.title&&(e.componentEditing.header_title=a.title)}"simple-form"===e.componentEditing.type&&(e.componentEditing.fields.length||e.componentEditing.fields.push({display:"First Name",value:!1,name:"first"},{display:"Last Name",value:!1,name:"last"},{display:"Phone Number",value:!1,name:"phone"}),e.componentEditing.redirectType||(e.componentEditing.redirectType="page")),"contact-us"===e.componentEditing.type&&(e.hours=m,angular.isDefined(e.componentEditing.boxOpacity)||(e.componentEditing.boxOpacity=1),e.place.address=d.stringifyAddress(e.componentEditing.location),e.originalContactMap=angular.copy(e.componentEditing.location),e.componentEditing.hours&&_.each(e.componentEditing.hours,function(e,t){"Sat"!==e.day&&"Sun"!==e.day||(""===e.start&&(e.start="9:00 am"),""===e.end&&(e.end="5:00 pm"),e.start2&&""!==e.start2||(e.start2="9:00 am"),e.end2&&""!==e.end2||(e.end2="9:00 am"))})),e.contactHoursInvalid=!1,e.contactHours=[];var r=0;for(r;r<=6;r++)e.contactHours.push({valid:!0});e.componentEditing&&"top-bar"==e.componentEditing.type&&(e.topbarInfo={},e.topbarInfo.hours=I(e.componentEditing.businessHours),e.topbarInfo.email=I(e.componentEditing.email),e.topbarInfo.phone=I(e.componentEditing.phone)),e.componentEditing&&c.getComponentVersions(e.componentEditing.type,function(t){e.componentEditingVersions=t,e.componentEditing&&e.componentEditing.version&&(e.componentEditing.version=e.componentEditing.version.toString(),e.versionSelected=e.componentEditing.version),e.originalCurrentPage=angular.copy(e.currentPage)}),angular.element("#feature-convert").iconpicker({iconset:"fontawesome",icon:"fa-credit-card",rows:5,cols:5,placement:"right"}),angular.element("#feature-convert").on("change",function(t){e.featureIcon||(e.featureIcon={}),e.featureIcon&&(e.featureIcon.icon=t.icon)}),n.opened.then(function(){o(function(){t.$broadcast("rzSliderForceRender"),e.originalComponent=angular.copy(e.componentEditing)},1e3)})},e.editComponent();var M={street_number:"short_name",route:"long_name",locality:"long_name",administrative_area_level_1:"short_name",postal_code:"short_name",country:"short_name"};e.setDefaultAddress=function(){e.componentEditing.location.address="",e.componentEditing.location.address2="",e.componentEditing.location.city="",e.componentEditing.location.state="",e.componentEditing.location.zip="",e.componentEditing.location.country=""},e.fillInAddress=function(t){e.setDefaultAddress();var n,a,o=0;for(o;o<t.address_components.length;o++)n=t.address_components[o].types[0],M[n]&&(a=t.address_components[o][M[n]],"street_number"===n?e.componentEditing.location.address=a:"route"===n?e.componentEditing.location.address2=a:"locality"===n?e.componentEditing.location.city=a:"administrative_area_level_1"===n?e.componentEditing.location.state=a:"postal_code"===n?e.componentEditing.location.zip=a:"country"===n&&(e.componentEditing.location.country=a));e.componentEditing.location.lat=t.geometry.location.lat(),e.componentEditing.location.lon=t.geometry.location.lng()},e.$watch("place.address",function(t){t&&angular.isObject(t)&&(e.fillInAddress(t),e.locationAddress=t,e.setLatLon(),e.validateGeoAddress())}),e.validateHours=function(t,n){if(e.contactHours[n].valid=!0,!t.closed){var a=t.start,o=t.end;if(a&&o&&(a="pm"===a.split(" ")[1]&&"12"!==a.split(":")[0]?parseInt(a.split(":")[0],10)+12:parseInt(a.split(":")[0],10),o="pm"===o.split(" ")[1]&&"12"!==o.split(":")[0]?parseInt(o.split(":")[0],10)+12:parseInt(o.split(":")[0],10),a=30===parseInt(t.start.split(":")[1],10)?a+.5:a,o=30===parseInt(t.end.split(":")[1],10)?o+.5:o),t.split&&e.componentEditing.splitHours){angular.element("#business_hours_start_"+n).removeClass("has-error"),angular.element("#business_hours_start2_"+n).removeClass("has-error"),angular.element("#business_hours_end_"+n).removeClass("has-error");var i=t.start2,s=t.end2;i&&s&&(i="pm"===i.split(" ")[1]&&"12"!==i.split(":")[0]?parseInt(i.split(":")[0],10)+12:parseInt(i.split(":")[0],10),s="pm"===s.split(" ")[1]&&"12"!==s.split(":")[0]?parseInt(s.split(":")[0],10)+12:parseInt(s.split(":")[0],10),i=30===parseInt(t.start2.split(":")[1],10)?i+.5:i,s=30===parseInt(t.end2.split(":")[1],10)?s+.5:s),(a>o||a>i||a>s)&&(a>o?angular.element("#business_hours_start_"+n).addClass("has-error"):a>i?angular.element("#business_hours_start_"+n).addClass("has-error"):a>s&&angular.element("#business_hours_start_"+n).addClass("has-error"),e.contactHours[n].valid=!1),(o>i||o>s)&&(o>i?angular.element("#business_hours_end_"+n).addClass("has-error"):o>s&&angular.element("#business_hours_end_"+n).addClass("has-error"),e.contactHours[n].valid=!1),i>s&&(angular.element("#business_hours_start2_"+n).addClass("has-error"),e.contactHours[n].valid=!1)}else t.wholeday||(angular.element("#business_hours_start_"+n).removeClass("has-error"),a>o&&(angular.element("#business_hours_start_"+n).addClass("has-error"),e.contactHours[n].valid=!1))}var r=_.where(e.contactHours,{valid:!1});r&&r.length?e.contactHoursInvalid=!0:e.contactHoursInvalid=!1},e.slugifyAnchor=function(t){t&&(e.componentEditing.anchor=r("slugify")(t))},e.sortNavConfig={onEnd:function(t){e.updateLinkList()}},e.tagToContact=function(e){return l.tagToContact(e)}}]),app.controller("importContactModalCtrl",["$scope","$location","$timeout","$modalInstance","FileUploader","editableOptions","ContactService","userConstant","SocialConfigService","getContacts","contactConstant","toaster","$filter",function(e,t,n,a,o,i,s,r,c,l,u,d,p){e.counter=0,e.getContacts=l,i.theme="bs3",e.socailType="",e.socailList=!1,e.groupList=!1,e.socialAccounts={},e.googlePlusActive=!1,e.contactConstant=u,c.getAllSocialConfig(function(t){e.socialAccounts=t.socialAccounts,_.find(t.trackedAccounts,function(e){return"go"===e.type})&&(e.googlePlusActive=!0)}),e.dropdownFocus=function(){},e.importContacts=function(t){var n=!1;t.type===r.social_types.GOOGLE&&(n=!0,e.tempGoogleAccount=t,c.getGoogleGroups(t.id,function(t){t.push({name:"All",id:"All"}),e.socialAccountGroups=t})),t.type===r.social_types.LINKEDIN&&(n=!0,e.closeModal(),d.pop("success","Contacts import initiated."),c.importLinkedinContact(t.id,function(){e.closeModal(),d.pop("success","Your LinkedIn contacts are being imported in the background.")}),e.socailList=!1,e.groupList=!1),!1===n&&(e.closeModal(),d.pop("warning","No such account integrated."),e.socailList=!1,e.groupList=!1)},e.showSocialAccountSelect=function(t){e.socailType=t,e.socailList=!1,e.showCSVUpload=!1,"csv"===t&&(e.showCSVUpload=!0),t===r.social_types.GOOGLE?(e.socailList=!0,e.groupList=!0):e.groupList=!1},e.importGoogleContacts=function(t){e.closeModal(),d.pop("success","Contacts import initiated."),c.importGoogleContactsForGroup(e.tempGoogleAccount.id,t.id,function(){e.closeModal(),e.minRequirements=!0,d.pop("success","Your Google contacts are being imported in the background. Please refresh the page to see newly imported contacts")}),e.tempGoogleAccount=null,e.socailList=!1,e.groupList=!1},e.closeModal=function(e){n(function(){a.close(),angular.element(".modal-backdrop").remove(),e&&t.path(e)})},e.validateEmail=function(e){return new RegExp("^[_a-z0-9]+(.[_a-z0-9]+)*@[a-z0-9-]+(.[a-z0-9-]+)*(.[a-z]{2,4})$").test(e.toLowerCase())},e.validatePhone=function(e){return new RegExp("^([0-9()/+ -]*)$").test(e)},e.validatePhones=function(t){var n=e.formatColumns().phone.index,a=[];if(_.each(e.csvResults,function(t,o){if(0!==o){var i=t[n];i&&!e.validatePhone(i)&&a.push(o)}}),a.length>0){var o=_.find(e.contactColumns,function(e){return"phone"===e.value});o.errorRows.length>0?(o.errorRows=_.union(a,o.errorRows),e.errorRows=_.union(o.errorRows,e.errorRows)):(o.errorRows=a,e.errorRows.length>0?e.errorRows=_.union(a,e.errorRows):e.errorRows=a)}t&&t()};var m=new o({url:"/api/1.0/assets/",filters:[]});e.uploader=m,m.onAfterAddingFile=function(t){e.csvUploaded([t._file])},e.contactColumns=[{name:"First Name",value:"first",match:"",known:["given name","first name","first"],errorRows:[]},{name:"Middle Name",value:"middle",match:"",known:["addtional name","middle","middle name"],errorRows:[]},{name:"Last Name",value:"last",match:"",known:["family name","last","last name"],errorRows:[]},{name:"Email Address",value:"email",match:"",known:["e-mail 1 - value","email","email address","e-mail","e-mail address"],errorRows:[]},{name:"Phone Number",value:"phone",match:"",known:["phone 1 - value","phone","business phone","personal phone","phone number","number"],errorRows:[]},{name:"Website URL",value:"website",match:"",known:["website","web page","url","site","site url"],errorRows:[]},{name:"Company Name",value:"company",match:"",known:["company","company name"],errorRows:[]},{name:"Gender",value:"gender",match:"",known:["gender","sex"],errorRows:[]},{name:"Birthday",value:"birthday",match:"",known:["birthday","bday","b-day","dob","date of birth"],errorRows:[]},{name:"Tags",value:"tags",match:"",known:[],errorRows:[]},{name:"Address",value:"address",match:"",known:["address 1 - street","address","business street"],errorRows:[]},{name:"Address 2",value:"address2",match:"",known:["address 1 - extended address","address2","business street 2"],errorRows:[]},{name:"City",value:"city",match:"",known:["address 1 - city","city","business city"],errorRows:[]},{name:"State",value:"state",match:"",known:["address 1 - region","state","business state"],errorRows:[]},{name:"Zip",value:"zip",match:"",known:["address 1 - postal code","zip","zip code","postal code","business postal code"],errorRows:[]}];var g={first:"",middle:"",last:"",birthday:"",gender:"",details:[{_id:Math.uuid(8),source:"csv",location:"",emails:[],photos:{square:"",small:"",medium:"",large:""},websites:[],company:"",phones:[],addresses:[{_id:Math.uuid(8),type:"w",address:"",address2:"",city:"",state:"",zip:"",country:"",countryCode:"",displayName:"",lat:"",lon:"",defaultShipping:!1,defaultBilling:!1}]}],extra:[]};e.addmorefields=function(){var t={name:"Custom"+e.counter,value:"qa"+(e.counter+1),label:"Custom"+e.counter,match:"",flag:"custom",known:["custom","extra","additional"],errorRows:[]};e.contactColumns.push(t),e.counter++},e.guessHeaders=function(t){_.each(e.contactColumns,function(t){var n={value:"",percent:0};_.each(e.csvHeaders,function(e){var a=t.value,o=e.replace(new RegExp("[^a-zA-Z ]"),"").toLowerCase();if(t.known.indexOf(e.toLowerCase())>-1)n.value=e,n.percent=1;else{var i=o.score(a);i>n.percent&&(n.value=e,n.percent=i)}}),n.percent>=0&&(t.match=n.value)}),e.updatePreview(),t&&t()},e.csvResults=[],e.uploadingCsv=!1;var f;e.endUpload=0;var h=[];e.csv={percent:0},e.previewContact={},e.currentRow=1;var v;e.alerts=[],e.errorRows=[],e.csvComplete=function(t){n(function(){e.uploadingCsv=!1,e.csvHeaders=t.data[0],e.csvResults=t.data,e.guessHeaders(function(){e.validateEmails(function(){e.validatePhones(function(){})})});var n=(new Date-f)/1e3;e.endUpload=n.toFixed(2)},2500)},e.changeFile=function(){e.csvHeaders=[],e.csvResults=[],e.previewContact={},e.currentRow=1,f=0,e.endUpload=0,_.each(e.contactColumns,function(e){e.match="",e.index=""}),h=[],e.csv.percent=0},e.increaseRow=function(){e.currentRow<e.csvResults.length-1&&(e.currentRow=e.currentRow+1,e.updatePreview())},e.decreaseRow=function(){e.currentRow>1&&(e.currentRow=e.currentRow-1,e.updatePreview())},e.goToRow=function(t){e.currentRow=t,e.updatePreview(),e.showPreviewPulse=!0,n(function(){e.showPreviewPulse=!1},1e3)},e.updatePreviewSelection=function(t){n(function(){e.updatePreview(t)},1e3)},e.updatePreview=function(t){var n=p("filter")(e.contactColumns,{flag:"Custom"});g.extra=[];for(var a=0;a<n.length;a++)g.extra.push(n[a]);var o=angular.copy(t);t&&!t.match&&(t.index=null);var i,s=null,r=e.formatColumns();o&&!o.match?(i=o.value,s=r[i].index,e.previewContact[i]=""):_.each(e.contactColumns,function(t){if(i=t.value,s=r[i].index,angular.isDefined(s)&&null!==s&&(e.previewContact[i]=angular.copy(e.csvResults[e.currentRow][s])),void 0!=g.extra)for(var n=0;n<g.extra.length;n++)void 0!=g.extra[n]&&g.extra[n].match==i&&(g.extra[n].value=e.previewContact[i])})},e.updateColumn=function(t,n){var a=e.formatColumns()[n.value].index;if(!isNaN(a)){e.csvResults[e.currentRow][a]=t,e.errorRows=_.reject(e.errorRows,function(t){return t===e.currentRow});var o=_.find(e.contactColumns,function(e){return e.value===n.value});o.errorRows=_.reject(o.errorRows,function(t){return t===e.currentRow})}},e.formatColumns=function(){var t=[];return _.each(e.contactColumns,function(n){var a=_.indexOf(e.csvHeaders,n.match);a>=0&&(n.index=a),t[n.value]=n}),t},e.uploadMatchedCSV=function(){v=new Date;var t=e.formatColumns(),n=[],a=["address","address2","city","state","zip","country","lat","lon"],o=["first","middle","last"],i=["gender","birthday"],r=angular.copy(g);_.each(e.csvResults,function(s,c){0!==c&&(_.each(e.contactColumns,function(e){var n=e.value,c=t[n].index,l=s[c];if(void 0!=l){var d=t[n].value,p=r.details[0];if(a.indexOf(n)>-1&&(p.addresses[0][n]=l),"email"===d){var m={_id:Math.uuid(8),email:l};p.emails.push(m)}if("phone"===d){var g={_id:Math.uuid(8),number:l};p.phones.push(g)}if("custom"===e.flag&&(_.findWhere(r.extra,{index:e.index}).value=l),"website"===d){var f={_id:Math.uuid(8),website:l};p.websites.push(f)}if("company"===d&&(p.company=l),i.indexOf(n)>-1&&(r[n]=l),o.indexOf(n)>-1&&(r[n]=l),"tags"===d){var h=u.contact_tags.dp,v=l.split("|"),b=[];_.each(v,function(e,t){if(e){var n=_.filter(h,function(t){return t.data.toLowerCase()==e.toLowerCase()||t.label.toLowerCase()==e.toLowerCase()});n&&n.length?b.push(n[0].data):b.push(e)}}),b.length&&(r[n]=b)}}}),n.push(r),r=angular.copy(g))}),e.uploadingServerCsv=!0,s.resetCount(),s.importCsvContacts(n,function(){})},e.$on("importingContacts",function(t,n){if(e.serverUploadPercent=Math.round(n.current/n.total*100),n.current===n.total){e.uploadingComplete=!0;var a=(new Date-v)/1e3;e.endServerUpload=a.toFixed(2),e.getContacts()}}),e.validateEmails=function(t){var n=e.formatColumns().email.index,a=[];if(_.each(e.csvResults,function(t,o){if(0!==o){var i=t[n];e.validateEmail(i)||a.push(o)}}),a.length>0){var o=_.find(e.contactColumns,function(e){return"email"===e.value});o.errorRows.length>0?(o.errorRows=_.union(a,o.errorRows),e.errorRows=_.union(o.errorRows,e.errorRows)):(o.errorRows=a,e.errorRows.length>0?e.errorRows=_.union(a,e.errorRows):e.errorRows=a)}t&&t()},e.closeAlert=function(t){e.alerts.splice(t,1)};var b=["text/csv","application/vnd.ms-excel","application/msexcel","application/x-msexcel","application/x-ms-excel","application/x-excel","application/x-dos_ms_excel","application/xls","application/x-xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"];e.csvUploaded=function(t){function a(n){e.incorrectFileType=!0,e.incorrectFile=t[0],e.$apply()}function o(){f=new Date,e.fileName=t[0].name,e.uploadingCsv=!0;var o={delimiter:"",newline:"",header:!1,dynamicTyping:!1,preview:0,encoding:"",worker:!1,comments:!1,complete:function(t,n){t.data=h,e.csvComplete(t,n)},step:function(a){h.push(a.data[0]);var o=a.meta.cursor,i=Math.round(o/t[0].size*100);i!==e.csv.percent&&n(function(){e.csv.percent=i,e.$apply()})},error:a,download:!1,skipEmptyLines:!0,keepEmptyRows:!1,chunk:void 0,fastMode:void 0,beforeFirstChunk:void 0};n(function(){Papa.parse(t[0],o)},1e3)}var i=[],s=[],r=!1;e.errorRows=[],e.incorrectFileType=!1,b.indexOf(t[0].type)>-1?o():Papa.parse(t[0],{step:function(t,n){i.push(t.data[0].length),5===i.length&&(s=i.filter(function(e){return e===i[0]}),(r=i[0]>1&&i.length===s.length)?o():a(),n.abort(),e.$apply())},error:function(e){a(e)},fastMode:!0})}}]),app.controller("MediaModalCtrl",["$scope","mediaManagerConstant","$injector","$modalInstance","$http","$timeout","FileUploader","AssetsService","ToasterService","showInsert","insertMedia","isSingleSelect","SweetAlert","$window","AccountService","editableOptions",function(e,t,n,a,o,i,s,r,c,l,u,d,p,m,g,f){function h(t){r.getPagedAssetsByAccount(e.pagingParams,function(n){if(n.results instanceof Array){if(e.originalAssets=n.results,e.assets=n.results,e.assetsCount=n.total,y(),1!=e.batch.length||t||e.assets.forEach(function(t){e.batch[0]._id===t._id&&(t.checked=!0)}),e.selectModel.select_all&&(e.m.selectAll(),e.singleSelected=!1),t){var a=_.find(e.assets,function(e){return e._id==t._id});a&&(a.checked=!0,e.m.singleSelect(a))}e.pageLoading=!1,i(function(){e.loadingAssets=!1},0)}})}function v(){if(S){S.css("height",angular.element(m).height()-30+"px"),k.css("height",angular.element(m).height()-30+"px"),e.bodyHeight=angular.element(m).height()-210+"px";var t=$(".filter-type");i(function(){t.removeClass("filter-type")},0),i(function(){t.addClass("filter-type")},0)}}function b(){e.pagingParams.curPage=1,e.pagingParams.skip=0,e.pageLoading=!0}function y(){var t,n,a=1,o=(e.pagingParams.curPage,e.assetsCount,e.pagingParams.curPage),i=w();for((t=(a=Math.max(a,o-Math.abs(Math.floor(e.pagingParams.showPages/2))))+e.pagingParams.showPages)>i&&(t=i+1,a=Math.max(1,t-e.pagingParams.showPages)),e.pages=[],n=a;n<t;n++)e.pages.push(n)}function w(){return e.assets?Math.ceil(e.assetsCount/e.pagingParams.limit):0}var C,S,k;e.showInsert=l,e.loadingAssets=!0,e.maximumUploadItems=20,e.cachebuster=(new Date).getTime(),e.mediaModal={replace:!1,asset:null},e.paging={recordPerPage:t.numberOfRowsPerPage},e.numberOfPages=w,e.selectPage=function(t){t!=e.pagingParams.curPage&&(e.pagingParams.curPage=t,e.pagingParams.skip=(t-1)*e.pagingParams.limit,e.pageLoading=!0,h())},e.refreshPaging=function(t){e.pagingParams.limit=t,b(),h()},e.pagingParams={limit:e.paging.recordPerPage,skip:0,curPage:1,showPages:t.displayedPages,filterType:e.insertMediaType||e.showType},f.theme="bs3",g.getAccount(function(t){e.account=t,h()}),e.successCopy=function(){c.show("success","Successfully copied text to your clipboard! Now just paste it wherever you would like.")},e.replaceAssetFn=function(t,n){e.mediaModal={replace:t,asset:n}},e.closeModal=function(){i(function(){a.close(),angular.element(".modal-backdrop").remove()})},(C=e.uploader=new s({url:"/api/1.0/assets/",removeAfterUpload:!0,filters:[{name:"SizeLimit",fn:function(e){switch(e.type.substring(0,e.type.indexOf("/"))){case"video":if(524288001>parseInt(e.size))return!0;c.show("error","The maximum video file size 500MB. Unable to Upload.");break;case"image":case"audio":if(52428800>parseInt(e.size))return!0;c.show("error","The maximum audio file size 50MB. Unable to Upload.");break;case"document":default:if(10485760>parseInt(e.size))return!0;c.show("error","The maximum file size 10MB. Unable to Upload.")}return!1}}]})).onBeforeUploadItem=function(t){e.mediaModal.asset?t.formData.push({replace:e.mediaModal.replace,assetToBeReplaced:e.mediaModal.asset._id}):t.formData.push({replace:e.mediaModal.replace,assetToBeReplaced:""})},C.filters.push({name:"customFilter",fn:function(t,n){return this.queue.length<e.maximumUploadItems?e.maxLengthExceed=!1:e.maxLengthExceed=!0,this.queue.length<e.maximumUploadItems}}),C.onSuccessItem=function(t,n,a,o){e.uploadComplete=!1,e.selectModel.select_all=!1;var i=t.file.name;if(i=i.replace(/ /g,"_"),n.files[0].filename=i,n.files[0].mimeType=t.file.type,e.mediaModal.replace){if(e.mediaModal.asset){e.cachebuster=(new Date).getTime(),n.files[0].filename=e.mediaModal.asset.filename;var s=_.findWhere(e.originalAssets,{_id:e.mediaModal.asset._id}),r=_.findWhere(e.assets,{_id:e.mediaModal.asset._id});_.extend(s,n.files[0]),_.extend(r,n.files[0]),s.checked=!0,r.checked=!0,e.m.singleSelect(r),c.showWithTitle("success","Replacement image has been uploaded","By default, images are cached by the browser for 24 hours. Flush your browser cache to see the latest media (or wait)")}}else C.queue.length<=1&&(b(),h(n.files[0]))},C.onErrorItem=function(t,n,a,o){e.uploadComplete=!1,c.show("error","Connection timed out")},angular.element(m).resize(function(){v()}),e.lastSelect=null,e.isSingleSelect=d,e.showType="all",u&&"insertVideoMedia"===u.name&&(e.showType="video"),e.editingImage=!1,e.selectModel={select_all:!1},e.batch=[],e.m=e.m||{},e.isMobile=!1,e.checkMobile=function(){var t=!1;return function(e,n){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||m.opera),e.isMobile=t,t},e.checkMobile(),e.typeMimes={image:["image/png","image/jpeg","image/gif","image/*"],video:["video/mpeg","video/mp4","video/webm","video/x-flv","video/x-ms-wmv","video/*"],audio:["audio/mpeg","audio/mp3","audio/*"],document:["application/octet-stream","application/pdf","text/plain"]},e.getFileType=function(e){return e.match("audio.*")?"audio":e.match("video.*")?"video":e.match("image.*")?"image":"application/pdf"===e?"pdf":"application/octet-stream"===e||"text/plain"===e?"octet-stream":void 0},e.m.selectTriggerFn=function(t){e.selectModel.select_all=t,e.m.selectAll(),e.singleSelected=!1},e.m.selectAll=function(t,n){n=n||!1,t&&(e.showType=t),e.batch=[],e.assets=[],e.mimeList=[],"all"!==e.showType&&(e.mimeList=e.typeMimes[e.showType]),e.originalAssets.forEach(function(t,a){n||(t.checked=e.selectModel.select_all),"all"===e.showType?(e.assets.push(t),t.checked&&e.batch.push(t)):(e.mimeList.indexOf(t.mimeType)>-1||e.getFileType(t.mimeType)===e.showType)&&(e.assets.push(t),t.checked&&e.batch.push(t))}),e.lastSelect=null,e.m.selectAllStatus()},e.m.filterAssets=function(t){t&&(e.showType=t),b(),e.pagingParams.filterType=t,h()},e.m.singleSelect=function(t){e.singleSelected=t.checked,i(function(){if(e.isSingleSelect&&e.singleSelected&&!e.selectModel.select_all)e.isSingleSelect&&(e.batch.forEach(function(e){t._id!==e._id&&(e.checked=!1)}),e.batch=[],e.singleSelected&&e.batch.push(t),e.m.selectAllStatus());else{var n=!1;e.batch.forEach(function(a,o){t._id===a._id&&(e.batch.splice(o,1),n=!0)}),n||e.batch.push(t),e.m.selectAllStatus()}},0)},e.m.toggleShiftKey=function(t){e.isSingleSelect=!e.isSingleSelect},e.m.selectAllStatus=function(){var t=!1;e.assets.length>0&&(t=!0,e.assets.forEach(function(e,n){!0!==e.checked&&(t=!1)})),e.selectModel.select_all=t},e.m.deleteAsset=function(t){angular.element(".modal.in").hide();p.swal({title:"Are you sure?",text:"Do you want to delete",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete!",cancelButtonText:"No, do not delete!",closeOnConfirm:!0,closeOnCancel:!0},function(n){if(n)if(t&&e.batch.push(t),e.batch&&e.batch.length){e.batch=_.uniq(e.batch);var a=angular.equals(e.batch.length,e.assets.length);r.deleteAssets(e.batch,function(t,n){200===n?(e.originalAssets.forEach(function(t,n){t._id===e.batch[0]._id&&e.originalAssets.splice(n,1)}),e.assets.forEach(function(t,n){t._id===e.batch[0]._id&&e.assets.splice(n,1)}),e.batch.forEach(function(t,n){t._id===e.batch[0]._id&&e.batch.splice(n,1)}),e.batch.length||(a&&b(),e.pageLoading=!0,h()),p.swal("Saved!","deleted.","success"),angular.element(".modal.in").show()):(p.swal("Error!","error deleting files.","error"),angular.element(".modal.in").show()),e.selectModel.select_all=!1,e.singleSelected=!1})}else p.swal("Error!","No file found for deletion.","error"),angular.element(".modal.in").show();else angular.element(".modal.in").show()})},e.m.editImage=function(t){e.editingImage=!0,e.singleAsset=t;$("#targetEditImage")},e.m.goback=function(){e.editingImage=!1},e.m.onInsertMedia=function(){e.batch.length>0&&(u?(e.isSingleSelect?u(e.batch[e.batch.length-1],e.type||e.insertMediaType):u(e.batch,e.type||e.insertMediaType),e.type=null):u(e.isSingleSelect?e.batch[e.batch.length-1]:e.batch)),e.m.selectTriggerFn(!1),e.singleSelected=!1,e.closeModal()},e.m.onCallbackOnMediaClose=function(){u(),e.closeModal()},e.m.onAssetUpdateCallback=function(t){var n=angular.copy(t);n.checked=!1,n.accountId=e.account._id,r.updateAsset(n,function(e,n){200==n&&(t.url=e.url,c.show("success","Asset updated."))})},e.validateAsset=function(e){if(!e)return"Please fill this field"},e.m.addRemoveAssetFromCache=function(t){var n=angular.copy(t);n.isCached=0==n.isCached,n.accountId=e.account._id,r.updateMatadata(n,function(n,a){200==a&&(e.cachebuster=(new Date).getTime(),t.url=n.url,t.isCached=n.isCached,c.show("success","Asset updated."))})},e.$watch("pagingParams.search",function(e){angular.isDefined(e)&&(b(),h())})}]),app.controller("SSBComponentSettingsModalCtrl",["$scope","$rootScope","$http","$timeout","$q","$compile","$filter","WebsiteService","ContactService","ProductService","GeocodeService","toaster","hoursConstant","CampaignService","SimpleSiteBuilderService","SweetAlert","$window","AccountService",function(e,t,n,a,o,i,s,r,c,l,u,d,p,m,g,f,h,v){function b(e){var t=[];return e.components&&e.components.length&&!e.sections.length?t=e.components:_.each(e.sections,function(e){e&&e.components&&_.each(e.components,function(n){n&&(e.components.length>1?n.sectionTitle=e.name:1===e.components.length&&e.name&&n.type&&e.name.toLowerCase()!==n.type.toLowerCase()&&(n.sectionTitle=e.name),t.push(n))})}),t}function y(t,n,a,o){"page"!==t||e.customnav||n!==e.$parent.vm.state.page.handle||(e.$parent.vm.state.page.mainmenu=a),"page"===t&&!e.customnav&&o&&o===e.$parent.vm.state.page.handle&&(e.$parent.vm.state.page.mainmenu=!1)}e.blog={},e.$parent.$watchGroup(["vm.uiState.activeSectionIndex","vm.uiState.activeComponentIndex"],function(){var t=e.$parent.vm.state.page.sections[e.$parent.vm.uiState.activeSectionIndex];t&&t.components&&t.components[e.$parent.vm.uiState.activeComponentIndex]&&(e.components=t.components,e.component=t.components[e.$parent.vm.uiState.activeComponentIndex])},!0),e.website=e.$parent.vm.state.website,e.originalWebsite=angular.copy(e.website),e.isDirty={},e.emailLoaded=!1,e.availableProductTags=[],e.barConfig={animation:0,handle:".reorder",draggable:".fragment",ghostClass:"sortable-ghost",scroll:!0,scrollSensitivity:200,scrollSpeed:20,onSort:function(e){},onStart:function(t){e.dragging=!0},onEnd:function(t){e.dragging=!1,a(function(){e.updateSubIndex()},1e3)}},e.testOptions={min:5,max:100,step:5,precision:2,orientation:"horizontal",handle:"round",tooltip:"show",tooltipseparator:":",tooltipsplit:!1,enabled:!0,naturalarrowkeys:!1,range:!1,ngDisabled:!1,reversed:!1},e.sliderValue=1,e.addBackground=function(){e.$parent.showInsert=!0,e.openParentModal("media-modal","MediaModalCtrl",null,"lg")},e.addFeaturedPost=function(){e.$parent.showInsert=!0,e.blogImage.featured_image=!0,e.openParentModal("media-modal","MediaModalCtrl",null,"lg")},e.revertComponent=function(){"navigation"===e.component.type&&(e.website.linkLists=e.originalWebsite.linkLists),e.blog.post&&e.originalBlog&&(e.blog.post.featured_image=e.originalBlog.featured_image,e.blog.post.post_excerpt=e.originalBlog.post_excerpt),e.components[clickedIndex]=e.originalComponent,a(function(){angular.element(h).trigger("resize")},0),e.closeModal()},e.spectrum={options:{showPalette:!0,clickoutFiresChange:!0,showInput:!0,showButtons:!1,allowEmpty:!0,hideAfterPaletteSelect:!1,showPaletteOnly:!0,togglePaletteOnly:!0,togglePaletteMoreText:"more",togglePaletteLessText:"less",preferredFormat:"hex",appendTo:"body",palette:[["#C91F37","#DC3023","#9D2933","#CF000F","#E68364","#F22613","#CF3A24","#C3272B","#8F1D21","#D24D57"],["#f47998","#F47983","#DB5A6B","#C93756","#FCC9B9","#FFB3A7","#F62459","#F58F84","#875F9A","#5D3F6A"],["#89729E","#763568","#8D608C","#A87CA0","#5B3256","#BF55EC","#8E44AD","#9B59B6","#BE90D4","#4D8FAC"],["#5D8CAE","#22A7F0","#19B5FE","#59ABE3","#48929B","#317589","#89C4F4","#4B77BE","#1F4788","#003171"],["#044F67","#264348","#7A942E","#8DB255","#5B8930","#6B9362","#407A52","#006442","#87D37C","#26A65B"],["#26C281","#049372","#2ABB9B","#16A085","#36D7B7","#03A678","#4DAF7C","#D9B611","#F3C13A","#F7CA18"],["#E2B13C","#A17917","#F5D76E","#F4D03F","#FFA400","#E08A1E","#FFB61E","#FAA945","#FFA631","#FFB94E"],["#E29C45","#F9690E","#CA6924","#F5AB35","#BFBFBF","#F2F1EF","#BDC3C7","#ECF0F1","#D2D7D3","#757D75"],["#EEEEEE","#ABB7B7","#6C7A89","#95A5A6"]]}},e.componentTypes=[{title:"Blog",type:"blog",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/blog.png",filter:"blog",description:"Use this component for your main blog pages which displays all your posts with a sidebar of categories, tags, recent posts, and posts by author.",enabled:!0},{title:"Blog Teaser",type:"blog-teaser",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/blog-teaser.png",filter:"blog",description:"The Blog Teaser is perfect to showcase a few of your posts with a link to you full blog page.",enabled:!0},{title:"Masthead",type:"masthead",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/masthead.jpg",filter:"misc",description:"Introduce your business with this component on the top of your home page.",enabled:!0},{title:"Feature List",type:"feature-list",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/feature-list.jpg",filter:"features",description:"Showcase what your business offers with a feature list.",enabled:!0},{title:"Contact Us",type:"contact-us",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/contact-us.jpg",filter:"contact",description:"Let your visitors where your located, how to contact you, and what your business hours are.",enabled:!0},{title:"Coming Soon",type:"coming-soon",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/coming-soon.jpg",filter:"misc",description:"Even if your site isn't ready you can use this component to let your visitors know you will be availiable soon.",enabled:!0},{title:"Feature block",type:"feature-block",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/feature-block.jpg",filter:"features",description:"Use this component to show one important feature or maybe a quote.",enabled:!0},{title:"Image Gallery",type:"image-gallery",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/gallery.jpg",filter:"images",description:"Display your images in this image gallery component with fullscreen large view.",enabled:!0},{title:"Image Text",version:1,type:"image-text",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/image-text.jpg",filter:"images",description:"Show an image next to a block of text on the right or the left.",enabled:!0},{title:"Meet Team",type:"meet-team",icon:"fa fa-users",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/meet-team.png",filter:"team",description:"Let your visitors know about the team behind your business. Show profile image, position, bio, and social links for each member.",enabled:!0},{title:"Navigation 1",type:"navigation",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/navbar-v1.jpg",filter:"navigation",description:"A simple navigation bar with the logo on the left and nav links on the right. Perfect for horizontal logos.",version:1,enabled:!0},{title:"Navigation 2",type:"navigation",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/nav-v2-preview.png",filter:"navigation",description:"If your logo is horizontal or square, this navigation will showcase your logo perfectly with addtional space for more links.",version:2,enabled:!0},{title:"Navigation 3",type:"navigation",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/nav-v3-preview.png",filter:"navigation",description:"This navigation features a large block navigation links for a modern feel.",version:3,enabled:!0},{title:"Products",type:"products",icon:"fa fa-money",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/products.png",filter:"products",description:"Use this as the main products page to start selling. It comes together with a cart and checkout built in.",enabled:!0},{title:"Pricing Tables",type:"pricing-tables",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/pricing-tables.png",filter:"products",description:"Subscription product types with multiple options are best when shown in a pricing table to help the visitor decide which one is best for them.",enabled:!0},{title:"Simple form",type:"simple-form",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/simple-form.jpg",filter:"forms",description:"Automatically create contacts in the backend when a visitor submits this form. Add first name, last name, email, or phone number fields.",enabled:!0},{title:"Single Post",type:"single-post",icon:"custom single-post",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/45274f46-0a21-11e5-83dc-0aee4119203c.png",filter:"blog",description:"Used for single post design. This is a mandatory page used to show single posts. This will apply to all posts.",enabled:!1},{title:"Social",type:"social-link",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/social-links.jpg",filter:"social",description:"Let your visitors know where else to find you on your social networks. Choose from 18 different networks.",enabled:!0},{title:"Video",type:"video",icon:"fa fa-video",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/video.png",filter:"video",description:"Showcase a video from Youtube, Vimeo, or an uploaded one. You can simply add the url your video is currently located.",enabled:!0},{title:"Text Block",type:"text-only",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/text-block.jpg",filter:"text",description:"A full width component for a large volume of text. You can also add images within the text.",enabled:!0},{title:"Thumbnail Slider",type:"thumbnail-slider",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/thumbnail.png",filter:"images",description:"Perfect for sponsor or client logos you have worked with in the past. Works best with logos that have a transparent background. ",enabled:!0},{title:"Top Bar",type:"top-bar",icon:"fa fa-info",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/top-bar.png",filter:"contact",description:"Show your social networks, phone number, business hours, or email right on top that provides visitors important info quickly.",enabled:!0},{title:"Testimonials",type:"testimonials",icon:"fa fa-info",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/45263570-0a21-11e5-87dd-b37fd2717aeb.png",filter:"text",description:"A component to showcase your testimonials.",enabled:!0},{title:"Footer",type:"footer",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/footer.png",filter:"misc",description:"Use this component to show footer on your page.",enabled:!1}],e.componentOpacityValues=[{label:10,value:.1},{label:20,value:.2},{label:30,value:.3},{label:40,value:.4},{label:50,value:.5},{label:60,value:.6},{label:70,value:.7},{label:80,value:.8},{label:90,value:.9},{label:100,value:1}],e.removeImage=function(t){e.component&&e.component.bg&&e.component.bg.img&&(!1===e.component.bg.img.show&&!0===t||!1===t)&&(!1===t&&(e.component.bg.img.url=null),e.component.bg.img.blur=!1,e.component.bg.img.parallax=!1,e.component.bg.img.overlay=!1,e.component.bg.img.undernav=!1,e.component.bg.img.fullscreen=!1)},e.closeModal=function(){a(function(){e.$apply(function(){"contact-us"===e.component.type?e.validateGeoAddress(function(){e.errorMapData&&(e.component.location=e.originalComponent.location),e.contactHoursInvalid&&(e.component.hours=e.originalComponent.hours),$modalInstance.close(),angular.element(".modal-backdrop").remove()}):($modalInstance.close(),angular.element(".modal-backdrop").remove())})})},e.$watch("newLink.linkPage",function(t){t&&(e.currentPage=_.find(e.filteredPages,function(e){return e.handle===t}))}),e.initializeEditLinks=function(t,n,a){t.page&&(n&&(t.data=null),a&&(t.ssb=!0),e.linkPage=t.page,e.currentPage=_.find(e.filteredPages,function(e){return e.handle===t.page}))},e.selectedData=function(e,t){return e&&e.linkTo.ssb?e.linkTo.data===t._id:e&&t.anchor?e.linkTo.data===t.anchor:e.linkTo.data===t._id},e.initializeLinks=function(t){e.addLink=t,e.newLink={linkUrl:null,linkTitle:null,linkType:null,linkPage:null,ssb:!0}},e.addSubLink=function(t){var n=void 0;if(e.component.customnav?e.component.linkLists[0].links.length>t&&(n=e.component.linkLists[0].links[t]):e.website.linkLists[0].links.length>t&&(n=e.website.linkLists[0].links[t]),n){if(!(n.links&&n.links.length>0)){var o=angular.copy(n);o.sub_index=0,n.links=[o],n.label="New Parent",n.linkTo={data:g.getTempUUID(),type:"sub-nav"},y(n.linkType,n.linkTo.data,!1)}n.links.push({sub_index:n.links.length,label:"New Child",linkTo:{type:"",data:""},ssb:!0}),e.editNav[t]&&(e.editNav[t].links[n.links.length-1]={isEdit:!0}),a(function(){e.updateSubIndex()},1e3)}},e.addAsParent=function(t,n){if(e.component.customnav){o=angular.copy(e.component.linkLists[0].links[t].links[n]);e.component.linkLists[0].links[t].links.splice(n,1),e.component.linkLists[0].links.push(o)}else{var o=angular.copy(e.website.linkLists[0].links[t].links[n]);e.website.linkLists[0].links[t].links.splice(n,1),e.website.linkLists[0].links.push(o)}a(function(){e.updateSubIndex()},1e3)},e.updateSubIndex=function(){$(".subnavs").unbind("sortable").sortable({opacity:.5,handle:".sub-reorder",start:function(t,n){e.old_index=n.item.index()},update:function(t,n){e.$apply(function(){var t=parseInt(n.item.attr("parent-index")),o=e.old_index,i=n.item.index();e.component.customnav?e.component.linkLists[0].links[t]&&e.component.linkLists[0].links[t].links.length>o&&a(function(){e.component.linkLists[0].links[t].links.splice(i,0,e.component.linkLists[0].links[t].links.splice(o,1)[0]),_.each(e.component.linkLists[0].links[t].links,function(e,t){e.sub_index=t})},0):e.website.linkLists[0].links[t]&&e.website.linkLists[0].links[t].links.length>o&&a(function(){e.website.linkLists[0].links[t].links.splice(i,0,e.website.linkLists[0].links[t].links.splice(o,1)[0]),_.each(e.website.linkLists[0].links[t].links,function(e,t){e.sub_index=t})},0)})}})},e.setLinkUrl=function(){e.newLink.linkTitle=angular.element("#linkSection option:selected").html()},e.setLinkTitle=function(t,n,a){var o=t.replace("-"," "),i=e.currentPage.components[n].sectionTitle,s=_.first(angular.copy(e.currentPage.components),[n+1]),r=_.filter(s,function(e){return e.type===t});return i&&(o=i+" - "+o),r.length>1&&(i?_.filter(r,function(e){return e.sectionTitle===i}).length>1&&(o=i+" - "+(r.length-1)+" - "+o):o=o+"-"+(r.length-1)),o},e.numberOfProductOptions=[{name:"All",value:0},{name:"1",value:1},{name:"2",value:2},{name:"3",value:3},{name:"4",value:4},{name:"5",value:5},{name:"10",value:10},{name:"15",value:15},{name:"20",value:20}],e.deleteLinkFromNav=function(t,n){f.swal({title:"Are you sure?",text:"Do you want to remove this link from main menu",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, remove this link!",cancelButtonText:"No, do not remove this link!",closeOnConfirm:!0,closeOnCancel:!0},function(a){if(a){var o=n[t];y(o.linkTo.type,o.linkTo.data,!1),n.splice(t,1),e.customnav||"page"!==o.linkTo.type&&"home"!==o.linkTo.type||g.setDeletedPageFromLinkList(o.linkTo.data)}})},e.radioName=function(e,t){return"radio-"+e+"-"+t},e.deleteLinkFromSubNav=function(t,n){f.swal({title:"Are you sure?",text:"Do you want to remove this link from sub menu",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, remove this link!",cancelButtonText:"No, do not remove this link!",closeOnConfirm:!0,closeOnCancel:!0},function(a){a&&(e.component.customnav?e.component.linkLists[0].links[t]&&e.component.linkLists[0].links[t].links.length>n&&e.component.linkLists[0].links[t].links.splice(n,1):e.website.linkLists[0].links[t].links.length>n&&e.website.linkLists[0].links[t].links.splice(n,1))})},e.addLinkToNav=function(){e.newLink&&e.newLink.linkTitle&&e.newLink.linkUrl&&(e.component.customnav?(e.component.linkLists&&e.component.linkLists.length||(e.component.linkLists=[],e.component.linkLists.push({name:"Head Menu",handle:"head-menu",links:[]})),e.component.linkLists.forEach(function(t,n){"head-menu"===t.handle&&(t.links.push({label:e.newLink.linkTitle,type:"link",linkTo:{data:e.newLink.linkUrl,type:e.newLink.linkType,page:e.newLink.linkPage,ssb:!0}}),e.initializeLinks(!1))})):e.website.linkLists.forEach(function(t,n){"head-menu"===t.handle&&(t.links.push({label:e.newLink.linkTitle,type:"link",linkTo:{data:e.newLink.linkUrl,type:e.newLink.linkType,page:e.newLink.linkPage,ssb:!0}}),y(e.newLink.linkType,e.newLink.linkUrl,!0),e.initializeLinks(!1))}))},e.setPageLinkTitle=function(t,n,a,o){var i=null,s=_.findWhere(e.filteredPages,{handle:t});s&&(i=s.menuTitle||s.title),e.component.customnav||(n?(a.label=i,y(a.linkTo.type,t,!0,o)):e.newLink.linkTitle=i)},e.refreshSlider=function(){a(function(){t.$broadcast("rzSliderForceRender")},0)},e.saveComponentVersion=function(){e.$parent.vm.pendingChanges=!0,e.isDirty.dirty=!0,a(function(){angular.element(h).trigger("resize")},0)},e.saveComponent=function(){e.$parent.vm.pendingChanges=!0,e.isDirty.dirty=!0,a(function(){angular.element(h).trigger("resize")},0)},e.saveContactComponent=function(t){t?(e.contactMap.refreshMap(),e.place.address=u.stringifyAddress(e.component.location)):e.contactMap.refreshHours(),e.$parent.vm.pendingChanges=!0,e.isDirty.dirty=!0},e.saveTestimonialComponent=function(){e.$parent.vm.pendingChanges=!0,e.isDirty.dirty=!0,e.testimonialSlider.refreshSlider()},e.saveComponentChanges=function(){e.$parent.vm.pendingChanges=!0,e.isDirty.dirty=!0,a(function(){angular.element(h).trigger("resize")},0)},e.spacingArr=[{name:"Top",category:"padding",value:"paddingTop",icon:"long-arrow-up"},{name:"Bottom",category:"padding",value:"paddingBottom",icon:"long-arrow-down"},{name:"Right",category:"padding",value:"paddingRight",icon:"long-arrow-right"},{name:"Left",category:"padding",value:"paddingLeft",icon:"long-arrow-left"},{name:"Top",category:"margin",value:"marginTop",icon:"long-arrow-up"},{name:"Bottom",category:"margin",value:"marginBottom",icon:"long-arrow-down"},{name:"Right",category:"margin",value:"marginRight",icon:"long-arrow-right"},{name:"Left",category:"margin",value:"marginLeft",icon:"long-arrow-left"}],e.resolutions=[320,360,480,720,768,960,1024,1280,1360,1366,1440,1600,1680,1920,"100%"],e.editComponent=function(){if(e.component){var n;if(e.component.bg||(e.component.bg={}),e.component.bg&&!angular.isDefined(e.component.bg.opacity)&&(e.component.bg.opacity=1),e.component.bg&&e.component.bg.img&&!angular.isDefined(e.component.bg.img.overlayopacity)&&(e.component.bg.img.overlayopacity=1),"navigation"===e.component.type){n=_.findWhere(e.componentTypes,{type:e.component.type,version:parseInt(e.component.version,10)}),e.editNav=[];(e.component.customnav?e.component.linkLists[0].links:e.website.linkLists[0].links).forEach(function(t,n){e.editNav[n]={isEdit:!1,links:[]},t.links&&t.links.forEach(function(t,a){e.editNav[n].links[a]={isEdit:!1}})})}else n=_.findWhere(e.componentTypes,{type:e.component.type});if(n&&n.icon&&(e.component.icon=n.icon),n&&n.title&&(e.component.header_title=n.title),"simple-form"===e.component.type)for(e.component.fields.length||e.component.fields.push({display:"First Name",value:!1,name:"first"},{display:"Last Name",value:!1,name:"last"},{display:"Phone Number",value:!1,name:"phone"}),e.component.redirectType||(e.component.redirectType="page"),e.fieldsCount=[],o=0;o<=e.component.fields.length;o++)e.fieldsCount.push(o+1);e.alignmentOptions=["left","center","right"],e.fontSizeOptions=[8,9,10,11,12,14,18,24,30,36,48,60,72,96],"contact-us"===e.component.type&&(e.hours=p,angular.isDefined(e.component.boxOpacity)||(e.component.boxOpacity=1),e.place.address=u.stringifyAddress(e.component.location),e.originalContactMap=angular.copy(e.component.location),e.component.hours&&_.each(e.component.hours,function(e,t){"Sat"!==e.day&&"Sun"!==e.day||(""===e.start&&(e.start="9:00 am"),""===e.end&&(e.end="5:00 pm"),e.start2&&""!==e.start2||(e.start2="9:00 am"),e.end2&&""!==e.end2||(e.end2="9:00 am"))}))}e.contactHoursInvalid=!1,e.contactHours=[];var o=0;for(o;o<=6;o++)e.contactHours.push({valid:!0});e.component&&r.getComponentVersions(e.component.type,function(t){e.componentVersions=t,e.component&&e.component.version&&(e.component.version=e.component.version.toString(),e.versionSelected=e.component.version),e.originalCurrentPage=angular.copy(e.currentPage)}),angular.element("#feature-convert").iconpicker({iconset:"fontawesome",icon:"fa-credit-card",rows:5,cols:5,placement:"right"}),angular.element("#feature-convert").on("change",function(t){e.featureIcon||(e.featureIcon={}),e.featureIcon&&(e.featureIcon.icon=t.icon)}),a(function(){t.$broadcast("rzSliderForceRender"),e.originalComponent=angular.copy(e.component)},1e3)};var w={street_number:"short_name",route:"long_name",locality:"long_name",administrative_area_level_1:"short_name",postal_code:"short_name",country:"short_name"};e.setDefaultAddress=function(){e.component.location.address="",e.component.location.address2="",e.component.location.city="",e.component.location.state="",e.component.location.zip="",e.component.location.country=""},e.fillInAddress=function(t){e.setDefaultAddress();var n,a,o=0;for(o;o<t.address_components.length;o++)n=t.address_components[o].types[0],w[n]&&(a=t.address_components[o][w[n]],"street_number"===n?e.component.location.address=a:"route"===n?e.component.location.address2=a:"locality"===n?e.component.location.city=a:"administrative_area_level_1"===n?e.component.location.state=a:"postal_code"===n?e.component.location.zip=a:"country"===n&&(e.component.location.country=a));e.component.location.lat=t.geometry.location.lat(),e.component.location.lon=t.geometry.location.lng()},e.$watch("place.address",function(t){t&&angular.isObject(t)&&(e.fillInAddress(t),e.locationAddress=t,e.setLatLon(),e.validateGeoAddress())}),e.slugifyAnchor=function(t){t&&(e.component.anchor=s("slugify")(t))},e.init=function(){v.getAccount(function(t){g.getPagesWithSections().then(function(n){var o=n.data;o=o.filter(function(e){return"blog-post"!==e.handle&&"single-post"!==e.handle&&"coming-soon"!==e.handle});var i=_.findWhere(o,{handle:"blog-list"});t.showhide.blog?t.showhide.blog&&t.showhide.ssbBlog&&i?(o=o.filter(function(e){return"blog"!==e.handle}),i.handle="blog"):t.showhide.ssbBlog||(o=o.filter(function(e){return"blog-list"!==e.handle})):o=o.filter(function(e){return"blog-list"!==e.handle&&"blog"!==e.handle}),e.allPages=angular.copy(o),e.filteredPages=s("orderBy")(o,"title",!1),_.each(e.filteredPages,function(e){e.components=b(e)}),e.linkPage&&(e.currentPage=_.find(e.filteredPages,function(t){return t.handle===e.linkPage})),a(function(){e.updateSubIndex()},1e3)})}),r.getEmails(!1,function(t){if(e.emails=t,e.emailLoaded=!0,e.component&&"simple-form"===e.component.type&&!e.component.emailId){var n=_.find(t,function(e){return"welcome-aboard"===e.handle});n&&(e.component.emailId=n._id)}}),m.getCampaigns(function(t){e.campaigns=_.filter(t,function(e){return"COMPLETED"===e.status})}),l.getProducts(function(t){e.products=t;var n=[];_.each(t,function(e){"active"===e.status&&e.tags&&e.tags.length>0&&_.each(e.tags,function(e){n.push(e)})}),_.uniq(n),n=_.map(n,function(e){return e.toLowerCase()}),e.availableProductTags=_.uniq(n),e.availableProductTagsString=e.availableProductTags.join(",")}),c.getContactTags(function(t){e.contactTags=t}),e.editComponent(),a(function(){e.updateSubIndex()},1e3)},a(e.init,500)}]),app.controller("TemplateSettingsModalCtrl",["$scope","$document","$modalInstance","$timeout","WebsiteService","toaster","components","clickedIndex",function(e,t,n,a,o,i,s,r){e.components=s,e.clickedIndex=r,e.saveLoading=!1,e.addBackground=function(){e.$parent.showInsert=!0,e.openParentModal("media-modal","MediaModalCtrl",null,"lg")}}]),app.controller("nestableCtrl",["$scope",function(e){e.mdl=[{item:{text:"Products"},children:[{item:{text:"Features"},children:[]},{item:{text:"Gallery"},children:[]},{item:{text:"Plans"},children:[{item:{text:"Purchase"},children:[]},{item:{text:"Confirmation"},children:[]}]}]},{item:{text:"About Us"},children:[{item:{text:"Executive Team"},children:[]},{item:{text:"Corporate Responsibility"},children:[]}]},{item:{text:"Careers"},children:[{item:{text:"Search Jobs"},children:[]},{item:{text:"Events"},children:[]}]},{item:{text:"Contact Us"},children:[]}]}]);var data=[{id:1,name:"Batman",alias:"Bruce Wayne",publisher:"DC Comics",gender:"male",power:37},{id:2,name:"Superman",alias:"Clark Kent",publisher:"DC Comics",gender:"male",power:94},{id:3,name:"Catwoman",alias:"Selina Kyle",publisher:"DC Comics",gender:"female",power:24},{id:4,name:"Spider-Man",alias:"Peter Benjamin Parker",publisher:"Marvel Comics",gender:"male",power:58},{id:5,name:"Banshee",alias:"Sean Cassidy",publisher:"Marvel Comics",gender:"male",power:60},{id:6,name:"Black Mamba",alias:"Tanya Sealy",publisher:"Marvel Comics",gender:"female",power:78},{id:7,name:"Batgirl",alias:"Mary Elizabeth Kane",publisher:"DC Comics",gender:"female",power:12},{id:8,name:"Blade",alias:"Eric Brooks",publisher:"Marvel Comics",gender:"male",power:33},{id:9,name:"Captain America",alias:"Steven Grant Rogers",publisher:"Marvel Comics",gender:"male",power:46},{id:10,name:"Lex Luthor",alias:"Alexander 'Lex' Joseph Luthor",publisher:"DC Comics",gender:"male",power:10},{id:11,name:"Marvel Girl",alias:"Rachel Anne Summers",publisher:"Marvel Comics",gender:"female",power:95},{id:12,name:"Penguin",alias:"Oswald Chesterfield Cobblepot",publisher:"DC Comics",gender:"male",power:30},{id:13,name:"Rogue",alias:"Anna Marie",publisher:"Marvel Comics",gender:"female",power:80}];app.controller("ngTableCtrl",["$scope","ngTableParams",function(e,t){e.tableParams=new t({page:1,count:5},{total:data.length,getData:function(e,t){e.resolve(data.slice((t.page()-1)*t.count(),t.page()*t.count()))}})}]),app.controller("ngTableCtrl2",["$scope","$filter","ngTableParams",function(e,t,n){e.tableParams=new n({page:1,count:5,sorting:{name:"asc"}},{total:data.length,getData:function(e,n){var a=n.sorting()?t("orderBy")(data,n.orderBy()):data;e.resolve(a.slice((n.page()-1)*n.count(),n.page()*n.count()))}})}]),app.controller("ngTableCtrl3",["$scope","$filter","ngTableParams",function(e,t,n){e.tableParams=new n({page:1,count:5,filter:{name:"M"}},{total:data.length,getData:function(n,a){var o=a.filter()?t("filter")(data,a.filter()):data;e.users=o.slice((a.page()-1)*a.count(),a.page()*a.count()),a.total(o.length),n.resolve(e.users)}})}]),app.controller("ngTableCtrl4",["$scope","$filter","ngTableParams",function(e,t,n){e.tableParams=new n({page:1,count:10},{total:data.length,getData:function(e,n){var a=n.sorting()?t("orderBy")(data,n.orderBy()):data;e.resolve(a.slice((n.page()-1)*n.count(),n.page()*n.count()))}})}]),app.controller("ngTableCtrl5",["$scope","$filter","ngTableParams",function(e,t,n){e.tableParams=new n({page:1,count:10},{total:data.length,getData:function(e,n){var a=n.sorting()?t("orderBy")(data,n.orderBy()):data;e.resolve(a.slice((n.page()-1)*n.count(),n.page()*n.count()))}})}]),app.controller("ngTableCtrl6",["$scope","$filter","ngTableParams",function(e,t,n){var a=[{id:1,lm:138661285100,ln:"Smith",fn:"John",dc:"CEO",em:"j.smith@company.com",ph:"617-321-4567",ac:!0,dl:!1},{id:2,lm:138661285200,ln:"Taylor",fn:"Lisa",dc:"VP of Marketing",em:"l.taylor@company.com",ph:"617-522-5588",ac:!0,dl:!1},{id:3,lm:138661285300,ln:"Jones",fn:"James",dc:"VP of Sales",em:"j.jones@company.com",ph:"617-589-9977",ac:!0,dl:!1},{id:4,lm:138661285400,ln:"Wong",fn:"Paul",dc:"VP of Engineering",em:"p.wong@company.com",ph:"617-245-9785",ac:!0,dl:!1},{id:5,lm:138661285500,ln:"King",fn:"Alice",dc:"Architect",em:"a.king@company.com",ph:"617-244-1177",ac:!0,dl:!1},{id:6,lm:138661285600,ln:"Brown",fn:"Jan",dc:"Software Engineer",em:"j.brown@company.com",ph:"617-568-9863",ac:!0,dl:!1},{id:7,lm:138661285700,ln:"Garcia",fn:"Ami",dc:"Software Engineer",em:"a.garcia@company.com",ph:"617-327-9966",ac:!0,dl:!1},{id:8,lm:138661285800,ln:"Green",fn:"Jack",dc:"Software Engineer",em:"j.green@company.com",ph:"617-565-9966",ac:!0,dl:!1},{id:9,lm:138661285900,ln:"Liesen",fn:"Abraham",dc:"Plumber",em:"a.liesen@company.com",ph:"617-523-4468",ac:!0,dl:!1},{id:10,lm:138661286e3,ln:"Bower",fn:"Angela",dc:"Product Manager",em:"a.bower@company.com",ph:"617-877-3434",ac:!0,dl:!1},{id:11,lm:138661286100,ln:"Davidoff",fn:"Fjodor",dc:"Database Admin",em:"f.davidoff@company.com",ph:"617-446-9999",ac:!0,dl:!1},{id:12,lm:138661286200,ln:"Vitrovic",fn:"Biljana",dc:"Director of Communications",em:"b.vitrovic@company.com",ph:"617-111-1111",ac:!0,dl:!1},{id:13,lm:138661286300,ln:"Valet",fn:"Guillaume",dc:"Software Engineer",em:"g.valet@company.com",ph:"617-565-4412",ac:!0,dl:!1},{id:14,lm:138661286400,ln:"Tran",fn:"Min",dc:"Gui Designer",em:"m.tran@company.com",ph:"617-866-2554",ac:!0,dl:!1}];e.tableParams=new n({page:1,count:10},{total:a.length,getData:function(e,n){var o=n.sorting()?t("orderBy")(a,n.orderBy()):a;e.resolve(o.slice((n.page()-1)*n.count(),n.page()*n.count()))}}),e.editId=-1,e.setEditId=function(t){e.editId=t}}]),angular,app.controller("OldHelpTopicsCtrl",["$scope",function(e){e.firstAccordionControl={onExpand:function(e){},onCollapse:function(e){}},e.panes=[{header:"Can I use my own domain name?",content:"Yes! No need to go changing all of those business cards! Please send a request via chat or email to info@indigenous.io.",category:"Website"},{header:"Can I use my existing website?",content:"No. For you to be able to utilize all of the cool integrated features we have, your site needs to be built on the Indigenous platform. However, you can customize our templates to get a feel very similar to your existing website. Or, try something fresh and give your site a makeover. Remember, you can always easily make changes.",category:"Website"},{header:"Will I lose all of my content and blog posts?",content:"Not at all. You can upload your content and media to use in our templates. We can also move your blog posts over for you; just sent us a request via chat or email to info@indigenous.io.",category:"Website"},{header:"Do I need a designer to make changes to my website?",content:"Absolutely not. Using our templates and drag-and-drop technology, its easy to upload media and restructure the design of your site.",category:"Website"},{header:"How do I select a page template?",content:"Go to the Website tab, click on Themes, and select your template.",category:"Website"},{header:"How do I create a page?",content:"Go to the Website tab, click Add in the top right corner, and select Page.",category:"Website"},{header:"Can I create pages without selecting a theme?",content:"Yes. However, selecting a theme first will help you to create a cohesive site efficiently. If youre not sure where to begin, use our Getting Started Checklist.",category:"Website"},{header:"How do I create a blog post?",content:"Go to the Website tab, click Add in the top right corner, and select Post.",category:"Website"},{header:"How do I add a feature or functionality to my site thats not offered in the templates?",content:"Were working to make sure everything you need is at your fingertips, but if theres a feature you dont see, send us a request via chat or email to info@indigenous.io. We like wish lists because we know how to answer them.",category:"Website"},{header:"How do I add a new customer?",content:"Go to the Customers tab and click Add in the top right corner.",category:"Customers"},{header:"Are customers added automatically?",content:"Yes. When a visitor enters his/her email address on your site, a profile is automatically generated.",category:"Customers"},{header:"Is there a limit to how many customers I can add?",content:"No. Currently, there is no tiered membership. You can add as many customers as you like.",category:"Customers"},{header:"Can I import/export my existing contact data?",content:"Yes. You can import your contacts from Facebook, LinkedIn, and Google+). Soon, you will be able to import .csv files. If you need to export files, please send a request via chat or email to info@indigenous.io.",category:"Customers"},{header:"How can I tag customers with labels?",content:"All customers are automatically tagged as Lead. You can then go in and edit that label, which allows for targeted communication and marketing. Soon, you will be able to have multiple labels for each customer.",category:"Customers"},{header:"Can I add variables/fields in customer profiles? ",content:"Indigenous tracks all of the activities of your customers in their respective profiles, but if theres additional field that youd like to see, please send a request via chat or email to info@indigenous.io.",category:"Customers"},{header:"How do I see my customers in a list?",content:"Go the Customers tab, click on the gear (Settings) icon in the top right corner, and select List under Default View.",category:"Customers"},{header:"How do I add products?",content:"Go to the Commerce tab, click Add in the top right corner, and fill in the fields. These products will not be visible on your site until you have added a store page with the products component under the Website tab.",category:"Commerce"},{header:"How do I add a store to my site?",content:"A store is a page on your site. Go to the Website tab, click Add in the top right corner, and select Page. Then, select a store template and add the product component. ",category:"Commerce"},{header:"What happens if I add a store before I add products?",content:"Visitors will see a message saying, Were busy getting our products ready. Please come back soon!",category:"Commerce"},{header:"What kinds of products can I add?",content:"You can add physical, digital, subscription, and external link products.",category:"Commerce"},{header:"Where can I see my customer orders?",content:"This feature is coming soon and when complete you will go the Commerce tab and click on Orders. You can also see orders in individual customer profile activity feeds and in your dashboard activity feed.",category:"Commerce"},{header:"Where does my money go?",content:"Straight into your wallet! Commerce is linked to and processed through your Stripe account.",category:"Commerce"},{header:"How do I add my social accounts?",content:"Go to the Account tab, click on Integrations, and easily connect your Facebook, LinkedIn, Twitter, and Google+ accounts.",category:"Marketing"},{header:"How do I track my social media?",content:"Go to the Marketing tab and click on Social Feed to see a collaborative filterable view of your social media activity. ",category:"Marketing"},{header:"How do I post to social media?",content:"Go to the Marketing tab and click on Social Feed to post, like, comment, edit, and delete on multiple sites, all from one place!",category:"Marketing"},{header:"Can I create targeted social media messages?",content:"You will be able to use the labels and tracked activities in your customer profiles to create targeted social media messages.",category:"Marketing"},{header:"Can I set up automated campaigns?",content:"Absolutely! You can use our campaign builder under the Marketing tab to enter your own content into smart and modifiable campaign templates. We will soon have more trigger and conditional options that allow you to send communication based on tracked customer activity (e.g. whether a specific email is opened, if no emails are opened for a certain amount of time, etc.).",category:"Marketing"},{header:"How do I know what marketing is working well?",content:"Go to your Dashboard and click on Marketing to see what campaigns and individual posts are generating leads and conversions.",category:"Marketing"},{header:"How do I send out a targeted email?",content:"Go to the Marketing tab and click on Campaigns to filter customers by label.",category:"Marketing"},{header:"How do I know what my customers are doing on my site?",content:"Go the Dashboard tab and click on Activity to see what customers are doing alongside easy-to-read summaries of your site analytics (whos visiting and how often, etc.).",category:"Dashboard"},{header:"Where can I see my site analytics?",content:"Go to the Website tab and click on Site Analytics to whos visiting and how often, etc. in easy-to-read graphs and charts.",category:"Dashboard"},{header:"Can I add additional employees?",content:"Not currently. If you require multiple users on one account, please send your request via chat or email to info@indigenous.io.",category:"Dashboard"},{header:"Can I use Indigenous on my mobile phone or device?",content:"Absolutely. You have all of the same capabilities on a mobile device that you would have on your computer.",category:"Dashboard"},{header:"Can I rearrange how my dashboard looks?",content:"Not currently, but if theres a concern, please let us know via chat or email to info@indigenous.io.",category:"Dashboard"},{header:"Where can I see my past invoices?",content:"Go to the Account tab and click on Billing.",category:"Account"},{header:"Where can I see my past invoices?",content:"Go to the Account tab and click on Billing.",category:"Account"},{header:"What happens if I cancel Indigenous?",content:"We will store your data for 30 days, and you may request export of your data, but more importantly, please let us know why youre considering canceling, and how our platform can serve you better.",category:"Account"},{header:"Can I get my money back?",content:"Your startup fee and monthly payments are non-refundable, but we are committed to making Indigenous work for you, so please send your concerns via chat or email to info@indigenous.io.",category:"Account"},{header:"What is the first thing I should do?",content:"Enter your basic personal and business information under Account information. Then, consult our Getting Started checklist and begin building your business with Indigenous.",category:"Account"},{header:"Where can I change my credit card information?",content:"Go to the Account tab and click on Billing. ",category:"Account"},{header:"What if forget my password?",content:"Click on Forgot Your Password? on the login page to have instructions for setting up a new password sent to your associated email account. If you cannot access that email account, please send a request via email to info@indigenous.io.",category:"Account"},{header:"Where can I get one-on-one support?",content:"We provide 24/7 live chat support. You can also schedule a one-on-one demo with one of our team members.",category:"Account"}]}]),angular,app.controller("OnboardingCtrl",["$scope","$window","toaster","ContactService",function(e,t,n,a){initialize()}]),function(e){app.controller("OrderDetailCtrl",["$scope","toaster","$modal","$filter","$stateParams","$location","OrderService","ContactService","UserService","ProductService","SweetAlert","orderConstant","productConstant",function(t,n,a,o,i,s,r,c,l,u,d,p,m){function g(){t.billing.sameAsBilling&&t.order.shipping_address&&t.order.billing_address&&t.order.billing_address.hasOwnProperty("address_1")&&(t.order.shipping_address=e.copy(t.order.billing_address))}function f(){var e=t.$parent.currentUser.email;return(t.$parent.currentUser.first||t.$parent.currentUser.last)&&(e=t.$parent.currentUser.first+" "+t.$parent.currentUser.last),e.trim()}t.dataLoaded=!1,t.billing={sameAsBilling:!1},t.notesEmail={enable:!1},t.showDiscount=!1,p&&(t.FailedStatus=p.order_status.FAILED),t.dateOptions={formatYear:"yy",startingDay:1},t.maxOrderDate=moment(),t.maxOrderDate.add(p.MAX_ORDER_DAYS||15,"days"),c.getContacts(function(e){t.customers=e,t.getUsers()}),t.closeModal=function(){t.modalInstance.close()},t.openModal=function(e){t.modalInstance=a.open({templateUrl:e,keyboard:!0,backdrop:"static",scope:t})},t.formatOrderStatus=function(e){return r.formatOrderStatus(e)},t.getUsers=function(){l.getUsers(function(e){t.users=e,t.getProducts()})},t.getProducts=function(){u.getProducts(function(e){t.products=e,t.activeProducts=e.filter(function(e){return e.status===m.product_status_types.ACTIVE}),t.getOrder()})},t.eliminateUsedProducts=function(){t.filterProducts=e.copy(t.activeProducts),_.each(t.order.line_items,function(e){var n=_.find(t.filterProducts,function(t){return t._id===e.product_id});if(n){var a=_.indexOf(t.filterProducts,n);a>-1&&t.filterProducts.splice(a,1)}})},t.compareAddress=function(){t.order.shipping_address&&t.order.billing_address&&t.order.billing_address.hasOwnProperty("address_1")&&e.equals(t.order.shipping_address,t.order.billing_address)&&(t.billing.sameAsBilling=!0)},t.getOrder=function(){r.getOrders(function(n){if(i.orderId){var a=_.find(n,function(e){return e._id===i.orderId});a.notes=t.matchUsers(a),a.line_items=t.matchProducts(a),t.currentStatus=a.status,a.locked=!0,t.order=a,t.eliminateUsedProducts(),t.selectedCustomer=_.find(t.customers,function(e){return e._id===t.order.customer_id}),t.compareAddress()}else t.order={created:{date:(new Date).toISOString()},order_id:n.length+1,status:"pending_payment",line_items:[],notes:[]},t.eliminateUsedProducts();t.originalOrder=e.copy(t.order),t.dataLoaded=!0})},t.checkIfDirty=function(){var n=!1;return t.newNote&&(n=!0),t.originalOrder&&!e.equals(t.originalOrder,t.order)&&(n=!0),n},t.resetDirty=function(){t.originalOrder=null,t.order=null},t.calculateTotals=function(){t.showDiscount=!1;var e=0,n=0,a=0,o=t.order.tax_rate||0,i=0;_.each(t.order.line_items,function(o){if(o.product){var s=o.on_sale?o.sale_price:o.regular_price;if(o.quantity&&(o.total=s*o.quantity),o.discount){var r=parseFloat(o.discount);o.total-=r,a+=r,n-=r,t.showDiscount=!0}e+=parseFloat(s)*parseFloat(o.quantity),n+=parseFloat(s)*parseFloat(o.quantity),o.taxable&&(i+=parseFloat(s)*parseFloat(o.quantity))}}),t.order.subtotal=e,t.order.total_discount=t.order.total_discount||a,t.order.total_discount?t.calculatedDiscountPercent=(100*parseFloat(t.order.total_discount)/parseFloat(e)).toFixed(2):t.calculatedDiscountPercent="",t.order.total_tax=i>0?(i-t.order.total_discount)*o:0,t.order.total=e+t.order.total_tax-t.order.total_discount},t.totalWithDiscount=function(e,t){return parseFloat(e)+parseFloat(t)};var h=function(e){d.swal({title:"Are you sure?",text:"You have unsaved data that will be lost",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, save changes!",cancelButtonText:"No, do not save changes!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?t.saveOrder(1,e):d.swal("Cancelled","Your edits were NOT saved.","error")})};t.navToCustomer=function(e){if(i.orderId){var n="/contacts/"+e._id;t.customRedirectUrl=n+"?order=true&id="+t.order._id,s.url(n).search({order:"true",id:t.order._id})}else h(e)},t.clearCustomer=function(){t.selectedCustomer=null},t.clearProduct=function(){t.selectedProduct=null},t.matchUsers=function(e){var n=e.notes;return n&&n.length>0&&t.users&&_.each(n,function(e){var n=_.find(t.users,function(t){return t._id===e.user_id});n&&(e.user={_id:n._id,first:n.first,last:n.last,email:n.email,profilePhotos:n.profilePhotos})}),n},t.matchProducts=function(e){var n=e.line_items||{};return n.length>0&&_.each(n,function(e){var n=_.find(t.products,function(t){return t._id===e.product_id});e.product=n,i.orderId||(e.discount=0)}),n},t.addNote=function(){t.order.notes||(t.order.notes=[]);var a=moment(),o={note:t.newNote,user_id:t.currentUser._id,date:a.toISOString()};t.order.notes.push(o),t.pushLocalNote(t.order,!0);var i={};t.notesEmail.enable&&(i={sendTo:t.order.customer.details[0].emails[0].email,fromEmail:t.$parent.currentUser.email,fromName:f(),note_value:t.newNote,enable_note:t.notesEmail.enable}),t.order&&t.order._id?(r.updateOrder(t.order,function(a){t.notesEmail={enable:!1},n.pop("success","Note added to order."),t.newNote="",t.order=a,e.copy(t.order,t.originalOrder)}),r.addOrderNote(t.order._id,i,function(e){t.notesEmail={enable:!1}})):t.order&&(t.newNote="")},t.pushLocalNote=function(e,n){if(e.notes=t.matchUsers(e),!n){var a=e.notes[e.notes.length-1];t.order.notes.push(a)}},t.checkOnSaleFn=function(e){if(e.on_sale){if(e.sale_date_from&&e.sale_date_to){var t=new Date,n=new Date(e.sale_date_from),a=new Date(e.sale_date_to);return n<=t&&t<=a}return!0}},t.addProductLineItem=function(e){var n={product_id:e._id,quantity:1,regular_price:e.regular_price,sale_price:e.on_sale?e.sale_price:null,on_sale:t.checkOnSaleFn(e),taxable:e.taxable||!1,sku:e.sku,total:e.regular_price,name:e.name,product:e,type:e.type};t.order.line_items.push(n),t.calculateTotals(),t.clearProduct(),t.eliminateUsedProducts(),t.closeModal()},t.removeLineItem=function(e){var n=t.order.line_items,a=[];_.each(n,function(t,n){n!==e&&a.push(t)}),t.order.line_items=a,t.eliminateUsedProducts(),t.calculateTotals()},t.openProductLineItemModal=function(){t.openModal("add-product-lineitem-modal")},t.formatInput=function(e){if(e){var t="No Email";return e.details[0]&&e.details[0].emails.length>0&&(t=e.details[0].emails[0].email),(e.first||"")+" "+(e.last||"")+" (#"+e._id+" "+t+") "}return""},t.open=function(e){e.preventDefault(),e.stopPropagation(),t.opened=!t.opened},t.endOpen=function(e){e.preventDefault(),e.stopPropagation(),t.startOpened=!1,t.endOpened=!t.endOpened},t.startOpen=function(e){e.preventDefault(),e.stopPropagation(),t.endOpened=!1,t.startOpened=!t.startOpened},t.customerSync=function(e){var n,a,o=t.selectedCustomer,i=o.details[0].addresses,s=o.details[0].emails,r=o.details[0].phones,c=o.details[0].company,l=0;for(l;l<i.length;l++)i[l].defaultBilling&&(n=i[l]),i[l].defaultShipping&&(a=i[l]);n||(n=i[0]),a||(a=i[0]);var u="";o.first&&(u=o.first);var d="";o.last&&(d=o.last);var p="";r.length>0&&(p=r[0].number);var m="";s.length>0&&(m=s[0].email);var g="",f="",h="",v="",b="",y="";n&&(n.address&&(g=n.address),n.address2&&(f=n.address2),n.city&&(h=n.city),n.state&&(v=n.state),n.zip&&(b=n.zip),n.country&&(y=n.country));var w="",C="",S="",_="",k="",T="";if(a&&(a.address&&(w=a.address),a.address2&&(C=a.address2),a.city&&(S=a.city),a.state&&(_=a.state),a.zip&&(k=a.zip),a.country&&(T=a.country)),"billing"===e){var P={first_name:u,last_name:d,phone:p,email:m,company:c,address_1:g,address_2:f,city:h,state:v,postcode:b,country:y};t.order.billing_address=P}if("shipping"===e){var D={first_name:u,last_name:d,phone:p,email:m,company:c,address_1:w,address_2:C,city:S,state:_,postcode:k,country:T};t.order.shipping_address=D}},t.statusUpdated=function(a){if(t.order.status!==a){var o="Status has been updated to ",i="Order status changed from "+t.order.status+" to "+a;"processing"===a&&n.pop("success",o+' "Processing"'),"on_hold"===a&&n.pop("success",o+'"On Hold"'),"pending_payment"===a&&n.pop("success",o+'"Pending Payment"'),"completed"===a&&(t.order._id?r.completeOrder(t.order._id,i,function(a){n.pop("success",o+'"Completed"'),t.originalOrder.status="completed",t.order.completed_at=a.completed_at,t.originalOrder.completed_at=a.completed_at;var i=!1;e.equals(t.order,t.originalOrder)&&(i=!0),t.pushLocalNote(a),i&&e.copy(t.order,t.originalOrder)}):n.pop("success",o+'"Completed"')),"cancelled"===a&&n.pop("success",o+'"Cancelled"'),"refunded"===a&&d.swal({title:"Are you sure?",text:"This order will be refunded and all funds will be returned.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, refund it.",cancelButtonText:"No, cancel!",closeOnConfirm:!1,closeOnCancel:!1},function(e){e?r.refundOrder(t.order._id,t.reasonData,function(e,o){o?d.swal(o.status,o.message,"error"):(t.order.payment_details.payKey?(d.swal("Order Update","We currently do not support refunding payments from Paypal. Please log into your paypal account and initiate the refund from there.","warning"),n.pop("warning","We currently do not support refunding payments from Paypal. Please log into your paypal account and initiate the refund from there.")):d.swal("Refunded","Order has been refunded.","success"),t.order.status=a,t.originalOrder.status=a,t.currentStatus=a)}):d.swal("Cancelled","Order refund cancelled.","error")}),"failed"===a&&n.pop("success",o+'"Failed"'),"refunded"!==a&&(t.order.status=a,t.currentStatus=a),"paid"===a&&n.pop("success",o+'"Paid"')}},t.sendEmail=function(e){},t.print=function(e){},t.saveOrder=function(a,o,c,l){return t.pageSaving=!0,t.formSubmitted=!0,t.saveLoading=!0,t.selectedCustomer?t.order.customer_id=t.selectedCustomer._id:t.order.customer_id=null,t.order?(t.order.created.date||(t.order.created.date=(new Date).toISOString()),t.order.customer_id?t.order.line_items.length<=0?(n.pop("error","Products cannot be blank"),void(t.saveLoading=!1)):!t.order.billing_address||c&&l?(t.billingEdit=!0,n.pop("error","Billing details cannot be blank"),void(t.saveLoading=!1)):(g(),void(i.orderId?r.updateOrder(t.order,function(a){t.saveLoading=!1,e.copy(t.order,t.originalOrder),n.pop("success","Order updated successfully."),t.pageSaving=!1}):r.createOrder(t.order,function(i){if(n.pop("success","Order created successfully."),e.copy(t.order,t.originalOrder),t.saveLoading=!1,t.pageSaving=!1,1==a){d.swal("Saved!","Your edits were saved to the page.","success");var r="/customers/"+o._id;s.url(r).search({order:"true",id:i._id})}}))):(n.pop("error","Orders must contain a customer."),void(t.saveLoading=!1))):(n.pop("error","Orders can not be blank."),void(t.saveLoading=!1))},t.backToOrders=function(){s.url("/commerce/orders")},t.isDonationOrderFn=function(){if(!t.order)return e;var e=!!_.findWhere(t.order.line_items,{type:"DONATION"});return e}}])}(angular),function(e){app.controller("OrderDetailEditCtrl",["$scope","toaster","$modal","$filter","$stateParams","$location","OrderService","ContactService","UserService","ProductService","SweetAlert","orderConstant","productConstant",function(t,n,a,o,i,s,r,c,l,u,d,p,m){function g(){t.billing.sameAsBilling&&t.order.shipping_address&&t.order.billing_address&&t.order.billing_address.hasOwnProperty("address_1")&&(t.order.shipping_address=e.copy(t.order.billing_address))}function f(){var e=t.$parent.currentUser.email;return(t.$parent.currentUser.first||t.$parent.currentUser.last)&&(e=t.$parent.currentUser.first+" "+t.$parent.currentUser.last),e.trim()}t.dataLoaded=!1,t.billing={sameAsBilling:!1},t.notesEmail={enable:!1},t.showDiscount=!1,p&&(t.FailedStatus=p.order_status.FAILED),t.dateOptions={formatYear:"yy",startingDay:1},t.maxOrderDate=moment(),t.maxOrderDate.add(p.MAX_ORDER_DAYS||15,"days"),c.getContacts(function(e){t.customers=e,t.getUsers()}),t.closeModal=function(){t.modalInstance.close()},t.openModal=function(e){t.modalInstance=a.open({templateUrl:e,keyboard:!0,backdrop:"static",scope:t})},t.formatOrderStatus=function(e){return r.formatOrderStatus(e)},t.getUsers=function(){l.getUsers(function(e){t.users=e,t.getProducts()})},t.getProducts=function(){u.getProducts(function(e){t.products=e,t.activeProducts=e.filter(function(e){return e.status===m.product_status_types.ACTIVE}),t.getOrder()})},t.eliminateUsedProducts=function(){t.filterProducts=e.copy(t.activeProducts),_.each(t.order.line_items,function(e){var n=_.find(t.filterProducts,function(t){return t._id===e.product_id});if(n){var a=_.indexOf(t.filterProducts,n);a>-1&&t.filterProducts.splice(a,1)}})},t.compareAddress=function(){t.order.shipping_address&&t.order.billing_address&&t.order.billing_address.hasOwnProperty("address_1")&&e.equals(t.order.shipping_address,t.order.billing_address)&&(t.billing.sameAsBilling=!0)},t.getOrder=function(){r.getOrders(function(n){if(i.orderId){var a=_.find(n,function(e){return e._id===i.orderId});a.notes=t.matchUsers(a),a.line_items=t.matchProducts(a),t.currentStatus=a.status,a.locked=!0,t.order=a,t.eliminateUsedProducts(),t.selectedCustomer=_.find(t.customers,function(e){return e._id===t.order.customer_id}),t.compareAddress()}else t.order={created:{date:(new Date).toISOString()},order_id:n.length+1,status:"pending_payment",line_items:[],notes:[]},t.eliminateUsedProducts();t.originalOrder=e.copy(t.order),t.dataLoaded=!0})},t.checkIfDirty=function(){var n=!1;return t.newNote&&(n=!0),t.originalOrder&&!e.equals(t.originalOrder,t.order)&&(n=!0),n},t.resetDirty=function(){t.originalOrder=null,t.order=null},t.calculateTotals=function(){t.showDiscount=!1;var e=0,n=0,a=0,o=t.order.tax_rate||0,i=0;_.each(t.order.line_items,function(o){if(o.product){var s=o.on_sale?o.sale_price:o.regular_price;if(o.quantity&&(o.total=s*o.quantity),o.discount){var r=parseFloat(o.discount);o.total-=r,a+=r,n-=r,t.showDiscount=!0}e+=parseFloat(s)*parseFloat(o.quantity),n+=parseFloat(s)*parseFloat(o.quantity),o.taxable&&(i+=parseFloat(s)*parseFloat(o.quantity))}}),t.order.subtotal=e,t.order.total_discount=t.order.total_discount||a,t.order.total_discount?t.calculatedDiscountPercent=(100*parseFloat(t.order.total_discount)/parseFloat(e)).toFixed(2):t.calculatedDiscountPercent="",t.order.total_tax=i>0?(i-t.order.total_discount)*o:0,t.order.total=e+t.order.total_tax-t.order.total_discount},t.totalWithDiscount=function(e,t){return parseFloat(e)+parseFloat(t)};var h=function(e){d.swal({title:"Are you sure?",text:"You have unsaved data that will be lost",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, save changes!",cancelButtonText:"No, do not save changes!",closeOnConfirm:!0,closeOnCancel:!0},function(n){n?t.saveOrder(1,e):d.swal("Cancelled","Your edits were NOT saved.","error")})};t.navToCustomer=function(e){if(i.orderId){var n="/contacts/"+e._id;t.customRedirectUrl=n+"?order=true&id="+t.order._id,s.url(n).search({order:"true",id:t.order._id})}else h(e)},t.clearCustomer=function(){t.selectedCustomer=null},t.clearProduct=function(){t.selectedProduct=null},t.matchUsers=function(e){var n=e.notes;return n&&n.length>0&&t.users&&_.each(n,function(e){var n=_.find(t.users,function(t){return t._id===e.user_id});n&&(e.user={_id:n._id,first:n.first,last:n.last,email:n.email,profilePhotos:n.profilePhotos})}),n},t.matchProducts=function(e){var n=e.line_items||{};return n.length>0&&_.each(n,function(e){var n=_.find(t.products,function(t){return t._id===e.product_id});e.product=n,i.orderId||(e.discount=0)}),n},t.addNote=function(){t.order.notes||(t.order.notes=[]);var a=moment(),o={note:t.newNote,user_id:t.currentUser._id,date:a.toISOString()};t.order.notes.push(o),t.pushLocalNote(t.order,!0);var i={};t.notesEmail.enable&&(i={sendTo:t.order.customer.details[0].emails[0].email,fromEmail:t.$parent.currentUser.email,fromName:f(),note_value:t.newNote,enable_note:t.notesEmail.enable}),t.order&&t.order._id?(r.updateOrder(t.order,function(a){n.pop("success","Note added to order."),t.newNote="",t.order=a,e.copy(t.order,t.originalOrder),t.notesEmail={enable:!1}}),r.addOrderNote(t.order._id,i,function(e){t.notesEmail={enable:!1}})):t.order&&(t.newNote="")},t.pushLocalNote=function(e,n){if(e.notes=t.matchUsers(e),!n){var a=e.notes[e.notes.length-1];t.order.notes.push(a)}},t.checkOnSaleFn=function(e){if(e.on_sale){if(e.sale_date_from&&e.sale_date_to){var t=new Date,n=new Date(e.sale_date_from),a=new Date(e.sale_date_to);return n<=t&&t<=a}return!0}},t.addProductLineItem=function(e){var n={product_id:e._id,quantity:1,regular_price:e.regular_price,sale_price:e.on_sale?e.sale_price:null,on_sale:t.checkOnSaleFn(e),taxable:e.taxable||!1,sku:e.sku,total:e.regular_price,name:e.name,product:e,type:e.type};t.order.line_items.push(n),t.calculateTotals(),t.clearProduct(),t.eliminateUsedProducts(),t.closeModal()},t.removeLineItem=function(e){var n=t.order.line_items,a=[];_.each(n,function(t,n){n!==e&&a.push(t)}),t.order.line_items=a,t.eliminateUsedProducts(),t.calculateTotals()},t.openProductLineItemModal=function(){t.openModal("add-product-lineitem-modal")},t.formatInput=function(e){if(e){var t="No Email";return e.details[0]&&e.details[0].emails.length>0&&(t=e.details[0].emails[0].email),(e.first||"")+" "+(e.last||"")+" (#"+e._id+" "+t+") "}return""},t.open=function(e){e.preventDefault(),e.stopPropagation(),t.opened=!t.opened},t.endOpen=function(e){e.preventDefault(),e.stopPropagation(),t.startOpened=!1,t.endOpened=!t.endOpened},t.startOpen=function(e){e.preventDefault(),e.stopPropagation(),t.endOpened=!1,t.startOpened=!t.startOpened},t.customerSync=function(e){var n,a,o=t.selectedCustomer,i=o.details[0].addresses,s=o.details[0].emails,r=o.details[0].phones,c=o.details[0].company,l=0;for(l;l<i.length;l++)i[l].defaultBilling&&(n=i[l]),i[l].defaultShipping&&(a=i[l]);n||(n=i[0]),a||(a=i[0]);var u="";o.first&&(u=o.first);var d="";o.last&&(d=o.last);var p="";r.length>0&&(p=r[0].number);var m="";s.length>0&&(m=s[0].email);var g="",f="",h="",v="",b="",y="";n&&(n.address&&(g=n.address),n.address2&&(f=n.address2),n.city&&(h=n.city),n.state&&(v=n.state),n.zip&&(b=n.zip),n.country&&(y=n.country));var w="",C="",S="",_="",k="",T="";if(a&&(a.address&&(w=a.address),a.address2&&(C=a.address2),a.city&&(S=a.city),a.state&&(_=a.state),a.zip&&(k=a.zip),a.country&&(T=a.country)),"billing"===e){var P={first_name:u,last_name:d,phone:p,email:m,company:c,address_1:g,address_2:f,city:h,state:v,postcode:b,country:y};t.order.billing_address=P}if("shipping"===e){var D={first_name:u,last_name:d,phone:p,email:m,company:c,address_1:w,address_2:C,city:S,state:_,postcode:k,country:T};t.order.shipping_address=D}},t.statusUpdated=function(a){if(t.order.status!==a){var o="Status has been updated to ",i="Order status changed from "+t.order.status+" to "+a;"processing"===a&&n.pop("success",o+' "Processing"'),"on_hold"===a&&n.pop("success",o+'"On Hold"'),"pending_payment"===a&&n.pop("success",o+'"Pending Payment"'),"completed"===a&&(t.order._id?r.completeOrder(t.order._id,i,function(a){t.order.completed_at=a.completed_at,n.pop("success",o+'"Completed"'),t.originalOrder.status="completed",t.order.completed_at=a.completed_at,t.originalOrder.completed_at=a.completed_at;var i=!1;e.equals(t.order,t.originalOrder)&&(i=!0),t.pushLocalNote(a),i&&e.copy(t.order,t.originalOrder)}):n.pop("success",o+'"Completed"')),"cancelled"===a&&n.pop("success",o+'"Cancelled"'),"refunded"===a&&d.swal({title:"Are you sure?",text:"This order will be refunded and all funds will be returned.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, refund it.",cancelButtonText:"No, cancel!",closeOnConfirm:!1,closeOnCancel:!1},function(e){e?r.refundOrder(t.order._id,t.reasonData,function(e,o){o?d.swal(o.status,o.message,"error"):(t.order.payment_details.payKey?(d.swal("Order Update","We currently do not support refunding payments from Paypal. Please log into your paypal account and initiate the refund from there.","warning"),n.pop("warning","We currently do not support refunding payments from Paypal. Please log into your paypal account and initiate the refund from there.")):d.swal("Refunded","Order has been refunded.","success"),t.order.status=a,t.originalOrder.status=a,t.currentStatus=a)}):d.swal("Cancelled","Order refund cancelled.","error")}),"failed"===a&&n.pop("success",o+'"Failed"'),"refunded"!==a&&(t.order.status=a,t.currentStatus=a),"paid"===a&&n.pop("success",o+'"Paid"')}},t.sendEmail=function(e){},t.print=function(e){},t.saveOrder=function(a,o,c,l){return t.pageSaving=!0,t.formSubmitted=!0,t.saveLoading=!0,t.selectedCustomer?t.order.customer_id=t.selectedCustomer._id:t.order.customer_id=null,t.order?(t.order.created.date||(t.order.created.date=(new Date).toISOString()),t.order.customer_id?t.order.line_items.length<=0?(n.pop("error","Products cannot be blank"),void(t.saveLoading=!1)):!t.order.billing_address||c&&l?(t.billingEdit=!0,n.pop("error","Billing details cannot be blank"),void(t.saveLoading=!1)):(g(),void(i.orderId?r.updateOrder(t.order,function(a){t.saveLoading=!1,e.copy(t.order,t.originalOrder),n.pop("success","Order updated successfully."),t.pageSaving=!1}):r.createOrder(t.order,function(i){if(n.pop("success","Order created successfully."),e.copy(t.order,t.originalOrder),t.saveLoading=!1,t.pageSaving=!1,1==a){d.swal("Saved!","Your edits were saved to the page.","success");var r="/customers/"+o._id;s.url(r).search({order:"true",id:i._id})}}))):(n.pop("error","Orders must contain a customer."),void(t.saveLoading=!1))):(n.pop("error","Orders can not be blank."),void(t.saveLoading=!1))},t.backToOrders=function(){s.url("/commerce/orders")},t.isDonationOrderFn=function(){if(!t.order)return e;var e=!!_.findWhere(t.order.line_items,{type:"DONATION"});return e}}])}(angular),function(e){app.controller("OrdersCtrl",["$scope","toaster","$modal","$filter","$state","OrderService","ContactService","orderConstant","ProductService","$window","$location",function(t,n,a,o,i,s,r,c,l,u,d){t.tableView="list",t.itemPerPage=100,t.showPages=15,t.orderConstant=c,t.openModal=function(e){t.modalInstance=a.open({templateUrl:e,keyboard:!0,backdrop:"static",scope:t})},t.closeModal=function(){t.modalInstance.close()},r.getContacts(function(e){t.contacts=e}),t.newOrder=function(){i.go("app.commerce.orderdetail")},t.formatInput=function(e){var t;return t=e&&e.email?e.email:"No Email",e.first+" "+e.last+" (#"+e._id+" "+t+") "},t.getProducts=function(){l.getProducts(function(e){t.products=e,t.getOrder()})},l.getProducts(function(e){t.products=e,s.getOrders(function(e){_.each(e,function(e){e.line_items?e.line_items_total=e.line_items.length:e.line_items_total=0,t.matchProducts(e),t.setOrderCustomer(e),e.total=e.total}),t.orders=e,t.showOrders=!0})}),t.matchProducts=function(e){var n=e.line_items||{};n.length>0&&_.each(n,function(e){var n=_.find(t.products,function(t){return t._id===e.product_id});e.product=n})},t.formatOrderStatus=function(e){return s.formatOrderStatus(e)},t.orderStatusOptions=[{name:"Pending Payment",value:"pending_payment"},{name:"Paid",value:"paid"},{name:"Processing",value:"processing"},{name:"On Hold",value:"on_hold"},{name:"Completed",value:"completed"},{name:"Cancelled",value:"cancelled"},{name:"Refunded",value:"refunded"},{name:"Failed",value:"failed"}],t.orderStatus="",t.line_items="",t.filterorder={},t.getters={customerName:function(e){return e.customer?e.customer.first+" "+e.customer.last:""},line_items:function(e){return e.line_items.length},created:function(e){return e.created.date},modified:function(e){return e.modified.date},order_status:function(e){return e}},t.triggerInput=function(t){e.element(t).trigger("input")},t.viewSingle=function(e){e?d.path("/commerce/orders/"+e._id):d.path("/commerce/orders/neworder")},t.clear=function(e,n){e.stopPropagation(),t.filterorder.selected=null,t.triggerInput(n)},t.setOrderCustomer=function(e){e.contact_email="",e&&e.customer&&(e.customerDetailedName=(e.customer.first||"")+" "+(e.customer.last||"")+" ("+e.customer._id+")",e.customer.details&&e.customer.details[0]&&e.customer.details[0].emails&&e.customer.details[0].emails.length>0&&(e.contact_email=e.customer.details[0].emails[0].email))}}])}(angular),function(e){app.controller("ProductsCtrl",["$scope","$modal","$window","AccountService","ProductService","$filter","productConstant","ipCookie","$location","$timeout",function(t,n,a,o,i,s,r,c,l,u){function d(e){_.each(e,function(e){e&&(e.hasImage="false",e.is_image&&e.icon&&0==!e.icon.indexOf("fa-")&&(e.hasImage="true"))})}t.tableView="list",t.itemPerPage=100,t.showPages=15,t.newProduct={status:"inactive",allowAddOns:!0},t.sortFields={"modified.date":-1},t.defaultSortorder="reverse",t.productTypeOptions=r.product_types.dp,t.checkPaymentAccountExistsFn=function(e){o.getUpdatedAccount(function(n){var a=_.find(n.credentials,function(e){return"stripe"===e.type});t.stripeAccountExist=a;var o=n.commerceSettings.paypal;e(e&&(a||o)?!0:!1)})},t.checkPaymentAccountExistsFn(function(e){e?i.getProductsWithSort(t.sortFields,function(e){t.products=e,t.showProducts=!0,t.noPaymentAccount=!1,d(e)}):t.noPaymentAccount=!0}),t.openProductModal=function(e){t.modalInstance=n.open({templateUrl:"new-product-modal",size:e,keyboard:!0,backdrop:"static",scope:t})},t.openImportModal=function(e){t.modalInstance=n.open({templateUrl:"import-product-modal",size:e,keyboard:!0,backdrop:"static",scope:t})},t.cancel=function(){t.modalInstance.close()},t.addProduct=function(){t.saveLoading=!0,"EXTERNAL"===t.newProduct.type&&(t.newProduct.externalLinkOpenIn="_blank"),i.postProduct(t.newProduct,function(e){e.hasImage="false",t.displayedProducts.unshift(e),t.products.unshift(e),t.modalInstance.close(),t.newProduct={},t.minRequirements=!0,t.saveLoading=!1})},t.viewSingleProduct=function(e){l.path("/commerce/products/"+e._id)},t.formatStatus=function(e){var n=" -- ";if(e){var a=_.findWhere(t.productStatusTypes,{data:e});a&&(n=a.label)}return n},t.filterProduct={},t.clearFilter=function(e,n,a){t.filterProduct[a]={},t.triggerInput(n,!1)},t.productImageTypes=[{label:"Image",data:"true"},{label:"No Image",data:"false"}],i.productStatusTypes(function(e){t.productStatusTypes=e}),t.triggerInput=function(t,n){e.element(t).trigger("input")},t.resizeGrid=function(e){u(function(){t.inserted||(t.inserted=!0,$("tr.product-item").length&&(t.maxProductHeight=Math.max.apply(null,$("tr.product-item").map(function(){return $(this).height()}).get()),t.maxProductHeight=t.maxProductHeight+3)),$("tr.product-item").css("min-height",t.maxProductHeight)},500)},t.inserted=!1,t.$watch("tableView",function(e,n){"grid"==e&&t.resizeGrid()}),t.$watch("displayedProducts",function(e,n){e&&"grid"===t.tableView&&t.resizeGrid()}),t.currentHost=a.location.host,t.redirectUrl="/admin/commerce/products",t.socailRedirect=function(e){var n=c("socialAccount"),o=new Date;if(o.setMinutes(o.getMinutes()+10),void 0===n)c("socialAccount",i={socialAccount:e,redirectTo:"/commerce/products"},{expires:o,path:"/"});else{c.remove("socialAccount",{path:"/"});var i={socialAccount:e,redirectTo:"/commerce/products"};c("socialAccount",i,{expires:o,path:"/"})}var s="/redirect/?next="+t.currentHost+"/"+e.toLowerCase()+"/connect/";"Paypal"===e&&(s="/admin/#/support/help-topics?title=adding-paypal-as-an-payment-option"),a.location=s}}])}(angular),function(e){app.controller("ProductsDetailCtrl",["$scope","$modal","$timeout","editableOptions","$state","$stateParams","$q","CommonService","ProductService","PaymentService","UserService","AccountService","WebsiteService","toaster","SweetAlert","productConstant","$location",function(t,n,a,o,i,s,r,c,l,u,d,p,m,g,f,h,v){function b(){return t.emailToSend&&t.originalEmailToSend&&!e.equals(t.emailToSend,t.originalEmailToSend)}function y(){return!e.equals(t.originalTags,t.product_tags)}o.theme="bs3",t.isProduct=!0,t.existingEmail={},t.isProductDirty={dirty:!1},t.slickConfig={infinite:!1,dots:!1,slidesToShow:3,slidesToScroll:1,focusOnSelect:!0},t.slickSlideIndex=0,t.isMediaSingleSelect=!1,t.openModal=function(e){t.modalInstance=n.open({templateUrl:e,keyboard:!0,backdrop:"static",scope:t})},t.openMediaModal=function(){t.showInsert=!0,t.modalInstance=n.open({templateUrl:"media-modal",controller:"MediaModalCtrl",size:"lg",keyboard:!0,backdrop:"static",resolve:{showInsert:function(){return t.showInsert},insertMedia:function(){return t.insertMedia},isSingleSelect:function(){return t.isMediaSingleSelect}}})},t.closeModal=function(e){!0===e?t.editCancelFn():t.modalInstance.close()},d.getUser(function(e){t.user=e}),t.initDatePicker=function(){a(function(){t.myform.$dirty=!1},0)},t.selectedDate={};var w=moment(),C=moment().add(6,"days");t.selectedDate.range={startDate:new Date(w),endDate:new Date(C)};var S=function(e){e.emailSettings={emailId:"",offset:"",fromEmail:"",fromName:"",replyTo:"",cc:"",bcc:"",subject:"",vars:[],sendAt:{}}};t.getProduct=function(){return l.getSingleProduct(s.productId,function(n){var a=n.sale_date_from,o=n.sale_date_to;a||o||(a=moment(),o=moment().add(6,"days")),t.selectedDate.range={startDate:new Date(a),endDate:new Date(o)},n.regular_price=parseFloat(n.regular_price),t.product=n,t.originalIcon=n.icon,n.assets&&n.assets.length&&(t.isMediaSingleSelect=!0);var i=t.product.icon;i&&0==!i.indexOf("fa-")&&(i="fa-cube"),e.element("#convert").iconpicker({iconset:"fontawesome",icon:i,rows:5,cols:5,placement:"right"}),t.getProductTags(),t.product.attributes||(t.product.attributes=[{name:"",values:[]}]),t.product.downloads.length<=0&&(t.product.downloads=[{id:Math.uuid(8),name:"",file:""}]);var s=[];t.product.product_attributes.stripePlans&&(t.product.product_attributes.stripePlans.forEach(function(e,t){s.push(u.getPlanPromise(e.id)),k[e.id]=e.active,T[e.id]=e.signup_fee}),r.all(s).then(function(e){e.forEach(function(e,n){e.data.active=k[e.data.id],e.data.signup_fee=T[e.data.id],t.plans.push(e.data)})}).catch(function(e){}))})},t.product_tags=[];var k={},T={};t.insertMedia=function(e){if(0==t.isMediaSingleSelect)var n=_.pluck(e,"url");t.currentDownload?0==t.isMediaSingleSelect?t.currentDownload.file=n[0]:t.currentDownload.file=e.url:0==t.isMediaSingleSelect?(t.product.icon=n[0],t.product.assets=n):(t.product.icon=e.url,t.product.assets[t.slickSlideIndex]=e.url),t.setDownloadId()},t.setDownloadId=function(e){t.currentDownload=e},t.addAttribute=function(){var e={name:"",values:[]};t.product.attributes.push(e),g.pop("success","New attribute has been added.")},t.addDownload=function(){var e={id:Math.uuid(8),name:"",file:""};t.product.downloads.push(e),g.pop("success","New download has been added.")},t.removeDownload=function(e){var n=_.filter(t.product.downloads,function(t){return t.id!==e});t.product.downloads=n,g.pop("warning","Download has been removed.")},t.removeAttribute=function(e){var n=[],a=[];_.each(t.product.attributes,function(t,o){o!==e?n.push(t):a.push(t)}),t.product.attributes=n;var o;o=a[0].name.length>0?a[0].name:"Empty Attribute",g.pop("error",o+" attribute has been removed.")},t.ldloading={},t.clickBtn=function(e){t.ldloading[e.replace("-","_")]=!0,a(function(){t.ldloading[e.replace("-","_")]=!1},2e3)},t.validateProduct=function(){var e=!0;return t.product.name||(e=!1,t.productNameError=!0),t.product.type||(e=!1,t.productTypeError=!0),e},t.setEmail=function(e){if(e){var n=t.product.emailSettings;n.emailId=e._id,n.fromEmail=e.fromEmail,n.fromName=e.fromName,n.replyTo=e.replyTo,n.cc=e.cc,n.bcc=e.bcc,n.subject=e.subject}},t.saveLoading=!1,t.saveProductFn=function(){if(t.pageSaving=!0,t.selectedDate.range&&(t.product.sale_date_from=new Date(t.selectedDate.range.startDate).toISOString(),t.product.sale_date_to=new Date(t.selectedDate.range.endDate).toISOString()),t.setProductTags(),t.validateProduct())if(t.saveLoading=!0,t.product.fulfillment_email){if(!t.emailToSend.title)return g.pop("warning","Warning","Email title can't not blank"),void(t.saveLoading=!1);if(t.emailTitleExists&&"new"===t.selectedEmail.type)return g.pop("warning","Warning","Email title already exists"),void(t.saveLoading=!1);!t.product.emailSettings.emailId||e.isDefined(t.existingEmail.replace)&&!t.existingEmail.replace?(t.emailToSend.productId=t.product._id,m.createEmail(t.emailToSend,function(e){t.isNewEmailObj=!0,t.updateProductEmail(e)})):(t.isNewEmailObj=!1,t.updateProductEmail(t.emailToSend))}else t.saveProduct()},t.saveProduct=function(){t.product.is_image||(t.product.assets=[t.product.icon]),l.saveProduct(t.product,function(n){t.product=n,e.copy(t.product,t.originalProduct),t.product_tags=[],t.getProductTags(),t.product.fulfillment_email&&t.getEmails(),t.saveLoading=!1,g.pop("success","Product Saved."),t.pageSaving=!1})},t.updateProductEmail=function(n){t.setEmail(n),t.updatedEmail=e.copy(n),t.updatedEmail&&t.existingEmail.replace||t.product&&t.emailToSend.productId&&t.emailToSend.productId===t.product._id?m.updateEmail(t.updatedEmail,function(e,n){t.saveProduct()}):t.saveProduct()},t.removeVariation=function(){},l.productStatusTypes(function(e){t.productStatusOptions=e}),t.productTypes=h.product_types,t.externalLinkOptions=h.external_link_options.dp,t.externalLinkViewOptions=h.external_link_view_options.dp,$("#convert").on("change",function(e){t.product&&!t.product.is_image&&(t.product.icon=e.icon)}),t.newSubscription={planId:c.generateUniqueAlphaNumericShort(),interval:"week",interval_count:1},t.plans=[],t.addSubscriptionFn=function(e,n){t.stripeAccountExist||(g.pop("error","Need to add a stripe account first."),i.go("account")),t.newSubscription=e;var a=100*parseInt(t.signup_fee);t.newSubscription.amount=100*t.newSubscription.amount,u.postCreatePlan(t.newSubscription,function(e){t.signup_fee=a,e.signup_fee=a,t.plans.push(e);var n=parseInt(e.amount,10);t.product.product_attributes.stripePlans?t.product.product_attributes.stripePlans.push({id:e.id,active:!0,signup_fee:a,price:n}):t.product.product_attributes.stripePlans=[{id:e.id,active:!0,signup_fee:a,price:n}],k[e.id]=!0,T[e.id]=t.signup_fee,t.saveProductFn(),t.newSubscription={planId:c.generateUniqueAlphaNumericShort(),interval:"week",interval_count:1},t.signup_fee=null,t.closeModal("add-subscription-modal")},n)},t.planEditFn=function(n){t.editingPlan=!0,t.openModal("add-subscription-modal"),t.plans.forEach(function(a,o){a.id===n&&(t.newSubscription=e.copy(a),t.newSubscription.amount=t.newSubscription.amount/100,t.newSubscription.planId=a.id,t.signup_fee=T[a.id])})},t.editCancelFn=function(){t.editingPlan=!1,t.saveLoadingPlan=!1,t.signup_fee=null,t.newSubscription={planId:c.generateUniqueAlphaNumericShort(),interval:"week",interval_count:1},t.closeModal("add-subscription-modal")},t.planDeleteFn=function(e,n,a,o){var i=o||!1;u.deletePlan(e,n,function(){t.plans.forEach(function(n,a){n.id===e&&t.plans.splice(a,1)}),t.product.product_attributes.stripePlans.forEach(function(n,a){n.id===e&&t.product.product_attributes.stripePlans.splice(a,1)}),a&&(t.plans.length||(t.product.status="inactive"),t.saveProductFn()),i&&i()},!0)},t.editSubscriptionFn=function(e){t.saveLoadingPlan=!0,t.planDeleteFn(e.planId,!1,!1,function(){t.addSubscriptionFn(e,!1),t.editCancelFn(),g.pop("success","Plan updated.")})},t.getProductTags=function(){t.product.tags&&t.product.tags.forEach(function(e,n){t.product_tags.push({text:e})}),t.originalTags=e.copy(t.product_tags)},t.setProductTags=function(){t.product.tags=[],t.product_tags.forEach(function(e,n){e.text&&t.product.tags.push(e.text)})},t.checkSalePrice=function(){},t.deleteProductFn=function(n){f.swal({title:"Are you sure?",text:"Do you want to delete this product?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, do not delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(a){a&&l.deleteProduct(n._id,function(){g.pop("warning","Product Deleted."),t.originalProduct=e.copy(t.product),i.go("app.commerce.products")})})},t.setDefault=function(){t.product.is_image?(t.product.icon=t.originalProduct.icon?t.originalProduct.icon:t.product.assets[0],t.product.assets.length<2&&(t.product.assets[0]=t.product.icon)):(t.product.icon="fa-cube",e.element("#convert").iconpicker("setIcon","fa-cube"))},t.checkIfDirty=function(){var n=!1;return t.originalProduct&&(!e.equals(t.originalProduct,t.product)||y()||b())&&(n=!0),n},t.resetDirty=function(){t.originalProduct=null,t.product=null,t.originalTags=null},t.emailToSend={title:"",type:"email",subject:"Edit Subject",fromName:"",fromEmail:"",replyTo:"",cc:"",bcc:"",components:[{_id:c.generateUniqueAlphaNumericShort(),anchor:c.generateUniqueAlphaNumericShort(),type:"email-header",version:1,txtcolor:"#888888",logo:"<h2>Logo Here</h2>",bg:{img:{url:"",width:null,height:null,parallax:!1,blur:!1},color:""},visibility:!0},{_id:c.generateUniqueAlphaNumericShort(),anchor:c.generateUniqueAlphaNumericShort(),type:"email-1-col",version:1,txtcolor:"#888888",title:'<h2 style="text-align:center;">One Column Layout Section</h2>',text:'<p style="text-align:center;">This is a single column content section.</p>',bg:{img:{url:"",width:null,height:null,parallax:!1,blur:!1},color:""},visibility:!0},{_id:c.generateUniqueAlphaNumericShort(),anchor:c.generateUniqueAlphaNumericShort(),type:"email-2-col",version:1,txtcolor:"#888888",title:'<h2 style="text-align:center;">Two Column Layout Section</h2>',text1:'<p style="text-align:center;">This is column 1.</p>',text2:'<p style="text-align:center;">This is column 2.</p>',bg:{img:{url:"",width:null,height:null,parallax:!1,blur:!1},color:""},visibility:!0},{_id:c.generateUniqueAlphaNumericShort(),anchor:c.generateUniqueAlphaNumericShort(),type:"email-3-col",version:1,txtcolor:"#888888",title:'<h2 style="text-align:center;">Three Column Layout Section</h2>',text1:'<p style="text-align:center;">This is column 1.</p>',text2:'<p style="text-align:center;">This is column 2.</p>',text3:'<p style="text-align:center;">This is column 3.</p>',bg:{img:{url:"",width:null,height:null,parallax:!1,blur:!1},color:""},visibility:!0},{_id:c.generateUniqueAlphaNumericShort(),anchor:c.generateUniqueAlphaNumericShort(),type:"email-footer",version:1,txtcolor:"#888888",text:"This is an email footer.",bg:{img:{url:"",width:null,height:null,parallax:!1,blur:!1},color:""},visibility:!0}]},t.emailToSendCopy=e.copy(t.emailToSend),t.getAccount=function(){return p.getUpdatedAccount(function(n){t.account=n,t.stripeAccountExist=!1,t.paypalAccountExist=t.account.commerceSettings.paypal,t.account.credentials.forEach(function(e,n){"stripe"==e.type&&(t.stripeAccountExist=!0)}),t.setBusinessDetails(),t.actualEmailToSend=e.copy(t.emailToSend)})},t.setBusinessDetails=function(e){var n=t.account,a=n.business.logo||"<h2>Logo Here</h2>",o=n.business.name||"Edit name",i=n.business.emails[0].email||"Edit email";t.emailToSend&&(-1!=a.indexOf("http")&&"<h2>Logo Here</h2>"==t.emailToSend.components[0].logo&&(t.emailToSend.components[0].logo='<img src="'+n.business.logo+'"/>',t.emailToSendCopy.components[0].logo='<img src="'+n.business.logo+'"/>'),o&&(""==t.emailToSend.fromName||e)&&(t.emailToSend.fromName=n.business.name,t.emailToSendCopy.fromName=n.business.name),i&&(""==t.emailToSend.fromEmail||e)&&(t.emailToSend.fromEmail=n.business.emails[0].email,t.emailToSendCopy.fromEmail=n.business.emails[0].email),i&&e&&(t.emailToSend.replyTo=n.business.emails[0].email,t.emailToSendCopy.replyTo=n.business.emails[0].email))},t.emails=[],t.selectedEmail={type:"new"},t.setEmailDefaults=function(e){t.emailToSend.title=e+" Email",t.emailToSend.subject=e,t.checkEmailTitle(t.emailToSend.title)},t.changeCurrentEmail=function(e){t.emailToSend=e},t.getEmails=function(){t.product.type==t.productTypes.DONATION&&(t.product.on_sale=!1),t.product.emailSettings||S(t.product),t.product.fulfillment_email&&t.product.emailSettings.emailId&&(t.selectedEmail={type:"template"});var n=m.getEmails(!1,function(n){var a=t.product.emailSettings.emailId,o=null;t.emails=e.copy(n),t.originalEmails=e.copy(n),o=t.emails.filter(function(e){return e._id===a})[0],a&&o&&(t.emailToSend=o,t.product.emailSettings.emailId&&(t.emailToSend.fromEmail=t.product.emailSettings.fromEmail,t.emailToSend.fromName=t.product.emailSettings.fromName,t.emailToSend.cc=t.product.emailSettings.cc,t.emailToSend.bcc=t.product.emailSettings.bcc,t.emailToSend.replyTo=t.product.emailSettings.replyTo,t.emailToSend.subject=t.product.emailSettings.subject),t.originalEmailToSend=e.copy(t.emailToSend)),t.emailToSendPrevious=t.emails[0]});return t.originalProduct=e.copy(t.product),n},t.checkEmailTitle=function(e){if("new"===t.selectedEmail.type){t.checkingEmailTitle=!0;var n=_.find(t.originalEmails,function(t){return t.title&&t.title.toLowerCase()==e.toLowerCase()});t.emailTitleExists=!!n}else t.emailTitleExists=!1;t.emailTitleChecked=!0,t.checkingEmailTitle=!1},t.clearEmail=function(n){t.checkingEmailTitle=!1,n?(t.emailToSendPrevious=e.copy(t.emailToSend),t.setBusinessDetails(n),t.emailToSend=t.emailToSendCopy,t.emailToSend.title=t.product.name+" Email",t.emailToSend.cc="",t.emailToSend.bcc="",t.emailToSend.subject=t.product.name,t.checkEmailTitle(t.emailToSend.title),t.product&&t.product.emailSettings&&(t.product.emailSettings.emailId=null)):(t.setBusinessDetails(),t.emailToSend=t.emailToSendPrevious,t.product.emailSettings&&!t.product.emailSettings.emailId&&t.emailToSendPrevious&&(t.product.emailSettings.emailId=t.emailToSendPrevious._id),t.actualEmailToSend=e.copy(t.emailToSend))},t.fullscreen=!1,t.toggleFullscreen=function(){t.transitionDone=!1,t.fullscreen?(t.fullscreen=!1,a(function(){t.transitionDone=!0},1e3)):(t.fullscreen=!0,a(function(){t.transitionDone=!0},1e3))},t.analyzeSubject=function(e){var n=e.split(" "),a=e.toLowerCase().split(" "),o=["freebie","urgent","breaking","important","alert","thank you","sneak peek","alert","daily","free delivery","cash","quote","save","jokes","promotional","congratulations","revision","forecast","snapshot","token","voluntary","monthly","deduction","upgrade","just","content","go","wonderful"],i=["free","reminder","canceled","helping","fundraising","raffle","fundraiser","charity","donate","last chance","breast cancer","sign up","help","percent off","newsletter","report","program","half","budget","unlimited","discount","down","sale","suburbs","decoder","inland","county","wish","forgotten","thirds","discussion","romantic","videos","miss","deals","groovy","conditions","friday","monday","furry","double","volunteer","learn"],s=!0,r=!0,c=!0,l=!0,u=!0,d=!0,p=!0,m=!0;if(_.each(n,function(e){e&&e[0]!==e[0].toUpperCase()&&(s=!1),i.indexOf(e.toLowerCase())>=0&&(d=!1)}),_.intersection(a,o).length<=0&&(u=!1),e.length>49&&(r=!1),n.length>9&&(c=!1),n.length<4&&(p=!1),t.emails&&t.emails.length>0){var g={value:"",percent:0},f=e.replace(new RegExp("[^a-zA-Z ]"),"").toLowerCase();_.each(t.emails,function(e){if(e.subject){var t=e.subject.replace(new RegExp("[^a-zA-Z ]"),"").toLowerCase(),n=f.score(t);g.percent<n&&(g.value=e.subject,g.percent=n)}}),g.value&&g.percent>.75&&(m=!1,t.bestMatch=g)}!1===/^[a-zA-Z0-9- ]*$/.test(e)&&(l=!1);var h=100,v=[s,r,c,l,u,d,p,m];_.each(v,function(e){!1===e&&(h-=12.5)}),t.subjectRules={capitalized:s,lessThan50Char:r,lessThan10Words:c,isAlphaNumeric:l,containsWordToUse:u,avoidsWordNotToUse:d,moreThan4Words:p,differentFromPreviousSubjects:m},t.subjectScore=Math.round(h)},t.$watch("emailToSend.subject",function(e,n){e&&t.analyzeSubject(e)}),t.assetSlideClickFn=function(e){t.slickSlideIndex=e,t.isMediaSingleSelect=!0,t.product.icon=t.product.assets[e],t.originalIcon=t.product.icon},t.planToggleActiveFn=function(e,n){t.product.product_attributes.stripePlans.forEach(function(t,a){t.id==e&&(t.active=n)})},t.cloneLoading=!1,t.cloneProductFn=function(){t.cloneLoading=!0,l.cloneProduct(t.product._id,function(e){g.pop("success","Product Cloned."),t.cloneLoading=!1,i.go("app.commerce.productsingle",{productId:e._id})})},t.displayDatePicker=function(){a(function(){e.element(".sales-date-date-picker").click()},0)},t.checkFulfillmentEmail=function(){var e=!1;return t.product&&t.product.fulfillment_email&&(e=!t.product.emailSettings||!t.product.emailSettings.emailId),e},t.backToProducts=function(){v.url("/commerce/products")},t.$watch("selectedDate.range",function(e,n){e&&(t.pickerOptions.startDate=new Date(t.selectedDate.range.startDate),t.pickerOptions.endDate=new Date(t.selectedDate.range.endDate))}),t.resetEmailTemplate=function(){t.product.type!=t.productTypes.DONATION&&t.product.type!=t.productTypes.EXTERNAL||(t.product.fulfillment_email=!1),t.product.type==t.productTypes.DONATION&&(t.product.on_sale=!1)},t.init=(t.getProduct().then(function(e){return t.getEmails()}).then(function(e){return t.getAccount()}),void(t.pickerOptions={startDate:new Date(t.selectedDate.range.startDate),endDate:new Date(t.selectedDate.range.endDate),format:"YYYY-MM-DD",opens:"left",ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}}))}])}(angular),function(e){app.controller("ProfileBusinessCtrl",["$scope","$modal","$timeout","toaster","$stateParams","UserService","CommonService","hoursConstant","AccountService","formValidations","$rootScope",function(t,n,a,o,i,s,r,c,l,u,d){function p(){if(t.account&&t.account.commerceSettings&&t.account.commerceSettings.taxes&&"business_location"===t.account.commerceSettings.taxbased){var e=!0;t.account.business?t.account.business&&!t.account.business.addresses?e=!1:t.account.business&&t.account.business.addresses&&!t.account.business.addresses.length?e=!1:t.account.business&&t.account.business.addresses&&t.account.business.addresses.length&&""===t.account.business.addresses[0].zip&&(e=!1):e=!1,e||(t.account.commerceSettings.taxbased=null)}}t.isValid=!0,t.hours=c,t.formValidations=u,l.getUpdatedAccount(function(n){t.account=n,t.setDefaults(),t.actualAccount=e.copy(n)}),s.getUser(function(e){t.user=e,t.fullName=[e.first,e.middle,e.last].join(" "),t.user.business||(t.user.business=[]),t.user.business.phones||(t.user.business.phones=[]),t.user.business.addresses||(t.user.business.addresses=[])}),t.openMediaModal=function(){t.showInsert=!0,t.modalInstance=n.open({templateUrl:"media-modal",controller:"MediaModalCtrl",size:"lg",keyboard:!0,backdrop:"static",resolve:{showInsert:function(){return t.showInsert},insertMedia:function(){return t.insertPhoto},isSingleSelect:function(){return!0}}})},t.insertPhoto=function(e){t.account.business.logo=e.url.replace(/^https?:/,"")},t.removePhoto=function(e){t.account.business.logo=null},t.accountAddEmailFn=function(){t.account.business.emails.push({_id:r.generateUniqueAlphaNumericShort(),email:""})},t.removeEmail=function(e){t.account.business.emails.splice(e,1)},t.showAddEmail=function(e){return e._id===t.account.business.emails[0]._id},t.accountAddPhoneFn=function(){t.account.business.phones.push({_id:r.generateUniqueAlphaNumericShort(),number:"",extension:""})},t.removePhone=function(e){t.account.business.phones.splice(e,1)},t.showAddPhone=function(e){return e._id===t.account.business.phones[0]._id},t.removeAddress=function(e){t.account.business.addresses.splice(e,1)},t.showAddAddress=function(e){return e._id===t.account.business.addresses[0]._id},t.accountAddAddressFn=function(){t.account.business.addresses.push({_id:r.generateUniqueAlphaNumericShort(),address:"",address2:"",state:"",zip:"",country:"",defaultShipping:!1,defaultBilling:!1,city:"",countryCode:"",displayName:"",lat:"",lon:""})},t.accountAddHoursFn=function(){t.account.business.splitHours=!1,t.account.business.hours=[{day:"Mon",start:"9:00 am",end:"5:00 pm",start2:"9:00 am",end2:"5:00 pm",closed:!1,split:!1},{day:"Tue",start:"9:00 am",end:"5:00 pm",start2:"9:00 am",end2:"5:00 pm",closed:!1,split:!1},{day:"Wed",start:"9:00 am",end:"5:00 pm",start2:"9:00 am",end2:"5:00 pm",closed:!1,split:!1},{day:"Thu",start:"9:00 am",end:"5:00 pm",start2:"9:00 am",end2:"5:00 pm",closed:!1,split:!1},{day:"Fri",start:"9:00 am",end:"5:00 pm",start2:"9:00 am",end2:"5:00 pm",closed:!1,split:!1},{day:"Sat",start:"9:00 am",end:"5:00 pm",start2:"9:00 am",end2:"5:00 pm",closed:!0,split:!1},{day:"Sun",start:"9:00 am",end:"5:00 pm",start2:"9:00 am",end2:"5:00 pm",closed:!0,split:!1}]},t.setDefaults=function(){t.account.business.phones||(t.account.business.phones=[]),t.account.business.emails||(t.account.business.emails=[]),t.account.business.addresses||(t.account.business.addresses=[]),t.account.business.phones.length||t.accountAddPhoneFn(),t.account.business.emails.length||t.accountAddEmailFn(),t.account.business.addresses.length||t.accountAddAddressFn(),t.account.business.hours&&t.account.business.hours.length||t.accountAddHoursFn(),t.account.business.hours&&_.each(t.account.business.hours,function(e,t){"Sat"!==e.day&&"Sun"!==e.day||(""===e.start&&(e.start="9:00 am"),""===e.end&&(e.end="5:00 pm"),""===e.start2&&(e.start2="9:00 am"),""===e.end2&&(e.end2="9:00 am"))})},t.profileSaveFn=function(){t.pageSaving=!0,p(),e.copy(t.account,t.actualAccount),t.validateBeforeSave(),t.isValid?_.filter(t.account.business.emails,function(e){return e.email&&e.email.length>0}).length<=0?o.pop("error","Email is required."):s.putAccount(t.account,function(n){t.account=n,o.pop("success","Profile Saved."),t.minRequirements=!0,t.setDefaults(),e.copy(t.account,t.actualAccount),t.pageSaving=!1,d.$broadcast("$ssbAccountUpdated")}):o.pop("error","Business hours are not valid")},t.checkProfileValidity=function(){var e=t.account.business.name,n=_.filter(t.account.business.emails,function(e){return""!==e.email});if(""!==e&&n.length>0)return!0},t.validateBeforeSave=function(){t.isValid=!0,_.each(t.account.business.hours,function(e,n){t.validateHours(e,n)})},t.validateHours=function(n,a){if(!n.closed){var o=n.start,i=n.end;if(o&&i&&(o="pm"===o.split(" ")[1]&&"12"!==o.split(":")[0]||"am"===o.split(" ")[1]&&"12"===o.split(":")[0]?parseInt(o.split(":")[0],10)+12:parseInt(o.split(":")[0],10),i="pm"===i.split(" ")[1]&&"12"!==i.split(":")[0]||"am"===i.split(" ")[1]&&"12"===i.split(":")[0]?parseInt(i.split(":")[0],10)+12:parseInt(i.split(":")[0],10),o=30===parseInt(n.start.split(":")[1],10)?o+.5:o,i=30===parseInt(n.end.split(":")[1],10)?i+.5:i),n.split&&t.account.business.splitHours){e.element("#business_hours_start_"+a+" .error").html(""),e.element("#business_hours_start_"+a).removeClass("has-error"),e.element("#business_hours_start2_"+a+" .error").html(""),e.element("#business_hours_start2_"+a).removeClass("has-error"),e.element("#business_hours_end_"+a+" .error").html(""),e.element("#business_hours_end_"+a).removeClass("has-error");var s=n.start2,r=n.end2;s&&r&&(s="pm"===s.split(" ")[1]&&"12"!==s.split(":")[0]||"am"===s.split(" ")[1]&&"12"===s.split(":")[0]?parseInt(s.split(":")[0],10)+12:parseInt(s.split(":")[0],10),r="pm"===r.split(" ")[1]&&"12"!==r.split(":")[0]||"am"===r.split(" ")[1]&&"12"===r.split(":")[0]?parseInt(r.split(":")[0],10)+12:parseInt(r.split(":")[0],10),s=30===parseInt(n.start2.split(":")[1],10)?s+.5:s,r=30===parseInt(n.end2.split(":")[1],10)?r+.5:r);var c="";(o>i||o>s||o>r)&&(t.isValid=!1,o>i?(c="Start time 1 can not be greater than end time 1",e.element("#business_hours_start_"+a+" .error").html(c),e.element("#business_hours_start_"+a).addClass("has-error")):o>s?(c="Start time 1 can not be greater than start time 2",e.element("#business_hours_start_"+a+" .error").html(c),e.element("#business_hours_start_"+a).addClass("has-error")):o>r&&(c="Start time 1 can not be greater than end time 2",e.element("#business_hours_start_"+a+" .error").html(c),e.element("#business_hours_start_"+a).addClass("has-error"))),(i>s||i>r)&&(t.isValid=!1,i>s?(c="End time 1 can not be greater than start time 2",e.element("#business_hours_end_"+a+" .error").html(c),e.element("#business_hours_end_"+a).addClass("has-error")):i>r&&(c="End time 1 can not be greater than end time 2",e.element("#business_hours_end_"+a+" .error").html(c),e.element("#business_hours_end_"+a).addClass("has-error"))),s>r&&(t.isValid=!1,c="Start time 2 can not be greater than end time 2",e.element("#business_hours_start2_"+a+" .error").html(c),e.element("#business_hours_start2_"+a).addClass("has-error"))}else n.wholeday||(e.element("#business_hours_start_"+a+" .error").html(""),e.element("#business_hours_start_"+a).removeClass("has-error"),o>i&&(t.isValid=!1,e.element("#business_hours_start_"+a+" .error").html("Start time can not be greater than end time"),e.element("#business_hours_start_"+a).addClass("has-error")))}},t.checkIfDirty=function(){var n=!1;return t.actualAccount&&!e.equals(t.actualAccount,t.account)&&(n=!0),n},t.resetDirty=function(){t.actualAccount=null,t.account=null}}])}(angular),function(e){app.controller("ProfilePersonalCtrl",["$scope","$rootScope","$modal","$timeout","toaster","$stateParams","UserService","PaymentService","CommonService","userConstant","formValidations",function(t,n,a,o,i,s,r,c,l,u,d){t.formValidations=d,t.auth={password:"",confirm:""},t.invoices=[],t.profileUser={},r.getUserActivity(function(e){t.activities=e}),t.getSubscription=function(){c.getInvoicesForAccount(function(e){(e=e).data.length&&e.data[0].lines&&2==e.data[0].lines.data.length?t.invoices=e.data[0].lines.data[1].plan:e.data.length&&e.data[0].lines&&1==e.data[0].lines.data.length&&(t.invoices=e.data[0].lines.data[0].plan)})},t.getSubscription(),t.openMediaModal=function(){t.showInsert=!0,t.modalInstance=a.open({templateUrl:"media-modal",controller:"MediaModalCtrl",size:"lg",keyboard:!0,backdrop:"static",resolve:{showInsert:function(){return t.showInsert},insertMedia:function(){return t.insertPhoto},isSingleSelect:function(){return!0}}})},t.insertPhoto=function(e){t.profileUser.profilePhotos[0]=e.url.replace(/^http[s]?:/,"")},t.removePhoto=function(e){t.profileUser.profilePhotos[0]=null},t.setProfileUser=function(n){t.profileUser=e.copy(n),t.originalprofileUser=e.copy(t.profileUser),t.auth.password=u.personal_profile.PASSWORD_PLACEHOLDER,t.auth.confirm=u.personal_profile.PASSWORD_PLACEHOLDER,t.passwordNotSame=!1},t.refreshUser=function(){e.copy(t.profileUser,t.currentUser)},t.setProfileUser(t.currentUser),t.passwordChanged=function(){var e=!1;return t.auth.password===u.personal_profile.PASSWORD_PLACEHOLDER&&t.auth.confirm===u.personal_profile.PASSWORD_PLACEHOLDER||(e=!0),e},t.validatePasswords=function(){return t.auth.password===t.auth.confirm?t.passwordNotSame=!1:t.passwordNotSame=!0,!t.passwordNotSame},t.profileSaveFn=function(){function a(){t.profileUser.email&&(t.profileUser.username=e.copy(t.profileUser.email.toLowerCase())),r.putUser(t.profileUser,function(a){t.refreshUser(),i.pop("success","Profile Saved."),e.copy(t.profileUser,t.originalprofileUser),t.pageSaving=!1,n.$broadcast("$personalProfileChanged")}),t.passwordChanged()&&(t.checkPasswordLength(t.auth)&&t.validatePasswords()?r.setPassword(t.auth.password,function(e){i.pop("success","Password changed.")}):i.pop("error","Passwords are not valid."))}t.pageSaving=!0,e.copy(t.profileUser,t.originalprofileUser),t.profileUser.email?e.equals(t.profileUser.username.toLowerCase(),t.profileUser.email.toLowerCase())?a():r.checkUserByUsername(t.profileUser.email,function(e){e?i.pop("error","Email already exist"):a()}):i.pop("error","Email is required.")},t.curPage=0,t.pageSize=100,t.numberOfPages=function(){return t.activities?Math.ceil(t.activities.length/t.pageSize):0},t.changePage=function(e){t.curPage=t.curPage+e},t.checkIfDirty=function(){var n=!1;return t.originalprofileUser&&!e.equals(t.originalprofileUser,t.profileUser)&&(n=!0),n},t.resetDirty=function(){t.originalprofileUser=null,t.profileUser=null},t.checkPasswordLength=function(e){return e.password&&e.password.length<6?t.passwordInValid=!0:t.passwordInValid=!1,!t.passwordInValid}}])}(angular),app.filter("propsFilter",function(){"use strict";return function(e,t){var n=[];return angular.isArray(e)?e.forEach(function(e){var a,o=!1,i=Object.keys(t);for(a=0;a<i.length;a++){var s=i[a],r=t[s].toLowerCase();if(-1!==e[s].toString().toLowerCase().indexOf(r)){o=!0;break}}o&&n.push(e)}):n=e,n}}),app.controller("SelectCtrl",["$scope","$http","$timeout",function(e,t,n){"use strict";e.disabled=void 0,e.searchEnabled=void 0,e.enable=function(){e.disabled=!1},e.disable=function(){e.disabled=!0},e.enableSearch=function(){e.searchEnabled=!0},e.disableSearch=function(){e.searchEnabled=!1},e.clear=function(){e.person.selected=void 0,e.address.selected=void 0,e.country.selected=void 0},e.someGroupFn=function(e){return e.name[0]>="A"&&e.name[0]<="M"?"From A - M":e.name[0]>="N"&&e.name[0]<="Z"?"From N - Z":void 0},e.personAsync={selected:"wladimir@email.com"},e.peopleAsync=[],n(function(){e.peopleAsync=[{name:"Adam",email:"adam@email.com",age:12,country:"United States"},{name:"Amalie",email:"amalie@email.com",age:12,country:"Argentina"},{name:"Estefana",email:"estefania@email.com",age:21,country:"Argentina"},{name:"Adrian",email:"adrian@email.com",age:21,country:"Ecuador"},{name:"Wladimir",email:"wladimir@email.com",age:30,country:"Ecuador"},{name:"Samantha",email:"samantha@email.com",age:30,country:"United States"},{name:"Nicole",email:"nicole@email.com",age:43,country:"Colombia"},{name:"Natasha",email:"natasha@email.com",age:54,country:"Ecuador"},{name:"Michael",email:"michael@email.com",age:15,country:"Colombia"},{name:"Nicols",email:"nicole@email.com",age:43,country:"Colombia"}]},3e3),e.counter=0,e.someFunction=function(t,n){e.counter++,e.eventResult={item:t,model:n}},e.removed=function(t,n){e.lastRemoved={item:t,model:n}},e.tagTransform=function(e){return{name:e,email:e+"@email.com",age:"unknown",country:"unknown"}},e.person={},e.people=[{name:"Adam",email:"adam@email.com",age:12,country:"United States"},{name:"Amalie",email:"amalie@email.com",age:12,country:"Argentina"},{name:"Estefana",email:"estefania@email.com",age:21,country:"Argentina"},{name:"Adrian",email:"adrian@email.com",age:21,country:"Ecuador"},{name:"Wladimir",email:"wladimir@email.com",age:30,country:"Ecuador"},{name:"Samantha",email:"samantha@email.com",age:30,country:"United States"},{name:"Nicole",email:"nicole@email.com",age:43,country:"Colombia"},{name:"Natasha",email:"natasha@email.com",age:54,country:"Ecuador"},{name:"Michael",email:"michael@email.com",age:15,country:"Colombia"},{name:"Nicols",email:"nicolas@email.com",age:43,country:"Colombia"}],e.availableColors=["Red","Green","Blue","Yellow","Magenta","Maroon","Umbra","Turquoise"],e.multipleDemo={},e.multipleDemo.colors=["Blue","Red"],e.multipleDemo.colors2=["Blue","Red"],e.multipleDemo.selectedPeople=[e.people[5],e.people[4]],e.multipleDemo.selectedPeople2=e.multipleDemo.selectedPeople,e.multipleDemo.selectedPeopleWithGroupBy=[e.people[8],e.people[6]],e.multipleDemo.selectedPeopleSimple=["samantha@email.com","wladimir@email.com"],e.address={},e.refreshAddresses=function(n){var a={address:n,sensor:!1};return t.get("http://maps.googleapis.com/maps/api/geocode/json",{params:a}).then(function(t){e.addresses=t.data.results})},e.country={},e.countries=[{name:"Afghanistan",code:"AF"},{name:"land Islands",code:"AX"},{name:"Albania",code:"AL"},{name:"Algeria",code:"DZ"},{name:"American Samoa",code:"AS"},{name:"Andorra",code:"AD"},{name:"Angola",code:"AO"},{name:"Anguilla",code:"AI"},{name:"Antarctica",code:"AQ"},{name:"Antigua and Barbuda",code:"AG"},{name:"Argentina",code:"AR"},{name:"Armenia",code:"AM"},{name:"Aruba",code:"AW"},{name:"Australia",code:"AU"},{name:"Austria",code:"AT"},{name:"Azerbaijan",code:"AZ"},{name:"Bahamas",code:"BS"},{name:"Bahrain",code:"BH"},{name:"Bangladesh",code:"BD"},{name:"Barbados",code:"BB"},{name:"Belarus",code:"BY"},{name:"Belgium",code:"BE"},{name:"Belize",code:"BZ"},{name:"Benin",code:"BJ"},{name:"Bermuda",code:"BM"},{name:"Bhutan",code:"BT"},{name:"Bolivia",code:"BO"},{name:"Bosnia and Herzegovina",code:"BA"},{name:"Botswana",code:"BW"},{name:"Bouvet Island",code:"BV"},{name:"Brazil",code:"BR"},{name:"British Indian Ocean Territory",code:"IO"},{name:"Brunei Darussalam",code:"BN"},{name:"Bulgaria",code:"BG"},{name:"Burkina Faso",code:"BF"},{name:"Burundi",code:"BI"},{name:"Cambodia",code:"KH"},{name:"Cameroon",code:"CM"},{name:"Canada",code:"CA"},{name:"Cape Verde",code:"CV"},{name:"Cayman Islands",code:"KY"},{name:"Central African Republic",code:"CF"},{name:"Chad",code:"TD"},{name:"Chile",code:"CL"},{name:"China",code:"CN"},{name:"Christmas Island",code:"CX"},{name:"Cocos (Keeling) Islands",code:"CC"},{name:"Colombia",code:"CO"},{name:"Comoros",code:"KM"},{name:"Congo",code:"CG"},{name:"Congo, The Democratic Republic of the",code:"CD"},{name:"Cook Islands",code:"CK"},{name:"Costa Rica",code:"CR"},{name:"Cote D'Ivoire",code:"CI"},{name:"Croatia",code:"HR"},{name:"Cuba",code:"CU"},{name:"Cyprus",code:"CY"},{name:"Czech Republic",code:"CZ"},{name:"Denmark",code:"DK"},{name:"Djibouti",code:"DJ"},{name:"Dominica",code:"DM"},{name:"Dominican Republic",code:"DO"},{name:"Ecuador",code:"EC"},{name:"Egypt",code:"EG"},{name:"El Salvador",code:"SV"},{name:"Equatorial Guinea",code:"GQ"},{name:"Eritrea",code:"ER"},{name:"Estonia",code:"EE"},{name:"Ethiopia",code:"ET"},{name:"Falkland Islands (Malvinas)",code:"FK"},{name:"Faroe Islands",code:"FO"},{name:"Fiji",code:"FJ"},{name:"Finland",code:"FI"},{name:"France",code:"FR"},{name:"French Guiana",code:"GF"},{name:"French Polynesia",code:"PF"},{name:"French Southern Territories",code:"TF"},{name:"Gabon",code:"GA"},{name:"Gambia",code:"GM"},{name:"Georgia",code:"GE"},{name:"Germany",code:"DE"},{name:"Ghana",code:"GH"},{name:"Gibraltar",code:"GI"},{name:"Greece",code:"GR"},{name:"Greenland",code:"GL"},{name:"Grenada",code:"GD"},{name:"Guadeloupe",code:"GP"},{name:"Guam",code:"GU"},{name:"Guatemala",code:"GT"},{name:"Guernsey",code:"GG"},{name:"Guinea",code:"GN"},{name:"Guinea-Bissau",code:"GW"},{name:"Guyana",code:"GY"},{name:"Haiti",code:"HT"},{name:"Heard Island and Mcdonald Islands",code:"HM"},{name:"Holy See (Vatican City State)",code:"VA"},{name:"Honduras",code:"HN"},{name:"Hong Kong",code:"HK"},{name:"Hungary",code:"HU"},{name:"Iceland",code:"IS"},{name:"India",code:"IN"},{name:"Indonesia",code:"ID"},{name:"Iran, Islamic Republic Of",code:"IR"},{name:"Iraq",code:"IQ"},{name:"Ireland",code:"IE"},{name:"Isle of Man",code:"IM"},{name:"Israel",code:"IL"},{name:"Italy",code:"IT"},{name:"Jamaica",code:"JM"},{name:"Japan",code:"JP"},{name:"Jersey",code:"JE"},{name:"Jordan",code:"JO"},{name:"Kazakhstan",code:"KZ"},{name:"Kenya",code:"KE"},{name:"Kiribati",code:"KI"},{name:"Korea, Democratic People's Republic of",code:"KP"},{name:"Korea, Republic of",code:"KR"},{name:"Kuwait",code:"KW"},{name:"Kyrgyzstan",code:"KG"},{name:"Lao People's Democratic Republic",code:"LA"},{name:"Latvia",code:"LV"},{name:"Lebanon",code:"LB"},{name:"Lesotho",code:"LS"},{name:"Liberia",code:"LR"},{name:"Libyan Arab Jamahiriya",code:"LY"},{name:"Liechtenstein",code:"LI"},{name:"Lithuania",code:"LT"},{name:"Luxembourg",code:"LU"},{name:"Macao",code:"MO"},{name:"Macedonia, The Former Yugoslav Republic of",code:"MK"},{name:"Madagascar",code:"MG"},{name:"Malawi",code:"MW"},{name:"Malaysia",code:"MY"},{name:"Maldives",code:"MV"},{name:"Mali",code:"ML"},{name:"Malta",code:"MT"},{name:"Marshall Islands",code:"MH"},{name:"Martinique",code:"MQ"},{name:"Mauritania",code:"MR"},{name:"Mauritius",code:"MU"},{name:"Mayotte",code:"YT"},{name:"Mexico",code:"MX"},{name:"Micronesia, Federated States of",code:"FM"},{name:"Moldova, Republic of",code:"MD"},{name:"Monaco",code:"MC"},{name:"Mongolia",code:"MN"},{name:"Montserrat",code:"MS"},{name:"Morocco",code:"MA"},{name:"Mozambique",code:"MZ"},{name:"Myanmar",code:"MM"},{name:"Namibia",code:"NA"},{name:"Nauru",code:"NR"},{name:"Nepal",code:"NP"},{name:"Netherlands",code:"NL"},{name:"Netherlands Antilles",code:"AN"},{name:"New Caledonia",code:"NC"},{name:"New Zealand",code:"NZ"},{name:"Nicaragua",code:"NI"},{name:"Niger",code:"NE"},{name:"Nigeria",code:"NG"},{name:"Niue",code:"NU"},{name:"Norfolk Island",code:"NF"},{name:"Northern Mariana Islands",code:"MP"},{name:"Norway",code:"NO"},{name:"Oman",code:"OM"},{name:"Pakistan",code:"PK"},{name:"Palau",code:"PW"},{name:"Palestinian Territory, Occupied",code:"PS"},{name:"Panama",code:"PA"},{name:"Papua New Guinea",code:"PG"},{name:"Paraguay",code:"PY"},{name:"Peru",code:"PE"},{name:"Philippines",code:"PH"},{name:"Pitcairn",code:"PN"},{name:"Poland",code:"PL"},{name:"Portugal",code:"PT"},{name:"Puerto Rico",code:"PR"},{name:"Qatar",code:"QA"},{name:"Reunion",code:"RE"},{name:"Romania",code:"RO"},{name:"Russian Federation",code:"RU"},{name:"Rwanda",code:"RW"},{name:"Saint Helena",code:"SH"},{name:"Saint Kitts and Nevis",code:"KN"},{name:"Saint Lucia",code:"LC"},{name:"Saint Pierre and Miquelon",code:"PM"},{name:"Saint Vincent and the Grenadines",code:"VC"},{name:"Samoa",code:"WS"},{name:"San Marino",code:"SM"},{name:"Sao Tome and Principe",code:"ST"},{name:"Saudi Arabia",code:"SA"},{name:"Senegal",code:"SN"},{name:"Serbia and Montenegro",code:"CS"},{name:"Seychelles",code:"SC"},{name:"Sierra Leone",code:"SL"},{name:"Singapore",code:"SG"},{name:"Slovakia",code:"SK"},{name:"Slovenia",code:"SI"},{name:"Solomon Islands",code:"SB"},{name:"Somalia",code:"SO"},{name:"South Africa",code:"ZA"},{name:"South Georgia and the South Sandwich Islands",code:"GS"},{name:"Spain",code:"ES"},{name:"Sri Lanka",code:"LK"},{name:"Sudan",code:"SD"},{name:"Suriname",code:"SR"},{name:"Svalbard and Jan Mayen",code:"SJ"},{name:"Swaziland",code:"SZ"},{name:"Sweden",code:"SE"},{name:"Switzerland",code:"CH"},{name:"Syrian Arab Republic",code:"SY"},{name:"Taiwan, Province of China",code:"TW"},{name:"Tajikistan",code:"TJ"},{name:"Tanzania, United Republic of",code:"TZ"},{name:"Thailand",code:"TH"},{name:"Timor-Leste",code:"TL"},{name:"Togo",code:"TG"},{name:"Tokelau",code:"TK"},{name:"Tonga",code:"TO"},{name:"Trinidad and Tobago",code:"TT"},{name:"Tunisia",code:"TN"},{name:"Turkey",code:"TR"},{name:"Turkmenistan",code:"TM"},{name:"Turks and Caicos Islands",code:"TC"},{name:"Tuvalu",code:"TV"},{name:"Uganda",code:"UG"},{name:"Ukraine",code:"UA"},{name:"United Arab Emirates",code:"AE"},{name:"United Kingdom",code:"GB"},{name:"United States",code:"US"},{name:"United States Minor Outlying Islands",code:"UM"},{name:"Uruguay",code:"UY"},{name:"Uzbekistan",code:"UZ"},{name:"Vanuatu",code:"VU"},{name:"Venezuela",code:"VE"},{name:"Vietnam",code:"VN"},{name:"Virgin Islands, British",code:"VG"},{name:"Virgin Islands, U.S.",code:"VI"},{name:"Wallis and Futuna",code:"WF"},{name:"Western Sahara",code:"EH"},{name:"Yemen",code:"YE"},{name:"Zambia",code:"ZM"},{name:"Zimbabwe",code:"ZW"}]}]),function(e){app.controller("SettingsCtrl",["$scope","$rootScope","$log","$modal","$state","WebsiteService","AccountService","UserService","toaster","$timeout","$location","SimpleSiteBuilderService","$window","SweetAlert","pageConstant","commerceConstant","$filter",function(t,n,a,o,i,s,r,c,l,u,d,p,m,g,f,h,v){t.keywords=[];var b={website:"Website Settings",commerce:"Commerce Settings",customers:"Customers Settings",emails:"Email Settings",all:"Settings"};t.clearAllNotifications=function(){t.account.email_preferences.new_contacts=!1,t.account.email_preferences.new_orders=!1,t.account.email_preferences.helpful_tips=!1},t.clearNoNotifications=function(){t.account.email_preferences.no_notifications=!1},t.settingsView="all",t.viewTitle=b.all,t.viewSettings=function(n,a){t.settingsView=n,t.viewTitle=b[n],u(function(){e.element('.sitesettings [heading="'+a+'"] a').triggerHandler("click")},0)},r.getUpdatedAccount(function(n){e.isDefined(n.showhide.blogSocialSharing)||(n.showhide.blogSocialSharing=!0),n.commerceSettings&&!n.commerceSettings.checkout&&(n.commerceSettings.checkout={redirectTimeout:h.redirect_timeout_options.defaultTimeOut}),t.account=n,t.originalAccount=e.copy(n),n.commerceSettings||(n.commerceSettings={taxes:!0,taxbased:"",taxnexus:""}),t.$watch(function(){return p.pages},function(a){if(e.isDefined(a)){var o=e.copy(a);o=o.filter(function(e){return"blog-post"!==e.handle&&"single-post"!==e.handle&&"coming-soon"!==e.handle});var i=_.findWhere(o,{handle:"blog-list"});n.showhide.blog?n.showhide.blog&&n.showhide.ssbBlog&&i?(o=o.filter(function(e){return"blog"!==e.handle}),i.handle="blog"):n.showhide.ssbBlog||(o=o.filter(function(e){return"blog-list"!==e.handle})):o=o.filter(function(e){return"blog-list"!==e.handle&&"blog"!==e.handle});var s={title:"Select a page",handle:""};t.allPages=o,t.allPages.splice(0,0,s)}})}),t.$watch(function(){return p.website},function(n){if(n){var a=!1;t.website=n,t.keywords=n.seo.keywords,t.website&&(!t.website.title&&t.account.business.name&&(t.website.title=e.copy(t.account.business.name),a=!0),t.website.seo||(t.website.seo={}),!t.website.seo.description&&t.account.business.description&&(t.website.seo.description=e.copy(t.account.business.description),a=!0)),a&&(t.saveLoading=!0,p.saveWebsite(t.website).then(function(e){t.saveLoading=!1}))}}),t.saveLoading=!1,t.saveSettings=function(){if(t.saveLoading=!0,!t.account.subdomain&&!t.account.domain)return t.saveLoading=!1,void l.pop("error","Subdomain can't be blank");if(t.account.commerceSettings.paypal&&!t.account.commerceSettings.paypalAddress)return t.saveLoading=!1,void l.pop("error","Paypal address can't be blank");if(t.account.commerceSettings.taxes&&"business_location"===t.account.commerceSettings.taxbased){var a=!0;if(t.account.business?t.account.business&&!t.account.business.addresses?a=!1:t.account.business&&t.account.business.addresses&&!t.account.business.addresses.length?a=!1:t.account.business&&t.account.business.addresses&&t.account.business.addresses.length&&""===t.account.business.addresses[0].zip&&(a=!1):a=!1,!a)return t.saveLoading=!1,void l.pop("error","Business Location tax basis requires an address on Business Profile")}r.updateAccount(t.account,function(a,o){if(o)t.saveLoading=!1,l.pop("error",o.message);else{var i=[];t.website.linkLists.forEach(function(e,t){"head-menu"===e.handle&&(i=e.links)});var s=_.findIndex(i,function(e){return e.linkTo.data===f.page_handles.BLOG});t.account.showhide.blog&&t.account.showhide.ssbBlog?-1===s&&i.push({label:f.page_handles.BLOG,type:"link",linkTo:{data:f.page_handles.BLOG,type:"page"}}):s>-1&&i.splice(s,1),p.updateBlogPages().then(function(a){p.saveWebsite(t.website).then(function(a){if(t.saveLoading=!1,l.pop("success"," Website Settings saved."),e.equals(t.account,t.originalAccount)||n.$broadcast("$refreshAccountSettings",t.account),t.account.subdomain!==t.originalAccount.subdomain){var o=d.absUrl().split(t.originalAccount.subdomain);m.location.href=o[0]+t.account.subdomain+o[1]}var i=r.getMainAccount();i&&(i.showhide.blog=t.account.showhide.blog),t.account.showhide.userScripts&&t.website.resources.toggles.userScripts&&p.updateScriptResource(t.website).then()})}),n.$broadcast("$refreshSocialAccounts")}})},t.insertFavicon=function(e){t.website.settings.favicon=e.url.replace(/^(http|https):/i,"")},t.removeFavicon=function(){t.website.settings.favicon=""},t.domainError=!1,t.modifysub={},t.modifysub.show=!1,t.checkDomainExists=function(e){e.subdomain=e.subdomain.replace(/ /g,"").replace(/\./g,"_").replace(/@/g,"").replace(/_/g," ").replace(/\W+/g,"").toLowerCase(),e.subdomain&&(t.checkingSubdomain=!0,t.originalAccount.subdomain!=e.subdomain?c.checkDuplicateSubdomain(e.subdomain,e._id,function(e){t.hasCheckedSubdomain=!0,a.debug("checkDomainExists",e),t.checkingSubdomain=!1,e.isDuplicate?t.domainError=!0:t.domainError=!1}):(t.hasCheckedSubdomain=!1,t.domainError=!1,t.checkingSubdomain=!1))},t.revertSubdomain=function(){t.hasCheckedSubdomain="",t.modifysub.show=!1,t.account.subdomain=t.originalAccount.subdomain},t.calculateTaxOptions=[{name:"Customer Shipping Address",value:"customer_shipping"},{name:"Customer Billing Address",value:"customer_billing"},{name:"Business Location",value:"business_location"}],t.redirectTimeoutOptions=h.redirect_timeout_options.dp,t.navigateTo=function(e,n){i.go(e),t.cancel(n)},t.openMediaModal=function(){t.showInsert=!0,t.modalInstance=o.open({templateUrl:"media-modal",controller:"MediaModalCtrl",size:"lg",keyboard:!0,backdrop:"static",resolve:{showInsert:function(){return t.showInsert},insertMedia:function(){return t.insertFavicon},isSingleSelect:function(){return!0}}})},t.closeModal=function(){t.modalInstance.close()},t.accountAddMetaFn=function(){t.website.metatags=t.website.metatags||[],t.website.metatags.push({name:"",value:""})},t.removeMeta=function(e){t.website.metatags.splice(e,1)},t.showAddMeta=function(e){return 0===e},t.toggleEnableBlog=function(e){e||g.swal({title:"Are you sure?",text:"Your blog and posts will no longer be accessible",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Ok",cancelButtonText:"Cancel",closeOnConfirm:!0,closeOnCancel:!0},function(n){n||(t.account.showhide.blog=!e)})},t.setDefaultShipping=function(e){e&&(e.chargeType||(e.chargeType="order"),e.charge||(e.charge="0.00"))},t.blogListResolutionOptions=[{label:"768",value:"768px"},{label:"960",value:"960px"},{label:"1024",value:"1024px"},{label:"1280",value:"1280px"},{label:"1360",value:"1360px"},{label:"1366",value:"1366px"},{label:"1440",value:"1440px"},{label:"1600",value:"1600px"},{label:"1680",value:"1680px"},{label:"1920",value:"1920px"},{label:"100%",value:"100%"}],t.spectrum={options:{showPalette:!0,clickoutFiresChange:!0,showInput:!0,showButtons:!1,allowEmpty:!0,hideAfterPaletteSelect:!1,showPaletteOnly:!0,togglePaletteOnly:!0,togglePaletteMoreText:"more",togglePaletteLessText:"less",preferredFormat:"hex",appendTo:"body",palette:[["#C91F37","#DC3023","#9D2933","#CF000F","#E68364","#F22613","#CF3A24","#C3272B","#8F1D21","#D24D57"],["#f47998","#F47983","#DB5A6B","#C93756","#FCC9B9","#FFB3A7","#F62459","#F58F84","#875F9A","#5D3F6A"],["#89729E","#763568","#8D608C","#A87CA0","#5B3256","#BF55EC","#8E44AD","#9B59B6","#BE90D4","#4D8FAC"],["#5D8CAE","#22A7F0","#19B5FE","#59ABE3","#48929B","#317589","#89C4F4","#4B77BE","#1F4788","#003171"],["#044F67","#264348","#7A942E","#8DB255","#5B8930","#6B9362","#407A52","#006442","#87D37C","#26A65B"],["#26C281","#049372","#2ABB9B","#16A085","#36D7B7","#03A678","#4DAF7C","#D9B611","#F3C13A","#F7CA18"],["#E2B13C","#A17917","#F5D76E","#F4D03F","#FFA400","#E08A1E","#FFB61E","#FAA945","#FFA631","#FFB94E"],["#E29C45","#F9690E","#CA6924","#F5AB35","#BFBFBF","#F2F1EF","#BDC3C7","#ECF0F1","#D2D7D3","#757D75"],["#EEEEEE","#ABB7B7","#6C7A89","#95A5A6"]]}}}])}(angular),function(e){app.controller("singleCustomerAnalyticsCtrl",["$scope","$modal","ChartAnalyticsService","$timeout","SiteAnalyticsService","$stateParams","$state","CustomerService","AnalyticsWidgetStateService",function(t,n,a,o,i,s,r,c,l){function u(){var e=moment().subtract(29,"days"),n=moment();t.accountDayDiffrence<1?e=moment().startOf("day"):t.accountDayDiffrence<6?(e=moment().subtract(1,"days").startOf("day"),n=moment().subtract(1,"days").endOf("day")):t.accountDayDiffrence<29&&(e=moment().subtract(6,"days").startOf("day"),n=moment().endOf("day")),t.date={startDate:e.format(),endDate:n.format()},t.selectedDate={startDate:e.startOf("day"),endDate:n},t.pickerOptions={startDate:e.toDate(),endDate:n.toDate(),format:"YYYY-MM-DD",opens:"left",ranges:{Today:[moment().startOf("day"),moment()],Yesterday:[moment().subtract(1,"days").startOf("day"),moment().subtract(1,"days").endOf("day")],"Last 7 Days":[moment().subtract(6,"days").startOf("day"),moment().endOf("day")],"Last 30 Days":[moment().subtract(29,"days").startOf("day"),moment().endOf("day")],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}}}function d(){window.Highcharts.charts.forEach(function(t){o(function(){e.isDefined(t)&&Object.keys(t).length&&t.reflow()},0)})}function p(e,t){var n=t.toLowerCase()+"_"+e.toLowerCase()+"_legend";return n=n.replace(/ /g,"_"),l.getNamedCustomerAnalyticsWidgetState(n)}function m(e,t,n){var a=e.toLowerCase()+"_"+t.toLowerCase()+"_legend";a=a.replace(/ /g,"_"),l.setCustomerAnalyticsWidgetStates(a,n)}t.analyticsOverviewConfig={},t.timeonSiteConfig={},t.trafficSourcesConfig={},t.newVsReturningConfig={},t.customerOverviewConfig={},t.analyticsOverviewConfig.title={text:""},t.timeonSiteConfig.title={text:""},t.trafficSourcesConfig.loading=!0,t.newVsReturningConfig.loading=!0,t.customerOverviewConfig.loading=!0,t.displayVisitors=!0,t.visitors=null;var g=0;g=window.chrome&&window.chrome.webstore||/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window["safari"]||safari.pushNotification).toString()?0:-6e4*(new Date).getTimezoneOffset(),t.Math=Math;var f=!1;t.$watch("selectedDate",function(n){e.isDefined(n)&&(t.date.startDate=moment(t.selectedDate.startDate).format(),t.date.endDate=moment(t.selectedDate.endDate).format(),f&&(t.analyticsOverviewConfig={},t.timeonSiteConfig={},t.trafficSourcesConfig={},t.newVsReturningConfig={},t.customerOverviewConfig={},t.analyticsOverviewConfig.title={text:""},t.timeonSiteConfig.title={text:""},t.locationData=null,t.countryLocationData=null,t.pagedformattedTopPages=null,t.runAnalyticsReports()),f=!0)}),t.runAnalyticsReports=function(){t.loadCharts=!0,a.runCustomerReports(t.date,s.customerId,function(n){var a,o=[];_.each(n.pageAnalyticsReport,function(e){var t={};e["url.path"]&&(t.page=e["url.path"],t.pageviews=e.pageviews,t.avgTime=Math.abs(e.avgTimeOnPage)/1e3,t.uniquePageviews=e.uniquePageviews),t&&o.push(t)}),a=o,n.formattedTopPages=o,n.pagedformattedTopPages=a,t.formattedTopPages=_.reject(o,function(t){return!e.isDefined(t.page)}),t.pagedformattedTopPages=_.reject(a,function(t){return!e.isDefined(t.page)}),t.setNewReportData(n)})},t.visitorDataReport=function(e,n){var o=[],i=0;_.each(e,function(e){var t=[],n=e.value||0;i+=n,t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+g),t.push(n),o.push(t)}),t.visitorsData=o;var s=0;_.each(n,function(e){var t=e.value||0;s+=t});var r=a.calculatePercentChange(s,i);t.visitors=i,t.visitorsPercent=r},t.locationReportData=function(e){var n=[];if(e){var o=[];_.each(e,function(e){e["ip_geo_info.province"]&&o.push(e)}),t.mostPopularState=_.max(o,function(e){return e.result}),_.each(e,function(e){var t=a.stateToAbbr(e["ip_geo_info.province"]);if(t){var o={};o.code=t,o.value=e.result,!_.find(n,function(t){return t.code===e.code})&&o.value&&n.push(o)}})}t.locationData=n},t.contentInteractionsReportData=function(e,n,o){var i=[];_.each(e,function(e){var t=[],n=e.count||e.value||0;t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+g),t.push(n),i.push(t)}),t.avgSessionData=i;var s=[],r=0;_.each(n,function(e){var t=[],n=e.count||e.value||0;r+=n,t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+g),t.push(n),s.push(t)}),t.bouncesData=s,a.timeOnSite(t.avgSessionData,t.bouncesData,function(e){t.timeonSiteConfig=e,t.timeonSiteConfig.loading=!1});var c=a.calculatePercentChange(o,r);t.bounces=r,t.bouncesPercent=c},t.setNewReportData=function(e){moment(t.date.endDate).diff(moment(t.date.startDate),"days")<=7?a.setGraunularity("hours"):a.setGraunularity("days");var n=0,i=0;_.each(e.visitorDeviceReport.result,function(e){var t=e["user_agent.device"];"desktop"===t?n=e.result:"mobile"===t&&(i=e.result)}),t.desktop=n,t.mobile=i,t.device_data_loaded=!0,t.visitorDataReport(e.userReport.currentMonth,e.userReport.previousMonth);var s=[],r=0;_.each(e.pageViewsReport.currentMonth,function(e){var t=[],n=e.value||0;r+=n,t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+g),t.push(n),s.push(t)}),t.pageviews=r,t.pageviewsData=s;var c=0;_.each(e.pageViewsReport.previousMonth,function(e){var t=e.value||0;c+=t}),t.pageviewsPreviousData=c;var l=a.calculatePercentChange(c,r);t.pageviewsPercent=l;var u=[],d=0;if(_.each(e.sessionsReport.currentMonth,function(e){var t=[],n=e.total||e.value||0;d+=n,t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+g),t.push(n),u.push(t)}),t.sessions=d,t.sessionsData=u,e.daily404sReport){var f=[];_.each(e.daily404sReport,function(e){var t=[];t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+g),t.push(e.total),f.push(t)}),t.fourOfours=f}e.four04sReport&&(t.fourOfoursDetails=e.four04sReport),a.analyticsOverview(t.pageviewsData,t.sessionsData,t.visitorsData,null,t.fourOfours,p,m,function(e){t.analyticsOverviewConfig=e,t.analyticsOverviewConfig.loading=!1});var h=0;_.each(e.sessionsReport.previousMonth,function(e){var t=e.total||e.value||0;h+=t});var v=a.calculatePercentChange(h,d);t.sessionsPercent=v;var b=e.sessionLengthReport,y=0;b.currentMonthAverage&&(y=b.currentMonthAverage/1e3);var w=a.secToTime(y);null===b.previousMonthAverage&&(b.previousMonthAverage=0),t.visitDuration=w;var C=b.previousMonthAverage,S=a.calculatePercentChange(C,b.currentMonthAverage);t.visitDurationPercent=S,t.contentInteractionsReportData(b.nonBounceAvg,b.bounceAvg,b.previousMonthBounceCount),t.trafficSourceData=a.mergeLiveTrafficData(e.trafficSourcesReport);var k=["New"],T=["Returning"];if(e.newVsReturningReport&&e.newVsReturningReport.length){_.each(e.newVsReturningReport,function(e){"new"===e._id?k.push(e.count):"returning"===e._id&&T.push(e.count)});P=[k,T]}else var P=[["New",0],["Returning",0]];t.newVsReturning=P,a.newVsReturning(t.newVsReturning,function(e){t.newVsReturningConfig=e,t.newVsReturningConfig.loading=!1});var D=[],A=[];if(e.visitorLocationsReport){var x=[];_.each(e.visitorLocationsReport,function(e){e["ip_geo_info.province"]&&x.push(e)}),t.mostPopularState=_.max(x,function(e){return e.result}),_.each(e.visitorLocationsReport,function(e){var t=a.stateToAbbr(e["ip_geo_info.province"]);if(t){var n={};n.code=t,n.value=e.result,!_.find(D,function(t){return t.code===e.code})&&n.value&&D.push(n)}})}if(e.visitorLocationsByCountryReport){var I=[];_.each(e.visitorLocationsByCountryReport,function(e){e["ip_geo_info.country"]&&"Unknown"!=e["ip_geo_info.country"]&&I.push(e)}),t.mostPopularCountry=_.max(I,function(e){return e.result}),_.each(e.visitorLocationsByCountryReport,function(e){var t=a.countryToAbbr(e["ip_geo_info.country"]);if(t&&"Unknown"!=t){var n={};n.code=t,n.value=e.result,!_.find(A,function(t){return t.code===e.code})&&n.value&&A.push(n)}})}var E=[],M={};if(e.userAgents){var B=0;_.each(e.userAgents,function(e){var t=e._id.browserName,n=e.count;M[t]?M[t]+=n:M[t]=n,B+=n}),t.browserTotal=B,E=E.concat(_.pairs(M)),E=_.sortBy(E,function(e){return e[1]}),t.userAgentData=E;var O=E.length-1;if(E.length){t.topBrowser=E[O][0];var L=Math.round(E[O][1]/B*100);t.browserPercent=L}a.userAgentChart(E,function(e){t.userAgentConfig=e,t.userAgentConfig.loading=!1,o(function(){$(window).resize()},0)}),t.userAgentTableData=E.reverse()}var F={xData:[],amountData:[],orderData:[]},j=0,U=0;_.each(e.revenueReport.currentMonth,function(e){F.xData.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+g);var t=e.total||0,n=e.count||0;F.amountData.push(t),F.orderData.push(n),j+=t,U+=n}),t.revenueData=F,t.revenue=parseFloat(j).toFixed(2),t.orderCount=U;var R=0,N=0;_.each(e.revenueReport.prevMonth,function(e){var t=e.total||0;R+=t;var n=e.count||0;N+=n}),t.revenuePreviousData=R;var V=a.calculatePercentChange(R,j);t.revenuePercent=V;var W=a.calculatePercentChange(N,U);t.ordersPercent=W,a.revenueOverview(t.revenueData,function(e){t.revenueConfig=e,t.revenueConfig.loading=!1});var z=[],q=0;_.each(e.emailsReport.emails,function(e){var t=[],n=e.total||0;t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+g),t.push(n),q+=n,z.push(t)});var H=[];_.each(e.emailsReport.campaigns,function(e){var t=[],n=e.total||0;t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+g),t.push(n),H.push(t)});var Y=[],G=0;_.each(e.emailsReport.opens,function(e){var t=[],n=e.total||0;t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+g),t.push(n),G+=n,Y.push(t)});var J=[],K=0;_.each(e.emailsReport.clicks,function(e){var t=[],n=e.total||0;t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+g),t.push(n),K+=n,J.push(t)}),a.emailsOverview(z,H,Y,J,function(e){t.emailsOverviewConfig=e,t.emailsOverviewConfig.loading=!1,t.totalEmails=q,t.totalOpens=G,t.totalClicks=K}),t.locationData=D,t.locationLabel="States",t.locationsLength=D.length,t.mostPopularLabel=t.mostPopularState["ip_geo_info.province"],t.countryLocationData=A,t.locationLabelCountry="Countries",t.locationsLengthCountry=t.countryLocationData.length,t.mostPopularLabelCountry=t.mostPopularCountry["ip_geo_info.country"],t.displayVisitors=t.visitors>0,t.renderAnalyticsCharts()},t.setReportData=function(e){t.legacyData=e,t.runNewReports();var n,o;_.each(e[1].result,function(e){var t=e["user_agent.device"];"desktop"===t&&(n=e.result),o="mobile"===t?e.result:0}),t.desktop=n,t.mobile=o,t.device_data_loaded=!0,t.visitorDataReport(e[2].result,e[3].result);var i=[],s=0;_.each(e[4].result,function(e){var t=[],n=e.value||0;s+=n,t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+g),t.push(n),i.push(t)}),t.pageviews=s,t.pageviewsData=i;var r=0;_.each(e[5].result,function(e){var t=e.value||0;r+=t}),t.pageviewsPreviousData=r;var c=a.calculatePercentage(s,r);t.pageviewsPercent=c;var l=[],u=0;if(_.each(e[6].result,function(e){var t=[],n=e.value||0;u+=n,t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+g),t.push(n),l.push(t)}),t.sessions=u,t.sessionsData=l,e.daily404sReport){var d=[];_.each(e.daily404sReport,function(e){var t=[];t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+g),t.push(e.value),d.push(t)}),t.fourOfours=d}e.four04sReport&&(t.fourOfoursDetails=e.four04sReport),a.analyticsOverview(t.pageviewsData,t.sessionsData,t.visitorsData,null,t.fourOfours,p,m,function(e){t.$apply(function(){t.analyticsOverviewConfig=e}),t.analyticsOverviewConfig.loading=!1});var f=0;_.each(e[7].result,function(e){var t=e.value||0;f+=t});var h=a.calculatePercentage(u,f);t.sessionsPercent=h;var v=0;e[9].result&&(v=e[9].result/1e3);var b=a.secToTime(v);null===e[15].result&&(e[15].result=0),t.visitDuration=b;var y=e[15].result,w=a.calculatePercentage(e[9].result,y);t.visitDurationPercent=w,t.contentInteractionsReportData(e[8].result,e[10].result,e[11].result),t.trafficSourceData=e[12].result;var C=[["New",e[14].result],["Returning",e[13].result]];t.newVsReturning=C,a.newVsReturning(t.newVsReturning,function(e){t.newVsReturningConfig=e,t.newVsReturningConfig.loading=!1}),t.locationReportData(e[0].result),t.displayVisitors=t.visitors>0,t.renderAnalyticsCharts()},t.renderAnalyticsCharts=function(){$("#visitor_locations").length?(o(function(){var n=e.copy(t.locationData),o=e.copy(t.countryLocationData);a.visitorLocations(n,Highcharts.maps["countries/us/us-all"],o,Highcharts.maps["custom/world"]),a.visitorLocationsGlobal(n,Highcharts.maps["countries/us/us-all"],o,Highcharts.maps["custom/world"])},200),t.displayVisitors):o(function(){t.renderAnalyticsCharts()},100)},t.displayDatePicker=function(){o(function(){e.element(".dashboard-date-picker").click()},0)},t.$on("$renderSingleCustomerAnalytics",function(e,n){o(function(){t.loadCharts||c.getSingleCustomer(s.customerId,function(e,n){if(n.created&&n.created.date){var a=moment(n.created.date),o=moment();t.accountDayDiffrence=o.diff(a,"days")}else t.accountDayDiffrence=30;u(),t.runAnalyticsReports()})},0),d()}),t.$watch("overview",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(l.setCustomerAnalyticsWidgetStates("overview",n),d())}),t.$watch("locations",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(l.setCustomerAnalyticsWidgetStates("locations",n),d())}),t.$watch("locationsGlobal",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(l.setCustomerAnalyticsWidgetStates("locationsGlobal",n),d())}),t.$watch("interactions",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(l.setCustomerAnalyticsWidgetStates("interactions",n),d())}),t.$watch("device",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(l.setCustomerAnalyticsWidgetStates("device",n),d())}),t.$watch("newVReturning",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(l.setCustomerAnalyticsWidgetStates("newVReturning",n),d())}),t.$watch("trafficSources",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(l.setCustomerAnalyticsWidgetStates("trafficSources",n),d())}),t.$watch("pageanalytics",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(l.setCustomerAnalyticsWidgetStates("pageanalytics",n),d())}),t.$watch("ua",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(l.setCustomerAnalyticsWidgetStates("ua",n),d())}),t.$watch("userAgentsTable",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(l.setCustomerAnalyticsWidgetStates("userAgentsTable",n),d())}),t.$watch("rev",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(l.setCustomerAnalyticsWidgetStates("rev",n),d())}),t.$watch("campaigns",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(l.setCustomerAnalyticsWidgetStates("campaigns",n),d())}),t.setAnalyticsWidgetStates=function(){l.getCustomerAnalyticsWidgetStates(),o(function(){t.overview=l.customerAnalyticsWidgetStateConfig.overview,t.locations=l.customerAnalyticsWidgetStateConfig.locations,t.locationsGlobal=l.siteAnalyticsWidgetStateConfig.locationsGlobal,t.interactions=l.customerAnalyticsWidgetStateConfig.interactions,t.device=l.customerAnalyticsWidgetStateConfig.device,t.newVReturning=l.customerAnalyticsWidgetStateConfig.newVReturning,t.trafficSources=l.customerAnalyticsWidgetStateConfig.trafficSources,t.pageanalytics=l.customerAnalyticsWidgetStateConfig.pageanalytics,t.ua=l.customerAnalyticsWidgetStateConfig.ua,t.userAgentsTable=l.customerAnalyticsWidgetStateConfig.userAgentsTable,t.rev=l.customerAnalyticsWidgetStateConfig.rev,t.campaigns=l.customerAnalyticsWidgetStateConfig.campaigns,t.dataLoaded=!0,d()},0)},t.$watchGroup(["app.layout.isAnalyticsDashboardMode","app.layout.isSidebarClosed"],function(t,n){(e.isDefined(t)||e.isDefined(n))&&d()})}])}(angular),function(e){app.controller("siteAnalyticsCtrl",["$scope","$modal","UserService","ChartAnalyticsService","$timeout","SiteAnalyticsService","AnalyticsWidgetStateService","$location","$interval","analyticsConstant","$rootScope",function(t,n,a,o,i,s,r,c,l,u,d){function p(){if("today"===c.search().date_filter)t.date={startDate:moment().startOf("day").format(),endDate:moment().format()},t.selectedDate={startDate:moment().startOf("day").format(),endDate:moment().format()},t.pickerOptions={startDate:moment().startOf("day").toDate(),endDate:moment().toDate(),format:"YYYY-MM-DD",opens:"left",ranges:{Today:[moment().startOf("day"),moment()],Yesterday:[moment().subtract(1,"days").startOf("day"),moment().subtract(1,"days").endOf("day")],"Last 7 Days":[moment().subtract(6,"days").startOf("day"),moment().endOf("day")],"Last 30 Days":[moment().subtract(29,"days").startOf("day"),moment().endOf("day")],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}};else{var e=moment().subtract(29,"days"),n=moment();t.accountDayDiffrence<1?e=moment().startOf("day"):t.accountDayDiffrence<6?(e=moment().subtract(1,"days").startOf("day"),n=moment().subtract(1,"days").endOf("day")):t.accountDayDiffrence<29&&(e=moment().subtract(6,"days").startOf("day"),n=moment().endOf("day")),t.date={startDate:e.format(),endDate:n.format()},t.selectedDate={startDate:e.startOf("day"),endDate:n},t.pickerOptions={startDate:e.toDate(),endDate:n.toDate(),format:"YYYY-MM-DD",opens:"left",ranges:{Today:[moment().startOf("day"),moment()],Yesterday:[moment().subtract(1,"days").startOf("day"),moment().subtract(1,"days").endOf("day")],"Last 7 Days":[moment().subtract(6,"days").startOf("day"),moment().endOf("day")],"Last 30 Days":[moment().subtract(29,"days").startOf("day"),moment().endOf("day")],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}}}}function m(){window.Highcharts.charts.forEach(function(t){i(function(){e.isDefined(t)&&Object.keys(t).length&&t.reflow()},0)})}function g(){d.app.layout.isAnalyticsDashboardMode=!0,w=l(function(){t.runAnalyticsReports(),t.siteTraffic()},t.analyticsRefreshAfterTime)}function f(){d.app.layout.isAnalyticsDashboardMode=!1,e.isDefined(w)&&(l.cancel(w),w=void 0)}function h(e,t){var n=t.toLowerCase()+"_"+e.toLowerCase()+"_legend";return n=n.replace(/ /g,"_"),r.getNamedSiteAnalyticsWidgetState(n)}function v(e,t,n){var a=e.toLowerCase()+"_"+t.toLowerCase()+"_legend";a=a.replace(/ /g,"_"),r.setSiteAnalyticsWidgetStates(a,n)}t.analyticsRefreshAfterTime=u.refreshAfterTime,t.analyticsOverviewConfig={},t.timeonSiteConfig={},t.trafficSourcesConfig={},t.newVsReturningConfig={},t.customerOverviewConfig={},t.analyticsOverviewConfig.title={text:""},t.timeonSiteConfig.title={text:""},t.trafficSourcesConfig.loading=!0,t.newVsReturningConfig.loading=!0,t.customerOverviewConfig.loading=!0,t.displayVisitors=!0,t.visitors=null;var b=0;b=window.chrome&&window.chrome.webstore||/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window["safari"]||safari.pushNotification).toString()?0:-6e4*(new Date).getTimezoneOffset(),t.Math=Math;var y=!1;t.$watch("selectedDate",function(n){e.isDefined(n)&&(t.date.startDate=moment(t.selectedDate.startDate).format(),t.date.endDate=moment(t.selectedDate.endDate).format(),y&&(t.analyticsOverviewConfig={},t.timeonSiteConfig={},t.trafficSourcesConfig={},t.newVsReturningConfig={},t.customerOverviewConfig={},t.analyticsOverviewConfig.title={text:""},t.timeonSiteConfig.title={text:""},t.locationData=null,t.countryLocationData=null,t.pagedformattedTopPages=null,t.runAnalyticsReports(t.analyticsAccount)),y=!0)}),a.getAccount(function(e){if(t.analyticsAccount=e,e.created&&e.created.date){var n=moment(e.created.date),a=moment();t.accountDayDiffrence=a.diff(n,"days")}else t.accountDayDiffrence=30;p(),t.runAnalyticsReports(),t.siteTraffic()}),t.siteTraffic=function(){o.getSiteAnalyticsTraffic(function(e){var n=_.pluck(e,"count"),a=o.liveTraffic(n);t.liveTraffic=e,t.liveTrafficConfig=a,i(t.updatesiteTraffic,6e4)})},t.updatesiteTraffic=function(){o.getSiteAnalyticsTraffic(function(e){var n=$("#live-traffic-chart").highcharts();n&&n.series[0].setData(_.pluck(e,"count"),!0),t.liveTraffic=e,i(t.updatesiteTraffic,6e4)})},t.runAnalyticsReports=function(){o.runIndividualMongoReports(t.date,t.analyticsAccount,function(n){var a,o=[];n.pageAnalytics&&(_.each(n.pageAnalytics,function(e){var t={};e["url.path"]&&(t.page=e["url.path"],t.pageviews=e.pageviews,t.avgTime=Math.abs(e.avgTimeOnPage)/1e3,t.uniquePageviews=e.uniquePageviews),t&&o.push(t)}),a=o,n.formattedTopPages=o,n.pagedformattedTopPages=a,t.formattedTopPages=_.reject(o,function(t){return!e.isDefined(t.page)}),t.pagedformattedTopPages=_.reject(a,function(t){return!e.isDefined(t.page)})),t.setNewReportData(n)})},t.runAnalyticsReports1=function(){o.runPagedReports(t.date,t.analyticsAccount,function(n){t.formattedTopPages=_.reject(n.formattedTopPages,function(t){return!e.isDefined(t.page)}),t.pagedformattedTopPages=_.reject(n.pagedformattedTopPages,function(t){return!e.isDefined(t.page)})}),o.runReports(t.date,t.analyticsAccount,function(e){t.setReportData(e)})},t.visitorDataReport=function(e,n){var a=[],i=0;_.each(e,function(e){var t=[],n=e.value||0;i+=n,t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(n),a.push(t)}),t.visitorsData=a;var s=0;_.each(n,function(e){var t=e.value||0;s+=t});var r=o.calculatePercentChange(s,i);t.visitors=i,t.visitorsPercent=r},t.locationReportData=function(e){var n=[];if(e){var a=[];_.each(e,function(e){e["ip_geo_info.province"]&&a.push(e)}),t.mostPopularState=_.max(a,function(e){return e.result}),_.each(e,function(e){var t=o.stateToAbbr(e["ip_geo_info.province"]);if(t){var a={};a.code=t,a.value=e.result,!_.find(n,function(t){return t.code===e.code})&&a.value&&n.push(a)}})}t.locationData=n},t.contentInteractionsReportData=function(e,n,a){var i=[];_.each(e,function(e){var t=[],n=e.count||e.value||0;t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(n),i.push(t)}),t.avgSessionData=i;var s=[],r=0;_.each(n,function(e){var t=[],n=e.count||e.value||0;r+=n,t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(n),s.push(t)}),t.bouncesData=s,o.timeOnSite(t.avgSessionData,t.bouncesData,function(e){t.timeonSiteConfig=e,t.timeonSiteConfig.loading=!1});var c=o.calculatePercentChange(a,r);t.bounces=r,t.bouncesPercent=c},t.setNewReportData=function(e){moment(t.date.endDate).diff(moment(t.date.startDate),"days")<=7?o.setGraunularity("hours"):o.setGraunularity("days");var n=0,a=0;if(e.visitorDevices&&(_.each(e.visitorDevices.result,function(e){var t=e["user_agent.device"];"desktop"===t?n=e.result:"mobile"===t&&(a=e.result)}),t.desktop=n,t.mobile=a,t.device_data_loaded=!0),e.users&&t.visitorDataReport(e.users.currentMonth,e.users.previousMonth),e.daily404s){var s=[];_.each(e.daily404s,function(e){var t=[];t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(e.total),s.push(t)}),t.fourOfours=s}if(e["404s"]&&(t.fourOfoursDetails=e["404s"]),e.pageviews){var r=[],c=0;_.each(e.pageviews.currentMonth,function(e){var t=[],n=e.value||0;c+=n,t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(n),r.push(t)}),t.pageviews=c,t.pageviewsData=r;var l=0;_.each(e.pageviews.previousMonth,function(e){var t=e.value||0;l+=t}),t.pageviewsPreviousData=l;var u=o.calculatePercentChange(l,c);t.pageviewsPercent=u}if(e.sessions){var d=[],p=0;_.each(e.sessions.currentMonth,function(e){var t=[],n=e.total||e.value||0;p+=n,t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(n),d.push(t)}),t.sessions=p,t.sessionsData=d;var m=0;_.each(e.sessions.previousMonth,function(e){var t=e.total||e.value||0;m+=t});var g=o.calculatePercentChange(m,p);t.sessionsPercent=g}if(t.pageviewsData&&t.sessionsData&&t.visitorsData&&t.fourOfours&&o.analyticsOverview(t.pageviewsData,t.sessionsData,t.visitorsData,null,t.fourOfours,h,v,function(e){t.analyticsOverviewConfig=e,t.analyticsOverviewConfig.loading=!1}),e.sessionLength){var f=e.sessionLength,y=0;f.currentMonthAverage&&(y=f.currentMonthAverage/1e3);var w=o.secToTime(y);null===f.previousMonthAverage&&(f.previousMonthAverage=0),t.visitDuration=w;var C=f.previousMonthAverage,S=o.calculatePercentChange(C,f.currentMonthAverage);t.visitDurationPercent=S,t.contentInteractionsReportData(f.nonBounceAvg,f.bounceAvg,f.previousMonthBounceCount)}if(e.trafficSources&&(t.trafficSourceData=e.trafficSources),e.newVsReturning){var k=["New"],T=["Returning"];if(e.newVsReturning&&e.newVsReturning.length){_.each(e.newVsReturning,function(e){"new"===e._id?k.push(e.count):"returning"===e._id&&T.push(e.count)});P=[k,T]}else var P=[["New",0],["Returning",0]];t.newVsReturning=P,o.newVsReturning(t.newVsReturning,function(e){t.newVsReturningConfig=e,t.newVsReturningConfig.loading=!1})}var D=[],A=[];if(e.visitorLocations){var x=[];_.each(e.visitorLocations,function(e){e["ip_geo_info.province"]&&x.push(e)}),t.mostPopularState=_.max(x,function(e){return e.result}),_.each(e.visitorLocations,function(e){var t=o.stateToAbbr(e["ip_geo_info.province"]);if(t){var n={};n.code=t,n.value=e.result,!_.find(D,function(t){return t.code===e.code})&&n.value&&D.push(n)}})}if(e.visitorLocationsByCountry){var I=[];_.each(e.visitorLocationsByCountry,function(e){e["ip_geo_info.country"]&&"Unknown"!=e["ip_geo_info.country"]&&I.push(e)}),t.mostPopularCountry=_.max(I,function(e){return e.result}),_.each(e.visitorLocationsByCountry,function(e){var t=o.countryToAbbr(e["ip_geo_info.country"]);if(t&&"Unknown"!=t){var n={};n.code=t,n.value=e.result,!_.find(A,function(t){return t.code===e.code})&&n.value&&A.push(n)}})}e.visitorLocations&&e.visitorLocationsByCountry&&(t.locationData=D,t.locationLabel="States",t.locationsLength=D.length,t.mostPopularLabel=t.mostPopularState["ip_geo_info.province"],t.countryLocationData=A,t.locationLabelCountry="Countries",t.locationsLengthCountry=t.countryLocationData.length,t.mostPopularLabelCountry=t.mostPopularCountry["ip_geo_info.country"],t.renderVisitorCharts());var E=[],M={};if(e.userAgents){var B=0;_.each(e.userAgents,function(e){var t=e._id.browserName,n=e.count;M[t]?M[t]+=n:M[t]=n,B+=n}),t.browserTotal=B,E=E.concat(_.pairs(M)),E=_.sortBy(E,function(e){return e[1]}),t.userAgentData=E;var O=E.length-1;if(E.length){t.topBrowser=E[O][0];var L=Math.round(E[O][1]/B*100);t.browserPercent=L}o.userAgentChart(E,function(e){t.userAgentConfig=e,t.userAgentConfig.loading=!1,i(function(){$(window).resize()},0)}),t.userAgentTableData=E.reverse()}if(e.revenue){var F={xData:[],amountData:[],orderData:[]},j=0,U=0;_.each(e.revenue.currentMonth,function(e){F.xData.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b);var t=e.total||0,n=e.count||0;F.amountData.push(t),F.orderData.push(n),j+=t,U+=n}),t.revenueData=F,t.revenue=parseFloat(j).toFixed(2),t.orderCount=U;var R=0,N=0;_.each(e.revenue.prevMonth,function(e){var t=e.total||0;R+=t;var n=e.count||0;N+=n}),t.revenuePreviousData=R;var V=o.calculatePercentChange(R,j);t.revenuePercent=V;var W=o.calculatePercentChange(N,U);t.ordersPercent=W,o.revenueOverview(t.revenueData,function(e){t.revenueConfig=e,t.revenueConfig.loading=!1})}t.displayVisitors=t.visitors>0},t.setReportData=function(e){t.legacyData=e,t.runNewReports();var n,a;_.each(e[1].result,function(e){var t=e["user_agent.device"];"desktop"===t&&(n=e.result),a="mobile"===t?e.result:0}),t.desktop=n,t.mobile=a,t.device_data_loaded=!0,t.visitorDataReport(e[2].result,e[3].result);var i=[],s=0;_.each(e[4].result,function(e){var t=[],n=e.value||0;s+=n,t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()),t.push(n),i.push(t)}),t.pageviews=s,t.pageviewsData=i;var r=0;_.each(e[5].result,function(e){var t=e.value||0;r+=t}),t.pageviewsPreviousData=r;var c=o.calculatePercentage(s,r);if(t.pageviewsPercent=c,e.daily404s){var l=[];_.each(e.daily404s,function(e){var t=[];t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(e.total),l.push(t)}),t.fourOfours=l}e["404s"]&&(t.fourOfoursDetails=e["404s"]);var u=[],d=0;_.each(e[6].result,function(e){var t=[],n=e.value||0;d+=n,t.push(new Date(e.timeframe.start.replace(" ","T")).getTime()+b),t.push(n),u.push(t)}),t.sessions=d,t.sessionsData=u,o.analyticsOverview(t.pageviewsData,t.sessionsData,t.visitorsData,null,t.fourOfours,h,v,function(e){t.$apply(function(){t.analyticsOverviewConfig=e}),t.analyticsOverviewConfig.loading=!1});var p=0;_.each(e[7].result,function(e){var t=e.value||0;p+=t});var m=o.calculatePercentage(d,p);t.sessionsPercent=m;var g=0;e[9].result&&(g=e[9].result/1e3);var f=o.secToTime(g);null===e[15].result&&(e[15].result=0),t.visitDuration=f;var y=e[15].result,w=o.calculatePercentage(e[9].result,y);t.visitDurationPercent=w,t.contentInteractionsReportData(e[8].result,e[10].result,e[11].result),t.trafficSourceData=e[12].result;var C=[["New",e[14].result],["Returning",e[13].result]];t.newVsReturning=C,o.newVsReturning(t.newVsReturning,function(e){t.newVsReturningConfig=e,t.newVsReturningConfig.loading=!1}),t.locationReportData(e[0].result),t.displayVisitors=t.visitors>0},t.renderVisitorCharts=function(){$("#visitor_locations").length?(i(function(){var n=e.copy(t.locationData),a=e.copy(t.countryLocationData);o.visitorLocations(n,Highcharts.maps["countries/us/us-all"],a,Highcharts.maps["custom/world"]),o.visitorLocationsGlobal(n,Highcharts.maps["countries/us/us-all"],a,Highcharts.maps["custom/world"])},200),t.displayVisitors):i(function(){t.renderVisitorCharts()},100)},t.renderAnalyticsCharts=function(){$("#visitor_locations").length?(i(function(){var n=e.copy(t.locationData),a=e.copy(t.countryLocationData);o.visitorLocations(n,Highcharts.maps["countries/us/us-all"],a,Highcharts.maps["custom/world"]),o.visitorLocationsGlobal(n,Highcharts.maps["countries/us/us-all"],a,Highcharts.maps["custom/world"])},200),t.displayVisitors):i(function(){t.renderAnalyticsCharts()},100)},t.displayDatePicker=function(){i(function(){e.element(".deshboard-date-picker").click()},0)},t.$watch("overview",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(r.setSiteAnalyticsWidgetStates("overview",n),m())}),t.$watch("locations",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(r.setSiteAnalyticsWidgetStates("locations",n),m())}),t.$watch("locationsGlobal",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(r.setSiteAnalyticsWidgetStates("locationsGlobal",n),m())}),t.$watch("interactions",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(r.setSiteAnalyticsWidgetStates("interactions",n),m())}),t.$watch("device",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(r.setSiteAnalyticsWidgetStates("device",n),m())}),t.$watch("newVReturning",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(r.setSiteAnalyticsWidgetStates("newVReturning",n),m())}),t.$watch("trafficSources",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(r.setSiteAnalyticsWidgetStates("trafficSources",n),m())}),t.$watch("pageanalytics",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(r.setSiteAnalyticsWidgetStates("pageanalytics",n),m())}),t.$watch("analytics404",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(r.setSiteAnalyticsWidgetStates("analytics404",n),m())}),t.$watch("ua",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(r.setSiteAnalyticsWidgetStates("ua",n),m())}),t.$watch("userAgentsTable",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(r.setSiteAnalyticsWidgetStates("userAgentsTable",n),m())}),t.$watch("rev",function(n,a){e.isDefined(n)&&e.isDefined(a)&&!e.equals(n,a)&&t.dataLoaded&&(r.setSiteAnalyticsWidgetStates("rev",n),m())}),t.setAnalyticsWidgetStates=function(){r.getSiteAnalyticsWidgetStates(),i(function(){t.overview=r.siteAnalyticsWidgetStateConfig.overview,t.locations=r.siteAnalyticsWidgetStateConfig.locations,t.locationsGlobal=r.siteAnalyticsWidgetStateConfig.locationsGlobal,t.interactions=r.siteAnalyticsWidgetStateConfig.interactions,t.device=r.siteAnalyticsWidgetStateConfig.device,t.newVReturning=r.siteAnalyticsWidgetStateConfig.newVReturning,t.trafficSources=r.siteAnalyticsWidgetStateConfig.trafficSources,t.pageanalytics=r.siteAnalyticsWidgetStateConfig.pageanalytics,t.analytics404=r.siteAnalyticsWidgetStateConfig.analytics404,t.ua=r.siteAnalyticsWidgetStateConfig.ua,t.userAgentsTable=r.siteAnalyticsWidgetStateConfig.userAgentsTable,t.rev=r.siteAnalyticsWidgetStateConfig.rev,t.dataLoaded=!0,m()},0)},t.uiState={dashboardMode:!1},t.$watch("uiState.dashboardMode",function(t){e.isDefined(t)&&(t?g():f())});var w=void 0;t.$watchGroup(["app.layout.isAnalyticsDashboardMode","app.layout.isSidebarClosed"],function(t,n){(e.isDefined(t)||e.isDefined(n))&&m()})}])}(angular),app.controller("SliderCtrl",["$scope",function(e){e.sliders={},e.sliders.sliderValue=90,e.sliders.secondSliderValue=75,e.sliders.thirdSliderValue=65,e.sliders.fourthSliderValue=50,e.sliders.fifthSliderValue=70,e.sliders.sixthSliderValue=80,e.sliders.verticalSliderValue=90,e.sliders.secondVerticalSliderValue=75,e.sliders.thirdVerticalSliderValue=65,e.sliders.fourthVerticalSliderValue=50,e.sliders.fifthVerticalSliderValue=70,e.sliders.sixthVerticalSliderValue=80,e.testOptions={min:0,max:100,step:1,value:7,rangeValue:[2,20]},e.sliders.rangeSliderValue=[10,50],e.sliders.statusSliderValue=5,e.myFormater=function(e){return e+"%"}}]),function(e){app.controller("SocialFeedCtrl",["$scope","$log","$q","toaster","$modal","$filter","$location","WebsiteService","UserService","SocialConfigService","$timeout",function(t,n,a,o,i,s,r,c,l,u,d){t.init=function(){t.followModalCheckmarks={},t.trackedAccounts=[],t.feed=[],t.feedLengths={},t.orderByAttribute="date",t.addComment={},t.followers=[]},t.init(),t.openModal=function(e){t.modalInstance=i.open({templateUrl:e,keyboard:!0,backdrop:"static",scope:t})},t.closeModal=function(){t.modalInstance.close()},t.getSocialConfig=function(){u.getAllSocialConfig(function(e){t.initializeSocialConfig(e)})},t.productionReadyAccount=function(e){return"tw"===e.type||"fb"===e.type},t.initializeSocialConfig=function(e){t.config=e,_.each(e.trackedAccounts,function(e){"account"===e.accountType&&"fb"===e.type&&u.getFBProfile(e.id,function(t){e.profile=t}),"adminpage"===e.accountType&&"fb"===e.type&&u.getFBPageInfo(e.id,e.socialId,function(t){e.profile=t}),e.checked=!0,t.trackedAccounts.push(e),e.toggle&&("tw"===e.type&&(u.getTwitterFeed(e.id,function(n){t.feedLengths[e.id]=n.length,_.each(n,function(n){n.trackedId=e.id,t.feed.push(n)})}),u.getTwitterFollowers(e.id,function(n){t.followers=n,t.feedLengths[e.id]=n.length,_.each(n,function(n){n.trackedId=e.id,t.feed.push(n)})})),"fb"===e.type&&u.getFBPosts(e.id,function(n){t.feedLengths[e.id]=n.length,_.each(n,function(n){n.trackedId=e.id,n.from.profile_pic="https://graph.facebook.com/"+n.from.sourceId+"/picture?width=32&height=32",t.feed.push(n),1==t.trackedAccounts.length&&(t.selectedSocial=t.trackedAccounts[0])})}))}),d(function(){t.$apply(function(){t.isLoaded=!0})},1500),t.displayFeed=t.feed},t.filterFeed=function(e){var n=_.find(t.trackedAccounts,function(t){return t.id===e.id}),a="";e.checked?(a=_.filter(t.feed,function(e){return e.trackedId===n.id}),_.each(a,function(e){t.displayFeed.push(e)})):(a=_.filter(t.displayFeed,function(e){return e.trackedId!==n.id}),t.displayFeed=a)},t.addPageFeed=function(e){var n=_.find(t.config.trackedAccounts,function(t){return t.id===e.id});n.toggle=!0,u.updateTrackedAccount(n,function(e){n.checked=!0,"fb"===n.type&&u.getFBPosts(n.id,function(e){t.feedLengths[n.id]=e.length,_.each(e,function(e){e.trackedId=n.id,t.feed.push(e),t.displayFeed.push(e)})}),t.minRequirements=!0,o.pop("success","Feed Added")})},t.removePageFeed=function(e){var n=_.find(t.config.trackedAccounts,function(t){return t.id===e.id});n.toggle=!1,u.updateTrackedAccount(n,function(e){var a=_.filter(t.displayFeed,function(e){return e.trackedId!==n.id});t.displayFeed=a,o.pop("warning","Social feed removed.")})},t.postContent=null,t.postToSocial=function(e,n,a){return t.postContent?t.selectedSocial?(t.postingToSocial=!0,"fb"===a&&t.handleFBPost(e,n),void("tw"===a&&t.handleTwitterPost(e,n))):(t.noPostTo=!0,!1):(t.noContent=!0,!1)},t.postContentChange=function(){t.postContent&&(t.noContent=!1)},t.handleFBPost=function(e,n){u.postFBPost(e,n,function(n){if(n.error)return t.postingToSocial=!1,t.duplicatePostError=!0,!1;u.getFBPosts(e,function(a){var o=_.findWhere(a,{sourceId:n});o&&(t.displayFeed.push(o),t.feedLengths[e]=a.length),t.afterPosting()})})},t.handleTwitterPost=function(e,n){u.postTwitterPost(e,n,function(n){u.getTwitterFeed(e,function(a){var o=_.findWhere(a,{sourceId:n.id_str});o&&(t.displayFeed.push(o),t.feedLengths[e]=a.length),t.afterPosting()})})},t.afterPosting=function(){t.duplicatePostError=!1,t.postingToSocial=!1,t.postContent=null},t.addCommentAdminPage=null,t.postToChange=function(e){t.noPostTo=!1,t.selectedSocial=e,t.addCommentAdminPage=e},t.showLikeModal=function(n){t.tempPost=n,t.openModal("like-unlike-modal"),t.tempTrackedAccounts=e.copy(t.trackedAccounts),_.each(t.tempTrackedAccounts,function(e,n){t.tempTrackedAccounts[n].liked=t.checkLikeExistFn(e)})},t.showFavModal=function(a){n.debug("--showFavModal"),t.tempPost=a,t.openModal("fav-unfav-modal"),t.tempTrackedAccounts=e.copy(t.trackedAccounts),_.each(t.tempTrackedAccounts,function(e,n){t.tempTrackedAccounts[n].favorited=t.checkFavExistFn(e)})},t.showFollowModal=function(a){n.debug("--showFollowModal"),t.tempPost=a,t.openModal("follow-modal"),t.tempTrackedAccounts=e.copy(t.trackedAccounts),_.each(t.tempTrackedAccounts,function(e,n){t.followModalCheckmarks[e.socialId]=!1})},t.showTweetModal=function(n){_.each(n.comments,function(e){}),t.addComment.post=n,t.tempTrackedAccounts=e.copy(t.trackedAccounts),t.addComment.comment="@"+n.from.name+" ",t.openModal("twitter-comments-modal")},t.showTweetDMModal=function(n){_.each(n.comments,function(e){}),t.addComment.post=n,t.tempTrackedAccounts=e.copy(t.trackedAccounts),t.openModal("twitter-direct-message-modal")},t.showRetweetModal=function(n){_.each(n.comments,function(e){}),t.addComment.post=n,t.tempTrackedAccounts=e.copy(t.trackedAccounts),t.openModal("twitter-retweet-modal")},t.showCommentModal=function(e){_.each(e.comments,function(e){e.picture="https://graph.facebook.com/"+e.sourceId+"/picture?width=32&height=32"}),t.tempPost=e,t.visibleComments=e.comments,t.updateComments(e,"fb"),t.openModal("facebook-comments-modal")},t.visibleComments=[],t.addCommentinModal="",t.addCommentFn=function(){"fb"===t.commentType?u.addFacebookPostComment(t.selectedSocial.parentSocialAccount,t.addCommentPage.sourceId,t.addCommentinModal,function(e){var n=new Date;n.setHours(n.getHours()+7);var a={picture:t.selectedSocial.profile.picture.data.url,created:s("date")(n,"yyyy-MM-ddTHH:mm:ss")+"+0000",name:t.selectedSocial.profile.name,comment:t.addCommentinModal};t.visibleComments.unshift(a),t.fbSelectedPost.comments.unshift(a),t.addCommentinModal="",o.pop("success","Comment added","Comment added to the facebook post.")}):"tw"===t.commentType?u.addTwitterReply(t.selectedSocial.socialId,t.addCommentPage.sourceId,t.selectedSocial.screen_name,t.addCommentinModal,function(e){t.visibleComments.unshift({picture:t.selectedSocial.profile_image_url,created:new Date,name:t.selectedSocial.name,comment:t.addCommentinModal}),t.addCommentinModal="",o.pop("success","Comment added","Comment added to the twitter post.")}):o.pop("error","Type miss match","Post type and admin type does not match.")},t.updateComments=function(e,n){t.commentType=n,"tw"===n&&(t.commentUsers=t.twAdminPages),"fb"===n&&(t.commentUsers=t.fbAdminPages),t.addCommentPage=e,e.comments?(t.visibleComments=e.comments,t.fbSelectedPost=e):t.visibleComments=[]},t.checkLikeExistFn=function(e){var n=!1;return void 0===t.tempPost?n:void 0===t.tempPost.likes?n:(t.tempPost.likes.forEach(function(t,a){e.socialId===t.sourceId&&(n=!0)}),n)},t.checkFavExistFn=function(e){var a=!1;return void 0===t.tempPost?a:void 0===t.tempPost.favorites?a:(n.debug("--checking favorites"),t.tempPost.favorites.forEach(function(t,o){n.debug(e.socialId,t.sourceId),e.socialId===t.sourceId&&(a=!0)}),n.debug("--done checking favorites"),a)},t.likeFBPost=function(n){var a=_.find(t.config.trackedAccounts,function(e){return e.id===n.id});u.likeFBPost(a.id,t.tempPost.sourceId,function(a){t.tempPost.likes?t.tempPost.likes.push({sourceId:n.sourceId,name:n.name}):t.tempPost.likes=[{sourceId:n.sourceId,name:n.name}],t.tempTrackedAccounts=e.copy(t.trackedAccounts),_.each(t.tempTrackedAccounts,function(e,n){t.tempTrackedAccounts[n].liked=t.checkLikeExistFn(e)}),o.pop("success","liked post")})},t.removeLikeFBPost=function(n,a){var i=_.find(t.config.trackedAccounts,function(e){return e.socialId===n.socialId});u.unlikeFBPost(i.id,t.tempPost.sourceId,function(a){t.tempPost.likes.forEach(function(e,a){e.sourceId===n.sourceId&&t.tempPost.likes.splice(a,1)}),t.tempSocialAccounts=e.copy(t.socialAccounts),_.each(t.tempSocialAccounts,function(e){e.liked=t.checkLikeExistFn(e,"account"),_.each(e.admins,function(e){e.liked=t.checkLikeExistFn(e,"admin")})}),o.pop("warning","unliked post.")})},t.addTwitterPostFavorites=function(e,a){n.debug("addTwitterPostFavorites >>>");var i=_.find(t.config.trackedAccounts,function(t){return t.socialId===e.socialId});u.favTwitterPost(i.id,t.tempPost.sourceId,function(e){o.pop("warning","favorited post.")})},t.deleteTwitterPostFavorites=function(e,a){n.debug("deleteTwitterPostFavorites >>>");var i=_.find(t.config.trackedAccounts,function(t){return t.socialId===e.socialId});u.unfavoriteTwitterPost(i.id,t.tempPost.sourceId,function(e){o.pop("warning","unfavorited post.")})},t.followTwitterCheck=function(e,a,o){e===a.id_str&&(n.debug("followTwitterCheck, postReturn.following="+a.following.toString()),a.friendly?t.followModalCheckmarks[o.socialId]=!0:t.followModalCheckmarks[o.socialId]=!1)},t.followTwitterUser=function(e,a){n.debug("---followTwitterUser, sourceID=",a,e.id),u.followTwitterUser(e.id,a,function(o){n.debug("returned from followTwitterUser("+JSON.stringify(o)+")"),t.followTwitterCheck(a,o,e)})},t.unfollowTwitterUser=function(e,a){n.debug("---unfollowTwitterUser, sourceID="+a),u.unfollowTwitterUser(e.id,a,function(o){n.debug("returned from unfollowTwitterUser("+JSON.stringify(o)+")"),t.followTwitterCheck(a,o,e)})},t.orderbyFilter=[{label:"Most liked",data:"likes"},{label:"Most commented",data:"comments"},{label:"Most Recent",data:"date"}],t.sortBy={label:"Most Recent",data:"date"},t.sortFeed=function(e){t.orderByAttribute=e.data,d(function(){$("#mcontainer").masonry()},1e3)},e.element(".sidebar-toggler").click(function(){t&&t.$state&&t.$state.current&&"app.marketing.socialfeed"===t.$state.current.name&&d(function(){$("#mcontainer")&&$("#mcontainer").masonry(),t.sortFeed({label:"Most Recent",data:"date"})},500)}),t.addTwCommentFn=function(e){u.addTwitterPostReply(e.socialId,e.post._id,e.comment,function(n){u.getTwitterFeed(e.socialId,function(a){var o=_.findWhere(a,{sourceId:n.id_str});o&&(t.displayFeed.push(o),t.feedLengths[e.socialId]=a.length),t.afterPosting(),t.closeModal()})})},t.addTwDMFn=function(e){u.addTwitterDirectMessage(e.socialId,e.post.from.sourceId||e.post.sourceId,e.comment,function(e){t.closeModal()})},t.isTwFollowerFn=function(e){return!!_.findWhere(t.followers,{sourceId:String(e)})},t.addRetweetFn=function(e){u.addTwitterPostRetweet(e.socialId,e.post.sourceId,function(n){t.displayFeed[_.indexOf(t.displayFeed,_.findWhere(t.displayFeed,{sourceId:e.post.sourceId}))].retweet_count+=1,u.getTwitterFeed(e.socialId,function(a){var o=_.findWhere(a,{sourceId:n.id_str});o&&(t.displayFeed.push(o),t.feedLengths[e.socialId]=a.length),t.afterPosting(),t.closeModal()})})}}])}(angular),app.controller("SweetAlertCtrl",["$scope","SweetAlert",function(e,t){"use strict";e.demo1=function(){t.swal({title:"Here's a message",confirmButtonColor:"#007AFF"})},e.demo2=function(){t.swal({title:"Here's a message!",text:"It's pretty, isn't it?",confirmButtonColor:"#007AFF"})},e.demo3=function(){t.swal({title:"Good job!",text:"You clicked the button!",type:"success",confirmButtonColor:"#007AFF"})},e.demo4=function(){t.swal({title:"Are you sure?",text:"Your will not be able to recover this imaginary file!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!"},function(){t.swal({title:"Booyah!",confirmButtonColor:"#007AFF"})})},e.demo5=function(){t.swal({title:"Are you sure?",text:"Your will not be able to recover this imaginary file!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel plx!",closeOnConfirm:!1,closeOnCancel:!1},function(e){e?t.swal({title:"Deleted!",text:"Your imaginary file has been deleted.",type:"success",confirmButtonColor:"#007AFF"}):t.swal({title:"Cancelled",text:"Your imaginary file is safe :)",type:"error",confirmButtonColor:"#007AFF"})})},e.demo6=function(){t.swal({title:"Sweet!",text:"Here's a custom image.",imageUrl:"http://oitozero.com/img/avatar.jpg",confirmButtonColor:"#007AFF"})}}]),function(e){"use strict";app.controller("TemplatesCtrl",["$scope","$location","toaster","$filter","$modal","WebsiteService",function(t,n,a,o,i,s){s.getTemplates(function(e){var n=t.formatTemplates(e);t.templates=n}),t.formatTemplates=function(e){var t,n=[];for(t in e)e.hasOwnProperty(t)&&(e[t].components?e[t].components=e[t].components.length:e[t].components=0,e[t].hasScreenshot=!1,e[t].screenshot&&(e[t].hasScreenshot=!0),n.push(e[t]));return n},t.openModal=function(e){t.modalInstance=i.open({templateUrl:e,keyboard:!0,backdrop:"static",scope:t})},t.closeModal=function(){t.modalInstance.close()},t.getters={components:function(e){return e.length},created:function(e){return e.created.date},modified:function(e){return e.modified.date}},t.setTemplateDetails=function(e){t.templateDetails=!0,t.selectedTemplate=e},t.resetTemplateDetails=function(){t.templateDetails=!1,t.selectedTemplate=null,t.showChangeURL=!1},t.$watch("createpage.title",function(e){e&&(t.createpage.handle=o("slugify")(e))}),t.$watch("createpage.handle",function(e){e&&(t.createpage.handle=o("slugify")(e))}),t.validateCreatePage=function(e,n){t.createPageValidated=!1,e&&(""===e.handle?t.handleError=!0:(t.handleError=!1,n||(e.handle=o("slugify")(e.title))),""===e.title?t.titleError=!0:t.titleError=!1,e&&e.title&&""!==e.title&&e.handle&&""!==e.handle&&(t.createPageValidated=!0))},t.createPageFromTemplate=function(e,n){if(t.validateCreatePage(e,!0),!t.createPageValidated)return t.titleError=!0,t.handleError=!0,!1;t.titleError=!1,t.handleError=!1;var o={title:e.title,handle:e.handle,mainmenu:e.mainmenu},i=!1,r=0;for(r;r<t.pages.length;r++)t.pages[r].handle===e.handle&&(i=!0);i?(a.pop("error","Page URL "+e.handle,"Already exists"),n.preventDefault(),n.stopPropagation()):s.createPageFromTemplate(t.selectedTemplate._id,o,function(n){a.pop("success","Page Created","The "+n.title+" page was created successfully."),t.closeModal(),n.components?n.components=n.components.length:n.components=0,t.pages.unshift(n),t.displayedPages.unshift(n),e.title="",e.handle="",t.resetTemplateDetails()})},t.viewSingle=function(e){n.path("/website/templates/").search({templatehandle:e.handle})},t.filterScreenshot={},t.pageScreenshotOptions=[{name:"Screenshot",value:!0},{name:"No Screenshot",value:!1}],t.triggerInput=function(t){e.element(t).trigger("input")},t.clearFilter=function(e,n){t.filterScreenshot={},t.triggerInput(n)}}])}(angular),app.controller("ToasterDemoCtrl",["$scope","toaster",function(e,t){"use strict";e.toaster={type:"success",title:"Title",text:"Message"},e.pop=function(){t.pop(e.toaster.type,e.toaster.title,e.toaster.text)}}]),app.controller("TreeCtrl",["$scope","$timeout",function(e,t){var n,a,o,i;return e.my_tree_handler=function(t){var n;if(e.output="You selected: "+t.label,null!=(n=t.data)?n.description:void 0)return e.output+="("+t.data.description+")"},n=function(t){return e.output="APPLE! : "+t.label},o=[{label:"Animal",children:[{label:"Dog",data:{description:"man's best friend"}},{label:"Cat",data:{description:"Felis catus"}},{label:"Hippopotamus",data:{description:"hungry, hungry"}},{label:"Chicken",children:["White Leghorn","Rhode Island Red","Jersey Giant"]}]},{label:"Vegetable",data:{definition:"A plant or part of a plant used as food, typically as accompaniment to meat or fish, such as a cabbage, potato, carrot, or bean.",data_can_contain_anything:!0},onSelect:function(t){return e.output="Vegetable: "+t.data.definition},children:[{label:"Oranges"},{label:"Apples",children:[{label:"Granny Smith",onSelect:n},{label:"Red Delicous",onSelect:n},{label:"Fuji",onSelect:n}]}]},{label:"Mineral",children:[{label:"Rock",children:["Igneous","Sedimentary","Metamorphic"]},{label:"Metal",children:["Aluminum","Steel","Copper"]},{label:"Plastic",children:[{label:"Thermoplastic",children:["polyethylene","polypropylene","polystyrene"," polyvinyl chloride"]},{label:"Thermosetting Polymer",children:["polyester","polyurethane","vulcanized rubber","bakelite","urea-formaldehyde"]}]}]}],i=[{label:"North America",children:[{label:"Canada",children:["Toronto","Vancouver"]},{label:"USA",children:["New York","Los Angeles"]},{label:"Mexico",children:["Mexico City","Guadalajara"]}]},{label:"South America",children:[{label:"Venezuela",children:["Caracas","Maracaibo"]},{label:"Brazil",children:["Sao Paulo","Rio de Janeiro"]},{label:"Argentina",children:["Buenos Aires","Cordoba"]}]}],e.my_data=o,e.try_changing_the_tree_data=function(){return e.my_data===o?e.my_data=i:e.my_data=o},e.my_tree=a={},e.try_async_load=function(){return e.my_data=[],e.doing_async=!0,t(function(){return Math.random()<.5?e.my_data=o:e.my_data=i,e.doing_async=!1,a.expand_all()},1e3)},e.try_adding_a_branch=function(){var e;return e=a.get_selected_branch(),a.add_branch(e,{label:"New Branch",data:{something:42,else:43}})}}]),app.controller("UploadCtrl",["$scope","FileUploader",function(e,t){"use strict";var n=e.uploaderImages=new t({url:"upload.php"});n.filters.push({name:"imageFilter",fn:function(e,t){var n="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(n)}}),n.onWhenAddingFileFailed=function(e,t,n){},n.onAfterAddingFile=function(e){},n.onAfterAddingAll=function(e){},n.onBeforeUploadItem=function(e){},n.onProgressItem=function(e,t){},n.onProgressAll=function(e){},n.onSuccessItem=function(e,t,n,a){},n.onErrorItem=function(e,t,n,a){},n.onCancelItem=function(e,t,n,a){},n.onCompleteItem=function(e,t,n,a){},n.onCompleteAll=function(){}}]),app.controller("UploadCtrl2",["$scope","FileUploader",function(e,t){"use strict";var n=e.uploader=new t({url:"upload.php"});n.filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),n.onWhenAddingFileFailed=function(e,t,n){},n.onAfterAddingFile=function(e){},n.onAfterAddingAll=function(e){},n.onBeforeUploadItem=function(e){},n.onProgressItem=function(e,t){},n.onProgressAll=function(e){},n.onSuccessItem=function(e,t,n,a){},n.onErrorItem=function(e,t,n,a){},n.onCancelItem=function(e,t,n,a){},n.onCompleteItem=function(e,t,n,a){},n.onCompleteAll=function(){}}]),app.controller("UserCtrl",["$scope","flowFactory",function(e,t){"use strict";e.removeImage=function(){e.noImage=!0},e.obj=new Flow,e.userInfo={firstName:"Peter",lastName:"Clark",url:"www.example.com",email:"peter@example.com",phone:"(641)-734-4763",gender:"male",zipCode:"12345",city:"London (UK)",avatar:"assets/images/avatar-1-xl.jpg",twitter:"",github:"",facebook:"",linkedin:"",google:"",skype:"peterclark82"},""===e.userInfo.avatar&&(e.noImage=!0)}]),app.controller("ValidationCtrl",["$scope","$state","$timeout","SweetAlert",function(e,t,n,a){"use strict";e.master=e.myModel,e.form={submit:function(e){var t=null;if(e.$invalid){var n=null;t=null;for(n in e)"$"!==n[0]&&(null!==t||e[n].$valid||(t=e[n].$name),e[n].$pristine&&(e[n].$dirty=!0));return angular.element(".ng-invalid[name="+t+"]").focus(),void a.swal("The form cannot be submitted because it contains validation errors!","Errors are marked with a red, dashed border!","error")}a.swal("Good job!","Your form is ready to be submitted!","success")},reset:function(t){e.myModel=angular.copy(e.master),t.$setPristine(!0)}}}]),function(e){app.controller("WebsiteSettingsCtrl",["$scope","WebsiteService","AccountService","UserService","toaster",function(t,n,a,o,i){t.keywords=[],n.getWebsite(function(e){t.website=e,t.keywords=e.seo.keywords}),a.getAccount(function(n){t.account=n,t.blogSettings=null,n&&n.showhide&&n.showhide&&(t.blogSettings=e.copy(n.showhide.blog))}),t.saveLoading=!1,t.saveWebsiteSettings=function(){t.saveLoading=!0,a.updateAccount(t.account,function(){n.updateWebsite(t.website,function(){t.saveLoading=!1,i.pop("success"," Website Settings saved."),t.account&&t.account.showhide&&t.blogSettings!==t.account.showhide.blog&&window.location.reload()})})},t.insertFavicon=function(e){t.website.settings.favicon=e.url},t.removeFavicon=function(){t.website.settings.favicon=""},t.domainError=!1,t.checkDomainExists=function(e){o.checkDuplicateSubdomain(e.subdomain,e._id,function(e){e.isDuplicate?t.domainError=!0:t.domainError=!1})},t.editTemplate=function(e){"blog"===e&&(window.location="/admin/#/website/pages/?pagehandle=blog"),"post"===e&&(window.location="/admin/#/website/pages/?pagehandle=single-post")}}])}(angular),app.controller("WizardCtrl",["$scope","toaster",function(e,t){e.currentStep=1,e.form={next:function(t){if(e.toTheTop(),t.$valid)n();else{var a=null,o=null;for(a in t)"$"!=a[0]&&(null!==o||t[a].$valid||(o=t[a].$name),t[a].$pristine&&(t[a].$dirty=!0));angular.element(".ng-invalid[name="+o+"]").focus(),i()}},prev:function(t){e.toTheTop(),a()},goTo:function(t,n){parseInt(e.currentStep)>parseInt(n)?(e.toTheTop(),o(n)):t.$valid?(e.toTheTop(),o(n)):i()},submit:function(){},reset:function(){}};var n=function(){e.currentStep++},a=function(){e.currentStep--},o=function(t){e.currentStep=t},i=function(e){t.pop("error","Error","please complete the form in this step before proceeding")}}]),app.controller("TextSimpleCtrl",["$scope",function(e){e.example={name:"awesome user"}}]),app.controller("SelectLocalCtrl",["$scope","$filter",function(e,t){e.example={status:2},e.statuses=[{value:1,text:"status1"},{value:2,text:"status2"},{value:3,text:"status3"},{value:4,text:"status4"}],e.showStatus=function(){var n=t("filter")(e.statuses,{value:e.example.status});return e.example.status&&n.length?n[0].text:"Not set"}}]),app.controller("TextareaCtrl",["$scope",function(e){e.example={desc:"Awesome user \ndescription!"}}]),app.controller("SelectRemoteCtrl",["$scope","$filter","$http",function(e,t,n){e.example={group:4,groupName:"admin"},e.groups=[],e.loadGroups=function(){return e.groups.length?null:n.get("assets/api/groups.js").success(function(t){e.groups=t.groups})},e.$watch("example.group",function(n,a){if(n!==a){var o=t("filter")(e.groups,{id:e.example.group});e.example.groupName=o.length?o[0].text:null}})}]),app.controller("CheckboxCtrl",["$scope",function(e){e.example={remember:!0}}]),app.controller("ChecklistCtrl",["$scope","$filter",function(e,t){e.example={status:[2,3]},e.statuses=[{value:1,text:"status1"},{value:2,text:"status2"},{value:3,text:"status3"}],e.showStatus=function(){var t=[];return angular.forEach(e.statuses,function(n){e.example.status.indexOf(n.value)>=0&&t.push(n.text)}),t.length?t.join(", "):"Not set"}}]),app.controller("RadiolistCtrl",["$scope","$filter",function(e,t){e.example={status:2},e.statuses=[{value:1,text:"status1"},{value:2,text:"status2"}],e.showStatus=function(){var n=t("filter")(e.statuses,{value:e.example.status});return e.example.status&&n.length?n[0].text:"Not set"}}]),app.controller("BsdateCtrl",["$scope",function(e){e.example={dob:new Date(1984,4,15)}}]),app.controller("TypeaheadCtrl",["$scope",function(e){e.user={state:"Arizona"},e.states=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Dakota","North Carolina","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"]}]),app.controller("TextCustomizeCtrl",["$scope",function(e){e.user={name:"awesome user"}}]),app.controller("TextBtnCtrl",["$scope",function(e){e.user={name:"awesome user"}}]),app.controller("SelectNobuttonsCtrl",["$scope","$filter",function(e,t){e.user={status:2},e.statuses=[{value:1,text:"status1"},{value:2,text:"status2"},{value:3,text:"status3"},{value:4,text:"status4"}],e.showStatus=function(){var n=t("filter")(e.statuses,{value:e.user.status});return e.user.status&&n.length?n[0].text:"Not set"}}]),app.controller("SelectMultipleCtrl",["$scope","$filter",function(e,t){e.user={status:[2,4]},e.statuses=[{value:1,text:"status1"},{value:2,text:"status2"},{value:3,text:"status3"},{value:4,text:"status4"}],e.showStatus=function(){var t=[];return angular.forEach(e.statuses,function(n){e.user.status.indexOf(n.value)>=0&&t.push(n.text)}),t.length?t.join(", "):"Not set"}}]),function(){app.directive("dashboardAnalyticTileComponent",function(){return{restrict:"E",scope:{state:"=",uiState:"=",analytic:"="},replace:!0,templateUrl:"assets/js/dashboard/dashboard-analytic-tile/dashboard-analytic-tile.component.html",controller:"DashboardAnalyticTileComponentController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i){var s=this;s.init=function(e){s.element=e,i(function(){s.analyticMap()},0)},s.analyticMap=function(){var t={},n=a.revenueFromStripe;e.finalrevenuedata="loading....",n=parseFloat(n).toFixed(2),isNaN(n)?e.finalrevenuedata="loading....":(e.finalrevenuedata=n,e.showrevenue=!0);var o=a.state.analytics;if(o)switch(s.analytic.name){case"visitors":t.widgetTitle="Website",t.buttonTitle="View Analytics",t.data=[{analyticDataLabel:"MTD New Visitors",analyticDataValue:o.visitors.total},{analyticDataLabel:"MTD Uniques",analyticDataValue:o.allvisitors.total},{analyticDataLabel:"MTD Page Views",analyticDataValue:o.pageViews.total}];break;case"contacts":t.widgetTitle="Contacts",t.buttonTitle="View Contacts",t.data=[{analyticDataLabel:"MTD Contacts",analyticDataValue:o.contacts.total},{analyticDataLabel:"MTD Leads",analyticDataValue:o.contacts.leadTotal}];break;case"CampaignMetrics":t.widgetTitle="Campaign Email",t.buttonTitle="View Campaigns",t.data=[{analyticDataLabel:"MTD Sent",analyticDataValue:o.campaigns.totalSent},{analyticDataLabel:"MTD Opened",analyticDataValue:o.campaigns.totalOpened},{analyticDataLabel:"MTD Clicked",analyticDataValue:o.campaigns.totalClicked}];break;case"SocialMedia":t.widgetTitle="Social Media",t.buttonTitle="View Social Networks",t.data=[{analyticDataLabel:"Facebook",analyticDataValue:function(){return s.analyticData.SocialMedia.facebook}},{analyticDataLabel:"Twitter",analyticDataValue:function(){return s.analyticData.SocialMedia.twitter}}];break;case"Orders":break;case"Revenue":t.widgetTitle="E-Commerce",t.buttonTitle="View Orders",t.data=[{analyticDataLabel:"YTD Revenue (Stripe)",analyticDataValue:e.finalrevenuedata},{analyticDataLabel:"YTD New Orders",analyticDataValue:o.revenue.YTDTotalOrders}]}else i(function(){s.analyticMap()},100);return s.uiDetails=t,t},s.uiDetails=[],s.analyticData={visitors:{},contacts:{},CampaignMetrics:{},Revenue:{},SocialMedia:{}},e.finalrevenuedata="loading....",e.showrevenue=!1,e.$watch(function(){return a.state.analytics},function(e,t){e&&e!==t&&s.analyticMap()}),e.$watch(function(){return a.revenueFromStripe},function(e,t){s.analyticMap()})}app.controller("DashboardAnalyticTileComponentController",e),e.$inject=["$scope","$attrs","$filter","DashboardService","$modal","$timeout"]}(),function(){app.directive("dashboardInboxComponent",function(){return{restrict:"E",scope:{state:"=",uiState:"="},replace:!0,templateUrl:"assets/js/dashboard/dashboard-inbox-widget/dashboard-inbox.component.html",controller:"DashboardInboxComponentController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i){var s=this;s.init=function(e){s.element=e},s.setSelectedMessage=function(e){s.selectedMessage=s.inboxMessages[e],s.selectedMessageIndex=e},s.stripHTML=function(e){return e.replace(/<\/?[^>]+(>|$)/g,"")};e.$watch(function(){return i.broadcastMessages},function(e){angular.isDefined(e)&&(s.inboxMessages=n("orderBy")(e,"-modified.date"),s.setSelectedMessage(0),o(function(){angular.element(".slick-swipe").hasClass("slick-initialized")||angular.element(".slick-swipe").slick({adaptiveHeight:!0,slidesToShow:1,dots:!1,arrows:!0,autoplay:!1,touchMove:!0,draggable:!0})},500))},!0)}app.controller("DashboardInboxComponentController",e),e.$inject=["$scope","$attrs","$filter","$modal","$timeout","DashboardService"]}(),function(){app.directive("dashboardWorkstreamTileComponent",function(){return{restrict:"E",scope:{state:"=",uiState:"=",workstream:"="},replace:!0,templateUrl:"assets/js/dashboard/dashboard-workstream-tile/dashboard-workstream-tile.component.html",controller:"DashboardWorkstreamTileComponentController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r,c){var l=this;l.init=function(e){l.element=e,s(function(){l.augmentCompletePercentage(parseInt(l.workstream.completePercentage,10))},1e3)},l.workstreamClick=function(){l.workstream.unlocked?l.uiState.openWorkstream&&l.uiState.openWorkstream._id===l.workstream._id?l.uiState.openWorkstream=null:(l.uiState.openWorkstream=l.workstream,s(function(){var e=l.workstream._id,t=document.getElementById(e);t&&r.scrollToElementAnimated(t,175,1e3)},0)):(l.uiState.openWorkstream=null,l.playWorkstreamVideo().result.then(l.videoClosed))},l.playWorkstreamVideo=function(){return l.videoConfig.video=l.workstream.unlockVideoUrl,l.openModal("dashboard-workstream-tile-video")},l.videoClosed=function(e){o.unlockWorkstream(l.workstream._id).then(function(){s(function(){l.workstreamClick()},500)})},l.openModal=function(t){return l.modalInstance=i.open({templateUrl:t,keyboard:!0,backdrop:"static",size:"lg",scope:e}),l.modalInstance},l.closeModal=function(){l.modalInstance.close()},l.getVideoConfigObject=function(e){var t=urlParser.parse(e.unlockVideoUrl),n=null;return t&&(n="//img.youtube.com/vi/"+t.id+"/0.jpg"),angular.extend(l.videoConfig,{video:e.unlockVideoUrl,videoAutoPlay:!0,videoPosterImage:n})},l.callAliasMethod=function(e){switch(e.toLowerCase()){case"mediamanager":l.openMediaModal("media-modal","MediaModalCtrl","lg");break;case"websiteseo":s(function(){angular.element(".topbar-settings").click()},0);break;case"chatwithsupport":Intercom("showNewMessage","");break;case"createpage":o.state.account.showhide.ssbSiteBuilder?a.path(l.ssbPath):a.path(l.pagesPath)}},l.openMediaModal=function(t,n,a){e.showDone=!0;var o={templateUrl:t,keyboard:!0,backdrop:"static",size:"md",scope:e,resolve:{vm:function(){return l}}};n&&(o.controller=n,o.resolve.showInsert=function(){return l.showInsert},o.resolve.insertMedia=function(){return l.callbackOnMediaClose},o.resolve.isSingleSelect=function(){return!0}),a&&(o.size="lg"),l.modalInstance=i.open(o),l.modalInstance.result.then(null,function(){angular.element(".sp-container").addClass("sp-hidden")})},l.augmentCompletePercentage=function(e){var t=0,n=c(function(){t===e&&c.cancel(n),l.completeStyle=t,t+=1,l.completePercentageStyle=t+"%"},10)},l.completePercentageStyle="0%",l.callbackOnMediaClose=function(){o.getWorkstreams().then(function(e){var t=e.data;t&&(l.uiState.openWorkstream=_.findWhere(t,{_id:l.uiState.openWorkstream._id}))})},l.videoConfig={version:3,text:null,visibility:!0,type:"video",videoType:"youtube",video:null,videoWidth:400,videoHeight:400,videoAutoPlay:!0,videoMp4:!1,videoWebm:!1,videoControls:!1},l.ssbPath="/website/site-builder/pages/",l.pagesPath="/website/pages",e.$watch(function(){return l.workstream.completePercentage},function(e){e&&l.completeStyle&&e!=l.completeStyle&&l.augmentCompletePercentage(parseInt(e,10))})}app.controller("DashboardWorkstreamTileComponentController",e),e.$inject=["$scope","$attrs","$filter","$location","DashboardService","$modal","$timeout","$document","$interval"]}(),function(e){app.controller("DOHYCtrl",["$scope","$location","toaster","$filter","$modal","$timeout","DashboardService","ChartAnalyticsService",function(t,n,a,o,i,s,r,c){function l(e){var t=" ";t+='background-image: url("'+e+'")',m.sectionBGStyle=t}function u(e){var n=[];if(e){var a=[];_.each(e,function(e){e["ip_geo_info.province"]&&a.push(e)}),_.each(e,function(e){var t=c.stateToAbbr(e["ip_geo_info.province"]);if(t){var a={};a.code=t,a.value=e.result,!_.find(n,function(t){return t.code===e.code})&&a.value&&n.push(a)}})}t.locationData=n}function d(e,t){if(t&&m.activeVisitorDetail){var n=_.findWhere(m.state.liveVisitorDetails,{_id:m.activeVisitorDetail._id});if(n){var a=_.findIndex(m.state.liveVisitorDetails,n);a>-1?(m.selectedVisitorIndex=a,m.activeVisitorDetail=m.state.liveVisitorDetails[a]):(m.selectedVisitorIndex=e,m.activeVisitorDetail=m.state.liveVisitorDetails[e])}else m.selectedVisitorIndex=e,m.activeVisitorDetail=m.state.liveVisitorDetails[e]}else m.selectedVisitorIndex=e,m.activeVisitorDetail=m.state.liveVisitorDetails[e]}function p(){window.Highcharts.charts.forEach(function(t){s(function(){e.isDefined(t)&&Object.keys(t).length&&t.reflow()},0)})}var m=this;m.state={account:t.account},m.uiState={openWorkstream:{_id:void 0}},m.showInsert=!0,m.openMediaModal=function(t,n,a){var o={templateUrl:t,keyboard:!0,backdrop:"static",size:"md",resolve:{vm:function(){return m}}};n&&(o.controller=n,o.resolve.showInsert=function(){return m.showInsert},o.resolve.insertMedia=function(){return m.insertMedia},o.resolve.isSingleSelect=function(){return!0}),a&&(o.size="lg"),m.modalInstance=i.open(o),m.modalInstance.result.then(null,function(){e.element(".sp-container").addClass("sp-hidden")})},m.insertMedia=function(e){m.state.account.business.logo=e.url.replace(/^https?:/,""),r.updateAccount(m.state.account).then(function(e){a.pop("success","Business Logo","The logo was updated successfully.")})},m.buildViewModel=function(){var t=[],n=[],a=0,i=0,s=[];_.each(m.state.workstreams,function(t){var n=e.copy(t.analyticWidgets);_.each(n,function(e){e.completed=t.unlocked&&t.completed,s.push(e)}),a=t.blocks.filter(function(e){return e.complete}).length,i=t.blocks.filter(function(e){return!e.complete}).length,t.completeRatio=a+" out of "+(a+i)+" completed.",t.completePercentage=o("number")(100*a/(a+i),0)}),m.state.analyticsWidgets=_.sortBy(_.uniq(s,function(e){return e.name}),function(e){return m.analyticDisplayOrder[e.name]&&!e.completed}),m.state.completeWorkstreams=n,m.state.incompleteWorksreams=t},m.setActiveVisitorIndex=d,m.workstreamDisplayOrder=_.invert(_.object(_.pairs(r.workstreamDisplayOrder))),m.analyticDisplayOrder=_.invert(_.object(_.pairs(r.analyticDisplayOrder))),m.convertUtcToLocal=function(e){if(e)return moment.utc(e).local().format("YYYY-MM-DD HH:mm:ss")},t.$watch(function(){return r.state},function(e){e.workstreams=_.sortBy(e.workstreams,function(e){return m.workstreamDisplayOrder[e.name]}),m.state=e,s(function(){m.buildViewModel()},0)},!0),t.$watch(function(){return r.imageGallery},function(e){if(e){var t=new Date,n=t-new Date(t.getFullYear(),0,0);l(e[Math.floor(n/864e5)%e.length])}}),t.$watch(function(){return r.broadcastMessages},function(e){e&&e.length?m.state.broadCastMessage=e[0]:m.state.broadCastMessage=null}),t.$watch("locationData",function(t,n){e.isDefined(t)&&!e.equals(t,n)&&s(function(){var n=e.copy(t);c.visitorLocationsDOHY(n,Highcharts.maps["countries/us/us-all"],[],Highcharts.maps["custom/world"])},200)}),t.$watch(function(){return r.liveTraffic},function(e){if(e&&e.length>0)if(t.liveTrafficConfig){var n=$("#live-traffic-chart").highcharts();n&&n.series[0].setData(_.pluck(e,"count"),!0),t.liveTraffic=e;var a=e[0].locations;u(a),s(r.getLiveTraffic,15e3)}else{var o=_.pluck(e,"count");u(a=e[0].locations);for(var i=[],l=0;l<e.length;l++)i.push(""+(e.length-l));var d=c.liveTraffic(o,i);t.liveTraffic=e,t.liveTrafficConfig=d,t.liveTrafficCategories=i,s(r.getLiveTraffic,15e3)}}),t.$watch(function(){return r.liveVisitorDetails},function(e){m.state.liveVisitorDetails=e,e&&e.length&&d(0,!0),s(r.getLiveVisitorDetails,15e3)}),t.$watch("app.layout.isSidebarClosed",function(t){e.isDefined(t)&&p()}),s(function(){p()},0)}])}(angular),function(){function e(e,t,n,a,o){function i(e){return s.loading.value=s.loading.value+1,e.finally(function(){s.loading.value=s.loading.value-1}),e}var s={state:{workstreams:[],reports:{}}},r="/api/1.0/integrations/payments/revenue",c="/api/2.0/dashboard/workstreams",l="/api/2.0/dashboard/analytics",u="/api/1.0/account/",d="/api/1.0/analytics/live",p="/api/1.0/analytics/admin/live",m="/api/2.0/insights/messages/",g="/api/1.0/analytics/liveDetails",f=60;return s.getActiveMessages=function(){return i(e.get(m+"messageswithuser").success(function(e){s.broadcastMessages=e}).error(function(e){}))},s.loading={value:0},s.updatedWorkstreams=!1,s.lastWorkstreamSet=[],s.awayFromDashboard=!1,s.polls=0,s.numberPolling=0,s.doPolling=!0,s.workstreamDisplayOrder=["Build an Online Presence","Manage Contacts","Engage Customers","Make Sales"],s.analyticDisplayOrder=["visitors","contacts","CampaignMetrics","Revenue","SocialMedia"],s.imageGallery=o.urls,s.liveTraffic=[],s.platformLiveTraffic=[],s.getWorkstreams=function(){return i(e.get(c).success(function(e){s.state.workstreams=e,s.awayFromDashboard?angular.equals(s.lastWorkstreamSet,e)?s.updatedWorkstreams=!1:s.updatedWorkstreams=!0:(s.lastWorkstreamSet=angular.copy(e),_.each(s.lastWorkstreamSet,function(e){delete e.completeRatio,delete e.completePercentage}))}).error(function(e){}))},s.getWorkstream=function(t){return i(e.get(c+"/"+t).success(function(e){}).error(function(e){}))},s.unlockWorkstream=function(t){return i(e.post(c+"/"+t+"/unlock").success(function(e){_.extend(_.findWhere(s.state.workstreams,{_id:e._id}),e)}).error(function(e){}))},s.updateAccount=function(t){return i(e.put(u+[t._id].join("/"),t).success(function(e){}).error(function(e){}))},s.setAwayFromDashboard=function(e){s.awayFromDashboard=e,s.getAnalytics()},s.getAnalytics=function(){return i(e.get(l).success(function(e){s.state.analytics=e}).error(function(e){}))},s.getAccount=function(t){return i(e.get(u+"?hash_id="+Math.random()).success(function(e){s.state.account=e,e.ui_preferences&&!1===e.ui_preferences.polling&&(s.doPolling=!1)}).error(function(e){}))},s.getLiveTraffic=function(){return i(e.get(d).success(function(e){s.liveTraffic=e}).error(function(e){}))},s.getLiveVisitorDetails=function(){return i(e.get(g+"?lookBackInMinutes="+f).success(function(e){s.liveVisitorDetails=e}).error(function(e){}))},s.getPlatformLiveTraffic=function(){return i(e.get(p).success(function(e){s.platformLiveTraffic=e}).error(function(e){}))},s.getRevenueFromStripe=function(){var t="?start="+moment().dayOfYear(1).hour(1).minute(0).second(0).toISOString();return i(e.get(r+t).success(function(e){s.revenueFromStripe=e.totalrevenue}).error(function(e){}))},n.$on("$ssbAccountUpdated",function(e,t){s.getAccount()}),s.getAccount(),s.getAnalytics(),s.getWorkstreams(),s.getLiveTraffic(),s.getLiveVisitorDetails(),s.getActiveMessages(),s.getRevenueFromStripe(),s.numberPolling++,s}app.factory("DashboardService",e),e.$inject=["$http","$q","$rootScope","$timeout","dashboardBackgrounds"]}(),app.directive("contactActivity",["$filter","ContactService","$modal","contactConstant",function(e,t,n,a){return{require:[],restrict:"E",transclude:!1,scope:{singleContact:"=singleContact",allActivity:"=allActivity",newLeads:"=newLeads",contactsAtRisk:"=contactsAtRisk",currentPage:"=currentPage",numPerPage:"=numPerPage",contactId:"@contactId",hideNewActivity:"@hideNewActivity"},templateUrl:"/admin/assets/views/partials/activity.html",link:function(o,i,s,r){o.next=!1,o.disablePaging=!0,o.main={page:o.currentPage,take:o.numPerPage},o.singleContact&&(o.contactId=o.$parent.contactId||o.contactId,o.newActivity={contactId:parseInt(o.contactId),start:new Date,end:new Date},t.getActivityTypes(function(e){o.activity_types=e})),o.activityTypes=[],a.contact_activity_types.dp.forEach(function(e,t){o.activityTypes.push(e.label)}),o.updateActivityTypeFn=function(e){var t=_.findWhere(a.contact_activity_types.dp,{label:e});t&&(o.newActivity.activityType=t.data)},o.openModal=function(e){o.modalInstance=n.open({templateUrl:e,scope:o})},o.closeModal=function(){o.modalInstance.close()},o.addActivityFn=function(){if(o.singleContact){angular.element("#contact_activity_type .error").html(""),angular.element("#contact_activity_type .error").removeClass("has-error");var n=angular.element("#contact_activity_type input").val(),i=_.findWhere(a.contact_activity_types.dp,{label:n});if(!n||!n.trim())return angular.element("#contact_activity_type .error").html("Activity Type Required"),void angular.element("#contact_activity_type .error").addClass("has-error");o.newActivity.activityType=i?i.data:n,o.newActivity.start=new Date,o.newActivity.end=new Date}t.postContactActivity(o.newActivity,function(t){o.singleContact&&(t.contact=o.$parent.contact),o.all_activities.push(t),o.all_activities=_.sortBy(o.all_activities,function(e){return e.start}).reverse(),o.newActivity={contactId:parseInt(o.contactId),start:new Date,end:new Date},angular.isDefined(o.activity_type)||(o.activity_type=""),o.activities=e("filter")(o.all_activities,{activityType:o.activity_type}),o.total=o.activities.length,o.closeModal("addActivityModal")})},o.filterActivities=function(t){o.main={page:o.currentPage,take:o.numPerPage},o.activity_type=t.activityTypeFilter.activityType,o.activities=e("filter")(o.all_activities,{activityType:o.activity_type}),o.total=o.activities.length},o.loadPage=function(){var e={limit:o.main.take,skip:(o.main.page-1)*o.main.take};o.singleContact?(t.getContactUnreadActivities(o.contactId,function(e){o.unread=e.length}),t.getContactActivities(o.contactId,function(e){t.getContact(o.contactId,function(t){for(var n=0;n<e.length;n++)e[n].contact=t,e[n].activityType=e[n].activityType;o.activities=e,o.activities=_.sortBy(o.activities,function(e){return e.start}).reverse(),o.all_activities=angular.copy(e),o.total=o.all_activities.length,o.disablePaging=!1})})):(o.contactsAtRisk&&(e={limit:o.main.take,skip:(o.main.page-1)*o.main.take,activityType:"SUBSCRIBE_CANCEL"}),o.newLeads&&(e={limit:o.main.take,skip:(o.main.page-1)*o.main.take,activityType:"CONTACT_CREATED,ACCOUNT_CREATED"}),t.getAllContactActivitiesWithLimit(e,function(e){for(var t=e.results,n=0;n<t.length;n++){var a=_.where(o.contacts,{_id:t[n].contactId});t[n].contact=a[0],t[n].activityType=t[n].activityType}o.total=e.total,o.activities=t,o.disablePaging=!1}))},o.singleContact?o.loadPage():o.$parent.contacts?(o.contacts=o.$parent.contacts,t.getAllContactUnreadActivities(function(e){o.unread=e.total}),o.loadPage()):t.getContacts(function(e){o.$parent.contacts=e,o.contacts=e,t.getAllContactUnreadActivities(function(e){o.unread=e.total}),o.loadPage()}),o.nextPage=function(){o.disablePaging=!0,o.main.page++,o.singleContact||o.loadPage()},o.previousPage=function(){o.disablePaging=!0,o.main.page--,o.singleContact||o.loadPage()},o.nextPageDisabled=function(){return o.main.page===o.pageCount()},o.prevPageDisabled=function(){return o.main.page<=1},o.pageCount=function(){return Math.ceil(o.total/o.numPerPage)},o.getActivityName=function(e){var t=_.findWhere(a.contact_activity_types.dp,{data:e});if(t)return t.label}}}}]),angular.module("angular-parallax",[]).directive("parallax",["$window",function(e){return{restrict:"A",scope:{parallaxRatio:"@",parallaxVerticalOffset:"@",parallaxHorizontalOffset:"@"},link:function(t,n,a){var o=function(){n.css("left",t.parallaxHorizontalOffset+"px");var a=e.pageYOffset*(t.parallaxRatio?t.parallaxRatio:1.1);if(a<=e.innerHeight){var o=a<t.parallaxVerticalOffset?t.parallaxVerticalOffset:a;n.css("top",o+"px")}};o(),angular.element(e).bind("scroll",o),angular.element(e).bind("touchmove",o)}}}]).directive("parallaxBackground",["$window",function(e){return{restrict:"A",transclude:!0,template:"<div ng-transclude></div>",scope:{parallaxRatio:"@",parallaxVerticalOffset:"@",parallaxXPosition:"@"},link:function(t,n,a){var o=function(){var a=0,o="50%";if(t.parallaxXPosition&&("left"==t.parallaxXPosition&&(o="0%"),"center"==t.parallaxXPosition&&(o="50%"),"right"==t.parallaxXPosition&&(o="100%")),n.hasClass("parallax")){var s=$(window).width(),r=!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g);(s<750||r)&&(t.parallaxRatio=.02);var c=0;0==e.pageYOffset&&(c=10);a=0;angular.element(".sortable-page-content").length>0?(a=(n.offset().top-t.offsetTop-e.pageYOffset)*(t.parallaxRatio?t.parallaxRatio:1.1)-(t.parallaxVerticalOffset||0),navigator.userAgent.indexOf("Firefox")>0&&(a*=-1),n.css("background-position","50% "+a+"px"),n.css("background-attachment","fixed")):(a=(i(n[0])-e.pageYOffset)*(t.parallaxRatio?t.parallaxRatio:1.1),a-=c,n.css("background-position",o+" "+a+"px"),n.css("background-attachment","fixed"))}else n.css("background-position",o+" "+a+"px"),n.css("background-attachment","inherit")},i=function(e){var t=0;if(e.offsetParent)do{e.offsetLeft,t+=e.offsetTop}while(e=e.offsetParent);return t};$(document).ready(function(){var n=t.$watch(function(){return angular.element(".sortable-page-content").length},function(e,a){if(e&&e>0){var i=angular.element("ssb-topbar").offset().top,s=angular.element("ssb-topbar").height(),r=(angular.element(window).height(),s+i);t.offsetTop=r,angular.element(".ssb-site-builder-container").scroll(function(){o()}),setTimeout(function(){o()},0),n()}});angular.element(e).bind("scroll",o),angular.element(e).bind("touchmove",o),t.$on("parallaxCall",function(e,t){setTimeout(function(){o()},100)})}),angular.element(e).bind("load",function(e){o(),t.$apply()})}}}]),app.directive("billingInvoice",[function(){return{restrict:"E",templateUrl:"/admin/assets/views/partials/billingInvoice.html",scope:{upcomingInvoice:"="},link:function(e,t,n){if(e.upcomingInvoice&&e.upcomingInvoice.lines&&e.upcomingInvoice.lines.data.length){var a=e.upcomingInvoice.period_start,o=e.upcomingInvoice.lines.data[0].plan.interval;10===a.toString().length&&(a*=1e3);var i=moment(a);"week"==o?i=i.add(7,"days"):"month"==o?i=i.add(1,"months"):"year"==o&&(i=i.add(1,"years")),e.paymentDueDate=i.format("MMMM Do, YYYY")}}}}]),app.directive("billingSubscription",["PaymentService",function(e){return{restrict:"E",templateUrl:"/admin/assets/views/partials/billingSubscription.html",link:function(e,t,n){if(e.$watch("plan",function(){var t=e.plan;if(t&&t.product_attributes.stripePlans.length){var n=t.product_attributes.stripePlans[0].amount.toString(),a=n.length;e.priceDollars=n.slice(0,a-2),e.priceCents=n.slice(a-2,a),setTimeout(function(){e.$apply(function(){e.billingSubscriptionUnavailable=!1})},0)}else e.billingSubscriptionUnavailable=!0},!0),e.account&&"NO_PLAN_ARGUMENT"!==e.account.billing.plan)var a=e.$watch("selectedPlan",function(){e.selectedPlan&&e.selectedPlan.product_attributes&&e.selectedPlan.product_attributes.stripePlans[0].id&&(e.plan=e.selectedPlan,a())});n.showselectbtn&&(e.showSelectBtn=n.showselectbtn)}}}]),app.directive("billingAddon",["PaymentService",function(e){return{restrict:"E",templateUrl:"/admin/assets/views/partials/billingAddon.html",link:function(e,t,n){n.showselectbtn&&(e.showSelectBtn=n.showselectbtn),e.priceDollars=(""+(e.addOn.on_sale?e.addOn.sale_price:e.addOn.regular_price)).split(".")[0],e.priceCents=(""+(e.addOn.on_sale?e.addOn.sale_price:e.addOn.regular_price)).split(".")[1]||"00"}}}]),app.directive("billingInvoiceTable",[function(){return{restrict:"E",templateUrl:"/admin/assets/views/partials/billingInvoiceTable.html"}}]),app.directive("billingTrial",["PaymentService","ToasterService","UserService","$window",function(e,t,n,a){return{restrict:"E",templateUrl:"/admin/assets/views/partials/billingTrial.html",link:function(a,o,i){a.submitPayment=function(){if(a.subscriptionSelected){var o=a.credit.card;o.exp_month=o.expiry.split("/")[0].trim(),o.exp_year=o.expiry.split("/")[1].trim(),a.selectedPlan.paymentProcessing=!0,e.getStripeCardToken(o,function(o){n.getAccount(function(i){a.account=i,a.account.billing&&a.account.billing.stripeCustomerId&&o?n.postAccountBilling(a.account.billing.stripeCustomerId,o,function(e){a.updateStripeIdFn(e),a.account=e,a.savePlanFn(a.selectedPlan.product_attributes.stripePlans[0].id,a.credit.coupon)},function(e){t.show("error","The purchase was unsuccessful. Please check your card information."),a.selectedPlan.paymentProcessing=!1}):o?e.postStripeCustomer(o,function(e){a.currentUser&&(a.currentUser.stripeId=e.id,n.postAccountBilling(e.id,o,function(e){a.updateStripeIdFn(e)}))}):(t.show("error","The purchase was unsuccessful. Please check your card information."),a.selectedPlan.paymentProcessing=!1)})})}},a.credit={card:{},values:{},options:{debug:!1,formatting:!0},messages:{},coupon:""}}}}]),app.directive("billingCreditCard",["$timeout",function(e){return{restrict:"E",templateUrl:"/admin/assets/views/partials/billingCC.html",scope:{cardInfo:"=",cardValues:"=",cardOptions:"=",cardMessages:"=",coupon:"=",plan:"="},link:function(t,n,a){t.$watch("plan",function(t){t&&null!=t._id&&e(function(){$(n[0]).find("input:first").focus()},0)})}}}]),angular.module("ui.bootstrap.carousel",["ui.bootstrap.transition"]).controller("CarouselController",["$scope","$timeout","$transition","$q",function(e,t,n,a){}]).directive("carousel",[function(){return{}}]),app.directive("maxlength",function(){return{restrict:"A",link:function(e,t,n){var a=n.maxlength;t.bind("keyup",function(e){var n=t.closest(".form-group");n.toggleClass("has-warning",a-t.val().length<=10),n.toggleClass("has-error",t.val().length>=a)}),t.bind("keypress",function(e){t.val().length>=a&&8!=e.keyCode&&e.preventDefault()})}}}),function(){"use strict";app.directive("clipChat",function(){return{restrict:"EA",template:'<div><ol class="discussion"><li class="messages-date" ng-repeat-start="message in newChatArray()" ng-if="displayDate($index) || $index == 0">{{message.date | amDateFormat:\'dddd, MMM D, h:mm a\'}}</li><li ng-class="{\'self\' : message.idUser == idSelf, \'other\' : message.idUser !== idSelf, \'nextSame\': newChatArray()[$index+1].idUser == message.idUser && !nextDate($index)}" ng-repeat-end><div class="message"><div class="message-name" ng-if="newChatArray()[$index-1].idUser !== message.idUser || displayDate($index)">{{  message.user }}</div><div class="message-text">{{ message.content }}</div><div class="message-avatar"><img ng-src="{{ message.avatar }}" alt=""></div></div></li></ol>',replace:!0,scope:{messages:"=",idSelf:"=",idOther:"="},link:function(e,t,n){e.newChatArray=function(){for(var t=[],n=0;n<e.messages.length;n++){var a=e.messages[n];a.idUser!=e.idSelf&&a.idOther!=e.idSelf||a.idUser!=e.idOther&&a.idOther!=e.idOther||t.push(a)}return t},e.displayDate=function(t){var n,a,o,i=e.newChatArray();if(0===t){if(!(i.length>1))return!0;n=new Date(i[t].date),a=new Date(i[t+1].date)-n,o=Math.round(a%864e5%36e5/6e4)}else n=new Date(i[t-1].date),a=new Date(i[t].date)-n,o=Math.round(a%864e5%36e5/6e4);return o>1},e.nextDate=function(t){var n,a,o,i=e.newChatArray();return t<i.length-1&&(n=new Date(i[t].date),a=new Date(i[t+1].date)-n,o=Math.round(a%864e5%36e5/6e4)),o>1}}}}),app.directive("chatSubmit",function(){return{restrict:"EA",template:'<form ng-submit="submitChat()"><div class="message-bar"><div class="message-inner"><a href="#" class="link icon-only"><i class="fa fa-camera"></i></a><div class="message-area"><input placeholder="Message" ng-model="ngModel" /></div><a translate="offsidebar.chat.SEND" href="#" class="link ng-scope" ng-click="submitChat()">Send</a></div></div></form></div>',replace:!0,scope:{submitFunction:"=",ngModel:"="},link:function(e,t,n){e.submitChat=function(){if(e.submitFunction(),void 0!==n.scrollElement){var t=angular.element(n.scrollElement),a=t.find(".discussion > li:last");a.length&&t.scrollToElementAnimated(a)}}}}})}(),app.directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(e,t,n,a){a.$validators.compareTo=function(t){return t==e.otherModelValue},e.$watch("otherModelValue",function(){a.$validate()})}}}),app.directive("blogTeaserComponent",["WebsiteService","$filter",function(e,t){"use strict";return{scope:{component:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(e){e.isEditing=!0},controller:["$scope","WebsiteService",function(e,n){function a(e){return e.postorder?1==e.postorder||2==e.postorder?"date_modified":3==e.postorder||4==e.postorder?"date_created":5==e.postorder||6==e.postorder?"date_published":void 0:"date_published"}function o(){return 1!=e.component.postorder&&3!=e.component.postorder&&5!=e.component.postorder&&(2==e.component.postorder||4==e.component.postorder||e.component.postorder,!0)}function i(n,a){var o=[],i=0;return _.each(n,function(e){r(e)&&c(e)&&o.push(e)}),o=s(o),i=2==e.component.version?e.component.numberOfTotalPosts||e.teaserposts.length:e.component.numberOfTotalPosts||3,o=t("limitTo")(o,i),e.posts=o,a()}function s(n){var i=o(),s=a(e.component);return t("orderBy")(n,[s,"date_created"],i)}function r(t){var n=e.component.postTags;return!(n&&n.length>0)||t.post_tags&&_.intersection(n,t.post_tags).length>0}function c(t){var n=e.component.postCategories;return!(n&&n.length>0)||t.post_categories&&_.intersection(n,_.pluck(t.post_categories,"text")).length>0}e.loading=!0,e.currentPostPage=1,n.getPosts(function(t){_.each(t,function(e){e.date_published=new Date(e.publish_date||e.created.date).getTime(),e.date_created=new Date(e.created.date).getTime(),e.date_modified=new Date(e.modified.date).getTime()}),e.teaserposts=angular.copy(t),i(t,function(){e.pageChanged(1),e.loading=!1})}),e.listArticleStyle=function(e){var t=" ";return e&&e.articleBorder&&e.articleBorder.show&&e.articleBorder.color&&(t+="border-color: "+e.articleBorder.color+";",t+="border-width: "+e.articleBorder.width+"px;",t+="border-style: "+e.articleBorder.style+";",t+="border-radius: "+e.articleBorder.radius+"%;"),t},e.titleStyle=function(e){var t=" ";return e&&e.settings&&e.settings.title&&(e.settings.title.fontSize&&(t+="font-size: "+e.settings.title.fontSize+"px !important;"),e.settings.title.fontFamily&&(t+="font-family: "+e.settings.title.fontFamily+"px !important;"),e.settings.title.color&&(t+="color: "+e.settings.title.color+"!important;")),t},e.descriptionStyle=function(e){var t=" ";return e&&e.settings&&e.settings.description&&(e.settings.description.fontSize&&(t+="font-size: "+e.settings.description.fontSize+"px !important;"),e.settings.description.fontFamily&&(t+="font-family: "+e.settings.description.fontFamily+"px !important;"),e.settings.description.color&&(t+="color: "+e.settings.description.color+"!important;")),t},e.pageChanged=function(t){if(e.currentPostPage=t,e.posts&&e.component.numberOfPostsPerPage){var n,a=(e.currentPostPage-1)*e.component.numberOfPostsPerPage,o=e.component.numberOfPostsPerPage;0===o&&(o=e.posts.length),n=a+o,e.filteredPosts=e.posts.slice(a,n)}else e.filteredPosts=e.posts},e.$watch("component.postTags",function(t,n){t!==n&&i(e.teaserposts,function(){e.pageChanged(1)})}),e.$watch("component.postCategories",function(t,n){t!==n&&i(e.teaserposts,function(){e.pageChanged(1)})}),e.$watch("component.numberOfTotalPosts",function(t,n){t!==n&&(e.component.numberOfTotalPosts=parseInt(t)>0?parseInt(t):0,i(e.teaserposts,function(){e.pageChanged(1)}))}),e.$watch("component.numberOfPostsPerPage",function(t,n){t!==n&&(e.component.numberOfPostsPerPage=parseInt(t)>0?parseInt(t):0,i(e.teaserposts,function(){e.pageChanged(1)}))}),e.$watch("component.postorder",function(t,n){t!==n&&i(e.teaserposts,function(){e.pageChanged(1)})})}]}}]),app.directive("blogComponent",["$filter","$timeout","WebsiteService","toaster","SweetAlert",function(e,t,n,a,o){"use strict";return{scope:{component:"=",media:"&",control:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(e){e.isEditing=!0,e.changeBlogImage=function(t,n){e.media({blog:t,index:n})},e.deletedPosts=[],e.ssbEditor||(e.component.spacing=e.$parent.defaultSpacings),e.control.saveBlogData=function(){_.each(e.blog.blogposts,function(t){var a=_.find(e.originalBlogPosts,function(e){return e._id===t._id});angular.equals(a,t)||n.updatePost(e.$parent.page._id,t._id,t,function(e){})}),e.deletedPosts.length&&(n.bulkDeletePosts(e.$parent.page._id,e.deletedPosts,function(e){}),e.deletedPosts=[])}},controller:["$scope","WebsiteService","$compile","$filter","$timeout",function(e,t,n,i,s){e.blog={},e.showCloud=!1,t.getPosts(function(t){e.blog.blogposts=t,e.originalBlogPosts=angular.copy(e.blog.blogposts),e.blog.postTags=[],e.blog.categories=[],_.each(t,function(t){t.post_tags&&_.each(t.post_tags,function(t){e.blog.postTags.indexOf(t)<=-1&&e.blog.postTags.push(t)}),t.post_category&&e.blog.categories.indexOf(t.post_category)<=-1&&e.blog.categories.push(t.post_category)}),e.activateTagCloud(e.blog.postTags)}),e.activateTagCloud=function(t,n){var a=[];_.each(t,function(e){var n=2,o=_.countBy(_.flatten(t),function(t){return t===e}).true;o&&(n+=o),a.push({text:e,weight:n,link:"/tag/"+e})}),e.rendered=!1,e.tagCloud=a,s(function(){$(".jqcloud").jQCloud(e.tagCloud,{autoResize:!0,width:230,height:300,afterCloudRender:function(){e.rendered||(e.rendered=!0,angular.element(".jqcloud").css({width:"100%"}),angular.element(".jqcloud").jQCloud("update",e.tagCloud))}})},1e3),n&&angular.element(".jqcloud").jQCloud("update",e.tagCloud)},e.curPage=0,e.pageSize=10,e.numberOfPages=function(){return e.blog.blogposts?Math.ceil(e.blog.blogposts.length/e.pageSize):0},e.sortBlogFn=function(e){return function(t){return e.postorder?1==e.postorder||2==e.postorder?Date.parse(i("date")(t.modified.date,"MM/dd/yyyy HH:mm:ss")):3==e.postorder||4==e.postorder?Date.parse(i("date")(t.created.date,"MM/dd/yyyy HH:mm:ss")):5==e.postorder||6==e.postorder?Date.parse(i("date")(t.publish_date||t.created.date,"MM/dd/yyyy")):void 0:Date.parse(i("date")(t.publish_date||t.created.date,"MM/dd/yyyy"))}},e.customSortOrder=function(e){return 1!=e.postorder&&3!=e.postorder&&5!=e.postorder&&(2==e.postorder||4==e.postorder||e.postorder,!0)},e.$watch("component.version",function(t,n){t&&n&&t!=n&&s(function(){angular.element(".jqcloud").length&&e.activateTagCloud(e.blog.postTags)},1e3)}),e.deleteBlogPost=function(t,n){o.swal({title:"Are you sure?",text:"Do you want to delete this post",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete post!",cancelButtonText:"No, do not delete post!",closeOnConfirm:!1,closeOnCancel:!0},function(i){if(i){var s=e.blog.blogposts.indexOf(n);e.blog.blogposts.splice(s,1),a.pop("success","Post deleted successfully"),o.swal("Saved!","Post deleted.","success"),e.deletedPosts.push(t),e.$parent.setDirty(!0),e.blog.postTags=[],_.each(e.blog.blogposts,function(t){t.post_tags&&_.each(t.post_tags,function(t){e.blog.postTags.indexOf(t)<=-1&&e.blog.postTags.push(t)})}),e.activateTagCloud(e.blog.postTags,!0)}})}}]}}]),app.directive("comingSoonComponent",function(){"use strict";return{scope:{component:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(e){e.isEditing=!0}}}),app.directive("contactUsComponent",["AccountService","GeocodeService","$timeout","$window",function(e,t,n,a){"use strict";return{scope:{component:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(o){function i(e,t){var n;return t=angular.isDefined(t)?t:1,3===(n=e.substring(1).split("")).length&&(n=[n[0],n[0],n[1],n[1],n[2],n[2]]),n="0x"+n.join(""),"rgba("+[n>>16&255,n>>8&255,255&n].join(",")+","+t+")"}o.isEditing=!0,o.component.map||(o.component.map={},o.component.map.zoom||(o.component.map.zoom=10)),o.component.custom||(o.component.custom={hours:!0,address:!0}),o.component.boxProperties||(o.component.boxProperties={}),angular.isDefined(o.component.bg)||(o.component.bg={}),angular.isDefined(o.component.bg.img)||(o.component.bg.img={}),angular.isDefined(o.component.bg.img.show)||(o.component.bg.img.show=!1),o.$watch("component.boxColor",function(e,t){e&&o.component.boxColor?o.boxColor=i(o.component.boxColor,o.component.boxOpacity):o.boxColor=null}),o.$watch("component.boxOpacity",function(e,t){angular.isDefined(e)&&o.component.boxColor&&(o.boxColor=i(o.component.boxColor,o.component.boxOpacity))}),o.setBusinessDetails=function(e,t){if(e)o.account.business.addresses&&o.account.business.addresses.length>-1&&angular.copy(o.account.business.addresses[0],o.component.location);else if(o.account.business.hours){angular.copy(o.account.business.hours,o.component.hours);var n=o.account.business.splitHours;o.component.splitHours=n}t()},o.reloadMap=function(){o.$watch("map",function(e){e&&(google.maps.event.trigger(o.map,"resize"),o.map.setCenter(new google.maps.LatLng(o.component.location.lat,o.component.location.lon)))})},o.setAddress=function(){return o.contactAddress=t.stringifyAddress(o.component.location,!0),o.contactAddress},o.updateContactUsAddress=function(){setTimeout(function(){o.component.location.lat&&o.component.location.lon?o.reloadMap():t.validateAddress(o.component.location,null,function(e,n){e&&1===n.length?(o.component.location.lat=n[0].geometry.location.lat(),o.component.location.lon=n[0].geometry.location.lng(),o.reloadMap()):o.contactAddress&&t.getGeoSearchAddress(o.contactAddress,function(e){e.lat&&e.lon&&(o.component.location.lat=e.lat,o.component.location.lon=e.lon,o.reloadMap())})})},500)},o.$on("mapInitialized",function(e,t){o.map=t,google.maps.event.trigger(o.map,"resize")}),o.$watch("component.custom.hours",function(e){angular.isDefined(e)&&o.loadedAllData&&(o.component.custom.hours||o.setBusinessDetails(!1,function(){}))}),o.$watch("component.custom.address",function(e){angular.isDefined(e)&&o.loadedAllData&&((o.component.location.address||o.component.location.address2||o.component.location.city||o.component.location.state||o.component.location.zip)&&o.component.custom.address?o.updateContactUsAddress():o.setBusinessDetails(!0,function(){o.updateContactUsAddress()}))}),o.$parent.$watchGroup(["vm.uiState.loaded"],function(t,a){(t[0]||t[1]&&o.component.visibility)&&e.getAccount(function(e){o.account=e,o.component.custom.hours||o.setBusinessDetails(!1,function(){}),o.component.custom.address||o.component.location.address||o.component.location.address2||o.component.location.city||o.component.location.state||o.component.location.zip?n(function(){o.updateContactUsAddress()},500):o.setBusinessDetails(!0,function(){n(function(){o.updateContactUsAddress()},500)}),o.loadedAllData=!0})}),o.$on("angular-resizable.resizeEnd",function(e,t){var n=t;!1===n.width?o.component.boxProperties.height=n.height:!1===n.height&&(o.component.boxProperties.width=n.width)}),o.calcMaxWidth=function(e){var t=angular.element("."+e);if(t.length)return t.width()-100-50+"px"},angular.element(a).bind("resize",function(){o.map&&n(function(){google.maps.event.trigger(o.map,"resize")},500)});var s=o.$watch(function(){return"object"==typeof google&&"object"==typeof google.maps},function(e,t){e&&(o.mapLoaded=!0,s())})}}}]),app.directive("emailComponent",function(){"use strict";return{scope:{component:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(e){e.isEditing=!0}}}),app.directive("featureBlockComponent",function(){"use strict";return{scope:{component:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(e){e.isEditing=!0}}}),app.directive("featureListComponent",["$window","$timeout",function(e,t){"use strict";return{scope:{component:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(e){e.isEditing=!0,e.listStyles=function(e,t){var n=" ";if(t){var a=$(".list-features-"+e._id+" li.active .fr-view span:not('.fr-marker'):not('.fr-placeholder'):not(:empty):last").css("color");a||(a=$(".list-features-"+e._id+" li.active").css("color")),n+="border-bottom: 1px solid "+a+";"}return n},e.features={featureIndex:0},e.loading=!0,e.addFeatureList=function(t){t||(t=0);var n={top:'<div style=\'text-align:center\'><span class="fa fa-arrow-right" style="font-size:96px;">&zwnj;</span></div>',content:'<div style="text-align: center;"><br><span style="font-size:24px;">Feature Title</span></div><div style="text-align: center;"><br>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nisi ab, placeat. Officia qui molestiae incidunt est adipisci.</div><div style="text-align: center;"><br><a class="btn ssb-theme-btn" data-cke-saved-href="http://" href="http://">Learn More</a></div>'};e.component.features.splice(t+1,0,n)},e.addFeatureService=function(t){t||(t=0);var n={top:'<div style=\'text-align:center\'><span class="fa fa-desktop" style="font-size:48px;">&zwnj;</span></div>',heading:"<div style='text-align:center'><span style=\"font-size:20px;\">TITLE</span></div>",content:"Lorem ipsum dolor sit amet, consectetur adipisicing elit. Nisi ab, placeat. Officia qui molestiae incidunt est adipisci.",media:""};e.component.features.splice(t+1,0,n)},e.deleteFeatureList=function(t){e.component.features.splice(t,1)},e.featureStyle=function(e){var t=" ";return e&&e.blockBorder&&e.blockBorder.show&&e.blockBorder.color&&(t+="border-color: "+e.blockBorder.color+";",t+="border-width: "+e.blockBorder.width+"px;",t+="border-style: "+e.blockBorder.style+";",t+="border-radius: "+e.blockBorder.radius+"%;"),e.blockbgcolor&&(t+="background: "+e.blockbgcolor),t},e.featureClass=function(){var t=e.component.anchor||e.component._id,n=angular.element("#"+t+" div.features-wrap");return n.width()<768?"feature-xs-width":n.width()<992?"feature-sm-width":""},e.setSelectedFeatureIndex=function(n){e.loading=!0,e.features.featureIndex=n,t(function(){e.loading=!1},0)},e.setStyles=function(e){var t=" ";return e&&("left"===e.align||"right"===e.align?t+="float: "+e.align+" !important;":"center"===e.align&&(t+="margin: 0 auto !important; float:none !important;")),t}}}}]),app.directive("footerComponent",["$window","WebsiteService","$location",function(e,t,n){"use strict";return{scope:{component:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(a,o){a.orgId=e.indigenous.orgId,a.isEditing=!0;var i=n.$$host,s="//www.indigenous.io";1==a.orgId?s="//www.gorvlvr.com":4==a.orgId&&(s="//techevent.us"),a.footerLinkUrl=s+"?utm_source="+i+"&utm_medium=footer_link",a.ssbEditor||(a.component.spacing=a.$parent.defaultSpacings),a.copyright={year:(new Date).getFullYear()},a.copyrightYear=(new Date).getFullYear(),t.getWebsite(function(e){a.website=e}),o.parents(".ssb-section-layout").length||o.addClass("legacy-footer")}}}]),app.directive("imageGalleryComponent",function(){"use strict";return{scope:{component:"=",media:"&",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(e){e.isEditing=!0,e.$parent.$watch("vm.uiState.loaded",function(t,n){t&&(e.dataLoaded=!0)}),e.addImageFromMedia=function(t,n,a){e.media({componentId:t,index:n,update:a,fields:{title:'<span style="font-size: 30px;">Service Title Here</span>'}})},e.deleteImageFromGallery=function(t){e.$broadcast("$refreshSlickSlider",t);var n=angular.copy(e.component.images);n.splice(t,1),e.component.images=n},e.touchMove=!1,e.draggable=!1,e.autoplay=!1}}}),app.directive("imageTextComponent",function(){"use strict";return{scope:{component:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(e){e.isEditing=!0}}}),app.directive("mastheadComponent",["$window","$timeout","SimpleSiteBuilderService",function(e,t,n){"use strict";return{scope:{component:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(a){a.addUndernavImages=function(){a.addUndernavClasses=a.component.bg&&a.component.bg.img&&a.component.bg.img.url&&a.component.bg.img.show&&a.component.bg.img.undernav},angular.element("body").on("click",".navbar-toggle",function(){a.setUnderbnavMargin()}),angular.element(e).bind("resize",function(){a.setUnderbnavMargin()}),a.setUnderbnavMargin=function(){a.allowUndernav=!1,a.addBgImage=!0,n.addUnderNavSetting(a.component._id,function(e){a.allowUndernav=e.allowUndernav,a.navComponent=e.navComponent}),a.addUndernavImages(),t(function(){var e=angular.element(".component_wrap_"+a.component._id+".undernav200"),t=angular.element(".masthead_"+a.component._id+".mastHeadUndernav");if(a.addUndernavClasses&&a.allowUndernav){var n,o,i=angular.element(".undernav").height();a.navComponent&&(i=angular.element(".component_wrap_"+a.navComponent._id+".undernav").height()),o="margin-top: -"+(n=i)+"px !important",e&&e.attr("style",o),angular.element(".undernav").addClass("nav-undernav"),!(a.navComponent&&a.navComponent.bg&&a.navComponent.bg.img&&!a.navComponent.bg.img.show&&a.navComponent.bg.color)?angular.element(".nav-undernav .bg").addClass("bg-nav-undernav"):(angular.element(".nav-undernav .bg").removeClass("bg-nav-undernav"),angular.element(".undernav").closest("li.fragment").addClass("li-nav-undernav")),t&&t.css("height",n),angular.element(".masthead-actions")&&angular.element(".masthead-actions").addClass("hover-action")}else e&&e.attr("style","margin-top:0px"),angular.element(".masthead-actions")&&angular.element(".masthead-actions").removeClass("hover-action"),angular.element(".nav-undernav .bg").removeClass("bg-nav-undernav"),angular.element(".undernav").removeClass("nav-undernav"),angular.element(".undernav").closest("li.fragment").removeClass("li-nav-undernav");$(window).trigger("scroll")},2e3)},a.$watch("component.bg.img",function(e,t){angular.isDefined(e)&&a.setUnderbnavMargin()},!0),a.isEditing=!0}}}]),app.directive("meetTeamComponent",function(){"use strict";return{scope:{component:"=",media:"&",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(e){e.isEditing=!0,e.addImageFromMedia=function(t,n,a){e.media({componentId:t,index:n,update:a})},e.deleteTeamMember=function(t){e.component.teamMembers.splice(t,1)},e.addTeamMember=function(t){t||(t=0);var n={name:"<p>First Last</p>",position:"<p>Position of Person</p>",profilepic:"https://s3-us-west-2.amazonaws.com/indigenous-admin/default-user.png",bio:"<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Explicabo laboriosam, officiis vero eius ipsam aspernatur, quidem consequuntur veritatis aut laborum corporis impedit, quam saepe alias quis tempora non. Et, suscipit.</p>",networks:[{name:"linkedin",url:"http://www.linkedin.com",icon:"linkedin"}]};e.component.teamMembers.splice(t+1,0,n)},e.teamClass=function(){var t=e.component.anchor||e.component._id,n=angular.element("#"+t+" div.team-member-wrap");return n.width()<768?"team-xs-width":n.width()<992?"team-sm-width":""}}}}),app.directive("navigationComponent",["WebsiteService","AccountService","$timeout",function(e,t,n){"use strict";return{scope:{component:"=",version:"=",ssbEditor:"=",website:"=?",control:"="},templateUrl:"/components/component-wrap.html",link:function(e){e.isEditing=!0,e.ssbEditor||(angular.isDefined(e.component.shownavbox)||(e.component.shownavbox=!0),e.control.refreshWebsiteLinks=function(t){e.website.linkLists=t}),e.$watch("component.logo",function(){n(function(){$(window).trigger("resize")},0)})},controller:["$scope","WebsiteService","AccountService",function(e,t,n){e.navbarId=_.random(0,1e3),e.isSinglePost=e.$parent.isSinglePost,e.website||(e.$parent.website?e.website=e.$parent.website:(t.getWebsite(function(t){e.website=t}),n.getAccount(function(t){e.account=t}))),e.currentpage=e.$parent.page,e.$parent.$watchCollection("vm.state.page",function(t){t&&(e.currentpage=t)})}]}}]),app.directive("pricingTablesComponent",function(){"use strict";return{scope:{component:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(e){e.isEditing=!0,e.addPricingTableFeature=function(e,t){},e.deletePricingTableFeature=function(e,t){},e.addPricingTable=function(e,t){},e.deletePricingTable=function(e,t){}}}}),app.directive("productsComponent",["ProductService","$location","$timeout","$filter","AccountService",function(e,t,n,a,o){return{scope:{component:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(i){function s(e){var t=i.component.productTags;if(!(t&&t.length>0))return!0;if(t=_.map(t,function(e){return e.toLowerCase()}),e.tags){var n=_.map(e.tags,function(e){return e.toLowerCase()});if(_.intersection(t,n).length>0)return!0}}function r(e){if(e.on_sale){if(e.sale_date_from&&e.sale_date_to){var t=new Date,n=new Date(e.sale_date_from),a=new Date(e.sale_date_to);return n<=t&&t<=a}return!0}}function c(e,t){var n=[];_.each(e,function(e){s(e)&&(r(e)?(e.onSaleToday=!0,e.actualSalesPrice=e.sale_price):e.actualSalesPrice=e.regular_price,n.push(e))});var o=_.filter(n,function(e){return"DONATION"!==e.type});if(i.productSortOrder.order){var c="created.date",l=!0;"price_low"==i.productSortOrder.order?(c="actualSalesPrice",l=!1):"price_high"==i.productSortOrder.order&&(c="actualSalesPrice",l=!0),i.products=a("orderBy")(o,[c,"created.date"],l)}else i.products=o;t&&t()}i.isEditing=!0,i.checkoutModalState=1,i.currentProductPage=1,i.currentPath=angular.copy(t),i.productSortOrder={order:"most_recent"},i.$watch("component.numtodisplay",function(e,t){e!==t&&(i.component.numtodisplay=parseInt(e)>0?parseInt(e):0,c(i.originalProducts,function(){i.pageChanged(1)}))}),i.$watch("component.productTags",function(e,t){e!==t&&(i.component.productTags=e,c(i.originalProducts,function(){i.pageChanged(1)}))}),e.getActiveProducts(function(e){i.originalProducts=angular.copy(e),c(e,function(){i.pageChanged(1)})}),i.changeProductSortOrder=function(){c(i.originalProducts,function(){i.pageChanged(1)})},o.getAccount(function(e){i.account=e,i.paypalInfo=null,i.stripeInfo=null,i.account.credentials.forEach(function(e,t){"stripe"==e.type&&(i.stripeInfo=e)}),i.paypalInfo=i.account.commerceSettings.paypal}),i.pageChanged=function(e){if(i.currentProductPage=e,i.products){var t=(i.currentProductPage-1)*i.component.numtodisplay,a=i.component.numtodisplay;0===a&&(a=i.products.length);var o=t+a;i.filteredProducts=i.products.slice(t,o),n(function(){$(window).trigger("resize")},0)}},i.addProducts=function(){t.path("/commerce/products")},i.isImage=function(e){return!(e&&0===e.indexOf("fa-"))},i.gridStyle=function(e){var t=" ";return e&&e.bg&&e.bg.color&&(t+="background-color: "+e.bg.color+"!important;"),t},i.titleStyle=function(e){var t=" ";return e&&(e.titleFontFamily&&(t+="font-family: "+e.titleFontFamily+"!important;"),e.titleTextSize&&(t+="font-size: "+e.titleTextSize+"px !important;"),e.titleTextColor&&(t+="color: "+e.titleTextColor+"!important;")),t},i.priceStyle=function(e){var t=" ";return e&&(e.priceFontFamily&&(t+="font-family: "+e.priceFontFamily+"!important;"),e.priceTextSize&&(t+="font-size: "+e.priceTextSize+"px !important;"),e.priceTextColor&&(t+="color: "+e.priceTextColor+"!important;")),t},i.descriptionStyle=function(e){var t=" ";return e&&(e.descriptionFontFamily&&(t+="font-family: "+e.descriptionFontFamily+"!important;"),e.descriptionTextSize&&(t+="font-size: "+e.descriptionTextSize+"px !important;"),e.descriptionTextColor&&(t+="color: "+e.descriptionTextColor+"!important;")),t},i.cartButtonStyle=function(e){var t=" ";return e&&(e.addToCartBtnBgColor&&(t+="background-color: "+e.addToCartBtnBgColor+"!important;",t+="border-color: "+e.addToCartBtnBgColor+"!important;"),e.addToCartBtnTxtColor&&(t+="color: "+e.addToCartBtnTxtColor+"!important;")),t},i.productSortOrderOptions=[{label:"Most Recent",data:"most_recent"},{label:"Price: Low to High",data:"price_low"},{label:"Price: High to Low",data:"price_high"}]}}}]),app.directive("simpleFormComponent",["formValidations","$timeout",function(e,t){"use strict";return{scope:{component:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(n){n.isEditing=!0,n.nthRow="nth-row",n.formValidations=e,n.elementClass=".simple-form-"+n.component._id+" .form-submit-button",n.originalData={bg:{}};var a=function(e){e.style.setProperty("border-color","none","important"),e.style.setProperty("border-width","0px","important"),e.style.setProperty("border-radius","none%","important"),e.style.setProperty("border-style","none","important")},o=function(e,t){a(e),t&&t.border&&t.border.show&&(t.border.color&&e.style.setProperty("border-color",t.border.color,"important"),t.border.width&&e.style.setProperty("border-width",t.border.width+"px","important"),t.border.radius||(t.border.radius=0),e.style.setProperty("border-radius",t.border.radius+"%","important"),t.border.style&&e.style.setProperty("border-style",t.border.style,"important"))};angular.isDefined(n.component.tags)||(n.component.tags=[],n.component.contact_type&&n.component.tags.push(n.component.contact_type)),_.find(n.component.fields,function(e){return"extension"===e.name})||n.component.fields.push({display:"Phone Extension",value:!1,name:"extension"}),n.fieldClass=function(e){var t="col-sm-12";return n.component.formSettings&&n.component.formSettings.fieldsPerRow>0&&(t="col-sm-"+Math.floor(12/n.component.formSettings.fieldsPerRow),n.component.formSettings.spacing&&n.component.formSettings.spacing.pr&&(n.nthRow="nth-row"+n.component.formSettings.fieldsPerRow)),t},n.fieldShow=function(e){var t=_.find(n.component.fields,function(t){return t.name===e});if(t&&t.value)return!0},n.fieldStyle=function(e){var t=" ";return e&&e.spacing&&e.spacing.mb&&(t+="margin-bottom: "+e.spacing.mb+"px;"),t},n.inputStyle=function(e){var t=" ";return e&&(e.align&&(t+="text-align: "+e.align+";"),e.inputTextSize&&(t+="font-size: "+e.inputTextSize+"px !important;"),e.inputFontFamily&&(t+="font-family: "+e.inputFontFamily+";"),e.inputBgColor&&(t+="background-color: "+e.inputBgColor+"!important;"),e.inputBorderColor&&(t+="border-color: "+e.inputBorderColor+";"),e.inputTextColor&&(t+="color: "+e.inputTextColor+";")),t},n.buttonStyle=function(e){var t="";return e&&(e.align&&("left"===e.align||"right"===e.align?t+="float: "+e.align+";":"center"===e.align&&(t+="margin: 0 auto;")),e.bg&&e.bg.color&&(t+=" background-color: "+e.bg.color+"!important;",t+=" border-color: "+e.bg.color+";",n.originalData.bg.color=e.bg.color,n.originalData.borderColor=e.bg.color),e.txtcolor&&(t+=" color: "+e.txtcolor+"!important;",n.originalData.txtcolor=e.txtcolor),e.border&&e.border.show&&(e.border.color&&(t+=" border-color: "+e.border.color+"  !important;",n.originalData.btn={},n.originalData.btn.border=e.border),e.border.width&&(t+=" border-width: "+e.border.width+"px   !important;"),e.border.radius||(e.border.radius=0),t+=" border-radius: "+e.border.radius+"%  !important;",e.border.style?t+=" border-style: "+e.border.style+" !important;":t+=" border-style: none !important;")),t},n.formStyle=function(e){var t="";return e&&(e.formFontFamily&&(t+="font-family: "+e.formFontFamily+";"),e.formTextColor&&(t+="color: "+e.formTextColor+";")),t},angular.element(document).ready(function(){var e=n.$watch(function(){return angular.element(n.elementClass).length},function(a,i){a&&(e(),t(function(){var e=angular.element(n.elementClass),a={bg:{color:e.css("background-color")},txtcolor:e.css("color"),borderColor:e.css("border-color")},i=null;e&&(e.hover(function(){var e=null;n.component.formSettings&&n.component.formSettings.btnStyle&&n.component.formSettings.btnStyle.hover&&(e=n.component.formSettings.btnStyle.hover),e&&(e.bg&&e.bg.color&&(this.style.setProperty("background-color",e.bg.color,"important"),this.style.setProperty("border-color",e.bg.color,"important")),o(this,e)),e&&e.txtcolor&&this.style.setProperty("color",e.txtcolor,"important")},function(){this.style.setProperty("background-color",n.originalData.bg.color||a.bg.color,"important"),this.style.setProperty("color",n.originalData.txtcolor||a.txtcolor,"important"),this.style.setProperty("border-color",n.originalData.borderColor||a.borderColor,"important"),o(this,n.originalData.btn||n.component.btn)}),e.on("mousedown touchstart",function(){n.component.formSettings&&n.component.formSettings.btnStyle&&n.component.formSettings.btnStyle.pressed&&(i=n.component.formSettings.btnStyle.pressed),i&&(i.bg&&i.bg.color&&(this.style.setProperty("background-color",i.bg.color,"important"),this.style.setProperty("border-color",i.bg.color,"important")),o(this,i)),i&&i.txtcolor&&this.style.setProperty("color",i.txtcolor,"important")}),e.on("mouseup touchend",function(){var e=this;t(function(){e.style.setProperty("background-color",n.originalData.bg.color||a.bg.color,"important"),e.style.setProperty("color",n.originalData.txtcolor||a.txtcolor,"important"),e.style.setProperty("border-color",n.originalData.borderColor||a.borderColor,"important"),o(e,n.originalData.btn||n.component.btn)},1e3)}))},500))})})}}}]),app.directive("singlePostComponent",function(){"use strict";return{scope:{component:"=",control:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(e){e.ssbEditor||(e.component.spacing=e.$parent.defaultSpacings),e.isEditing=!0,e.blog={},e.datePicker={},e.dateOptions={formatYear:"yy",startingDay:1},e.open=function(t){t.preventDefault(),t.stopPropagation(),e.datePicker.isOpen=!0},e.endOpen=function(t){t.preventDefault(),t.stopPropagation(),e.startOpened=!1,e.endOpened=!e.endOpened},e.startOpen=function(t){t.preventDefault(),t.stopPropagation(),e.endOpened=!1,e.startOpened=!e.startOpened},e.$parent.blog&&(e.blog.post=e.$parent.blog.post),e.control.getSinglePost=function(){return e.blog.post},e.control.setSinglePost=function(){return e.blog.post=e.$parent.blog.post},e.getEncodedUrl=function(e){return encodeURI(e)},e.getPlainTitle=function(e){var t=e;if(e){var n=angular.element(".plain-post-title");n&&n.length&&(t=n.text().trim())}return t}}}}),app.directive("socialLinkComponent",["$modal","$timeout",function(e,t){"use strict";return{scope:{component:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(e){e.isEditing=!0,e.sortableConfig={animation:150,onSort:function(e){},onStart:function(e){},onEnd:function(e){}},t(function(){e.loadSocialLinks=!0},500)}}}]),app.directive("testimonialsComponent",["$timeout",function(e){"use strict";return{scope:{component:"=",control:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(t){function n(e,n){t.$broadcast("$refreshSlickSlider",e+1);var a=angular.copy(t.component.testimonials);n?a.splice(e+1,0,angular.copy(t.newTestimonial)):a.splice(e,1),t.component.testimonials=a}t.touchMove=!1,t.draggable=!1,t.autoplay=!1,t.isEditing=!0,t.component.slider||(t.component.slider={speed:300,autoPlay:!0,autoPlayInterval:5e3}),t.autoplay=!1,t.accessibility=!1,t.$parent.$watchGroup(["vm.uiState.loaded"],function(e,n){(e[0]||e[1])&&(t.dataLoaded=!0)}),t.newTestimonial=t.component.newSlide?angular.copy(t.component.newSlide):{img:"<img src='//s3-us-west-2.amazonaws.com/indigenous-admin/default-user.png'/>",name:"First Last",site:"www.examplesite.com",text:"This is the testimonial."},t.deleteTestimonial=function(e){n(e,!1)},t.addTestimonial=function(e){n(e,!0)},t.control.refreshSlider=function(){t.dataLoaded=!1,e(function(){t.dataLoaded=!0})}}}}]),app.directive("textOnlyComponent",function(){"use strict";return{scope:{component:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(e){e.isEditing=!0}}}),app.directive("thumbnailSliderComponent",["$window","$timeout",function(e,t){"use strict";return{scope:{component:"=",media:"&",control:"=",sbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(n){function a(e,t){var n=[];if(angular.isArray(e[0]))return e;for(var a=0;a<e.length;a+=t)n.push(e.slice(a,a+t));return n}n.isEditing=!0,n.interval="false",n.imagesPerPage=4,n.slider=[];var o=angular.element(e),i=function(){var e=!1;return function(t,n){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}(),s=o.width();n.bindThumbnailSlider=function(e,o){n.showSlider=!1;var i=n.component.thumbnailCollection,s=4;n.component.layoutModifiers&&n.component.layoutModifiers.columns&&(s=n.component.layoutModifiers.columns),(e<768||o)&&(s=1),n.imagesPerPage=s,n.slider=a(i,s),n.displayThumbnailPaging=n.slider.length>1,t(function(){n.showSlider=!0},0)},n.deleteImageFromThumbnail=function(e,t){var a=t>0?t*n.imagesPerPage+e:e;n.component.thumbnailCollection.splice(a,1),n.bindThumbnailSlider(s,i)},n.bindThumbnailSlider(s,i),n.$on("refreshThumbnailSlider",function(e,t){n.bindThumbnailSlider(s,i)}),n.control.refreshSlider=function(){n.bindThumbnailSlider(s,i)},n.addImageFromMedia=function(e,t,a,o){var i=o>0?o*n.imagesPerPage+t:t;n.media({componentId:e,index:i,update:a})}}}}]),app.directive("topBarComponent",function(){"use strict";return{scope:{component:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(e){e.isEditing=!0,e.sortableConfig={animation:150,onSort:function(e){},onStart:function(t){e.$parent.vm&&(e.$parent.vm.uiState.sortableListPageContentConfig.disabled=!0)},onEnd:function(e){}}}}}),app.directive("videoGalleryComponent",function(){"use strict";return{scope:{component:"=",media:"&",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(e){e.isEditing=!0,e.addNewVideo=function(t,n){n||(n=0);var a={title:'<span style="font-size: 30px;">Service Title Here</span>',description:"<p>This is a paragraph. Lorem ipsum dolor sit am et, consectetur elit. Donec sagittis inte rdum neque, con vallis rutrum lorem varius ut.</p>",video:'<span class="fr-video fr-fvc fr-dvb fr-draggable" contenteditable="false"><iframe src="https://www.youtube.com/embed/1BCG4G_FUhs" style="width:100%;"></iframe>'};e.component.collections.splice(n+1,0,a)},e.deleteVideoFromGallery=function(t){var n=angular.copy(e.component.collections);n.splice(t,1),e.component.collections=n}}}}),app.directive("videoComponent",["$sce",function(e){"use strict";return{scope:{component:"=",ssbEditor:"="},templateUrl:"/components/component-wrap.html",link:function(t){t.isEditing=!0,t.flvVideoUrl=function(t,n,a,o,i){var s=urlParser.parse(n),r="";return s?(r=t+s.id+"?showinfo=0&rel=0&hd=1",a&&(r+="&autoplay=1"),o||(r+="&controls=0"),i||(r+="&modestbranding=1")):r=t,e.trustAsResourceUrl(r)},t.trustSrc=function(t){return e.trustAsResourceUrl(t)},t.config={autoHide:!0,autoPlay:!1,autoHideTime:1500,responsive:!0,stretch:"fit",theme:{url:"../../js/libs/videogular-themes-default/videogular.css",playIcon:"&#xe000;",pauseIcon:"&#xe001;",volumeLevel3Icon:"&#xe002;",volumeLevel2Icon:"&#xe003;",volumeLevel1Icon:"&#xe004;",volumeLevel0Icon:"&#xe005;",muteIcon:"&#xe006;",enterFullScreenIcon:"&#xe007;",exitFullScreenIcon:"&#xe008;"}}}}}]),app.directive("confirmClick",["$state",function(e){"use strict";return{restrict:"A",scope:{confirmClickConfirm:"&",confirmClickCancel:"&",confirmClickHref:"@",confirmClickBtnOkLabel:"="},link:function(t,n){var a="#/";void 0!==t.confirmClickHref?"#"===t.confirmClickHref?a=t.confirmClickHref:a+=t.confirmClickHref:a+=e.current.name,$(n).confirmation({placement:"top",btnOkLabel:t.confirmClickBtnOkLabel,onConfirm:function(){t.confirmClickConfirm&&t.confirmClickConfirm()},onCancel:function(){t.confirmClickCancel&&t.confirmClickCancel()},href:a}).off("show")}}}]),app.directive("stCustomPagination",["stConfig",function(e){"use strict";return{restrict:"EA",require:"^stTable",scope:{stItemsByPage:"=?",stDisplayedPages:"=?",stPageChange:"&"},templateUrl:function(t,n){return n.stTemplate?n.stTemplate:e.pagination.template},link:function(t,n,a,o){function i(){var e,n,a=o.tableState().pagination,i=1,s=t.currentPage;for(t.totalItemCount=a.totalItemCount,t.currentPage=Math.floor(a.start/a.number)+1,(e=(i=Math.max(i,t.currentPage-Math.abs(Math.floor(t.stDisplayedPages/2))))+t.stDisplayedPages)>a.numberOfPages&&(e=a.numberOfPages+1,i=Math.max(1,e-t.stDisplayedPages)),t.pages=[],t.numPages=a.numberOfPages,n=i;n<e;n++)t.pages.push(n);s!==t.currentPage&&t.stPageChange({newPage:t.currentPage})}t.stItemsByPage=t.stItemsByPage?+t.stItemsByPage:e.pagination.itemsByPage,t.stDisplayedPages=t.stDisplayedPages?+t.stDisplayedPages:e.pagination.displayedPages,t.currentPage=1,t.pages=[],t.$watch(function(){return o.tableState().pagination},i,!0),t.$watch("stItemsByPage",function(e,n){e!==n&&t.selectPage(1)}),t.$watch("stDisplayedPages",i),t.selectPage=function(e){e>0&&e<=t.numPages&&(o.slice((e-1)*t.stItemsByPage,t.stItemsByPage),$("html, body").animate({scrollTop:0},600))},o.tableState().pagination.number||o.slice(0,t.stItemsByPage)}}}]),app.directive("ctDismiss",function(){"use strict";return{restrict:"A",link:function(e,t,n){t.on("click",function(e){t.parent("."+n.ctDismiss).hide(),e.preventDefault()})}}}),app.directive("elem",["$rootScope","$timeout","$compile","SimpleSiteBuilderService","$window","UtilService","toaster",function(e,t,n,a,o,i,s){"use strict";return{require:"?ngModel",replace:!0,transclude:!0,scope:{title:"@ngModel",className:"@className"},template:function(t,n){var a=e.$state&&e.$state.current&&"app.support.singletopic"===e.$state.current.name;return a&&(n.helpTopics=a),n.ssbBlogEditor||n.broadcastMessageEditor?'<div class="editable {{className}}" ng-bind-html="ngModel | unsafe"></div>':n.helpTopics?'<div class="edit-wrap"> <span class="editable-title">{{title | formatText}}</span><div class="editable element-wrapng-bind-html="ngModel | unsafe"></div></div>':n.broadcastMessageEditor?'<div class="editable {{className}}" ng-bind-html="ngModel | unsafe"></div>':'<div data-edit class="edit-wrap ssb-edit-wrap ssb-element"> <span class="editable-title">{{component}}</span><div ng-class="{{vm.elementClass()}}" ng-attr-style="{{vm.elementStyle(true)}}" class="ssb-text-settings {{className}}" is-edit="true" ><div ng-if="component.isOverlayActive"class="bg slider-overlay-bg" ng-style ="{\'background\': component.overlayBackground, opacity: component.overlayOpacity === 0 ?  component.overlayOpacity : component.overlayOpacity/100  || 0 , \'height\': component.isOverlayActive ? component.gridHeight+\'px\':\'\' }"> </div><div ng-show="vm.showHide()" class="editable element-wrap" ng-bind-html="ngModel | unsafe"></div><div ng-if="!vm.showHide()" class="text-center">HIDDEN</div></div></div>'},link:function(n,r,c,l){function u(e){e.shared.count=1,e.shared&&(e.shared.count=1,delete e.shared.$tb,delete e.shared.popup_buttons,delete e.shared.popups,delete e.shared.$image_resizer,delete e.shared.$img_overlay,delete e.shared.$line_breaker,delete e.shared.exit_flag,delete e.shared.vid_exit_flag)}function d(e){return!(e.ssbBlogEditor||e.broadcastMessageEditor||e.helpTopics||e.ssbEmailEditor)}n.component=n.$parent.component,n.update=function(e){t(function(){n.$apply(function(){l.$setViewValue(e.editor.getData())})},0)},n.setContent=function(e){t(function(){n.$apply(function(){e.editor.setData(l.$viewValue)})},0)},n.updateFroalaContent=_.debounce(function(e,a){t(function(){var t=a||e.html.get().replace(/\u2028|\u2029/g,"");l.$setViewValue(t),n.compileEditorElements(e)})},500),e.$on("$destroyFroalaInstances",function(){var e=angular.element(r[0].querySelector(".editable"))[0];$(e).data("froala.editor")&&u($(e).data("froala.editor"))});var p=angular.element(r[0].querySelector(".editable"))[0],m=$(p).closest("[component]").attr("id");(c.ssbBlogEditor||c.broadcastMessageEditor)&&(p=r[0]),n.compileEditorElements=function(e,t){a.compileEditorElements(e,t,m,e.id,n)},(n.$parent.ssbEditor||angular.element(p).scope()&&angular.element(p).scope().pvm||n.$parent.vm&&n.$parent.vm.ssbEditor||c.helpTopics||c.broadcastMessageEditor)&&$(function(){var r=c.ssbBlogEditor,m=c.helpTopics,g=$.FroalaEditor.build(c.broadcastMessageEditor?"broadcastMessageEditor":c.ssbBlogEditor?"ssbBlogEditor":c.ssbEmailEditor?"ssbEmailEditor":void 0);r&&(g.enter=$.FroalaEditor.ENTER_P,g.placeholderText=c.placeholder,a.permissions&&!0===a.permissions.html&&-1===g.toolbarButtons.indexOf("html")&&g.toolbarButtons.push("html")),$.merge(g.htmlAllowedEmptyTags,["healcode-widget"]),t(function(){$(p).on("froalaEditor.initialized",function(e,t){if((r||m||c.broadcastMessageEditor)&&u(t),$(".fr-toolbar.fr-inline.fr-desktop:first").addClass("ssb-froala-first-editor"),l.$viewValue){var a=l.$viewValue.replace("<span>","<span style=''>").replace(/\u2028|\u2029/g,"");l.$setViewValue(a),t.html.set(a)}n.compileEditorElements(t,!0),c.placeholder&&t.$placeholder&&t.$placeholder.text(c.placeholder)}).froalaEditor(g).on("froalaEditor.contentChanged",function(e,t){n.updateFroalaContent(t)}).on("froalaEditor.click",function(e,t){d(c)&&i.flyoverhideonclick(),c.placeholder&&t.$placeholder&&t.$placeholder.text(c.placeholder)}).on("froalaEditor.keydown",function(e,t){n.updateFroalaContent(t)}).on("froalaEditor.image.resizeEnd",function(e,t){n.updateFroalaContent(t)}).on("froalaEditor.toolbar.show",function(t,a){e.app.layout.isSidebarClosed=!0,$(".fr-toolbar").removeClass("ssb-froala-active-editor"),a.$tb.addClass("ssb-froala-active-editor"),n.$emit("focusEditor",{editor:a})}).on("froalaEditor.toolbar.hide",function(e,t){t.shared&&t.shared.$img_overlay&&t.shared.$img_overlay.hide(),t.popups.areVisible()&&$(".fr-toolbar").removeClass("ssb-froala-active-editor")}).on("froalaEditor.commands.before",function(e,t,n){"videoInsertEmbed"===n&&$.FE&&($.FE.VIDEO_EMBED_REGEX=g.VIDEO_EMBED_REGEX)}).on("froalaEditor.image.inserted",function(e,t,n){if(n&&n.attr("src")){var a=n.attr("src").replace(/^(http|https):/i,"");n.attr("src",a)}}).on("froalaEditor.link.beforeInsert",function(e,t,n){if((c.ssbEmailEditor||c.broadcastMessageEditor)&&n&&0!==n.indexOf("mailto:")&&0!==n.indexOf("tel:")&&!/^(f|ht)tps?:\/\//i.test(n))return t.popups.get("link.insert").find('input[name="href"]').addClass("fr-error"),t.events.trigger("link.bad",[]),s.clear("*"),s.pop("warning","Protocol is required"),!1}).on("froalaEditor.commands.after",function(e,a,o,i){if(a.popups.areVisible()&&$(".fr-toolbar").removeClass("ssb-froala-active-editor"),"undo"===o&&n.compileEditorElements(a,!0),"imageStyle"!==o&&"imageDisplay"!==o&&"linkInsert"!==o&&"imageAlign"!==o&&"imageSetSize"!==o&&"linkRemove"!==o&&"imageRemove"!==o&&"imageSetAlt"!==o||n.updateFroalaContent(a),"html"===o&&a.codeView.isActive()){var s=a.$box.find(".CodeMirror");if(s&&s.length>0){var r=s[0].CodeMirror;r&&r.on("change",function(){t(function(){n.updateFroalaContent(a,a.codeView.get())},0)})}}if("linkRemoveBtn"===o&&a.selection&&a.selection.element&&(f=angular.element(a.selection.element())).length&&f.removeAttr("href"),"tableRows"===o||"tableHeader"===o){if(a.$el.find(".fr-selected-cell").length){var c=a.$el.find(".fr-selected-cell").css("padding"),l=a.$el.find(".fr-selected-cell").css("border-width"),u=a.$el.find(".fr-selected-cell").closest("table").find("td"),d=a.$el.find(".fr-selected-cell").closest("table").find("th");u.css("padding",c),d.css("padding",c),u.css("border-width",l),d.css("border-width",l)}if("tableHeader"===o){var p=a.popups.get("table.edit");if(p){var m=p.find('.fr-command[data-cmd="tableHeader"]');m&&m.hasClass("fr-active")&&m.removeClass("fr-active")}}}if("clearFormatting"===o){var g=a.$el.find("video");g.length&&g.each(function(){var e=$(this);e.parents("span.fr-video.fr-dvb").length||e.wrap("<span class='fr-video fr-dvb' />")})}if("linkStyle"===o&&"ssb-theme-btn"===i&&a.selection&&a.selection.element){var f=angular.element(a.selection.element());f.hasClass("ssb-theme-btn")?f.addClass("btn"):f.is("span")&&f.closest(".ssb-theme-btn").length&&f.closest(".ssb-theme-btn").addClass("btn")}}).on("froalaEditor.focus",function(e,t){t.selection.save(),d(c)&&i.flyoverhideonclick()}).on("froalaEditor.paste.before",function(e,t){t.selection.restore()}).on("froalaEditor.blur",function(e,t){c.placeholder&&t.$placeholder&&t.$placeholder.text(c.placeholder),$(".fr-toolbar").removeClass("ssb-froala-active-editor"),t.selection.save(),n.$emit("activeEditor",{editor:t,editorImage:t.image.get()})}).on("froalaEditor.popups.hide.image.insert",function(){}).on("froalaEditor.popups.hide.image.edit",function(){}).on("froalaEditor.popups.show.image.edit",function(e,t){t.selection.save(),n.$emit("activeEditor",{editor:t,editorImage:t.image.get()})}).on("froalaEditor.image.removed",function(e,t){n.updateFroalaContent(t)}).on("froalaEditor.bgColorChange",function(e,t,n){if(t.opts.isButton){var a=t.opts.button.scope().vm.elementData;"Button"===a.title&&(a.bg||(a.bg={}),t.opts.button.scope().vm.elementData.bg.color=n)}}).on("froalaEditor.txtColorChange",function(e,t,n){t.opts.isButton&&"Button"===t.opts.button.scope().vm.elementData.title&&(t.opts.button.scope().vm.elementData.txtcolor=n)}),$(p).froalaEditor("events.on","keydown",function(e){return d(c)&&i.flyoverhideonclick(),13!==e.which||!$(o.getSelection().focusNode).parents(".ssb-theme-btn").length||(0!==o.getSelection().focusOffset&&o.getSelection().focusOffset!==o.getSelection().focusNode.length?(e.preventDefault(),!1):void 0)},!0)},2e3)})}}}]),app.directive("a",function(){return{restrict:"E",link:function(e,t,n){(n.ngClick||""===n.href||"#"===n.href)&&t.on("click",function(e){e.preventDefault()})}}}),app.directive("errSrc",function(){return{scope:{errSrc:"@",errContact:"=",isContact:"@"},link:function(e,t,n){var a=["turquoise","emerland","peterriver","amethyst","wetasphalt","greensea","nephritis","belizehole","wisteria","midnightblue","sunflower","carrot","alizarin","clouds","concrete","orange","pumpkin","pomegranate","silver","asbestos"];e.$watch(function(){return n.ngSrc},function(n){!n&&e.errContact?(t.hide(),angular.element('<div class="animated bounce two-letter-label '+_.sample(a)+'">'+e.getContactLetters()+"</div>").insertAfter(t)):n||t.attr("src",e.errSrc)}),t.bind("error",function(){if(e.errSrc.length>0&&!e.errContact)t.attr("src",e.errSrc);else{t.hide();var n=angular.element('<div class="animated bounce two-letter-label '+_.sample(a)+'">'+e.getContactLetters()+"</div>");e.isContact&&t.attr("src",e.errSrc),n.insertAfter(t)}});var o=["beer","diamond","fighter-jet","gamepad","flag-checkered","key","leaf","motorcycle","ship","space-shuttle"];e.getContactLetters=function(){var t="";e.errContact;return e.errContact&&e.errContact.details&&e.errContact.details.length>0&&e.errContact.details[0].emails&&e.errContact.details[0].emails.length>0&&e.errContact.details[0].emails[0].email&&(t=e.errContact.details[0].emails[0].email.charAt(0)),e.errContact&&e.errContact.first&&(t=e.errContact.first.charAt(0)),e.errContact&&e.errContact.last&&(t=t+" "+e.errContact.last.charAt(0)),t.length<=0&&(t='<span class="fa fa-'+_.sample(o)+'"></span>'),t}}}}),app.directive("stExport",["$http","$timeout","OrderService","$filter",function(e,t,n,a){return{require:"^stTable",link:function(e,t,n,o){function i(t,n,a){var o=angular.isObject(t)?t:JSON.parse(t),i="";n.length&&(i+=n+"\r\n\n");var c=["customer","contact_email","order_id","completed_at","modified","created","status","total","total_discount","tax_rate","total_tax","subtotal","total_shipping","shipping_tax","cart_tax","currency","line_items","total_line_items_quantity","billing_address","shipping_address","notes"],l={customer:"Contact",contact_email:"Email",order_id:"Order Id",completed_at:"Completed At",modified:"Updated At",created:"Created At",status:"Status",total:"Total",total_discount:"Total Discount",tax_rate:"Tax Rate",total_tax:"Total Tax",subtotal:"Subtotal",total_shipping:"Shipping",shipping_tax:"Shipping Tax",cart_tax:"Cart Tax",currency:"Currency",line_items:"Line Items",total_line_items_quantity:"Total Line Items Quantity",billing_address:"Billing Details",shipping_address:"Shipping Details",notes:"Notes"};_.invert(c);if(a){var u="";_.each(l,function(e,t){u+=e+","}),u=u.slice(0,-1),i+=u+"\r\n"}if(_.each(o,function(e,t){var n=_.allKeys(l),a={};_.each(n,function(t,n){a[t]=e[t]}),e=a;var o="";_.each(e,function(e,t){if(-1!==c.indexOf(t))if("line_items"==t){var n="",a="",i="";o+='"';for(var l in e)n=e[l].name,a=e[l].product?e[l].product.sku:e[l].sku,(i=e[l].quantity)&&(o+=i+" ea. "),o+=n,a&&"null"!=a&&(o+=" ("+a+")"),e.length-1!=l&&(o+="\r");o+="\n",o+='",'}else if("customer"==t)o+='"'+(e?e._full:"")+'",';else if("notes"==t){var u="";for(var d in e)e.length-1==d?u+=e[d].note:u+=e[d].note+"\r\n";o+='"'+u+'",'}else if("billing_address"==t){var p=s(e);o+='"'+p+'",'}else if("shipping_address"==t){var m=s(e);o+='"'+m+'",'}else if("modified"==t){var g=r(e);o+='"'+g+'",'}else if("created"==t){var f=r(e);o+='"'+f+'",'}else o+='"'+e+'",'}),o.slice(0,o.length-1),i+=o+"\r\n"}),""!=i){var d="Orders";d+=n.replace(/ /g,"_");var p=e.charset||"utf-8",m=new Blob([i],{type:"text/csv;charset="+p+";"});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(m,d+".csv");else{var g="data:text/csv;charset=utf-8,"+escape(i),f=document.createElement("a");f.href=g,$(f).css("visibility","hidden"),f.download=d+".csv",document.body.appendChild(f),f.click(),document.body.removeChild(f)}}else alert("Invalid data")}function s(e){var t="";return Object.keys(e).length&&(e.company&&(t+=e.company||"\r\n"),e.address_1&&!e.address_2?t+=e.address_1||"\r\n":e.address_1&&e.address_2?t+=(e.address_1||"")+", "+(e.address_2||"")+"\r\n":!e.address_1&&e.address_2&&(t+=e.address_2||"\r\n"),e.city&&(t+=e.city||""),e.city&&(e.state||e.postcode)?t+=", "+(e.state||"")+" "+(e.postcode||""):e.city||!e.state&&!e.postcode||(t+=(e.state||"")+" "+(e.postcode||"")),e.phone&&(t+="\r\n"+e.phone||""),(e.first_name||e.last_name)&&(t+="\r\n\r\n"+((e.first_name||"")+" "+(e.last_name||"")).trim()),e.email&&(t+="\r\n"+e.email||"")),t.trim()}function r(e){var t="";return e&&e.date&&(t=a("date")(e.date,"MMM d yy")),t}t.bind("click",function(){i(o.getFilteredCollection(),"",!0)})}}}]),app.directive("fileChange",["$parse",function(e){return{require:"ngModel",restrict:"A",link:function(t,n,a,o){var i=e(a.fileChange);n[0].addEventListener("change",function(e){t.$apply(function(){i(t,{$event:e,files:e.target.files})})},!1)}}}]),app.directive("fileModel",["$parse","toaster",function(e,t){return{restrict:"A",link:function(n,a,o){var i=e(o.fileModel).assign,s=o.acceptedFormats;a.bind("change",function(){n.$apply(function(){a&&a[0]&&a[0].files&&a[0].files[0]&&s?_.contains(s.split(","),a[0].files[0].type)?i(n,a[0].files[0]):t.pop("warning","Invalid file format"):i(n,a[0].files[0])})})}}}]),app.directive("ngThumb",["$window",function(e){var t={support:!(!e.FileReader||!e.CanvasRenderingContext2D),isFile:function(t){return angular.isObject(t)&&t instanceof e.File},isImage:function(e){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(t)}};return{restrict:"A",template:"<canvas/>",link:function(e,n,a){function o(){var e=i.width||this.width/this.height*i.height,t=i.height||this.height/this.width*i.width;s.attr({width:e,height:t}),s[0].getContext("2d").drawImage(this,0,0,e,t)}if(t.support){var i=e.$eval(a.ngThumb);if(t.isFile(i.file)&&t.isImage(i.file)){var s=n.find("canvas"),r=new FileReader;r.onload=function(e){var t=new Image;t.onload=o,t.src=e.target.result},r.readAsDataURL(i.file)}}}}}]),app.directive("fixedHeaderTable",["$timeout","$document","$rootScope","$window",function(e,t,n,a){return{restrict:"A",link:function(t,o,i){function s(){var e=angular.element(o).find("tbody").width();$(".sticky-header-class tr").width(e+"px")}t.$watch(function(){return o.find("thead.sticky-header-class").length},function(e){e&&s()}),n.$watch("app.layout.isSidebarClosed",function(t){e(function(){s()},0)}),angular.element(a).bind("resize",function(){s()})}}}]),app.directive("ctFullheight",["$window","$rootScope","$timeout","APP_MEDIAQUERY",function(e,t,n,a){return{restrict:"AE",scope:{ctFullheightIf:"&"},link:function(t,a,o){var i,s,r=$(e),c=$(document),l=!0;t.initializeWindowSize=function(){n(function(){if(i=0,o.ctFullheightIf&&t.$watch(t.ctFullheightIf,function(e,t){e&&!t?l=!0:e||($(a).css("height","auto"),l=!1)}),o.ctFullheightExclusion){var e=o.ctFullheightExclusion.split(",");angular.forEach(e,function(e){i+=$(e).outerHeight(!0)})}o.ctFullheightNum&&(i+=parseInt(o.ctFullheightNum)),s=$(o.ctFullheight),"window"!=o.ctFullheight&&o.ctFullheight||(s=r),"document"==o.ctFullheight&&(s=c),t.$watch(function(){t.__height=s.height()}),l&&($(a).css("height","auto"),s.innerHeight()<r.innerHeight()&&(s=r),$(a).css("height",s.innerHeight()-i),o.dataCtOverflow&&$(a).css("overflow","auto"))},300)},t.initializeWindowSize(),t.$watch("__height",function(e,n){t.initializeWindowSize()}),r.on("resize",function(){t.initializeWindowSize()})}}}]),app.directive("globalScripts",["$sce",function(e){return{restrict:"E",replace:!0,template:'<span ng-bind-html="globalScripts"></span>',scope:{website:"=",account:"="},link:function(t,n,a){t.globalScripts="";!function(){t.globalScripts="";var n=t.account,a=t.website;n.showhide.userScripts&&a&&a.resources&&a.resources.userScripts&&a.resources.toggles&&a.resources.toggles.userScripts&&(angular.isDefined(a.resources.userScripts.global)&&(t.globalScripts+="\n\n"+a.resources.userScripts.global.sanitized),t.globalScripts=e.trustAsHtml(t.globalScripts))}()}}}]),app.directive("includeReplace",function(){return{require:"ngInclude",restrict:"A",link:function(e,t,n){}}}),app.directive("indDraggable",["$document",function(e){return{link:function(t,n,a){function o(e){l=e.pageY-r,c=e.pageX-s,n.css({top:l+"px",left:c+"px"}),(l>3||c>3)&&e.stopPropagation()}function i(){e.off("mousemove",o),e.off("mouseup",i)}var s=n.position().left||0,r=n.position().top||0,c=s,l=r;n.css({position:"fixed"});var u=n.find(".draggable-handle");0===u.length&&(u=n),u.on("mousedown",function(t){"INPUT"!==t.target.nodeName&&"TEXTAREA"!==t.target.nodeName&&"SELECT"!==t.target.nodeName&&(s=t.pageX-c,r=t.pageY-l,e.on("mousemove",o),e.on("mouseup",i))})}}}]),app.directive("indInternationalTelNumber",["$timeout","$window",function(e,t){"use strict";return{restrict:"A",require:"ngModel",scope:{form:"@form"},link:function(t,n,a,o){("phone"===a.name||a.phoneField)&&e(function(){$(n).removeAttr("placeholder"),$(n).intlTelInput({nationalMode:!1,utilsScript:"/js/libs_misc/intl-tel-input/build/js/utils.js"}),t.$watch(function(){return o.$modelValue},function(e,t){e&&!t&&$(n).trigger("keyup")}),t.form&&($(n).on("open:countrydropdown",function(e){$(n).parents("section").addClass("overflow_visible-without-index")}),$(n).on("close:countrydropdown",function(e){$(n).parents("section").removeClass("overflow_visible-without-index")}),t.$watch(function(){return o.$modelValue},function(e){e?t.$parent[t.form][a.name].$setValidity(a.name,$(n).intlTelInput("isValidNumber")):t.$parent[t.form][a.name].$setValidity(a.name,!0)}))},0)}}}]),app.directive("indSlider",["$timeout",function(e){return{restrict:"A",link:function(t,n,a){e(function(){$(n).slick(t.$eval(a.indSlider))},500),t.$on("updatetestimonialHeight.component",function(o,i){t.applyingNewWidth=!0,$(n).hasClass("slick-initialized")&&($(n).slick("unslick"),e(function(){t.$apply(function(){$(n).slick(t.$eval(a.indSlider)),t.applyingNewWidth=!1})},0))}),t.$on("$refreshSlickSlider",function(o,i){$(n).hasClass("slick-initialized")&&($(n).slick("unslick"),e(function(){t.$apply(function(){$(n).slick(t.$eval(a.indSlider)),i&&$(n).slick("slickGoTo",i)})},100))})}}}]),app.directive("indiDatepicker",["$compile","$timeout",function(e,t){return{replace:!0,restrict:"E",scope:{ngModel:"=",popup:"@",readOnly:"@",clickInput:"@"},template:'<div class="input-group"><input type="text" ng-click="clickInputFn($event)" readonly="{{readOnly}}" class="form-control" datepicker-popup="{{popup}}" ng-model="ngModel" is-open="datePicker.isOpen" min-date="minDate" close-text="Close"/><span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="open($event)"><i class="glyphicon glyphicon-calendar"></i></button></span></div>',link:function(e,n,a){e.datePicker={},e.dateOptions={formatYear:"yy",startingDay:1},e.open=function(a){a.preventDefault(),a.stopPropagation(),$("div[click-input][show-single] ul.dropdown-menu").length?($("div[click-input][show-single] ul.dropdown-menu").hide(),t(function(){e.datePicker.isOpen=!0,$(n).find("ul.dropdown-menu").show()},0)):e.datePicker.isOpen=!0},e.endOpen=function(t){t.preventDefault(),t.stopPropagation(),e.startOpened=!1,e.endOpened=!e.endOpened},e.startOpen=function(t){t.preventDefault(),t.stopPropagation(),e.endOpened=!1,e.startOpened=!e.startOpened},e.clickInputFn=function(t){e.clickInput&&e.open(t)}}}}]),app.directive("imgLazyLoad",["$window","$document",function(e,t){function n(e){function t(t){t?(e.attr("height",s),e.attr("width",s)):(e.removeAttr("height"),e.removeAttr("width"))}function n(){e.attr("src",a)}var a=null,o=!1,i=150,s="150px";return{isVisible:function(n,a){if(t(!0),!e.is(":visible"))return t(!1),!1;null===i&&(i=e.height()||150);var o=e.offset().top-$("#assets").offset().top,s=o+i;return t(!1),o<=a&&o>=n||s<=a&&s>=n||o<=n&&s>=a||o<=a&&s<=a&&(o<=a||o<=n)},render:function(){o=!0,n()},setSource:function(e){a=e,o&&n()}}}var a=function(){function e(){for(var e=$("#assets"),t=[],a=[],o=e.height(),s=e.scrollTop(),c=s+o,l=0;l<r.length;l++){var u=r[l];u.isVisible(s,c)?t.push(u):a.push(u)}for(l=0;l<t.length;l++)t[l].render();r=a,n(),r.length||i()}function n(){clearTimeout(c),c=null}function a(){c=setTimeout(e,l)}function o(){u=!0;var e=$("#assets");e.on("resize.imgLazyLoad",s),e.on("scroll.imgLazyLoad",s)}function i(){u=!1;var e=$("#assets");e.off("resize.imgLazyLoad"),e.off("scroll.imgLazyLoad")}function s(){c||a()}var r=[],c=null,l=2e3,u=(t.height(),!1);return{addImage:function(e){r.push(e),c||a(),u||o()},removeImage:function(e){for(var t=0;t<r.length;t++)if(r[t]===e){r.splice(t,1);break}r.length||(n(),i())}}}();return{link:function(e,t,o){var i=new n(t);a.addImage(i),o.$observe("imgLazyLoad",function(e){i.setSource(e)}),e.$on("$destroy",function(){a.removeImage(i)})},restrict:"A",scope:{container:"@container"}}}]),app.directive("mediaModal",["$http","$timeout","FileUploader","AssetsService","ToasterService",function(e,t,n,a,o){return{require:[],restrict:"C",transclude:!1,replace:!1,scope:{insertMediaType:"=",onInsertMediacb:"=",downloadData:"=",user:"=user"},controller:["$scope","AssetsService","$compile",function(a,i,s){function r(){if(d){d.css("height",$(window).height()-30+"px"),p.css("height",$(window).height()-30+"px"),a.bodyHeight=$(window).height()-210+"px";var e=$(".filter-type");t(function(){e.removeClass("filter-type")},0),t(function(){e.addClass("filter-type")},0)}}var c,l,u,d,p,m;(c=a.uploader=new n({url:"/api/1.0/assets/",removeAfterUpload:!0,filters:[{name:"SizeLimit",fn:function(e){switch(e.type.substring(0,e.type.indexOf("/"))){case"video":if(524288001>parseInt(e.size))return!0;o.show("error","The maximum video file size 500MB. Unable to Upload.");break;case"image":case"audio":if(52428800>parseInt(e.size))return!0;o.show("error","The maximum audio file size 50MB. Unable to Upload.");break;case"document":default:if(10485760>parseInt(e.size))return!0;o.show("error","The maximum file size 10MB. Unable to Upload.")}return!1}}]})).filters.push({name:"customFilter",fn:function(e,t){return this.queue.length<10}}),c.onSuccessItem=function(e,t,n,o){a.uploadComplete=!1,t.files[0].filename=e.file.name,t.files[0].mimeType=e.file.type,a.originalAssets.push(t.files[0]),a.assets.push(t.files[0]),t.files[0].checked=!0,a.m.singleSelect(t.files[0])},c.onErrorItem=function(e,t,n,i){a.uploadComplete=!1,o.show("error","Connection timed out")},e.get("/admin/assets/views/partials/mediamodal.html").success(function(e){s(e)(a).appendTo($("#model_container")),m=$("#media-manager-modal","#model_container"),l=$(".modal-footer",m),u=$(".modal-header",m),d=$(".modal-content",m),p=$(".media",m),d.css("visibility","hidden"),m.on("shown.bs.modal",function(e){e.relatedTarget?(a.showInsert=$(e.relatedTarget).attr("media-modal-show-insert"),a.blogImage=$(e.relatedTarget).attr("blog-post-image"),$(window).trigger("resize"),d.css("visibility","visible")):a.$parent.showInsert&&(a.showInsert=!0,$(window).trigger("resize"),d.css("visibility","visible"))})}),$(window).resize(function(){r()}),a.lastSelect=null,a.isSingleSelect=!0,a.showType="all",a.editingImage=!1,a.selectModel={select_all:!1},a.batch=[],a.m=a.m||{},a.isMobile=!1,a.checkMobile=function(){var e=!1;return function(t,n){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),a.isMobile=e,e},a.checkMobile(),a.typeMimes={image:["image/png","image/jpeg","image/gif"],video:["video/mpeg","video/mp4","video/webm","video/x-flv","video/x-ms-wmv"],audio:["audio/mpeg"],document:["application/octet-stream","application/pdf"]},a.m.selectTriggerFn=function(e){a.selectModel.select_all=e,a.m.selectAll(),a.singleSelected=!1},a.m.selectAll=function(e,t){t=t||!1,e&&(a.showType=e),a.batch=[],a.assets=[],a.mimeList=[],"all"!==a.showType&&(a.mimeList=a.typeMimes[a.showType]),a.originalAssets.forEach(function(e,n){t||(e.checked=a.selectModel.select_all),"all"===a.showType?(a.assets.push(e),e.checked&&a.batch.push(e)):a.mimeList.indexOf(e.mimeType)>-1&&(a.assets.push(e),e.checked&&a.batch.push(e))}),a.lastSelect=null,a.m.selectAllStatus()},a.m.singleSelect=function(e){a.singleSelected=e.checked,t(function(){if(a.isSingleSelect)a.isSingleSelect&&(a.batch.forEach(function(t){e._id!==t._id&&(t.checked=!1)}),a.batch=[],a.singleSelected&&a.batch.push(e),a.m.selectAllStatus());else{var t=!1;a.batch.forEach(function(n,o){e._id===n._id&&(a.batch.splice(o,1),t=!0)}),t||a.batch.push(e),a.m.selectAllStatus()}},0)},a.m.toggleShiftKey=function(e){a.isSingleSelect=!a.isSingleSelect},a.m.selectAllStatus=function(){var e=!1;a.assets.length>0&&(e=!0,a.assets.forEach(function(t,n){!0!==t.checked&&(e=!1)})),a.selectModel.select_all=e},a.m.deleteAsset=function(e){e&&a.batch.push(e),i.deleteAssets(a.batch,function(e,t){200===t&&(a.originalAssets.forEach(function(e,t){e._id===a.batch[0]._id&&a.originalAssets.splice(t,1)}),a.assets.forEach(function(e,t){e._id===a.batch[0]._id&&a.assets.splice(t,1)}),a.batch.forEach(function(e,t){e._id===a.batch[0]._id&&a.batch.splice(t,1)}),o.show("success","Image(s) deleted")),a.selectModel.select_all=!1})},a.m.editImage=function(e){a.editingImage=!0,a.singleAsset=e;$("#targetEditImage")},a.m.goback=function(){a.editingImage=!1},a.m.onInsertMedia=function(){a.batch.length>0&&(a.onInsertMediacb?(a.onInsertMediacb&&a.onInsertMediacb(a.batch[a.batch.length-1],a.type||a.insertMediaType),a.type=null):a.$parent.insertMedia(a.batch[a.batch.length-1],a.blogImage)),a.m.selectTriggerFn(!1),a.singleSelected=!1,$("#media-manager-modal").modal("hide")}}],link:function(e,t){e.assets=[],a.getAssetsByAccount(function(t){t instanceof Array&&(e.originalAssets=t.slice(0),e.assets=t.slice(0),e.insertMediaType&&e.m.selectAll(e.insertMediaType,!0))}),t.attr("data-toggle","modal"),t.attr("data-target","#media-manager-modal"),$(document).on("add_image",function(t){$("#media-manager-modal").modal("show"),e.type="image_gallery_add_image"}),$(document).on("delete_image",function(t,n){e.type="image_gallery_delete_image",e.onInsertMediacb&&e.onInsertMediacb(n,e.type)})}}}]).directive("captureShift",function(){return{restrict:"A",scope:{onPresskey:"="},link:function(e,t,n){function a(n){n.shiftKey&&(e.onPresskey(),t[0].onkeydown=null,t[0].onkeyup=o)}function o(n){"Shift"===n.keyIdentifier&&(e.onPresskey(),t[0].onkeyup=null,t[0].onkeydown=a)}t[0].onkeydown=a}}}),app.directive("messageItem",["$location",function(e){return{restrict:"EA",link:function(e,t,n){t.on("click tap",function(e){n.messageItem})}}}]),app.directive("stopEvent",function(){return{restrict:"A",link:function(e,t,n){t.on(n.stopEvent,function(e){e.stopPropagation()})}}}),app.directive("indigNavprompt",["$rootScope","$location","$state","SweetAlert","$urlRouter",function(e,t,n,a,o){return{restrict:"C",scope:{checkIfDirty:"&",resetDirty:"&",myState:"@myState",savePage:"&",savePageCheck:"=",allowRedirect:"=?",customRedirectUrl:"@customRedirectUrl"},link:function(o,i,s){angular.isDefined(o.allowRedirect)||(o.allowRedirect=!0),e.$on("$stateChangeStart",function(i,s,r,c,l){o.myState&&n.$current.name===o.myState&&o.checkIfDirty&&o.checkIfDirty()&&(i.preventDefault(),e.app.layout.isMinimalAdminChrome=!0,a.swal({title:"Are you sure?",text:"You have unsaved data. Do you want to save it before navigating to a new page?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",showNoActionButton:!0,noActionButtonText:"Cancel",closeOnConfirm:!0,closeOnCancel:!0},function(i){i?(o.savePage&&(o.savePage(),o.$watch(function(){return o.savePageCheck},function(a){e.app.layout.isMinimalAdminChrome=!1,a&&o.allowRedirect&&(angular.isDefined(o.customRedirectUrl)&&o.customRedirectUrl?t.url(o.customRedirectUrl):n.go(s,r,{notify:!1}).then(function(){e.$broadcast("$stateChangeSuccess",s,r,c,l)}))},!0)),e.$broadcast("$stateChangeSuccess",s,r,c,l)):angular.isDefined(i)?(e.app.layout.isMinimalAdminChrome=!1,o.resetDirty&&o.resetDirty(),a.swal("Not Saved!","Unsaved data was discarded.","success"),angular.isDefined(o.customRedirectUrl)&&o.customRedirectUrl?t.url(o.customRedirectUrl):n.go(s,r,{notify:!1}).then(function(){e.$broadcast("$stateChangeSuccess",s,r,c,l)})):(e.$broadcast("$stateChangeSuccess",s,r,c,l),e.app.layout.isMinimalAdminChrome=!0)}))})}}}]),app.directive("numbersOnly",function(){return{require:"ngModel",link:function(e,t,n,a){a.$parsers.push(function(e){if(void 0==e)return"";var t=e.replace(/[^0-9\.]/g,""),n=t.split(".");return angular.isUndefined(n[1])||(n[1]=n[1].slice(0),t=n[0]+"."+n[1]),t!=e&&(a.$setViewValue(t),a.$render()),t})}}}),app.directive("offClick",["$document","$timeout",function(e,t){function n(e,t){if(!e||!t)return!1;for(var n=angular.element(document.querySelectorAll(t)),a=n.length,o=0;o<a;++o)if(n[o].contains(e))return!0;return!1}return{restrict:"A",scope:{offClick:"&",offClickIf:"&"},link:function(a,o,i){function s(e){if(0!=e.pageX||0!=e.pageY){var t=e.target||e.srcElement;o[0].contains(t)||n(t,i.offClickFilter)||a.$apply(a.offClick())}}i.offClickIf?a.$watch(a.offClickIf,function(n,a){n&&!a?t(function(){e.on("click",s)}):n||e.off("click",s)}):e.on("click",s),a.$on("$destroy",function(){e.off("click",s)})}}}]),app.directive("ctPaneltool",function(){var e={collapse:"<a href='javascript:void(0)' class='btn btn-transparent btn-sm' panel-collapse='' tooltip-placement='top' ng-attr-tooltip='{{{{panelId}} ? \"Expand\" : \"Collapse\"}}' ng-click='{{panelId}} = !{{panelId}}' ng-init='{{panelId}}=false'><i ng-if='{{panelId}}' class='ti-angle-down'></i><i ng-if='!{{panelId}}' class='ti-angle-up'></i></a>",dismiss:"<a href='javascript:void(0)' class='btn btn-transparent btn-sm' panel-dismiss='' tooltip-placement='top' tooltip='Close' ng-click='{{dismissFn}}'><i class='ti-close'></i></a>",refresh:"<a href='javascript:void(0)' class='btn btn-transparent btn-sm' panel-refresh='' tooltip-placement='top' tooltip='Refresh' data-spinner='{{spinner}}'><i class='ti-reload'></i></a>"};return{restrict:"E",template:function(t,n){var a="";return n.toolCollapse&&(a+=e.collapse.replace(/{{panelId}}/g,t.parent().parent().attr("id"))),n.toolDismiss&&(a+=e.dismiss.replace(/{{dismissFn}}/g,n.toolDismiss)),n.toolRefresh&&(a+=e.refresh.replace(/{{spinner}}/g,n.toolRefresh)),a}}}),app.directive("panelDismiss",function(){"use strict";return{restrict:"A",controller:["$scope","$element",function(e,t){t.on("click",function(){var e=$(this).closest(".panel");!function(){var t=e.parent();e.fadeOut(300,function(){$(this).remove(),t.is('[class*="col-"]')&&0===t.children("*").length&&t.remove()})}()})}]}}).directive("panelRefresh",function(){"use strict";return{restrict:"A",controller:["$scope","$element",function(e,t){function n(){this.removeClass(a)}var a="csspinner";t.on("click",function(){var e=$(this),t=e.parents(".panel").eq(0),o=e.data("spinner")||"load1";t.addClass(a+" "+o),t.removeSpinner=n,e.trigger("panel-refresh",[t])})}]}}),function(e,t,n){"use strict";jQuery(n).on("panel-refresh",".panel",function(e,t){setTimeout(function(){t.removeSpinner()},3e3)})}(0,window,document),app.directive("perfectScrollbar",["$parse","$window",function(e,t){var n=["wheelSpeed","wheelPropagation","minScrollbarLength","useBothWheelAxes","useKeyboard","suppressScrollX","suppressScrollY","scrollXMarginOffset","scrollYMarginOffset","includePadding"];return{restrict:"EA",transclude:!0,template:"<div><div ng-transclude></div></div>",replace:!0,link:function(a,o,i){function s(e){a.$evalAsync(function(){"true"==i.scrollDown&&"mouseenter"!=e&&setTimeout(function(){$(o).scrollTop($(o).prop("scrollHeight"))},100),o.perfectScrollbar("update")})}var r=angular.element(t),c={};if(!a.$root.app.isMobile){for(var l=0,u=n.length;l<u;l++){var d=n[l];void 0!==i[d]&&(c[d]=e(i[d])())}a.$evalAsync(function(){o.perfectScrollbar(c);var t=e(i.onScroll);o.scroll(function(){var e=o.scrollTop(),n=o.prop("scrollHeight")-o.height();a.$apply(function(){t(a,{scrollTop:e,scrollHeight:n})})})}),o.bind("mousemove",s),i.refreshOnChange&&a.$watchCollection(i.refreshOnChange,function(){s()}),i.refreshOnResize&&r.on("resize",s),o.bind("$destroy",function(){r.off("resize",s),o.perfectScrollbar("destroy")})}}}}]),app.factory("SelectFx",["$http",function(e){function t(e,t){if(!e)return!1;for(var n=e.target||e.srcElement||e||!1;n&&n!=t;)n=n.parentNode||!1;return!1!==n}function n(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function a(e,t){this.el=e[0],this.options=n({},this.options),n(this.options,t),this._init()}function o(e){return new RegExp("(^|\\s+)"+e+"(\\s+|$)")}function i(e,t){(s(e,t)?c:r)(e,t)}var s,r,c;"classList"in document.documentElement?(s=function(e,t){return e.classList.contains(t)},r=function(e,t){e.classList.add(t)},c=function(e,t){e.classList.remove(t)}):(s=function(e,t){return o(t).test(e.className)},r=function(e,t){s(e,t)||(e.className=e.className+" "+t)},c=function(e,t){e.className=e.className.replace(o(t)," ")});var l={hasClass:s,addClass:r,removeClass:c,toggleClass:i,has:s,add:r,remove:c,toggle:i};return"function"==typeof define&&define.amd?define(l):window.classie=l,a.prototype.options={newTab:!0,stickyPlaceholder:!0,onChange:function(e){return!1}},a.prototype._init=function(){var e=!1;this.el.hasAttribute("disabled")&&(this.el.className=this.el.className+" disabled",e=!0);var t=this.el.querySelector("option[selected]");this.hasDefaultPlaceholder=t&&t.disabled,this.selectedOpt=t||this.el.querySelector("option"),this._createSelectEl(),this.selOpts=[].slice.call(this.selEl.querySelectorAll("li[data-option]")),this.selOptsCount=this.selOpts.length,this.current=this.selOpts.indexOf(this.selEl.querySelector("li.cs-selected"))||-1,this.selPlaceholder=this.selEl.querySelector("span.cs-placeholder"),e||this._initEvents()},a.prototype._createSelectEl=function(){var e="",t=function(e){var t="",n="",a="";return!e.selectedOpt||this.foundSelected||this.hasDefaultPlaceholder||(n+="cs-selected ",this.foundSelected=!0),e.getAttribute("data-class")&&(n+=e.getAttribute("data-class")),e.getAttribute("data-link")&&(a="data-link="+e.getAttribute("data-link")),""!==n&&(t='class="'+n+'" '),"<li "+t+a+' data-option data-value="'+e.value+'"><span>'+e.textContent+"</span></li>"};[].slice.call(this.el.children).forEach(function(n){if(!n.disabled){var a=n.tagName.toLowerCase();"option"===a?e+=t(n):"optgroup"===a&&(e+='<li class="cs-optgroup"><span>'+n.label+"</span><ul>",[].slice.call(n.children).forEach(function(n){e+=t(n)}),e+="</ul></li>")}});var n='<div class="cs-options"><ul>'+e+"</ul></div>";this.selEl=document.createElement("div"),this.selEl.className=this.el.className,this.selEl.tabIndex=this.el.tabIndex,this.selEl.innerHTML='<span class="cs-placeholder">'+this.selectedOpt.textContent+"</span>"+n,this.el.parentNode.appendChild(this.selEl),this.selEl.appendChild(this.el)},a.prototype._initEvents=function(){var e=this;this.selPlaceholder.addEventListener("click",function(){e._toggleSelect()}),this.selOpts.forEach(function(t,n){t.addEventListener("click",function(){e.current=n,e._changeOption(),e._toggleSelect()})}),document.addEventListener("click",function(n){var a=n.target;e._isOpen()&&a!==e.selEl&&!t(a,e.selEl)&&e._toggleSelect()}),this.selEl.addEventListener("keydown",function(t){switch(t.keyCode||t.which){case 38:t.preventDefault(),e._navigateOpts("prev");break;case 40:t.preventDefault(),e._navigateOpts("next");break;case 32:t.preventDefault(),e._isOpen()&&void 0!==e.preSelCurrent&&-1!==e.preSelCurrent&&e._changeOption(),e._toggleSelect();break;case 13:t.preventDefault(),e._isOpen()&&void 0!==e.preSelCurrent&&-1!==e.preSelCurrent&&(e._changeOption(),e._toggleSelect());break;case 27:t.preventDefault(),e._isOpen()&&e._toggleSelect()}})},a.prototype._navigateOpts=function(e){this._isOpen()||this._toggleSelect();var t=void 0!==this.preSelCurrent&&-1!==this.preSelCurrent?this.preSelCurrent:this.current;("prev"===e&&t>0||"next"===e&&t<this.selOptsCount-1)&&(this.preSelCurrent="next"===e?t+1:t-1,this._removeFocus(),l.add(this.selOpts[this.preSelCurrent],"cs-focus"))},a.prototype._toggleSelect=function(){this._removeFocus(),this._isOpen()?(-1!==this.current&&(this.selPlaceholder.textContent=this.selOpts[this.current].textContent),l.remove(this.selEl,"cs-active")):(this.hasDefaultPlaceholder&&this.options.stickyPlaceholder&&(this.selPlaceholder.textContent=this.selectedOpt.textContent),l.add(this.selEl,"cs-active"))},a.prototype._changeOption=function(){void 0!==this.preSelCurrent&&-1!==this.preSelCurrent&&(this.current=this.preSelCurrent,this.preSelCurrent=-1);var e=this.selOpts[this.current];this.selPlaceholder.textContent=e.textContent,this.el.value=e.getAttribute("data-value");var t=new Event("change");this.el.dispatchEvent(t);var n=this.selEl.querySelector("li.cs-selected");n&&l.remove(n,"cs-selected"),l.add(e,"cs-selected"),e.getAttribute("data-link")&&(this.options.newTab?window.open(e.getAttribute("data-link"),"_blank"):window.location=e.getAttribute("data-link")),this.options.onChange(this.el.value)},a.prototype._isOpen=function(e){return l.has(this.selEl,"cs-active")},a.prototype._removeFocus=function(e){var t=this.selEl.querySelector("li.cs-focus");t&&l.remove(t,"cs-focus")},a}]),app.directive("csSelect",["SelectFx",function(e){return{restrict:"AC",link:function(t,n,a){new e(n)}}}]),app.directive("showSettings",["$timeout",function(e){return{restrict:"C",link:function(t,n,a){var o;n.on("mouseenter",function(){o=e(function(){},500)}),n.on("mouseleave",function(){e.cancel(o)})}}}]),app.directive("sidebar",["$document","$rootScope","$timeout",function(e,t,n){return{replace:!1,restrict:"C",link:function(a,o,i){var s=!0;"false"!=i.closeOnOuterClicks&&"0"!=i.closeOnOuterClicks||(s=!1);var r=function(e,t){for(var n=e;n.length>0;){if(n[0]===t[0])return n=null,!0;n=n.parent()}return n=null,!1},c=function(e){if(!r(angular.element(e.target),o))return t.toggle(i.id,"off"),e.preventDefault(),!1},l=angular.noop();s&&(l=t.$on("clip-two.toggled",function(t,a,o){a==i.id&&(o?n(function(){e.on("click tap",c)},300):e.off("click tap",c))})),a.$on("$destroy",function(){l(),e.off("click tap",c)})}}}]).directive("searchForm",function(){return{restrict:"AC",link:function(e,t,n){var a=$(".app-aside"),o=t.children("form");t.parent();$(".s-open").on("click",function(e){o.prependTo(a),e.preventDefault(),$(document).on("mousedown touchstart",i)}),$(".s-remove").on("click",function(e){o.appendTo(t),e.preventDefault()});var i=function(e){o.is(e.target)||0!==o.has(e.target).length||($(".s-remove").trigger("click"),$(document).off("mousedown touchstart",i))}}}}).directive("appAside",["$window","$rootScope","$timeout","APP_MEDIAQUERY","DashboardService",function(e,t,n,a,o){function i(){m.trigger("mouseleave")}function s(){return d.hasClass("touch")}function r(){return p.width()<a.desktop}function c(){return $(".app-sidebar-closed").length}function l(){return $(".app-sidebar-fixed").length}var u,d=$("html"),p=$(e),m=$(".app-aside");return{restrict:"AC",controller:["$scope",function(e){e.showDashboardNotificationIcon=!1,e.$watch(function(){return o.updatedWorkstreams},function(){o.updatedWorkstreams&&o.awayFromDashboard&&(e.showDashboardNotificationIcon=!0)},!0),e.userHasNavigated=function(t){"#/dashboard"===t||"#/dohy"===t?(o.setAwayFromDashboard(!1),e.showDashboardNotificationIcon=!1):o.setAwayFromDashboard(!0)}}],link:function(a,o,d,g){var f,h=s()?"click":"mouseenter",v="";o.on("click","a",function(e){u=$(this),(!c()||r()||u.closest("ul").hasClass("sub-menu"))&&(u.closest("ul").find(".open").not(".active").children("ul").not(u.next()).slideUp(200).parent(".open").removeClass("open"),u.next().is("ul")&&u.parent().toggleClass("open")?(u.next().slideToggle(200,function(){p.trigger("resize")}),e.stopPropagation(),e.preventDefault()):t.toggle("sidebar","off"))}),o.on(h,"a",function(e){if(c()&&!r()&&!(u=$(this)).parent().hasClass("hover")&&!u.closest("ul").hasClass("sub-menu")){i(),u.parent().addClass("hover"),f=u.find(".item-inner").clone(),u.parent().hasClass("active")&&f.addClass("active");var t=$("#sidebar").position().top,a=l()?u.parent().position().top+t:u.parent().position().top;if(f.css({position:l()?"fixed":"absolute",height:u.outerHeight(),top:a}).appendTo(m),!u.next().is("ul"))return void(v="");(v=u.next().clone(!0)).appendTo(m).css({top:f.position().top+u.outerHeight(),position:l()?"fixed":"absolute"}),u.parent().position().top+u.outerHeight()+t+v.height()>p.height()&&l()?v.css("bottom",0):v.css("bottom","auto"),m.children().first().scroll(function(){l()&&i()}),n(function(){m.is(":empty")||$(document).on("click tap",i)},300)}}),m.on("mouseleave",function(e){$(document).off("click tap",i),$(".hover",m).removeClass("hover"),$("> .item-inner",m).remove(),$("> ul",m).remove()}),t.$on("$locationChangeSuccess",function(){var t;t=e.location.hash,a.userHasNavigated(t),angular.forEach(o.find(".main-navigation-menu a"),function(e){var n,a=angular.element(e);if(e.hash===t&&(!c()||r()))if(a.closest("ul").hasClass("sub-menu")){n=a.closest("ul");n.slideDown(200).parent().siblings().children(".sub-menu").slideUp(200,function(){$(this).parent().removeClass("open")})}else $(".sub-menu").slideUp(200,function(){$(this).parent().removeClass("open")});n=null})})}}}]),app.directive("indigewebSkeuocard",["PaymentService","UserService","ToasterService","formValidations","$timeout",function(e,t,n,a,o){return{require:[],restrict:"C",transclude:!1,scope:{user:"=user",updateFn:"=update",autoClose:"=autoClose",wrapper:"=wrapperDiv"},templateUrl:"/admin/assets/views/partials/_skeuocard.html",link:function(i,s,r,c){i.saveLoading=!1,t.getAccount(function(e){i.account=e}),i.$watch("account",function(t,n){t&&t.billing.stripeCustomerId?e.getCustomerCards(t.billing.stripeCustomerId,function(e){i.cards=e,i.cards.data.length&&(i.defaultCardValue="XXXX-XXXX-XXXX-"+i.cards.data[0].last4,i.defaultExpiry=i.cards.data[0].exp_month+"/"+(i.cards.data[0].exp_year-2e3),s.find("form").card({container:"."+i.wrapper,values:{number:"4XXXXXXXXXXX"+i.cards.data[0].last4,expiry:i.cards.data[0].exp_month+"/"+i.cards.data[0].exp_year}}))},function(e){}):s.find("form").card({container:"."+i.wrapper})}),i.checkCardNumber=function(){var e=$("#number").val();e?e.length<16?($("#card_number .error").html("Card Number Invalid"),$("#card_number").addClass("has-error"),$("#card_number .glyphicon").addClass("glyphicon-remove")):e.length>=16&&($("#card_number .error").html(""),$("#card_number").removeClass("has-error").addClass("has-success"),$("#card_number .glyphicon").removeClass("glyphicon-remove").addClass("glyphicon-ok")):($("#card_number .error").html("Card Number Required"),$("#card_number").addClass("has-error"),$("#card_number .glyphicon").addClass("glyphicon-remove")),i.cardValidated=!0},i.checkCardName=function(){$("#card_name #name").val()?($("#card_name .error").html(""),$("#card_name").removeClass("has-error").addClass("has-success"),$("#card_name .glyphicon").removeClass("glyphicon-remove").addClass("glyphicon-ok"),i.cardNameValidated=!0):($("#card_name .error").html("Card Name Required"),$("#card_name").addClass("has-error"),$("#card_name .glyphicon").addClass("glyphicon-remove"),i.cardNameValidated=!1)},i.checkCardPostcode=function(){var e=$("#address_zip").val();e?a.zip.test(e)?($("#card_postcode .error").html(""),$("#card_postcode").removeClass("has-error").addClass("has-success"),$("#card_postcode .glyphicon").removeClass("glyphicon-remove").addClass("glyphicon-ok"),i.cardPostcodeValidated=!0):($("#card_postcode .error").html("Invalid postcode"),$("#card_postcode").addClass("has-error"),$("#card_postcode .glyphicon").addClass("glyphicon-remove"),i.cardPostcodeValidated=!1):($("#card_postcode .error").html("Postcode Required"),$("#card_postcode").addClass("has-error"),$("#card_postcode .glyphicon").addClass("glyphicon-remove"),i.cardPostcodeValidated=!1)},i.currentYear=(new Date).getYear()-100,i.fullCurrentYear=(new Date).getFullYear(),i.currentMonth=(new Date).getMonth()+1,i.checkCardExpiry=function(){var e,t=$("#expiry").val(),n=t.split("/"),a=n[0].trim();n.length>1&&(e=n[1].trim());if(t&&a&&e){if(i.yearLength=e.length,2==i.yearLength){if(parseInt(e)<parseInt(i.currentYear))return $("#card_expiry .error").html("Card Year has Expired"),$("#card_expiry").addClass("has-error"),void $("#card_expiry .glyphicon").addClass("glyphicon-remove")}else if(4==i.yearLength&&parseInt(e)<parseInt(i.fullCurrentYear))return $("#card_expiry .error").html("Card Year has Expired"),$("#card_expiry").addClass("has-error"),void $("#card_expiry .glyphicon").addClass("glyphicon-remove");a<i.currentMonth&&parseInt(e)<=i.currentYear?($("#card_expiry .error").html("Card Month has Expired"),$("#card_expiry").addClass("has-error"),$("#card_expiry .glyphicon").addClass("glyphicon-remove")):a>12?($("#card_expiry .error").html("Card Month is invalid"),$("#card_expiry").addClass("has-error"),$("#card_expiry .glyphicon").addClass("glyphicon-remove")):(i.expirationValidated=!0,$("#card_expiry .error").html(""),$("#card_expiry").removeClass("has-error").addClass("has-success"),$("#card_expiry .glyphicon").removeClass("glyphicon-remove").addClass("glyphicon-ok"))}else t?a?e||$("#card_expiry .error").html("Expiry Year Required"):$("#card_expiry .error").html("Expiry Month Required"):$("#card_expiry .error").html("Expiry Required"),$("#card_expiry").addClass("has-error"),$("#card_expiry .glyphicon").addClass("glyphicon-remove")},i.checkCardCvv=function(){var e=$("#cvc").val();e?(i.cvvValidated=!0,$("#card_cvc .error").html(""),$("#card_cvc").removeClass("has-error").addClass("has-success"),$("#card_cvc .glyphicon").removeClass("glyphicon-remove").addClass("glyphicon-ok")):($("#card_cvc .error").html("CVC Required"),$("#card_cvc").addClass("has-error"),$("#card_cvc .glyphicon").addClass("glyphicon-remove"))},i.addCardFn=function(){if(i.cardValidated=i.expirationValidated=i.cvvValidated=i.cardNameValidated=i.cardPostcodeValidated=!1,i.checkCardCvv(),i.checkCardExpiry(),i.checkCardName(),i.checkCardNumber(),i.checkCardPostcode(),i.cardValidated&&i.expirationValidated&&i.cvvValidated&&i.cardNameValidated&&i.cardPostcodeValidated){i.saveLoading=!0;var a=$("."+i.wrapper).next();if(a.length&&a.attr("wrapper-div")){var s=(c=a.find("#expiry").val().split("/"))[0].trim(),r="";c.length>1&&(r=c[1].trim()),a.find("#expiry").val().split("/")[0].trim();l={number:a.find("#number").val(),cvc:a.find("#cvc").val(),exp_month:s,exp_year:r,name:a.find("#name").val(),address_zip:a.find("#address_zip").val()}}else{var c=$("#expiry").val().split("/"),s=c[0].trim(),r="";c.length>1&&(r=c[1].trim()),$("#expiry").val().split("/")[0].trim();var l={number:$("#number").val(),cvc:$("#cvc").val(),exp_month:s,exp_year:r,name:$("#card_name #name").val(),address_zip:$("#address_zip").val()}}e.getStripeCardToken(l,function(a){i.$parent.closeModal&&a&&i.$parent.closeModal(),i.account&&i.account.billing.stripeCustomerId?(t.postAccountBilling(i.account.billing.stripeCustomerId,a,function(e){i.updateFn(e),i.saveLoading=!1},function(e){n.show("error","The purchase was unsuccessful. Please check your card information."),i.$parent.closeModal(),o(function(){i.$parent.openModal("change-card-modal")},500),i.saveLoading=!1}),i.cards&&i.cards.data&&i.cards.data.forEach(function(t,n){e.deleteCustomerCard(t.customer,t.id,!1,function(e){}),i.saveLoading=!1})):void 0!==a?e.postStripeCustomer(a,function(e){i.account&&(i.account.billing.stripeCustomerId=e.id),t.postAccountBilling(e.id,a,function(e){i.updateFn(e),i.saveLoading=!1})}):i.saveLoading=!1})}}}}}]),app.directive("slickSlider",function(){return{restrict:"A",scope:{objects:"=",config:"="},link:function(e,t,n){e.$watch("objects",function(n,a){$(t).hasClass("slick-initialized")&&$(t).slick("unslick"),$(t).slick(e.config)},!0)}}}),app.directive("stSortTable",function(){return{require:"^stTable",link:function(e,t,n,a){e.getSortOrder=function(){return a.tableState()},e.setSortOrder=function(e){a.sortBy(e.predicate,e.reverse)}}}}),app.directive("facebookPost",function(){return{restrict:"E",templateUrl:"/admin/assets/views/social-facebook-post.html",scope:{post:"=",actionLike:"&",actionComment:"&"}}}),app.directive("twitterFeed",function(){return{restrict:"E",templateUrl:"/admin/assets/views/social-twitter-feed.html",scope:{post:"=",actionReply:"&",actionFavorite:"&",actionRetweet:"&",actionDirectMessage:"&",showDm:"="}}}),app.directive("twitterFollower",function(){return{restrict:"E",templateUrl:"/admin/assets/views/social-twitter-follower.html",scope:{post:"=",actionTweetAt:"&",actionFollowBack:"&",actionDirectMessage:"&",showDm:"="}}}),app.directive("socialLinks",["$modal","$http","$timeout","$q","$compile","$filter","toaster",function(e,t,n,a,o,i,s){return{require:[],restrict:"C",transclude:!1,replace:!1,scope:!1,link:function(t,a,o,i){t.openModal=function(n,a,o){t.setEditingComponent(a,o),t.modalInstance=e.open({templateUrl:n,scope:t,backdrop:"static"})},t.setEditingComponent=function(e,n){var a=[],o=e,i=!(!angular.isDefined(n)||null===n);a=i?angular.isDefined(o)&&null!==o?t.component.teamMembers[n].networks[o]:null:t.component.networks[o];var s=!(!angular.isDefined(o)||null===o);t.setSelectedSocialLink(a,t.component._id,s,i,n)},t.closeModal=function(){n(function(){t.modalInstance&&t.modalInstance.close()})},t.saveSocialLink=function(e,n,a){angular.element("#social-link-name .error").html(""),angular.element("#social-link-name").removeClass("has-error"),angular.element("#social-link-url .error").html(""),angular.element("#social-link-url").removeClass("has-error");var o,i=_.findWhere(t.networks,{name:t.social.selectedLink});switch(a){case"add":if(!e||!e.name)return angular.element("#social-link-url .error").html("Please enter link url."),angular.element("#social-link-url").addClass("has-error"),angular.element("#social-link-name .error").html("Please select link icon."),void angular.element("#social-link-name").addClass("has-error");if(!e.url||""==e.url)return angular.element("#social-link-url .error").html("Link url can not be blank."),void angular.element("#social-link-url").addClass("has-error");if(e.url&&0==/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e.url))return angular.element("#social-link-url .error").html("Link url incorrect format"),void angular.element("#social-link-url").addClass("has-error");if(o=_.findWhere(t.networks,{name:e.name}))return angular.element("#social-link-name .error").html("Link icon already exists"),void angular.element("#social-link-name").addClass("has-error");if(_.findWhere(t.networks,{url:e.url}))return angular.element("#social-link-url .error").html("Link url already exists"),void angular.element("#social-link-url").addClass("has-error");angular.element("#social-link-name .error").html(""),angular.element("#social-link-name").removeClass("has-error"),angular.element("#social-link-url .error").html(""),angular.element("#social-link-url").removeClass("has-error");break;case"update":if(e&&e.name&&e.url){var s=angular.copy(t.networks);(o=_.findWhere(s,{name:i.name})).name=e.name,o.url=e.url,o.icon=e.icon;var r=_.where(s,{name:e.name}),c=_.where(s,{url:e.url});if(r.length>1)return angular.element("#social-link-name .error").html("Link icon already exists"),void angular.element("#social-link-name").addClass("has-error");if(c.length>1)return angular.element("#social-link-url .error").html("Link url already exists"),void angular.element("#social-link-url").addClass("has-error")}}null!==t.meetTeamIndex?t.updateTeamNetworks(i,a,e,t.meetTeamIndex):t.updateSocialNetworks(i,a,e),t.social={},t.meetTeamIndex=null,t.closeModal()},t.setSelectedLink=function(e){t.social.name=e.name,t.social.icon=e.icon,t.social.url=e.url},t.setSelectedSocialLink=function(e,n,a,o,i){t.social||(t.social={}),t.meetTeamIndex=o?i:null,a?(t.social.selectedLink=e.name,t.social.name=e.name,t.social.icon=e.icon,t.social.url=e.url):t.social={},t.social.selectedLink&&(t.matchingLink=_.findWhere(t.social_links,{name:t.social.selectedLink})),angular.element("#social-link-name .error").html(""),angular.element("#social-link-name").removeClass("has-error"),angular.element("#social-link-url .error").html(""),angular.element("#social-link-url").removeClass("has-error"),t.networks=t.getSocialNetworks(o,i)},t.getSocialNetworks=function(e,n){return e?t.component.teamMembers[n].networks:t.component.networks},t.updateSocialNetworks=function(e,a,o){var i;switch(a){case"add":o&&o.name&&o.url&&n(function(){t.$apply(function(){t.component.networks.push({name:o.name,url:o.url,icon:o.icon})})},500);break;case"update":o&&o.name&&o.url&&((i=_.findWhere(t.component.networks,{name:e.name})).name=o.name,i.url=o.url,i.icon=o.icon);break;case"delete":n(function(){i=_.findWhere(t.component.networks,{name:e.name}),t.$apply(function(){if(i){var e=t.component.networks.indexOf(i);t.component.networks.splice(e,1)}})},500)}},t.updateTeamNetworks=function(e,a,o,i){var s;switch(a){case"add":o&&o.name&&o.url&&(t.component.teamMembers[i].networks||(t.component.teamMembers[i].networks=[]),t.component.teamMembers[i].networks.push({name:o.name,url:o.url,icon:o.icon}));break;case"update":o&&o.name&&o.url&&((s=_.findWhere(t.component.teamMembers[i].networks,{name:e.name})).name=o.name,s.url=o.url,s.icon=o.icon);break;case"delete":n(function(){if(s=_.findWhere(t.component.teamMembers[i].networks,{name:e.name})){var n=t.component.teamMembers[i].networks.indexOf(s);t.component.teamMembers[i].networks.splice(n,1)}},500)}},t.social_links=[{name:"adn",icon:"adn",tooltip:"Adn",url:"http://www.adn.com"},{name:"bitbucket",icon:"bitbucket",tooltip:"BitBucket",url:"https://bitbucket.org"},{name:"dropbox",icon:"dropbox",tooltip:"Dropbox",url:"https://www.dropbox.com"},{name:"facebook",icon:"facebook",tooltip:"Facebook",url:"https://www.facebook.com"},{name:"flickr",icon:"flickr",tooltip:"Flickr",url:"https://www.flickr.com"},{name:"foursquare",icon:"foursquare",tooltip:"Four Square",url:"https://foursquare.com"},{name:"github",icon:"github",tooltip:"Github",url:"https://github.com"},{name:"google-plus",icon:"google-plus",tooltip:"Google Plus",url:"http://plus.google.com"},{name:"instagram",icon:"instagram",tooltip:"Instagram",url:"https://instagram.com"},{name:"linkedin",icon:"linkedin",tooltip:"Linkedin",url:"https://www.linkedin.com"},{name:"microsoft",icon:"windows",tooltip:"Microsoft",url:"http://www.microsoft.com"},{name:"openid",icon:"openid",tooltip:"Open Id",url:"http://openid.com"},{name:"pinterest",icon:"pinterest",tooltip:"Pinterest",url:"https://www.pinterest.com"},{name:"reddit",icon:"reddit",tooltip:"Reddit",url:"http://www.reddit.com"},{name:"comment-o",icon:"comment-o",tooltip:"Snapchat",url:"https://www.snapchat.com"},{name:"soundcloud",icon:"soundcloud",tooltip:"Sound Cloud",url:"https://soundcloud.com"},{name:"tumblr",icon:"tumblr",tooltip:"Tumblr",url:"https://www.tumblr.com"},{name:"twitter",icon:"twitter",tooltip:"Twitter",url:"https://twitter.com"},{name:"vimeo",icon:"vimeo-square",tooltip:"Vimeo",url:"https://vimeo.com"},{name:"vine",icon:"vine",tooltip:"Vine",url:"http://www.vinemarket.com"},{name:"vk",icon:"vk",tooltip:"Vk",url:"http://vk.com"},{name:"desktop",icon:"desktop",tooltip:"Website",url:"http://www.website.com"},{name:"yahoo",icon:"yahoo",tooltip:"Yahoo",url:"https://yahoo.com"},{name:"youtube",icon:"youtube",tooltip:"Youtube",url:"https://www.youtube.com"},{name:"yelp",icon:"yelp",tooltip:"Yelp",url:"http://www.yelp.com"}]}}}]),app.directive("jqSparkline",[function(){"use strict";return{restrict:"A",require:"ngModel",link:function(e,t,n,a){var o={};o.type=n.type||"line",o.barColor=n.barColor||"#000000",o.height=n.height||"35px",o.width=n.width||"35px",o.barWidth=n.barWidth||"5px",o.barSpacing=n.barSpacing||"2px",o.zeroAxis=n.zeroAxis||"true",o.resize=n.resize||!1,o.fillColor=n.fillColor||"#cdf",o.lineWidth=n.lineWidth||1,o.lineColor=n.lineColor||"#00f",o.spotColor=n.spotColor||"#f80",o.spotRadius=n.spotRadius||1.5,o.minSpotColor=n.minSpotColor||"#f80",o.maxSpotColor=n.maxSpotColor||"#f80",o.highlightSpotColor=n.highlightSpotColor||"#5f5",o.highlightLineColor=n.highlightLineColor||"#f22",e.$watch(n.ngModel,function(){s()}),e.$watch(n.opts,function(){s()});var i,s=function(){var e;n.opts&&angular.extend(o,angular.fromJson(n.opts)),e=angular.isString(a.$viewValue)?a.$viewValue.replace(/(^,)|(,$)/g,""):a.$viewValue;var i;i=angular.isArray(e)?e:e.split(","),$(t).sparkline(i,o)};$(window).resize(function(e){o.resize&&(clearTimeout(i),i=setTimeout(s,500))})}}}]),app.directive("stFilteredCollection",["$timeout",function(e){return{require:"^stTable",link:function(e,t,n,a){e.$watch(a.getFilteredCollection,function(t){e.filteredCollection=t}),e.$on("refreshTableData",function(e,t){var n=t.globalSearch,o=t.fieldSearch;if(Object.keys(a.tableState().search).length||(a.tableState().search={predicateObject:{}}),n&&(a.tableState().search.predicateObject.$=n),!_.isEmpty(o))for(var i=0;i<=Object.keys(o).length-1;i++){var s=Object.keys(o)[i],r=o[s];r&&(a.tableState().search.predicateObject[s]=r)}a.pipe(a.tableState())}),e.showFilteredRecords=function(){return a.tableState().search&&a.tableState().search.predicateObject&&Object.keys(a.tableState().search.predicateObject).length}}}}]),app.directive("stringToNumber",function(){return{require:"ngModel",link:function(e,t,n,a){a.$parsers.push(function(e){return""+e}),a.$formatters.push(function(e){return parseFloat(e,10)})}}}),app.factory("ToggleHelper",["$rootScope",function(e){return{events:{toggle:"clip-two.toggle",toggleByClass:"clip-two.toggleByClass",togglerLinked:"clip-two.linked",toggleableToggled:"clip-two.toggled"},commands:{alternate:"toggle",activate:"on",deactivate:"off"},toggle:function(t,n){null==n&&(n="toggle"),e.$emit(this.events.toggle,t,n)},toggleByClass:function(t,n){null==n&&(n="toggle"),e.$emit(this.events.toggleByClass,t,n)},notifyToggleState:function(t,n,a){e.$emit(this.events.toggleableToggled,n.id,a,n.exclusionGroup)},toggleStateChanged:function(e,t,n){this.updateElemClasses(e,t,n),this.notifyToggleState(e,t,n)},applyCommand:function(e,t){switch(e){case this.commands.activate:return!0;case this.commands.deactivate:return!1;case this.commands.alternate:return!t}},updateElemClasses:function(e,t,n){if(n){t.activeClass&&e.addClass(t.activeClass),t.inactiveClass&&e.removeClass(t.inactiveClass);a=e.parent();t.parentActiveClass&&a.addClass(t.parentActiveClass),t.parentInactiveClass&&a.removeClass(t.parentInactiveClass)}else{t.inactiveClass&&e.addClass(t.inactiveClass),t.activeClass&&e.removeClass(t.activeClass);var a=e.parent();t.parentInactiveClass&&a.addClass(t.parentInactiveClass),t.parentActiveClass&&a.removeClass(t.parentActiveClass)}}}}]).run(["$rootScope","ToggleHelper",function(e,t){e.toggle=function(e,n){null==n&&(n="toggle"),t.toggle(e,n)},e.toggleByClass=function(e,n){null==n&&(n="toggle"),t.toggleByClass(e,n)}}]).directive("ctToggle",["$rootScope","ToggleHelper",function(e,t){return{restrict:"A",link:function(n,a,o){var i=o.ctToggle||t.commands.alternate,s=o.target,r=o.targetClass,c="true"===o.bubble||"1"===o.bubble||1===o.bubble||""===o.bubble||"bubble"===o.bubble;if(!s&&o.href&&(s=o.href.slice(1)),!s&&!r)throw"'target' or 'target-class' attribute required with 'ct-toggle'";a.on("click tap",function(e){if(!angular.element(e.target).hasClass("disabled"))return null!=s&&t.toggle(s,i),null!=r&&t.toggleByClass(r,i),!!c||(e.preventDefault(),!1)});var l=e.$on(t.events.toggleableToggled,function(e,n,i){n===s&&t.updateElemClasses(a,o,i)});null!=s&&e.$emit(t.events.togglerLinked,s),n.$on("$destroy",l)}}}]).directive("toggleable",["$rootScope","ToggleHelper",function(e,t){return{restrict:"A",link:function(n,a,o){var i=!1;if(o.default){switch(o.default){case"active":i=!0;break;case"inactive":i=!1}t.toggleStateChanged(a,o,i)}var s=e.$on(t.events.toggle,function(e,n,s){var r;n===o.id&&(r=i)!==(i=t.applyCommand(s,r))&&t.toggleStateChanged(a,o,i)}),r=e.$on(t.events.toggleByClass,function(e,n,s){var r;a.hasClass(n)&&(r=i)!==(i=t.applyCommand(s,r))&&t.toggleStateChanged(a,o,i)}),c=e.$on(t.events.toggleableToggled,function(e,n,s,r){s&&o.id!==n&&o.exclusionGroup===r&&null!=o.exclusionGroup&&(i=!1,t.toggleStateChanged(a,o,i))}),l=e.$on(t.events.togglerLinked,function(e,n){o.id===n&&t.notifyToggleState(a,o,i)});n.$on("$destroy",function(){s(),r(),c(),l()})}}}]),app.directive("ctooltip",["$compile",function(e){return{restrict:"A",scope:{msg:"@msg",placement:"@placement"},link:function(t,n,a){angular.isUndefined(n.attr("tooltip"))&&(n.attr("tooltip-placement",t.placement||"right"),n.attr("tooltip",t.msg||"This link will work on front End only"),e(n)(t))}}}]),app.directive("touchspin",function(){return{restrict:"EA",link:function(e,t,n){for(var a=["initval","min","max","step","forcestepdivisibility","decimals","stepinterval","stepintervaldelay","verticalbuttons","verticalupclass","verticaldownclass","prefix","postfix","prefix_extraclass","postfix_extraclass","booster","boostat","maxboostedstep","mousewheel","buttondown_class","buttonup_class"],o={},i=0,s=a.length;i<s;i++){var r=a[i];void 0!==n[r]&&(o[r]="max"===r||"min"===r?parseInt(n[r],10):n[r])}t.TouchSpin(o)}}}),app.directive("indigewebTransactionLabel",["OrderService","DashboardService","$rootScope",function(e,t,n){return{restrict:"E",template:"{{label}}",link:function(a,o,i){a.hasOrder=!1,a.hasDonation=!1;var s=function(e){!0===e.donations&&(a.hasDonation=!0),!0===e.orders&&(a.hasOrder=!0),a.hasOrder&&a.hasDonation?a.label="transaction":a.hasOrder&&!a.hasDonation?a.label="order":!a.hasOrder&&a.hasDonation?a.label="donation":a.label="order",i.plural&&(a.label=a.label+"s"),i.lower&&(a.label=a.label.toLowerCase()),i.upper&&(a.label=a.label.toUpperCase()),i.capitalize&&(a.label=a.label.charAt(0).toUpperCase()+a.label.slice(1))};e.getOrderAndDonationStatus(function(e){s(e)}),n.$on("$locationChangeSuccess",function(){var n=!1;a.$watch(function(){return t.state.analytics&&t.state.analytics.revenue&&t.state.analytics.revenue.YTDTotalOrders},function(t,a){t&&t!==a&&!n&&(n=!0,e.getOrderAndDonationStatus(function(e){s(e)}))})})}}}]),app.directive("userScripts",["$sce",function(e){return{restrict:"E",replace:!0,template:'<span ng-bind-html="pageScripts"></span>',scope:{website:"=",handle:"=",account:"="},link:function(t,n,a){t.pageScripts="";!function(){t.pageScripts="";var n=t.account,a=t.website;t.handle;n.showhide.userScripts&&a&&a.resources&&a.resources.userScripts&&a.resources.toggles&&a.resources.toggles.userScripts&&(angular.isDefined(a.resources.userScripts[t.handle])&&(t.pageScripts+="\n\n"+a.resources.userScripts[t.handle].sanitized),t.pageScripts=e.trustAsHtml(t.pageScripts))}()}}}]),app.directive("widgetHeaderLabel",["$filter",function(e){return{restrict:"E",scope:{count:"@",item:"@"},template:"{{message}}",link:function(t,n,a){function o(t,n){return 1==t?"There is 1 "+n:t>1?"There are "+e("number")(t,0)+" "+n+"s":"There are no "+n+"s"}t.$watch("count",function(e){t.message=o(e,t.item)})}}}]),app.filter("cleanType",function(){return function(e){return String(e).replace("ssb","").replace("text-only","text").replace("-"," ").replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}}),app.filter("filterPages",function(){"use strict";return function(e,t,n,a,o){var i=[];if((a?n:t).forEach(function(e){"head-menu"===e.handle&&(i=e.links)}),e)return e.filter(function(e){var t=!0;return!1===e.mainmenu&&(t=!1),t&&_.each(i,function(n){e.handle!==n.linkTo.data||"page"!==n.linkTo.type&&"home"!==n.linkTo.type||(t=!(!o||o!==n.linkTo.data))}),t})}}),app.filter("filterSsbSections",function(){return function(e,t){return _.filter(e,function(e){return angular.isDefined(e.filterArray)?_.contains(e.filterArray,t.lowercase)&&e.enabled:e.filter===t.lowercase&&e.enabled})}}),app.filter("formatText",function(){return function(e){if(e){var t;"blog.post.post_title"===e&&(t="Post Title"),"blog.post.post_content"===e&&(t="Post Content"),t||(t=e.replace("_"," ").replace("."," ").replace("component","").replace("img","Image ").replace("vm .text","Text"));var n="";t=t.split(" ");for(var a=0;a<t.length;a++)n+=t[a].substring(0,1).toUpperCase()+t[a].substring(1,t[a].length)+" ";return n}}}),app.filter("generateURLforLinks",function(){"use strict";return function(e){if(e)switch(e.type){case"page":return"/page/"+e.data;case"home":return"/";case"url":return e.data;case"section":return"/#"+e.data;case"product":case"collection":return"";case"external":var t=e.data;return t&&!/http[s]?/.test(t)&&(t="http://"+t),t;default:return"#"}}}),app.filter("generateURLforProducts",function(){return function(e,t){var n="";return e&&(n=t.search("productId",e._id).$$absUrl),n}}),app.filter("htmlToPlaintext",function(){return function(e){return String(e).replace(/<[^>]+>/gm,"")}}),app.filter("offset",function(){return function(e,t){if(t=parseInt(t,10),e)return e.slice(t)}}),app.filter("orderByArrayLength",function(){return function(e,t){return angular.isObject(e)?_.sortBy(e,function(e){return e[t]?_.isArray(e[t])?e[t].length:e[t]:null}).reverse():e}}),app.filter("productTableFilter",["$filter",function(e){return function(t,n){var a=angular.copy(n);return n.status?e("filter")(t,a,!0):(n.is_image&&(a.is_image="true"==n.is_image),n.tags&&(t=_.filter(t,function(e){return e.tags&&_.contains(_.invoke(e.tags,"toLowerCase"),n.tags.toLowerCase())}),delete a.tags),e("filter")(t,a,!1))}}]),app.filter("selectedTags",function(){return function(e,t){if(e)return e.filter(function(e){if(t&&0!==t.length)_.each(e.tags,function(n){if("active"===e.status&&-1!==t.indexOf(n))return!0});else if("active"===e.status)return!0})}}),app.filter("propsFilter",function(){return function(e,t){var n=[];return angular.isArray(e)?e.forEach(function(e){var a=!1,o=Object.keys(t),i=0;for(i;i<o.length;i++)if(e[o[i]]&&-1!==e[o[i]].toString().toLowerCase().indexOf(t[o[i]].toLowerCase())){a=!0;break}a&&n.push(e)}):n=e,n}}),app.filter("secTotime",["$filter",function(e){return function(e){var t=parseInt(Math.floor(e/60)),n=parseInt(e-60*t);return t=t<10?"0"+t:t,n=n<10?"0"+n:n,t+":"+n}}]),app.filter("sortListPages",function(){return function(e,t,n){if(e){var a=_(e).chain().where({_id:t}).pluck("_id").value(),o=_.invert(_.object(_.pairs(a))),i=e;return n&&!n.showhide.blog&&(i=_(e).chain().filter(function(e){return"blog-list"!==e.handle&&"blog-post"!==e.handle}).value()),_.sortBy(i,function(e){return o[e._id]})}}}),app.filter("timeAgoFilter",function(){return function(e){return moment(e).fromNow()}}),app.filter("titleCase",function(){return function(e){if(e&&e.length>0){for(var t=e.split(" "),n=0;n<t.length;n++)t[n]=t[n].charAt(0).toUpperCase()+t[n].slice(1);return t.join(" ")}}}),app.filter("unsafe",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),function(){function e(e,t){return{restrict:"A",controller:"EmailBuilderComponentLoaderController",controllerAs:"vm",bindToController:!0,scope:{component:"=",website:"=",account:"=",componentClass:"&",componentStyle:"&",componentIndex:"=",componentCount:"=",state:"=",uiState:"="},replace:!1,templateUrl:"/admin/assets/js/indi-email-builder/email-component-loader/email-component-loader.component.html",link:function(e,t,n,a){}}}app.directive("emailComponentLoader",e),e.$inject=["$compile","$timeout"]}(),function(){function e(e,t,n,a,o){var i=this,s=t.$parent.vm;i.ssbEditor=!0,i.components=s.state.email.components,t.component=i.component,t.isEditing=!0,t.website=i.state.website,i.init=function(e){i.element=e},i.componentStyleFn=function(e){var t=" ";return e.bg&&(e.bg.color&&(t+="background-color: "+e.bg.color+";"),e.bg.img&&e.bg.img.show&&""!==e.bg.img.url&&(t+='background-image: url("'+e.bg.img.url+'");')),t}}app.controller("EmailBuilderComponentLoaderController",e),e.$inject=["$rootScope","$scope","$attrs","$filter","$timeout"]}(),function(){app.directive("emailActionButtons",function(){return{restrict:"E",scope:{state:"=",saveAction:"&",cancelAction:"&",createCampaignAction:"&",sendEmailAction:"&",settingsValidAction:"&"},templateUrl:"assets/js/indi-email-builder/email-controls/email-action-buttons/email-action-buttons.component.html",controller:"EmailBuilderActionButtonsController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s){var r=this;r.init=function(e){r.element=e},r.save=function(){r.settingsValid()?r.saveAction():i.pop("warning","Mandatory field should not be blank")},r.createCampaign=function(){r.createCampaignAction()},r.sendEmail=function(){r.sendEmailAction()},r.cancel=function(){r.cancelAction()},r.revert=function(e){r.revertAction({versionId:e})},r.settingsValid=function(){return r.settingsValidAction()},r.backToEmails=function(){s.url("/emails")}}app.controller("EmailBuilderActionButtonsController",e),e.$inject=["$scope","$attrs","$filter","SimpleSiteBuilderService","$timeout","toaster","$location"]}(),function(){app.directive("emailEditControl",function(){return{restrict:"E",scope:{state:"=",uiState:"=",sectionIndex:"=",component:"=",componentIndex:"=?",compiledControlId:"@?"},templateUrl:"/admin/assets/js/indi-email-builder/email-controls/email-edit-control/email-edit-control.component.html",controller:"EmailBuilderEditControlController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n){function a(e){var a=i.state.email.components[e],o={name:t("cleanType")(a.type).toLowerCase().trim().replace(" ","-"),id:a._id,componentId:a._id};n(function(){i.uiState.activeComponentIndex=e,i.uiState.navigation.sectionPanel.loadPanel(o),void 0!==e&&(i.uiState.showSectionPanel=!0)})}function o(){var e=i.uiState.activeElementHistory[i.uiState.activeElementHistory.length-1];i.uiState.activeElement&&i.uiState.activeElement.type?i.uiState.activeElementHistory.push(i.uiState.activeElement):i.uiState.activeElement=e;var t={name:i.uiState.activeElement.name,id:i.uiState.activeElement.id};i.uiState.navigation.sectionPanel.loadPanel(t),i.uiState.showSectionPanel=!0}var i=this;i.init=function(e){i.element=e},i.moveComponentFn=function(t,n){e.$emit("email.move.component",{direction:t,component:i.component})},i.duplicateComponentFn=function(){e.$emit("email.duplicate.component",{component:i.component})},i.removeComponentFn=function(){e.$emit("email.remove.component",{component:i.component})},i.setActive=function(e,t){i.uiState.showSectionPanel=!1,i.uiState.navigation.sectionPanel.reset(),i.uiState.activeComponentIndex=void 0,t||null===e&&null===sectionIndex?o():void 0!==e?a(e):(i.uiState.navigation.sectionPanel.reset(),i.uiState.showSectionPanel=!1,i.uiState.activeComponentIndex=null,i.uiState.showSectionPanel=!0)},i.uiState.activeElementHistory=[]}app.controller("EmailBuilderEditControlController",e),e.$inject=["$scope","$filter","$timeout"]}(),function(){function e(e,t,n,a){return{restrict:"E",scope:{component:"=",state:"=",uiState:"=",settingsTemplate:"@"},controller:"SiteBuilderSidebarSettingsPanelController",controllerAs:"vm",bindToController:!0,link:function(a,o,i,s){var r="";s.settingsTemplate&&(-1!==s.settingsTemplate.indexOf("#COMPONENTTYPE#")&&(s.settingsTemplate=s.settingsTemplate.replace("#COMPONENTTYPE#",a.component.type)),r=s.settingsTemplate,t.get(r,{cache:n}).success(function(t){o.empty().append(e(t)(a)),s.init(o)}))}}}app.directive("emailSidebarSettingsPanel",e),e.$inject=["$compile","$http","$templateCache","$parse"]}(),function(){function e(e,t,n,a,o,i,s,r,c,l,u){var d=this;d.init=function(e){d.element=e,d.setTags(d.contactTags)};var p=e.$parent.vm;d.addBackground=p.addBackground,d.addBackgroundVideo=p.addBackgroundVideo,d.addImage=p.addImage,d.openModal=p.openModal,d.setActiveComponent=p.setActiveComponent,d.removeImage=p.removeImage,d.removeBackgroundImage=p.removeBackgroundImage,d.removeSectionFromPage=p.removeSectionFromPage,d.hideSectionFromPage=p.hideSectionFromPage,d.editSectionName=p.editSectionName,d.moveSection=p.moveSection,d.duplicateSection=p.duplicateSection,d.enabledPlatformSections=p.enabledPlatformSections,d.contactTags=p.contactTags,d.constructVideoUrl=p.constructVideoUrl,d.donationProductTags=p.donationProductTags,d.addSectionToPage=function(e,t,n){if(!d.isSelectedLayout(e))return p.addSectionToPage(e,t,n)},d.tagToCustomer=function(e){return u.tagToContact(e)},d.setTags=function(e){d.component&&d.component.tags&&(_.each(d.component.tags,function(t,n){var a=_.findWhere(d.contactTags,{data:t});a?e.push(a):e.push({data:t,label:t})}),d.contactTags=_.uniq(e,function(e){return e.label}))},d.filteredSections=function(){var e=d.state.page.sections[d.uiState.activeSectionIndex],t=_(e.components).pluck("type"),n=_.filter(d.state.platformSections,function(e){return"footer"===e.type||e.enabled});return _.filter(n,function(n){if("ssb-page-section"===n.type){if(e.title)return n.title===e.title;if(e.name)return n.name===e.name;if(1===e.components.length&&"navigation"===e.components[0].type)return"Header"===n.title}else if(1===e.components.length)return _.contains(t,n.type)})},d.isSelectedLayout=function(e){var t=!1,n=d.state.page.sections[d.uiState.activeSectionIndex];if("ssb-page-section"===e.type&&e.version===n.version)t=e.title===n.title;else{var a=_.map(n.components,function(e){return{type:e.type,version:e.version}}),o=_.findWhere(a,{type:e.type,version:parseInt(e.version,10)});o||(o=_.findWhere(a,{type:e.type,version:e.version})),t=angular.isObject(o)}return t},d.resizeWindow=function(){$(window).trigger("resize")},d.changeButtonDesign=function(e){var t=d.uiState.activeElement,n=d.uiState.activeElement._id.replace("button-element_","");if(n){var a=$(".ssb-theme-btn[data-compiled='"+n+"']");1===a.length&&$(a).removeClass(function(e,t){return t.match(/ssb-theme-btn-style-\d+/g)&&t.match(/ssb-theme-btn-style-\d+/g).join(" ")})}t.version=e},d.addCustomField=p.addCustomField,d.checkDuplicateField=p.checkDuplicateField,d.openCal=function(e,t){e.preventDefault(),e.stopPropagation(),"start"==t&&(d.startCalOpened=!0),"end"==t&&(d.endCalOpened=!0)},d.closeCal=function(t){t.preventDefault(),t.stopPropagation(),e.opened=!1},d.isHero=d.component.title&&"hero"===d.component.title.toLowerCase(),d.spectrum={options:i.getSpectrumColorOptions()},d.fontFamilyOptions=i.getFontFamilyOptions(),d.fontWeightOptions=i.getFontWeightOptions(),e.component=d.component,e.$watch(function(){return d.component?d.component.txtcolor:""},function(e){}),e.$watch(function(){return d.component&&d.component.bg?d.component.bg.color:""},function(e){}),e.$watch("component.bg.img.overlaycolor",function(t,n){t&&(angular.isDefined(e.component.bg.img.overlayopacity)&&!isNaN(e.component.bg.img.overlayopacity)||(e.component.bg.img.overlayopacity=100))})}app.controller("SiteBuilderSidebarSettingsPanelController",e),e.$inject=["$scope","$attrs","$filter","$document","$timeout","SimpleSiteBuilderService","$modal","editableOptions","$location","SweetAlert","ContactService"]}(),function(){app.directive("emailSidebar",function(){return{restrict:"E",scope:{state:"=",uiState:"="},templateUrl:"assets/js/indi-email-builder/email-controls/email-sidebar/email-sidebar.component.html",controller:"EmailBuilderSidebarController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r,c,l,u,d,p){function m(){return b.state.pendingWebsiteChanges=!1,i.saveWebsite(b.state.website).then(function(e){})}function g(){var e="";b.enabledComponentTypes=_.where(b.uiState.componentTypes,{enabled:!0}),b.componentFilters=_.without(_.uniq(_.pluck(_.sortBy(b.enabledComponentTypes,"filter"),"filter")),"misc"),_.each(b.componentFilters,function(t,n){e=t.charAt(0).toUpperCase()+t.substring(1).toLowerCase(),b.componentFilters[n]={capitalized:e,lowercase:t},e=null}),b.componentFilters.unshift({capitalized:"All",lowercase:"all"})}function f(e){_.each(b.state.website.linkLists,function(t,n){if("head-menu"===t.handle)if(e)t.links.push({label:b.state.page.menuTitle||b.state.page.title,type:"link",linkTo:{data:b.state.page.handle,type:"page"}});else{var a=_.reject(t.links,function(e){return e.linkTo.data===b.state.page.handle&&("page"===e.linkTo.type||"home"===e.linkTo.type)});a&&(t.links=a)}})}function h(e,t){var n,a=/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?.*?(?:v|list)=(.*?)(?:&|$)|^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?(?:(?!=).)*\/(.*)$/;if(t){var o=t.match(a);o.length&&(o=_.filter(o,function(e){return void 0!==e}));var i=o&&o[1]?o[1]:null;n="//www.youtube.com/embed/#VIDEO_ID#?playlist=#VIDEO_ID#&autoplay=1&controls=0&loop=1&rel=0&showinfo=0&autohide=1&wmode=transparent&hd=1".replace(e,i).replace(e,i)}return{url:n,id:i}}function v(e,t){var n,a=/https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/;if(t){var o=t.match(a),i=o&&o[4]?o[4]:null;n="//vimeo.com/#VIDEO_ID#?autopause=0&autoplay=1&badge=0&byline=0&color=&loop=0&player_id=0&portrait=0&title=0".replace(e,i)}return{url:n,id:i}}var b=this;b.init=function(e){b.element=e,g(),u.getContacts(function(e){u.getAllContactTags(e,function(e){b.contactTags=e})}),b.donationProductTags=[],p.getProducts(function(e){e.forEach(function(e,t){"DONATION"===e.type&&"active"===e.status.toLowerCase()&&b.donationProductTags.push({data:e._id,label:e.name})})})},b.savePage=function(){b.state.saveLoading=!0;var e=!b.state.page.ssb;!b.uiState.hasSeenWarning&&e?l.swal({title:"Are you sure?",text:"CAUTION: This editor is under active development. Pages saved in Site Builder will not render or be editable in the legacy Pages editor.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes  Use Site Builder editor.",cancelButtonText:"No  Use the legacy editor.",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?(b.uiState.hasSeenWarning=!0,b.state.pendingPageChanges=!1,b.uiState.showSectionPanel=!1,b.uiState.navigation.sectionPanel.reset(),m().then(function(){return i.savePage(b.state.page).then(function(e){i.getSite(b.state.website._id).then(function(){d.pop("success","Page Saved","The page was saved successfully."),b.state.saveLoading=!1})}).catch(function(e){b.state.saveLoading=!1,d.pop("error","Error","The page was not saved. Please try again.")})})):b.state.saveLoading=!1}):(b.state.pendingPageChanges=!1,b.uiState.showSectionPanel=!1,b.uiState.navigation.sectionPanel.reset(),m().then(function(){return i.savePage(b.state.page).then(function(e){i.getSite(b.state.website._id).then(function(){d.pop("success","Page Saved","The page was saved successfully."),b.state.saveLoading=!1})}).catch(function(e){d.pop("error","Error","The page was not saved. Please try again."),b.state.saveLoading=!1})}))},b.saveWebsite=m,b.cancelPendingEdits=function(){b.state.pendingPageChanges=!1,b.state.pendingWebsiteChanges=!1,i.website=angular.copy(b.state.originalWebsite),i.page=angular.copy(b.state.originalPage)},b.togglePageSectionAccordion=function(e){b.uiState.accordion.sections[e].isOpen&&i.setActiveSection(e)},b.setActiveComponent=function(e){i.setActiveComponent(e)},b.setActiveSection=function(e){b.uiState.showSectionPanel=!1,o(function(){i.setActiveSection(e),b.state.page.sections[e].visibility&&(b.uiState.showSectionPanel=!0,b.scrollToActiveSection())})},b.getPlatformSections=function(){},b.getPlatformComponents=function(){i.getPlatformComponents()},b.addSectionToPage=function(e,t,n,a,o){return b.uiState.showSectionPanel=!1,i.addSectionToPage(e,t,n,b.state.page.sections[b.uiState.activeSectionIndex],o).then(function(){b.scrollToActiveSection()},function(e){})},b.scrollToActiveSection=function(){o(function(){var e=document.querySelector(".ssb-site-builder-container"),t=document.querySelector(".ssb-active-section");t&&(e.scrollTop=t.offsetTop)},500)},b.removeSectionFromPage=function(e){b.state.page.sections[e].global?l.swal({title:"Are you sure?",text:"You are removing a global section. Changes made to global sections on this page will be reflected on all other pages. Consider removing from this page only.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Remove from all pages",cancelButtonText:"Hide on this page",showNoActionButton:!0,noActionButtonText:"Cancel",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?i.removeSectionFromPage(e):angular.isDefined(t)&&!1===t&&(b.state.page.sections[e].visibility=!1,b.uiState.toggleSection(b.state.page.sections[e]))}):l.swal({title:"Are you sure?",text:"Do you want to delete this section?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, do not delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t&&i.removeSectionFromPage(e)})},b.removeComponentFromSection=function(e){l.swal({title:"Are you sure?",text:"Do you want to delete this component?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, do not delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t&&(b.state.page.sections[b.uiState.activeSectionIndex].components.splice(e,1),b.uiState.activeComponentIndex=void 0)})},b.addComponentToSection=function(e,t){return i.getComponent(e,1).then(function(e){b.state.page.sections[t].components.push(e.data)})},b.addBackground=function(e,t){b.openMediaModal("media-modal","MediaModalCtrl",null,"lg"),b.insertMediaCallback=function(n){void 0!==t&&null!==t?b.state.page.sections[b.uiState.activeSectionIndex].components[b.uiState.activeComponentIndex].bg.img.url=n.url:!angular.isDefined(e)&&b.uiState.activeElement&&b.uiState.activeElement.hasOwnProperty("bg")?b.uiState.activeElement.bg.img.url=n.url:b.state.page.sections[b.uiState.activeSectionIndex].bg.img.url=n.url},i.setActiveSection(e),i.setActiveComponent(t)},b.addBackgroundVideo=function(e,t){b.openMediaModal("media-modal","MediaModalCtrl",null,"lg"),b.insertMediaCallback=function(e){void 0!==t&&null!==t?b.state.page.sections[b.uiState.activeSectionIndex].components[b.uiState.activeComponentIndex].bg.video.url=e.url:b.state.page.sections[b.uiState.activeSectionIndex].bg.video.url=e.url},i.setActiveSection(e),i.setActiveComponent(t)},b.addImage=function(e,t){b.openMediaModal("media-modal","MediaModalCtrl",null,"lg"),b.insertMediaCallback=function(e){void 0!==t&&null!==t?b.state.page.sections[b.uiState.activeSectionIndex].components[b.uiState.activeComponentIndex].src=e.url:b.state.page.sections[b.uiState.activeSectionIndex].src=e.url},i.setActiveSection(e),i.setActiveComponent(t)},b.openModal=function(t,n,a,o){var i={templateUrl:t,keyboard:!0,backdrop:"static",size:"md",scope:e,resolve:{parentVm:function(){return b}}};n&&(i.controller=n+" as vm"),o&&(i.size="lg"),b.modalInstance=s.open(i),b.modalInstance.result.then(null,function(){angular.element(".sp-container").addClass("sp-hidden")})},b.closeModal=function(){b.modalInstance.close()},b.openMediaModal=function(e,t,n,a){var o={templateUrl:e,keyboard:!0,backdrop:"static",size:"md",resolve:{vm:function(){return b}}};t&&(o.controller=t,o.resolve.showInsert=function(){return b.showInsert},o.resolve.insertMedia=function(){return b.insertMedia},o.resolve.isSingleSelect=function(){return!0}),a&&(o.size="lg"),b.modalInstance=s.open(o),b.modalInstance.result.then(null,function(){angular.element(".sp-container").addClass("sp-hidden")})},b.insertMedia=function(e){return b.insertMediaCallback(e),b.insertMediaCallback=function(){},!0},b.addToMainMenu=function(e){},b.showInsert=!0,b.applyThemeToSite=i.applyThemeToSite,b.insertMediaCallback=function(e){},b.removeBackgroundImage=function(e){e.bg.img.url=null},b.removeImage=function(e){e.src=null},b.createPage=function(e){b.state.saveLoading||(b.state.saveLoading=!0,b.saveWebsite().then(function(){return i.createPage(e._id).then(function(e){i.getSite(b.state.website._id).then(function(){b.closeModal(),b.state.saveLoading=!1,b.uiState.navigation.loadPage(e.data._id)})})}))},b.getTemplateById=function(e){i.getTemplateById(e)},b.editSectionName=function(e){o(function(){angular.element(document.getElementById(e)).click()},0)},b.hideSectionFromPage=function(e,t){e.visibility?l.swal({title:"Are you sure?",text:"Do you want to hide this section from the email?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, hide it!",cancelButtonText:"No, do not hide it!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t&&(e.visibility=!1,b.uiState.activeSectionIndex=void 0,b.uiState.activeComponentIndex=void 0,b.uiState.toggleSection(e))}):(e.visibility=!0,b.uiState.toggleSection(e))},b.deletePage=function(){e="Do you want to delete this page";if("index"===b.state.page.handle)var e="This is home page of the website. Do you want to delete this page";l.swal({title:"Are you sure?",text:e,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&(b.state.saveLoading=!0,b.state.pendingPageChanges=!1,b.state.pendingWebsiteChanges=!1,i.deletePage(b.state.page).then(function(e){i.getSite(b.state.page.websiteId).then(function(){b.state.saveLoading=!1,d.pop("success","Page deleted","The page deleted successfully."),o(function(){var e=_.reject(b.state.pages,function(e){return e.handle===b.state.page.handle});e.length?b.uiState.navigation.loadPage(e[0]._id):i.getPages().then(function(e){c.path("/website/site-builder/pages/")})},0)})}))})},b.duplicatePage=function(){l.swal({title:"Are you sure?",text:"Do you want to create a duplicate page?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&(b.state.saveLoading=!0,m().then(function(){i.createDuplicatePage(b.state.page).then(function(e){i.getSite(b.state.website._id).then(function(){b.state.saveLoading=!1,b.uiState.navigation.loadPage(e.data._id)})})}))})},b.hideFromMenu=function(){l.swal({title:"Are you sure?",text:"Do you want to hide this page from main menu",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, hide page!",cancelButtonText:"No, do not hide page!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&(b.state.page.mainmenu=!1,f(!1))})},b.showPageOnMenu=function(){l.swal({title:"Are you sure?",text:"Do you want to show this page on main menu",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, show page!",cancelButtonText:"No, do not show page!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&(b.state.page.mainmenu=!0,f(!0))})},b.moveSection=function(e,t,n){var a,o=b.state.page.sections,i=n;"up"===e&&(a=i-1),"down"===e&&(a=i+1),o.splice(a,0,o.splice(i,1)[0]),b.setActiveSection(a)},b.duplicateSection=function(e,t){var n=t>0?t+1:t;(e=i.setTempUUIDForSection(e)).accountId=0,b.addSectionToPage(e,null,null,null,t).then(function(){b.setActiveSection(n)})},b.validateDuplicatePage=function(e){var t=b.state.pages.filter(function(t){return t.handle.toLowerCase()===e.toLowerCase()})[0];return t&&t._id!==b.state.page._id?"Page handles must be unique.":i.inValidPageHandles[e.toLowerCase()]?"Page handle cannot be a system route.":void _.each(b.state.page.sections,function(t,n){t.hiddenOnPages&&t.hiddenOnPages[b.state.page.handle]&&(delete t.hiddenOnPages[b.state.page.handle],t.hiddenOnPages[e]=!0)})},b.constructVideoUrl=function(e){var t={};return"youtube"===e.bg.video.type?t=h("#VIDEO_ID#",e.bg.video.url):"vimeo"===e.bg.video.type&&(t=v("#VIDEO_ID#",e.bg.video.url)),e.bg.video.urlProcessed=t.url,e.bg.video.id=t.id,t},b.closeSectionPanel=function(){b.uiState.activeElement={},b.uiState.showSectionPanel=!1,b.uiState.openSidebarSectionPanel={name:"",id:""}},b.initializeMapSlider=function(){o(function(){e.$broadcast("rzSliderForceRender")},0)},b.addCustomField=function(e){var t={name:e.replace(" ",""),type:e,label:e,custom:!0,optional:!0,visible:!0};b.state.page.sections[b.uiState.activeSectionIndex].components[b.uiState.activeComponentIndex].contactInfo.push(t),b.contactInfo={}},b.checkDuplicateField=function(e){var t=b.state.page.sections[b.uiState.activeSectionIndex].components[b.uiState.activeComponentIndex];return _.filter(t.contactInfo,function(t){return t.type.toLowerCase()===e.toLowerCase()}).length},b.showSection=function(e){var t=!1;if(e&&(t=e.visibility||void 0===e.visibility,e.global&&e.hiddenOnPages)){var n=n=b.state.page.handle;t=!e.hiddenOnPages[n],e.visibility=t}return t},r.theme="bs3",b.sortableOptions={handle:".ssb-sidebar-move-handle",onSort:function(e){b.setActiveSection(e.newIndex)},onStart:function(e){b.dragging=!0},onEnd:function(e){b.dragging=!1}},b.spectrum={options:i.getSpectrumColorOptions()},b.social_links=[{name:"adn",icon:"adn",tooltip:"Adn",url:"http://www.adn.com"},{name:"bitbucket",icon:"bitbucket",tooltip:"BitBucket",url:"https://bitbucket.org"},{name:"dropbox",icon:"dropbox",tooltip:"Dropbox",url:"https://www.dropbox.com"},{name:"facebook",icon:"facebook",tooltip:"Facebook",url:"https://www.facebook.com"},{name:"flickr",icon:"flickr",tooltip:"Flickr",url:"https://www.flickr.com"},{name:"foursquare",icon:"foursquare",tooltip:"Four Square",url:"https://foursquare.com"},{name:"github",icon:"github",tooltip:"Github",url:"https://github.com"},{name:"google-plus",icon:"google-plus",tooltip:"Google Plus",url:"https://www.gmail.com"},{name:"instagram",icon:"instagram",tooltip:"Instagram",url:"https://instagram.com"},{name:"linkedin",icon:"linkedin",tooltip:"Linkedin",url:"https://www.linkedin.com"},{name:"microsoft",icon:"windows",tooltip:"Microsoft",url:"http://www.microsoft.com"},{name:"openid",icon:"openid",tooltip:"Open Id",url:"http://openid.com"},{name:"pinterest",icon:"pinterest",tooltip:"Pinterest",url:"https://www.pinterest.com"},{name:"reddit",icon:"reddit",tooltip:"Reddit",url:"http://www.reddit.com"},{name:"comment-o",icon:"comment-o",tooltip:"Snapchat",url:"https://www.snapchat.com"},{name:"soundcloud",icon:"soundcloud",tooltip:"Sound Cloud",url:"https://soundcloud.com"},{name:"tumblr",icon:"tumblr",tooltip:"Tumblr",url:"https://www.tumblr.com"},{name:"twitter",icon:"twitter",tooltip:"Twitter",url:"https://twitter.com"},{name:"vimeo",icon:"vimeo-square",tooltip:"Vimeo",url:"https://vimeo.com"},{name:"vine",icon:"vine",tooltip:"Vine",url:"http://www.vinemarket.com"},{name:"vk",icon:"vk",tooltip:"Vk",url:"http://vk.com"},{name:"desktop",icon:"desktop",tooltip:"Website",url:"http://www.website.com"},{name:"yahoo",icon:"yahoo",tooltip:"Yahoo",url:"https://yahoo.com"},{name:"youtube",icon:"youtube",tooltip:"Youtube",url:"https://www.youtube.com"},{name:"yelp",icon:"yelp",tooltip:"Yelp",url:"http://www.yelp.com"}],e.$watch("vm.state.page.handle",function(e,t){e&&!angular.equals(t,e)&&(b.state.page.handle=n("slugify")(e))})}app.config(["$provide",function(e){e.decorator("accordionDirective",["$delegate",function(e){return e[0].replace=!0,e}])}]),app.controller("EmailBuilderSidebarController",e),e.$inject=["$scope","$attrs","$filter","$document","$timeout","SimpleSiteBuilderService","$modal","editableOptions","$location","SweetAlert","ContactService","toaster","ProductService"]}(),function(){app.directive("emailTopbar",function(){return{restrict:"E",scope:{state:"=",uiState:"="},templateUrl:"assets/js/indi-email-builder/email-controls/email-topbar/email-topbar.component.html",controller:"EmailBuilderTopbarController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r,c,l,u,d){function p(){return m.state.pendingWebsiteChanges=!1,s.saveWebsite(m.state.website).then(function(e){}).finally(function(){m.hideActiveToolTips()})}var m=this;m.init=function(e){m.element=e,m.state.email||(m.state.email=i.email)},m.saveEmail=function(){m.state.saveLoading=!0;return m.state.pendingPageChanges=!1,m.uiState.showSectionPanel=!1,m.uiState.navigation.sectionPanel.reset(),p().then(function(){return i.updateEmail(m.state.email).then(function(e){s.getSite(m.state.website._id).then(function(){u.pop("success","Email Saved","The email was saved successfully."),m.state.saveLoading=!1,m.state.pendingEmailChanges=!1,m.uiState.updateEmailCache(e.data,!0)})}).catch(function(e){var t=e.data?e.data.message:"The email was not saved. Please try again.";u.pop("error","Error",t),m.state.saveLoading=!1})})},m.createCampaign=function(e){m.uiState.createCampaign(e)},m.openSendEmailModal=function(e){m.uiState.openSimpleModal("send-test-email-modal")},m.cancelPendingEdits=function(){m.uiState.openSidebarPanel="",m.uiState.showSectionPanel=!1,m.uiState.openSidebarSectionPanel={name:"",id:""},m.state.pendingEmailChanges=!1,m.state.pendingWebsiteChanges=!1,s.website=angular.copy(m.state.originalWebsite),i.email=angular.copy(m.state.originalEmail),m.hideActiveToolTips()},m.hideActiveToolTips=function(){angular.element(".tooltip").remove()},m.checkSettingsValidityFn=function(){return!!(m.state.email.title&&m.state.email.subject&&m.state.email.fromName&&m.state.email.fromEmail)}}app.controller("EmailBuilderTopbarController",e),e.$inject=["$scope","$rootScope","$timeout","$attrs","$filter","EmailBuilderService","SimpleSiteBuilderService","$modal","$location","SweetAlert","toaster","$q"]}(),function(){app.directive("indiEmailBuilder",function(){return{restrict:"E",scope:{},templateUrl:"assets/js/indi-email-builder/indi-email-builder.component.html",controller:"EmailBuilderController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r,c,l,u,d,p,m,g,f){function h(e){if(T.uiState.dataLoaded){T.uiState.dataLoaded=!1;var t=null;if(["email-footer","email-header"].indexOf(e.type)>-1&&(t=_.findWhere(T.state.email.components,{type:e.type})))return r.pop("error",t.type+" component already exists"),void(T.uiState.dataLoaded=!0);l.getComponent(e,e.version||1,function(e){e&&(T.uiState.closeModal(),T.state.email.components.push(e),d(function(){var t=document.getElementById(e._id);t&&(p.scrollToElementAnimated(t,175,1e3),$(window).trigger("resize")),T.uiState.dataLoaded=!0,r.pop("success","Component Added","The "+e.type+" component was added successfully.")},500))})}}function v(){T.checkSettingsValidityFn()?(T.uiState.allowRedirect=!0,T.uiState.dataLoaded=!1,n.updateEmail(T.state.email).then(function(e){T.uiState.dataLoaded=!0,T.state.pendingEmailChanges=!1,T.state.saveLoading=!1,r.pop("success","Email saved"),T.uiState.updateEmailCache(e.data,!0)}).catch(function(e){var t=e.data?e.data.message:"The email was not saved. Please try again.";r.pop("error","Error",t),T.state.saveLoading=!1,T.uiState.dataLoaded=!0,T.uiState.updateEmailCache(T.state.originalEmail,!0),T.state.pendingEmailChanges=!1})):(T.uiState.allowRedirect=!1,r.pop("warning","Mandatory field should not be blank"))}function b(){f.swal({title:"Are you sure?",text:"You want to delete this email?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&(T.uiState.dataLoaded=!1,l.deleteEmail(T.state.email,function(){T.uiState.dirtyOverride=!0,T.uiState.dataLoaded=!0,s.go("app.emails"),r.pop("Warning","Email deleted.")}))})}function y(e){angular.element(this).hasClass("clickable-link")||e.preventDefault()}function w(e,t){var n=!1;return e&&t&&(n=angular.isDefined(e)&&angular.isDefined(e.indexOf)&&-1===e.indexOf("data-compiled"),angular.isDefined(t)&&angular.isDefined(t.indexOf)&&t.indexOf("data-compiled")),n&&angular.isDefined(e)&&angular.isDefined(t)&&(n=angular.equals(e,t)),n}function C(e,t){return e&&t&&angular.isDefined(e)&&angular.isDefined(e.indexOf)&&-1!==e.indexOf("data-compiled")&&angular.isDefined(t)&&angular.isDefined(t.indexOf)&&-1===t.indexOf("data-compiled")}function S(e,t){if(e&&t&&angular.isDefined(e)&&angular.isDefined(t)){var n=e.replace(/ style=''/g,""),a=t.replace(/ style=''/g,"");return angular.equals(n,a)}}function k(){return T.state.pendingWebsiteChanges=!1,o.saveWebsite(T.state.website).then(function(e){})}e.$state=s;var T=this;T.init=function(e){T.element=e,T.uiState.isSidebarClosed=t.app.layout.isSidebarClosed,t.app.layout.isSidebarClosed=!0,t.app.layout.isMinimalAdminChrome=!0,t.app.layout.isMinimalAdminChromeLight=!0,angular.element("body").on("click","[email-component-loader] a",y),c.getAccount(function(e){T.state.account=e}),l.getWebsite(function(e){T.state.website=e}),n.getEmail(T.state.emailId).then(function(e){e.data._id||(r.pop("error","Email not found"),s.go("app.emails")),T.state.email=e.data,T.state.originalEmail=angular.copy(e.data),d(function(){T.uiState.dataLoaded=!0},1e3)},function(e){s.go("app.emails")})},T.state=T.state||{},T.state.emailId=i.id,T.state.email=null,T.state.emails=null,T.state.pendingEmailChanges=!1,T.state.pendingWebsiteChanges=!1,T.state.account=null,T.state.website={settings:{}},T.uiState={allowRedirect:!0,sidebarOrientation:"vertical",dataLoaded:!1,modalInstance:null,editor:null,dirtyOverride:!1,openSimpleModal:function(t,n){var a={templateUrl:t,keyboard:!0,scope:e,size:n||"md"};T.uiState.modalInstance=u.open(a),T.uiState.modalInstance.result.then(null,function(){angular.element(".sp-container").addClass("sp-hidden")})},closeModal:function(){T.uiState.modalInstance&&T.uiState.modalInstance.close()},saveEmail:v,saveAndLoadEmail:function(e){T.state.pendingEmailChanges||T.state.pendingWebsiteChanges?(T.state.saveLoading=!0,T.state.pendingWebsiteChanges=!1,T.state.pendingEmailChanges=!1,k().then(function(){return n.updateEmail(T.state.email).then(function(t){o.getSite(T.state.website._id).then(function(){r.pop("success","Email Saved","The email was saved successfully."),T.state.saveLoading=!1,t.data&&T.uiState.updateEmailCache(t.data,!0),T.uiState.navigation.loadEmail(e._id),n.getEmails(),T.state.pendingEmailChanges=!1})}).catch(function(e){var t=e.data?e.data.message:"The email was not saved. Please try again.";r.pop("error","Error",t),T.state.saveLoading=!1})})):(T.uiState.navigation.loadEmail(e._id),n.getEmails())},createCampaign:function(){var e={name:T.state.email.title+" Campaign Draft "+moment().toDate().getTime(),type:"onetime",status:"DRAFT",visibility:1,startDate:"",emailSettings:{emailId:T.state.email._id,fromEmail:T.state.email.fromEmail,fromName:T.state.email.fromName,replyTo:T.state.email.replyTo,bcc:T.state.email.bcc,cc:T.state.email.cc,subject:T.state.email.subject,vars:[],sendAt:{}},searchTags:{operation:"set",tags:[]},contactTags:[]};a.createCampaign(e).then(function(e){T.uiState.closeModal(),g.path("/emails/campaigns/"+e.data._id)}).catch(function(e){})},sendOneTimeEmail:function(e){T.uiState.dataLoaded=!1,n.sendOneTimeEmail(e,T.state.email).then(function(){T.uiState.dataLoaded=!0,T.uiState.closeModal(),r.pop("success","Test email sent successfully")}).catch(function(e){T.uiState.dataLoaded=!0,T.uiState.closeModal(),r.pop("error","Test email sending failed")})},addComponent:h,delete:b,duplicateEmail:function(){f.swal({title:"Are you sure?",text:"You want to clone this email?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&(T.uiState.dataLoaded=!1,T.state.saveLoading=!0,n.duplicateEmail(T.state.email).then(function(e){var t=e.data;T.uiState.dirtyOverride=!0,T.uiState.dataLoaded=!0,T.state.saveLoading=!1,r.pop("Warning","Email cloned."),T.uiState.updateEmailCache(t,!1),T.uiState.navigation.loadEmail(t._id)}))})},updateEmailCache:function(e,t){l.updateEmailCache(e,t)},componentTypes:[{title:"Header",type:"email-header",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/photos/content_email_header.jpg",filter:"email",description:"Use this component for email header section.",enabled:!0},{title:"Content 1 Column",type:"email-1-col",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/photos/content_email_1_column.jpg",filter:"layout",description:"Use this component for single column content.",enabled:!0},{title:"Content 2 Column",type:"email-2-col",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/photos/content_email_2_column.jpg",filter:"layout",description:"Use this component for 2 column content.",enabled:!0},{title:"Content 3 Column",type:"email-3-col",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/photos/content_email_3_column.jpg",filter:"layout",description:"Use this component for 3 column content.",enabled:!0},{title:"Social Links",type:"email-social",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/photos/content_email_social.jpg",filter:"social",description:"Use this component for social links.",enabled:!0},{title:"Horizontal Rule",type:"email-hr",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/photos/content_email_breakline.jpg",filter:"layout",description:"Use this component to insert a horizontal rule between components.",enabled:!0},{title:"Footer",type:"email-footer",preview:"https://s3-us-west-2.amazonaws.com/indigenous-admin/photos/content_email_footer.jpg",filter:"email",description:"A footer for your email.",enabled:!0}]},T.uiState.navigation={back:function(){T.uiState.navigation.index=0,T.uiState.navigation.indexClass="ssb-sidebar-position-0"},loadEmail:function(e){e&&e!==T.state.email._id?(n.getEmails(),T.state.pendingWebsiteChanges||T.state.pendingEmailChanges||(T.uiState.loaded=!1),g.path("/emails/editor/"+e)):(T.uiState.navigation.index=1,T.uiState.navigation.indexClass="ssb-sidebar-position-1")},index:0,sectionPanel:{navigationHistory:[],loadPanel:function(e,t){t||T.uiState.navigation.sectionPanel.navigationHistory.push(e),T.uiState.openSidebarSectionPanel=e},back:function(){var e,t=T.uiState.navigation.sectionPanel.navigationHistory;t.pop(),e=t[t.length-1],T.uiState.navigation.sectionPanel.loadPanel(e,!0),e&&!e.id&&(hideAllControls(),angular.element(".ssb-active-section").addClass("ssb-active-edit-control"))},reset:function(){T.uiState.openSidebarSectionPanel={name:"",id:""},T.uiState.navigation.sectionPanel.navigationHistory=[]}}},T.addComponentFn=h,T.cloneComponentFn=function(e){var t=angular.copy(e);delete t._id,delete t.anchor;var n={type:t.type,version:t.version};if(T.uiState.dataLoaded){T.uiState.dataLoaded=!1;var a=null;if(["email","email-footer","email-header"].indexOf(n.type)>-1&&(a=_.findWhere(T.state.email.components,{type:n.type})))return r.pop("error",a.type+" component can't be cloned"),void(T.uiState.dataLoaded=!0);l.getComponent(n,n.version||1,function(e){e&&(_.extend(e,t),T.state.email.components.push(e),d(function(){var t=document.getElementById(e._id);t&&(p.scrollToElementAnimated(t,175,1e3),$(window).trigger("resize")),T.uiState.dataLoaded=!0,r.pop("success","Component cloned","The "+e.type+" component was cloned successfully.")},500))})}},T.saveFn=v,T.insertMediaFn=function(e){T.uiState.editor?d(function(){T.uiState.editor.image.insert(e.url,!1,null,T.uiState.editor.img)},0):r.pop("error","Position cursor at the point of insertion")},T.moveComponentFn=function(e,t){var n,a=_.findIndex(T.state.email.components,function(t){return t._id===e._id});"up"===t&&(n=a-1),"down"===t&&(n=a+1),T.state.email.components.splice(n,0,T.state.email.components.splice(a,1)[0])},T.clickImageButton=function(t,n){e.insertMediaImage=!0,e.showInsert=!0,e.inlineInput=t,e.isEditMode=n,T.openModalFn("media-modal","MediaModalCtrl",null,"lg")},T.deleteFn=b,T.changeBackgroundFn=function(){T.uiState.navigation.sectionPanel.loadPanel({name:"Email Background",id:"background"}),T.uiState.showSectionPanel=!0,T.uiState.activeComponentIndex=null},T.closeSectionPanel=function(){T.uiState.navigation.sectionPanel.reset(),T.uiState.showSectionPanel=!1,T.uiState.activeComponentIndex=null},T.checkIfDirtyFn=function(){return T.state.pendingEmailChanges},T.resetDirtyFn=function(){T.state.pendingEmailChanges=!1,T.uiState.dirtyOverride=!1},T.pageChanged=function(e,t){if(angular.equals(e,t)||T.state.pendingEmailChanges)return!angular.equals(e,t);var e=JSON.parse(angular.toJson(e)),t=JSON.parse(angular.toJson(t)),n=DeepDiff.diff(e,t),a=n.length;if(!a)return a>0;for(var o=0;o<a;o++){var i=n[o].lhs,s=n[o].rhs;if(n[o].path,!(w(i,s)||C(i,s)||S(i,s)))return!0;d(function(){return DeepDiff.applyChange(e,t,n[o]),T.state.originalEmail=e,--a>0})}},T.openModalFn=function(t,n,a,o){var i={templateUrl:t,keyboard:!0,backdrop:"static",size:"md",scope:e,resolve:{components:function(){return T.state.email&&T.state.email.components?T.state.email.components:[]}}};n&&(i.controller=n,i.resolve.contactMap=function(){return{}},i.resolve.website=function(){return T.state.website},i.resolve.showInsert=function(){return!0},i.resolve.insertMedia=function(){return T.insertMediaFn},i.resolve.openParentModal=function(){return T.openModalFn},i.resolve.accountShowHide=function(){return T.state.account.showhide},i.resolve.isEmail=function(){return!0},i.resolve.isSingleSelect=function(){return!0}),angular.isDefined(a)&&null!==a&&a>=0&&(e.setEditingComponent(a),i.resolve.clickedIndex=function(){return a},i.resolve.pageHandle=function(){return e.page?e.page.handle:null}),o&&(i.size=o),T.uiState.modalInstance=u.open(i),T.uiState.modalInstance.result.then(null,function(){angular.element(".sp-container").addClass("sp-hidden")})},T.checkSettingsValidityFn=function(){return!!(T.state.email.title&&T.state.email.subject&&T.state.email.fromName&&T.state.email.fromEmail)},t.$on("$stateChangeStart",function(e,n,a,o,i,s){t.$broadcast("$destroyFroalaInstances"),t.app.layout.isMinimalAdminChrome=!1,t.app.layout.isMinimalAdminChromeLight=!1,t.app.layout.isSidebarClosed=T.uiState.isSidebarClosed}),e.$on("email.move.component",function(e,t){T.moveComponentFn(t.component,t.direction)}),e.$on("email.duplicate.component",function(e,t){T.cloneComponentFn(t.component)}),e.$on("email.remove.component",function(e,t){T.uiState.dataLoaded=!1,T.state.email.components.forEach(function(e,n){e._id===t.component._id&&T.state.email.components.splice(n,1)}),d(function(){var e=T.state.email.components.length?document.getElementById(T.state.email.components[T.state.email.components.length-1]._id):null;e&&(p.scrollToElementAnimated(e,175,1e3),$(window).trigger("resize")),T.uiState.dataLoaded=!0,r.pop("warning","component deleted")},500)}),e.$on("focusEditor",function(e,t){T.uiState.editor=t.editor,T.uiState.editor.img=null}),e.$on("activeEditor",function(e,t){t.editor&&(T.uiState.editor=t.editor),t.editorImage&&(T.uiState.editor.img=t.editorImage)}),e.$on("$destroy",function(){angular.element("body").off("click","[email-component-loader] a",y),A(),D(),P()});var P=e.$watch(function(){return o.website},function(e){T.state.pendingWebsiteChanges=!1,T.state.website=e,T.state.originalWebsite=null,d(function(){T.state.originalWebsite=angular.copy(e)},1e3)}),D=e.$watch(function(){return n.emails},function(e){T.state.emails=e}),A=e.$watch("vm.state.email",_.debounce(function(e){e&&T.state.originalEmail&&T.pageChanged(e,T.state.originalEmail)?d(function(){T.state.pendingEmailChanges=!0,T.uiState&&T.uiState.selectedEmail&&(T.uiState.selectedEmail=T.state.email)},0):T.state.pendingEmailChanges=!1},100),!0);m.clickandInsertImageButton=function(e){T.clickImageButton(e,!1)}}app.controller("EmailBuilderController",e),e.$inject=["$scope","$rootScope","EmailBuilderService","EmailCampaignService","SimpleSiteBuilderService","$stateParams","$state","toaster","AccountService","WebsiteService","$modal","$timeout","$document","$window","$location","SweetAlert"]}(),function(){function e(e,t){function n(e){return a.loading.value=a.loading.value+1,e.finally(function(){a.loading.value=a.loading.value-1}),e}var a={},o="/api/1.0/cms",i="/api/2.0/cms",s="/api/1.0/cms/website";return a.loading={value:0},a.email={},a.emails=[],a.getEmails=function(){return n(e.get([s,a.websiteId,"emails"].join("/")).success(function(e){a.emails=e}).error(function(e){}))},a.getEmail=function(t){return n(e.get([o,"email",t].join("/")).success(function(e){a.email=e}).error(function(e){}))},a.updateEmail=function(t){return n(e({url:[i,"email",t._id].join("/"),method:"PUT",data:angular.toJson(t)})).success(function(e){}).error(function(e){})},a.sendOneTimeEmail=function(t,a){var i=angular.toJson({address:t,content:a});return n(e({url:[o,"testemail"].join("/"),method:"POST",data:i}).success(function(e){}).error(function(e){}))},a.duplicateEmail=function(t){return n(e({url:[i,"email","duplicate"].join("/"),method:"POST",data:angular.toJson(t)})).success(function(e){}).error(function(e){})},t.getAccount(function(e){a.account=e,a.websiteId=e.website.websiteId,a.getEmails()}),a}app.factory("EmailBuilderService",e),e.$inject=["$http","AccountService"]}(),function(){app.directive("campaignRecipientDetailsComponent",function(){return{restrict:"E",scope:{},templateUrl:"assets/js/indi-email-campaign/campaign-recipient-details/campaign-recipient.component.html",controller:"CampaignRecipientDetailsController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r,c,l,u,d,p){function m(){y.uiState.fieldSearch={}}function g(){return y.state.recipients?Math.ceil(y.state.totalFilteredRecipients/y.uiState.limit):0}function f(){var e,t,n=1,a=(y.uiState.curPage,y.state.totalFilteredRecipients,y.uiState.curPage),o=g();for((e=(n=Math.max(n,a-Math.abs(Math.floor(y.pagingConstant.displayedPages/2))))+y.pagingConstant.displayedPages)>o&&(e=o+1,n=Math.max(1,e-y.pagingConstant.displayedPages)),y.pages=[],t=n;t<e;t++)y.pages.push(t)}function h(){y.uiState.curPage=1,y.uiState.skip=0,y.uiState.pageLoading=!0,y.uiState.isFieldSearchEnabled=b()}function v(){l.getCampaignRecipientDetails(s.id,y.uiState).then(function(e){y.state.recipients=e.data.results,y.state.totalFilteredRecipients=e.data.total,y.state.totalRecipients=l.totalRecipients,f(),y.uiState.loading=!1,y.uiState.pageLoading=!1,y.uiState.loadingFilter=!1,$("html, body").animate({scrollTop:0},600)})}function b(){return u.checkIfFieldSearch(y.uiState.fieldSearch)}var y=this;y.init=function(e){y.element=e,v()},y.state={},y.uiState={loading:!0,curPage:1,limit:c.numberOfRowsPerPage,skip:0,sortBy:null,sortDir:null},y.showFilter=function(){y.uiState.showFilter=!y.uiState.showFilter,y.uiState.showFilter||m()},y.numberOfPages=g,y.pagingConstant=c,y.selectPage=function(e){y.uiState.pageLoading=!0,y.uiState.curPage=e,y.uiState.skip=(e-1)*y.uiState.limit,v()},y.sortCampaignRecipientList=function(e,t){y.sortData.column!==t&&(y.sortData.details={}),y.sortData.column=t,y.sortData.details[t]?1===y.sortData.details[t].direction?y.sortData.details[t].direction=-1:y.sortData.details[t].direction=1:y.sortData.details[t]={direction:1,sortColum:e},y.uiState.sortBy=e,y.uiState.sortDir=y.sortData.details[t].direction,h(),v()},y.viewSingleContact=function(e){var n=e.contactId;if(n)t.go("app.singleContact",{contactId:n});else{var a=e.receiver,o=_.findWhere(e.events,function(e){return e.email===a});o&&t.go("app.singleContact",{contactId:o.contactId})}},y.showFilteredRecords=function(){return!y.uiState.loadingFilter&&u.showFilteredRecords(y.uiState.globalSearch,y.uiState.fieldSearch)},y.downloadReport=function(){d.downloadReport(s.id),p.pop("success","Please wait while report is downloading...")},y.sortData={column:"",details:{}},y.booleanSearchOptions=[{label:"true",value:"true"},{label:"false",value:"false"}],l.totalRecipients=null,e.$watch("vm.uiState.globalSearch",function(e){angular.isDefined(e)&&(y.uiState.loadingFilter=!0,h(),v())},!0),e.$watch("vm.uiState.fieldSearch",function(e){angular.isDefined(e)&&(y.uiState.loadingFilter=!0,h(),v())},!0)}app.controller("CampaignRecipientDetailsController",e),e.$inject=["$scope","$state","$attrs","$filter","$modal","$timeout","$stateParams","$location","pagingConstant","EmailCampaignService","UtilService","CampaignService","toaster"]}(),function(){app.directive("indiEmailCampaign",function(){return{restrict:"E",scope:{},templateUrl:"assets/js/indi-email-campaign/indi-email-campaign.component.html",controller:"EmailCampaignController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r,c,l,u,d,p,m,g,f,h,v,b){function y(){var e=!0;return k.state.campaign.emailSettings.fromEmail||(e=!1),e}function w(){var e=[];return _.each(k.state.tagSelection,function(t){var n=_.find(T,function(e){return e.label===t});n?e.push(n.label):e.push(t)}),e}function C(){var e=!1;return k.state.campaign&&"COMPLETED"!==k.state.campaign.status&&(angular.equals(k.state.campaign,k.state.campaignOriginal)||(e=!0),angular.equals(k.uiState.delivery.date,k.uiState.delivery.originalDate)||(e=!0),angular.equals(_.pluck(k.state.recipients,"_id").sort(),_.pluck(k.state.originalRecipients,"_id").sort())||(e=!0),angular.equals(k.uiState.originalNewEmails,k.uiState.selectedContacts.newEmails)||(e=!0)),e}function S(){k.state.campaign=angular.copy(k.state.campaignOriginal),k.uiState.delivery.date=angular.copy(k.uiState.delivery.originalDate),k.state.recipients=angular.copy(k.state.originalRecipients)}e.$state=a;var k=this,T=m.contact_types.dp;k.init=function(e){k.element=e,i.getAccount(function(e){k.state.account=e}),s.getWebsite(function(e){k.state.website=e}),p.getContactTags(function(e){k.state.contactTags=e}),p.getContactTagCounts(function(e){var t=e.count,n={};_.map(t,function(e,t){var a=t.trim(),o=_.find(k.state.contactTags,function(e){return e.data===a});o&&(a=o.label),n[a]?n[a]=parseInt(e)+parseInt(n[a]):n[a]=parseInt(e)});var a=_.map(n,function(e,t){var n={uniqueTag:t,numberOfTags:e};return"NOTAG"===t?(n.matchingTag="No Tag",n.uniqueTag="nt"):n.matchingTag=t,n});k.contactCounts=a}),"create"!==k.state.campaignId&&d.getCampaign(k.state.campaignId).then(function(e){e.data._id||(o.pop("error","Campaign not found"),a.go("app.marketing.campaigns"));var n=e.data;n.emailSettings.emailId?t.getEmail(n.emailSettings.emailId).then(function(e){k.state.email=e.data,k.state.campaign=angular.extend(k.state.campaign,n),"DRAFT"===k.state.campaign.status&&(k.uiState.disableEditing=!1),s.getEmails(null,function(e){k.state.emails=e,k.updateCampaignEmailSettingsFn(),k.state.campaignOriginal=angular.copy(n)})}):(k.state.campaign=angular.extend(k.state.campaign,n),k.state.campaignOriginal=angular.copy(n));var i=null;if(n.emailSettings){var r=n.emailSettings.sendAt,c=r.month+"/"+r.day+"/"+r.year+" "+r.hour+":"+r.minute;i=moment.utc(c).toISOString()}var l=moment(i);"onetime"===k.state.campaign.type&&l.isValid()&&(k.uiState.delivery.date=l,k.uiState.delivery.originalDate=angular.copy(l),n.emailSettings.whenToSend?k.uiState.whenToSend=n.emailSettings.whenToSend:k.uiState.whenToSend=l.isAfter()?"later":"now"),n.contacts&&n.contacts.length<=m.campaigns.MAX_CONTACT_LIST_COUNT?k.getCampaignContactsFn():k.uiState.contactLimitExceeded=!0,p.getContactsCount(function(e){e.count<=m.campaigns.MAX_CONTACT_LIST_COUNT?k.getContactsFn().then(function(){k.loadSavedTagsFn()}):(k.loadSavedTagsFn(),k.uiState.contactLimitExceeded=!0)})},function(e){a.go("app.marketing.campaigns")})},k.state=k.state||{},k.uiState=k.uiState||{},g.theme="bs3",k.getTagLabel=function(e){return"No Tag"===e?"(no tag)":e},k.state.campaignId=n.id,k.state.campaign={name:"",type:"onetime",status:"DRAFT",startDate:"",emailSettings:{emailId:"",fromEmail:"",fromName:"",replyTo:"",bcc:"",cc:"",subject:"",vars:[],sendAt:{}},searchTags:{operation:"set",tags:[]}},k.state.campaignOriginal=angular.copy(k.state.campaign),k.state.email=null,k.uiState.dataLoaded=!1,k.uiState.disableEditing=!0,k.state.account=null,k.state.website={settings:{}},k.state.contacts=[],k.state.allContacts=[],k.state.tagSelection=[],k.state.recipients=[],k.state.recipientsToRemove=[],k.state.originalRecipients=[],k.uiState.selectedContacts={individuals:[],newEmails:[]},k.uiState.originalNewEmails=[],k.uiState.whenToSend="now",k.uiState.watchDeliveryDate=!1,k.uiState.delivery={date:moment(),minDate:new Date},k.uiState.delivery.originalDate=angular.copy(k.uiState.delivery.date),k.uiState.hstep=1,k.uiState.mstep=1,k.uiState.tableView="list",k.uiState.allowRedirect=!0,k.uiState.triggers=[{name:"Sign Up",icon:"fa-paper-plane",value:"SIGNUP"}],k.saveAsDraftFn=function(e){k.uiState.allowRedirect=!0,k.uiState.dataLoaded=!1;var t=d.updateCampaign;"create"===k.state.campaignId&&(t=d.createCampaign),k.state.campaign.status="DRAFT";var n={};n.year=moment.utc(k.uiState.delivery.date).get("year"),n.month=moment.utc(k.uiState.delivery.date).get("month")+1,n.day=moment.utc(k.uiState.delivery.date).get("date"),n.hour=moment.utc(k.uiState.delivery.date).get("hour"),n.minute=moment.utc(k.uiState.delivery.date).get("minute"),k.state.campaign.emailSettings&&(k.state.campaign.emailSettings.sendAt=n),k.state.campaign.contactTags=k.getSelectedTagsFn(),k.state.campaign.contactTagData=[],_.each(k.state.campaign.contactTags,function(e){k.state.campaign.contactTagData.push(p.getTagFromLabel(e))}),k.removeContactsFromCampaignFn(),d.checkIfDuplicateCampaign(k.state.campaign._id,k.state.campaign.name).then(function(n){if(n.data)return o.pop("warning","Campaign name already exists"),k.uiState.dataLoaded=!0,k.uiState.disableEditing=!1,void(k.uiState.allowRedirect=!1);e&&(k.state.campaign.status="RUNNING"),k.checkAndCreateContactFn(function(n){k.addContactsFn(n),t(k.state.campaign).then(function(t){k.state.campaign=angular.extend(k.state.campaign,t.data),k.state.campaignOriginal=angular.copy(k.state.campaign),k.state.originalRecipients=angular.copy(k.state.recipients),k.uiState.delivery.originalDate=angular.copy(k.uiState.delivery.date),k.uiState.originalNewEmails=angular.copy(k.uiState.selectedContacts.newEmails),k.uiState.dataLoaded=!0,k.uiState.disableEditing=!1,e?(k.uiState.disableEditing=!0,o.pop("success","Campaign activated")):o.pop("success","Campaign saved")},function(t){k.uiState.dataLoaded=!0,e?o.pop("error","Campaign activation failed"):o.pop("error","Campaign save failed")})})})},k.sendTestFn=function(e){k.uiState.dataLoaded=!1,k.state.email.fromEmail=k.state.campaign.emailSettings.fromEmail,k.state.email.fromName=k.state.campaign.emailSettings.fromName,k.state.email.replyTo=k.state.campaign.emailSettings.replyTo,k.state.email.bcc=k.state.campaign.emailSettings.bcc,k.state.email.cc=k.state.campaign.emailSettings.cc,k.state.email.subject=k.state.campaign.emailSettings.subject,d.sendTestEmail(e,k.state.email).then(function(e){k.uiState.dataLoaded=!0,k.closeModalFn(),o.pop("success","Send test email")},function(e){k.uiState.dataLoaded=!0,k.closeModalFn(),o.pop("error","Send test mail failed")})},k.activateCampaignFn=function(){if(y())k.uiState.saveLoading=!0,(0,d.activateCampaign)(k.state.campaign).then(function(e){k.state.campaign=angular.extend(k.state.campaign,e.data),k.state.campaignOriginal=angular.copy(k.state.campaign),k.state.originalRecipients=angular.copy(k.state.recipients),k.uiState.originalNewEmails=angular.copy(k.uiState.selectedContacts.newEmails),k.uiState.delivery.originalDate=angular.copy(k.uiState.delivery.date),k.uiState.dataLoaded=!0,k.uiState.disableEditing=!1,k.uiState.saveLoading=!1,k.uiState.disableEditing=!0,o.pop("success","Campaign activated")},function(e){k.uiState.dataLoaded=!0,o.pop("error","Campaign activation failed"),k.uiState.saveLoading=!1});else{o.pop("warning","Please fill the required fields");var e=document.getElementById("campaign-email-settings-container");l.scrollToElementAnimated(e,0,1e3)}},k.getContactsFn=function(){return p.getContacts(function(e){var t=[];_.each(e,function(e){k.checkBestEmailFn(e)||t.push(e)}),e=_.difference(e,t),k.state.contacts=e,k.state.allContacts=[],_.each(e,function(e){k.state.allContacts.push({_id:e._id,first:e.first})})})},k.checkBestEmailFn=function(e){return p.checkContactBestEmail(e)},k.toggleSelectionFn=function(e){var t=k.state.tagSelection.indexOf(e);t>-1?k.state.tagSelection.splice(t,1):k.state.tagSelection.push(e),k.state.recipients=k.getRecipientsFn()},k.getRecipientsFn=function(){var e=[],t=k.getSelectedTagsFn();return _.each(k.state.contacts,function(n){if(n.tags&&n.tags.length>0){var a=[],o="";_.each(n.tags,function(e){(o=_.findWhere(T,{data:e}))?a.push(o.label):a.push(e)}),_.intersection(a,t).length>0&&(k.eliminateDuplicateFn(n)||e.push(n))}else t.indexOf("No Tag")>-1&&(k.eliminateDuplicateFn(n)||e.push(n));k.uiState.selectedContacts.individuals.indexOf(n._id)>-1&&e.push(n)}),e},k.getSelectedTagsFn=w,k.eliminateDuplicateFn=function(e){return k.uiState.selectedContacts.individuals.indexOf(e._id)>-1},k.contactSelectedFn=function(e){var t=e.selected[e.selected.length-1],n=_.indexOf(k.state.recipientsToRemove,t._id);_.find(k.state.recipients,function(e){return e._id===t._id})||k.state.recipients.push(t),e.search="",-1!==n&&k.state.recipientsToRemove.splice(n,1)},k.contactRemovedFn=function(e,t){var n,a=_.findWhere(k.state.recipients,{_id:t._id});if(a&&(n=_.indexOf(k.state.recipients,a)),n>-1){var o=k.getSelectedTagsFn(),i=[],s="";_.each(a.tags,function(e){(s=_.findWhere(T,{data:e}))?i.push(s.label):i.push(e)}),i.length||i.push("No Tag"),0===_.intersection(i,o).length&&k.state.recipients.splice(n,1)}e.search="",k.state.recipientsToRemove.push(t._id)},k.checkContactExistsFn=function(e){if(e){if(!b.email.test(e.text))return!1;var t=_.find(k.state.recipients,function(t){if(t.details&&t.details[0]&&t.details[0].emails&&t.details[0].emails[0]&&t.details[0].emails[0].email)return t.details[0].emails[0].email.toLowerCase()===e.text.toLowerCase()}),n=_.find(k.state.contacts,function(t){if(t.details&&t.details[0]&&t.details[0].emails&&t.details[0].emails[0]&&t.details[0].emails[0].email)return t.details[0].emails[0].email.toLowerCase()===e.text.toLowerCase()});return!t&&!n}return!1},k.updateSendNowFn=function(e){k.uiState.whenToSend=e,k.uiState.watchDeliveryDate=!0,"now"!==k.uiState.whenToSend&&k.uiState.delivery.date.isBefore(moment())&&(k.uiState.delivery.date=moment()),"later"!==k.uiState.whenToSend&&(k.uiState.delivery.date=moment()),k.state.campaign.emailSettings.whenToSend=k.uiState.whenToSend},k.openModalFn=function(t){k.modalInstance=r.open({templateUrl:t,keyboard:!0,backdrop:"static",scope:e}),k.modalInstance.result.finally(k.closeModalFn())},k.closeModalFn=function(){k.modalInstance.close()},k.getCampaignContactsFn=function(){k.uiState.dataLoaded=!1,d.getCampaignContacts(k.state.campaignId).then(function(e){k.state.recipients=e.data,k.state.originalRecipients=angular.copy(k.state.recipients);var t=[];_.each(e.data,function(e){t.push(e._id)}),k.uiState.selectedContacts.individuals=t,k.uiState.dataLoaded=!0})},k.loadSavedTagsFn=function(){k.uiState.dataLoaded=!1,_.each(k.state.campaign.contactTags,function(e){if(e&&"No Tag"===e)k.toggleSelectionFn(e);else{var t=_.findWhere(T,{data:e});t&&(e=t.label),(e=_.findWhere(k.contactCounts,{uniqueTag:e}))&&k.toggleSelectionFn(e.matchingTag)}}),c(function(){k.state.originalRecipients=angular.copy(k.state.recipients)},0),k.uiState.dataLoaded=!0},k.checkAndCreateContactFn=function(e){var t=[],n=[];if(k.uiState.selectedContacts.newEmails){var a=k.uiState.selectedContacts.newEmails;_.each(a,function(e){var a=_.findWhere(k.state.contacts,{email:e.text.toLowerCase()});if(a)t.push(a._id);else{var o=k.createContactDataFn(e.text.toLowerCase());n.push(p.createContact(o))}})}n.length?v.all(n).then(function(n){_.each(n,function(e){t.push(e.data._id)}),e(t)}).catch(function(e){}):e(t)},k.addContactsFn=function(e){var t=[];_.each(k.state.recipients,function(e){e._id&&t.push(e._id)}),e.length>0&&_.each(e,function(e){t.indexOf(e)<0&&t.push(e)});var n=t;k.state.campaign.contacts=n},k.removeContactsFromCampaignFn=function(){angular.forEach(k.state.recipientsToRemove,function(e){d.cancelCampaignForContact(k.state.campaign,e).then(function(e){})}),_.each(k.removeContactsFromCampaign,function(e){})},k.resetDirtyFn=S,k.checkIfDirtyFn=C,k.duplicateFn=function(){d.duplicateCampaign(k.state.campaign).then(function(e){a.go("app.emailCampaign",{id:e.data._id}),o.pop("success","Campaign cloned")})},k.updateCampaignEmailSettingsFn=function(e){var t=k.state.email;if(e&&k.state.campaign.emailSettings)t=_.findWhere(k.state.emails,{_id:k.state.campaign.emailSettings.emailId}),k.state.campaign.emailSettings.emailId=t._id,k.state.campaign.emailSettings.fromEmail=t.fromEmail,k.state.campaign.emailSettings.fromName=t.fromName,k.state.campaign.emailSettings.replyTo=t.replyTo,k.state.campaign.emailSettings.bcc=t.bcc,k.state.campaign.emailSettings.cc=t.cc,k.state.campaign.emailSettings.subject=t.subject,k.state.campaign.emailSettings.vars=t.vars,k.state.email=angular.copy(t);else{var n=_.findIndex(k.state.emails,{_id:t._id});k.state.emails[n]=t}},k.deleteCampaignFn=function(){f.swal({title:"Are you sure?",text:"Do you want to delete this campaign?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete campaign!",cancelButtonText:"No, do not delete campaign!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?d.deleteCampaign(k.state.campaign).then(function(e){o.pop("success","Campaign deleted.","The "+k.state.campaign.name+" campaign was deleted successfully."),S(),c(function(){h.path("/marketing/campaigns")},500)}):f.swal("Not Deleted","The campaign was not deleted.","error")})},k.cancelCampaignFn=function(){f.swal({title:"Are you sure?",text:"Do you want to cancel this campaign?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, cancel campaign!",cancelButtonText:"No, do not cancel campaign!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?d.cancelCampaign(k.state.campaign).then(function(e){o.pop("success","Campaign cancelled.","The "+k.state.campaign.name+" campaign was cancelled successfully."),S(),c(function(){h.path("/marketing/campaigns")},500)}):f.swal("Not Cancelled","The campaign was not cancelled.","error")})},k.canActivateFn=function(){var e=k.uiState.dataLoaded,t=k.state.campaign&&angular.isDefined(k.state.campaign._id),n="cancelled"!==k.state.campaign.status.toLowerCase(),a=k.state.recipients.length+k.uiState.selectedContacts.newEmails.length+w().length>0,o="onetime"===k.state.campaign.type,i=C();return e&&t&&n&&(!o||a)&&!i},k.tagToContactFn=function(e){return p.tagToContact(e)},k.createContactDataFn=function(e){var t={details:[{emails:[]}]};return t.details[0].emails.push({email:e}),t},k.contactTagsFn=function(e){return p.contactTags(e)},k.formValidations=b,k.backToCampaigns=function(){h.url("/marketing/campaigns")},k.customTagFilter=function(e){if(k.state.campaign.searchTags&&k.state.campaign.searchTags.tags){var t=!0;return angular.forEach(k.state.campaign.searchTags.tags,function(n){n.label.toLowerCase()===e.label.toLowerCase()&&(t=!1)}),t}return!0},k.showSelectTagsPane=function(){var e=!0;return k.state.campaign&&k.uiState.dataLoaded&&"COMPLETED"===k.state.campaign.status&&(k.state.campaign.searchTags&&k.state.campaign.searchTags.tags.length||(e=!1)),e},e.$watch("vm.state.campaign.type",function(){k.state.campaign.emailSettings&&"COMPLETED"!==k.state.campaign.status&&("autoresponder"===k.state.campaign.type?k.state.campaign.emailSettings.trigger="SIGNUP":k.state.campaign.emailSettings.trigger=null)}),e.$watch("emailToSend.subject",function(e,t){e&&k.analyzeSubject(e)})}app.controller("EmailCampaignController",e),e.$inject=["$scope","EmailBuilderService","$stateParams","$state","toaster","AccountService","WebsiteService","$modal","$timeout","$document","$window","EmailCampaignService","ContactService","userConstant","editableOptions","SweetAlert","$location","$q","formValidations"]}(),function(){function e(e,t){function n(e){return a.loading.value=a.loading.value+1,e.finally(function(){a.loading.value=a.loading.value-1}),e}var a={},o="/api/1.0/campaigns",i="/api/1.0/cms";return a.loading={value:0},a.getCampaign=function(t){return n(e.get([o,t].join("/")).success(function(e){}).error(function(e){}))},a.createCampaign=function(t){return n(e.post(o,t).success(function(e){}).error(function(e){}))},a.updateCampaign=function(t){return n(e.post([o,t._id].join("/"),t).success(function(e){}).error(function(e){}))},a.activateCampaign=function(t){return n(e.post([o,t._id,"activate"].join("/"),t).success(function(e){}).error(function(e){}))},a.sendTestEmail=function(t,a){var o={address:t,content:a};return n(e.post([i,"testemail"].join("/"),o).success(function(e){}).error(function(e){}))},a.getCampaignContacts=function(t){return n(e.get([o,t,"contacts"].join("/")).success(function(e){}).error(function(e){}))},a.cancelCampaignForContact=function(t,a){return n(e({url:[o,t._id,"contact",a].join("/"),method:"DELETE",data:t})).success(function(e){}).error(function(e){})},a.duplicateCampaign=function(t){return n(e.post([o,t._id,"duplicate"].join("/"),t).success(function(e){}).error(function(e){}))},a.deleteCampaign=function(t){return n(e({url:[o,t._id].join("/"),method:"DELETE"}).success(function(e){}).error(function(e){}))},a.cancelCampaign=function(t){return n(e({url:[o,t._id,"cancel"].join("/"),method:"DELETE"}).success(function(e){}).error(function(e){}))},a.checkIfDuplicateCampaign=function(t,a){function i(e){}function s(e){}return n(t?e.get([o,t,"campaigns",encodeURIComponent(a)].join("/")).success(i).error(s):e.get([o,"campaigns","exists",encodeURIComponent(a)].join("/")).success(i).error(s))},a.getCampaignRecipientDetails=function(t,i){var s=[o,t,"recipients","statistics"],r="?limit="+i.limit+"&skip="+i.skip;return i.sortBy&&(r+="&sortBy="+i.sortBy+"&sortDir="+i.sortDir),i.globalSearch&&(r+="&term="+i.globalSearch),i.isFieldSearchEnabled&&(s.push("filter"),_.each(i.fieldSearch,function(e,t){null!=e&&(r+="&"+t+"="+e)})),n(e.get(s.join("/")+r).success(function(e){a.totalRecipients||(a.totalRecipients=e.total)}).error(function(e){}))},t.getAccount(function(e){a.account=e,a.websiteId=e.website.websiteId}),a}app.factory("EmailCampaignService",e),e.$inject=["$http","AccountService"]}(),function(){app.directive("indiLoginModal",function(){return{restrict:"E",templateUrl:"assets/js/indi-login-modal/indi-login-modal.component.html",controller:"IndiLoginModalController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r,c){function l(e){i(function(){p.uiState.loading=!0})}function u(){t.reload()}function d(){var e=p.element.find("iframe").contents(),t=e.find("html"),n=e.find('button[type="submit"');t.addClass("is-indi-modal"),n.on("click",l)}var p=this;p.init=function(e){p.element=e,p.loginIframe=p.element.find("iframe"),p.loginIframe.on("load",p.onload)},p.onload=function(e){p.loginIframeContentWindow=p.loginIframe.get(0).contentWindow,i(function(){p.uiState.loading=!1,"/login"===p.loginIframeContentWindow.location.pathname?d():-1!==p.loginIframeContentWindow.location.pathname.indexOf("/admin")?(c.loginConfirmed(),p.closeModal(),u(),s.pop("success","Signed in","Sign in successful.")):(p.closeModal(),s.pop("success","Not Signed in","Sign in failed. Please try again."))})},p.setupModalEvents=function(e){p.modalInstance=e,p.modalInstance.result.then(function(e){},function(e){})},p.closeModal=function(){r.closeModal(),p.unbindModalWatcher(),p.loginIframe=null,p.loginIframeContentWindow=null},p.uiState={loading:!0},p.unbindModalWatcher=e.$watch(function(){r.getModalInstance()},function(e){e&&p.setupModalEvents(e)})}app.controller("IndiLoginModalController",e),e.$inject=["$scope","$state","$attrs","$filter","$document","$timeout","toaster","IndiLoginModalService","authService"]}(),function(){function e(e,t,n,a){var o=this;return o.setModalInstance=function(e){o.modalInstance=e},o.getModalInstance=function(){return o.modalInstance},o.closeModal=function(){o.modalInstance.close(),o.modalInstance=void 0},o.queue=[],o}app.factory("IndiLoginModalService",e),e.$inject=["$rootScope","$http","$q","$timeout"]}(),angular,app.controller("jobsCtrl",["$scope","JobsService","toaster",function(e,t,n){var a=this;a.state={},a.uiState={loading:!0},a.rescheduleJob=function(e){t.rescheduleJob(e),n.pop("success","Job rescheduled.")},a.isDateInPast=function(e){return!!moment(e).isBefore(moment())},t.listJobs(function(e){a.state.jobs=e})}]),function(){function e(e,t,n){function a(e){return o.loading.value=o.loading.value+1,e.finally(function(){o.loading.value=o.loading.value-1}),e}var o={},i="/api/1.0/admin/jobs",s=i+"/scheduled";return o.loading={value:0},o.listJobs=function(t){return a(e.get(s).success(function(e){o.jobs=e,t(e)}).error(function(e){}))},o.rescheduleJob=function(t){var n=[i,t,"reschedule"].join("/");return a(e.post(n).success(function(e){}).error(function(e){}))},o}app.factory("JobsService",e),e.$inject=["$http","$q","$timeout"]}();var app=angular.module("indigenousApp",["indigenous"]);app.run(["$rootScope","$state","$stateParams","$injector","$window","ENV",function(e,t,n,a,o,i){var s,r,c;e.orgId=o.indigenous.orgId,i.stripeKey=i.stripeKey[e.orgId],FastClick.attach(document.body),e.$state=t,e.$stateParams=n,e.app={name:"Indigenous",author:"Indigenous Software, INC",description:"An all in one solution for small to medium sized businesses.",version:"1.0",year:(new Date).getFullYear(),isMobile:!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),layout:{isNavbarFixed:!0,isSidebarFixed:!0,isSidebarClosed:!1,isFooterFixed:!1,isMinimalAdminChrome:!1,theme:"theme-6",logo:"assets/images/logo.png",isAnalyticsDashboardMode:!1}},e.user={name:"Peter",job:"ng-Dev",picture:"app/img/user/02.jpg"},e.$on("event:auth-loginRequired",function(e){s=s||a.get("$modal"),c=c||a.get("IndiLoginModalService"),angular.isObject(c.getModalInstance())||(r=s.open({templateUrl:"indigeneous-admin-login-modal",keyboard:!0,backdrop:"static",size:"sm"}),c.setModalInstance(r))})}]),app.config(["$translateProvider",function(e){e.useStaticFilesLoader({prefix:"assets/i18n/",suffix:".json"}),e.preferredLanguage("en"),e.useLocalStorage()}]),app.config(["cfpLoadingBarProvider",function(e){e.includeBar=!0,e.includeSpinner=!1}]),function(e){app.controller("broadcastMessageEditorCtrl",["$scope","$modal","$timeout","$location","toaster","$stateParams","BroadcastMessagesService",function(t,n,a,o,i,s,r){function c(){o.url("customer/messages")}function l(t,a,o,i){var s={templateUrl:t,keyboard:!0,backdrop:"static",size:"md",resolve:{vm:function(){return p}}};a&&(s.controller=a,s.resolve.showInsert=function(){return!0},s.resolve.insertMedia=function(){return u},s.resolve.isSingleSelect=function(){return!0}),i&&(s.size="lg"),p.modalInstance=n.open(s),p.modalInstance.result.then(null,function(){e.element(".sp-container").addClass("sp-hidden")})}function u(e){d(e)}function d(e){a(function(){p.callBackOnImageInsert(e.url,p.callBackImage)},0)}var p=this;p.state={},p.uiState={loading:!0,saveLoading:!1},p.messageId=s.id,p.saveMessage=function(){if(p.uiState.saveLoading=!0,!p.state.message.startDate||!p.state.message.endDate)return p.uiState.saveLoading=!1,void i.pop("warn","Missing Message Dates.","Please enter start and end dates for the broadcast message.");if(p.state.message.endDate){var e=new Date(p.state.message.endDate);e.setHours(23),e.setMinutes(59),e.setSeconds(59),p.state.message.endDate=e}return p.state.message&&!p.state.message._id?r.createMessage(p.state.message).then(function(e){i.pop("success","Message created","The message was created successfully.")}).catch(function(e){}).finally(function(){p.uiState.saveLoading=!1,c()}):p.state.message&&p.state.message._id?r.updateMessage(p.state.message,p.state.message._id).then(function(e){i.pop("success","Message saved","The message was saved successfully.")}).catch(function(e){}).finally(function(){p.uiState.saveLoading=!1}):void 0},p.backToMessages=c;t.$watch(function(){return r.messages},function(e){e&&("new"==p.messageId?p.state.message={}:p.state.message=_.find(e,function(e){return e._id==s.id}),a(function(){p.uiState.showMessageEditor=!0},1500))},!0);window.clickandInsertImageButton=function(e,t,n){p.callBackOnImageInsert=n,p.callBackImage=t,l("media-modal","MediaModalCtrl",0,"lg")}}])}(angular),function(e){app.controller("messagesCtrl",["$scope","$location","BroadcastMessagesService",function(t,n,a){var o=this;o.state={},o.uiState={loading:!0},o.editMessage=function(e){e||(e="new");var t="/customer/messages/"+e;n.url(t)},o.deleteMessage=function(e){return o.uiState.saveLoading=!0,a.deleteMessage(e).then(function(e){}).catch(function(e){}).finally(function(){o.uiState.saveLoading=!1})},o.stripHTML=function(e){return e.replace(/<\/?[^>]+(>|$)/g,"")};t.$watch(function(){return a.messages},function(t){e.isDefined(t)&&(o.state.messages=t,o.uiState.loading=!1)},!0)}])}(angular),function(){function e(e,t,n,a){function o(e){return i.loading.value=i.loading.value+1,e.finally(function(){i.loading.value=i.loading.value-1}),e}var i={},s="/api/2.0/insights/messages/";return i.loading={value:0},i.listBroadcastMessages=function(){return o(e.get(s).success(function(e){i.messages=e,i.messages.length?i.message=i.messages[0]:i.message={}}).error(function(e){}))},i.createMessage=function(t){return o(e({url:s,method:"POST",data:angular.toJson(t)}).success(function(e){var t=_.findIndex(i.messages,{_id:e._id});t>-1?i.messages[t]=e:i.messages.push(e),i.messages.length&&(i.message=i.messages[0])}).error(function(e){}))},i.updateMessage=function(t,n){return o(e({url:s+n,method:"POST",data:angular.toJson(t)}).success(function(e){var t=_.findIndex(i.messages,{_id:e._id});t>-1?i.messages[t]=e:i.messages.push(e),i.messages.length&&(i.message=i.messages[0])}).error(function(e){}))},i.deleteMessage=function(t){return o(e({url:s+t._id,method:"DELETE"}).success(function(e){var n=_.findIndex(i.messages,{_id:t._id});n>-1&&i.messages.length&&(i.messages.splice(n,1),i.message={})}).error(function(e){}))},a.getAccount(function(e){i.account=e,i.listBroadcastMessages()}),i}app.factory("BroadcastMessagesService",e),e.$inject=["$http","$q","$timeout","AccountService"]}(),angular,app.service("AccountService",["$http","$q",function(e,t){var n="/api/1.0/account/";this.mainAccount=null,this.getMainAccount=function(){return this.mainAccount},this.setMainAccount=function(e){this.mainAccount=e},this.getAccount=function(n){var a=t.defer();return e.get("/api/1.0/account/").success(function(e){n&&a.resolve(n(e))}).error(function(e){n(e,null)}),a.promise},this.getUpdatedAccount=function(t){e.get("/api/1.0/account/?hash_id="+Math.random()).success(function(e){t&&t(e)}).error(function(e){t(e,null)})},this.updateAccount=function(t,a){var o=n+[t._id].join("/");e.put(o,t).success(function(e){a(e)}).error(function(e){a(null,e)})},this.getUsersByAccount=function(t,a){var o=n+["users"].join("/");e.get(o).success(function(e,t,n,o){a(e)})},this.copyExitingUser=function(t,a){var o=n+["copyUser",t].join("/");e.post(o).success(function(e){a(null,e)}).error(function(e){a(e)})},this.addNewUser=function(t,a,o,i){var s=n+["user"].join("/"),r={username:a,password:o};e.post(s,r).success(function(e){i(null,e)}).error(function(e){i(e)})},this.addNewUserWithParams=function(t,a,o,i,s){var r=n+["user"].join("/");(i=i||{}).username=a,i.password=o,e.post(r,i).success(function(e){s(null,e)}).error(function(e){s(e)})},this.removeUserFromAccount=function(t,a){var o=n+["user",t].join("/");e.delete(o).success(function(e){a(null,e)}).error(function(e){a(e)})},this.setUserPassword=function(t,a,o){var i=n+["user",t,"password"].join("/"),s={password:a};e.post(i,s).success(function(e){o(null,e)}).error(function(e){o(e)})}}]),angular,app.service("AssetsService",["$http",function(e){this.getAssetsByAccount=function(t){var n="/api/1.0/"+["assets"].join("/");e.get(n).success(function(e){t(e)})},this.getPagedAssetsByAccount=function(t,n){var a="?limit="+t.limit+"&skip="+t.skip;t.filterType&&"all"!==t.filterType&&(a+="&filterType="+t.filterType),t.search&&(a+="&search="+t.search);var o="/api/1.0/"+["assets","paged","list"].join("/")+a;e.get(o).success(function(e){n(e)})},this.deleteAssets=function(e,t){e.forEach(function(e){this.deleteAssetById(e._id,t)},this)},this.deleteAssetById=function(t,n){var a="/api/1.0/"+["assets",t].join("/");e.delete(a).error(function(e,t){n(e,t)}).success(function(e,t){n(e,t)})},this.updateAsset=function(t,n){var a="/api/1.0/"+["assets",t._id].join("/");e.post(a,t).error(function(e,t){n(e,t)}).success(function(e,t){n(e,t)})},this.updateMatadata=function(t,n){var a="/api/1.0/"+["assets","cache",t._id].join("/");e.post(a,t).error(function(e,t){n(e,t)}).success(function(e,t){n(e,t)})}}]),function(e){app.service("CampaignService",["$http","$cacheFactory","$q",function(t,n,a){var o="/api/1.0/campaigns/",i=n("campaigns");this.getCampaigns=function(e){t.get("/api/1.0/campaigns/").success(function(t){i.put("campaigns",t),e(t)})},this.getCampaign=function(e,n){var i=o+e,s=a.defer();return t.get(i).success(function(e){n&&s.resolve(n(e))}).error(function(e){n(e,null)}),s.promise},this.createCampaign=function(e,n){var a=i.get("campaigns");t({url:"/api/1.0/campaigns/",method:"POST",data:e}).success(function(e){a&&(a.push(e),i.put("campaigns",a)),n(e)}).error(function(e){})},this.updateCampaign=function(e,n){var a=o+e._id;t({url:a,method:"POST",data:e}).success(function(e){n(e)}).error(function(e){})},this.activateCampaign=function(e,n){var a=o+e._id+"/activate";t({url:a,method:"POST",data:e}).success(function(e){n(e)}).error(function(e){})},this.cancelCampaignForContact=function(e,n,a){var i=o+[e._id,"contact",n].join("/");t({url:i,method:"DELETE",data:e}).success(function(e){a(e)}).error(function(e){})},this.duplicateCampaign=function(e,n,a){var i=o+[e,"duplicate"].join("/");t({url:i,method:"POST",data:n}).success(function(e){a(e)}).error(function(e){})},this.deleteCampaign=function(e,n){var a=o+[e].join("/");t({url:a,method:"DELETE"}).success(function(t){var a=i.get("campaigns");a=_.without(a,_.findWhere(a,{_id:e})),i.put("campaigns",a),n(t)}).error(function(e){})},this.bulkAddContactsToCampaign=function(e,n,a){var i=o+[n,"contacts"].join("/");t({url:i,method:"POST",data:e}).success(function(e){a(e)}).error(function(e){})},this.checkCampaignNameExists=function(t,n){this.getCampaigns(function(a){var o=_.find(a,function(n){return e.lowercase(n.name)===e.lowercase(t)});n(o?!0:!1)})},this.getCampaignContacts=function(e,n){var i=o+[e,"contacts"].join("/"),s=a.defer();return t.get(i).success(function(e){n&&s.resolve(n(e))}).error(function(e){n(e,null)}),s.promise},this.downloadReport=function(e){var t=o+[e,"statistics","opens"].join("/");window.location=t}}])}(angular),angular,app.service("ChartAnalyticsService",["SiteAnalyticsService","$q",function(e,t){this.secToTime=function(e){var t=parseInt(Math.floor(e/60),10),n=parseInt(e-60*t,10);return t=t<10?"0"+t:t,n=n<10?"0"+n:n,t+":"+n},Highcharts.setOptions({global:{useUTC:!1}}),this.getHostName=function(e){var t="",n=window.location.hostname;return t=n.indexOf(".local")>-1?e.subdomain+".indigenous.local":n.indexOf(".test.")>-1?n:e.subdomain+".indigenous.io",e.domain&&(t=e.domain),6===e._id&&n.indexOf(".local")<=0&&n.indexOf(".test")<=0&&(t="indigenous.io"),t},this.getCommaSeparatedHostNames=function(e){var t="",n=window.location.hostname;return t=n.indexOf(".local")>-1?e.subdomain+".indigenous.local":n.indexOf(".test.")>-1?n:e.subdomain+".indigenous.io",6===e._id&&n.indexOf(".local")<=0&&n.indexOf(".test")<=0&&(t="indigenous.io,www.indigneous.io"),e.customDomain&&(t+=","+e.customDomain+",www."+e.customDomain),e.alternateDomains&&_.each(e.alternateDomains,function(e){t+=","+e+",www."+e}),t},this.calculatePercentChange=function(e,t){if(e=parseInt(e,10),t=parseInt(t,10),0===e&&0===t)return 0;if(0===e)return"(n/a)";var n=(t-e)/e*100;return Math.round(100*n)/100},this.calculatePercentage=function(e,t){var n;return e=parseInt(e,10),t=parseInt(t,10),0===e&&0===t?0:(n=t<e?(e-t)/e*100:(t-e)/t*100,t===e&&(n=100),Math.round(100*n)/100)},this.countryToAbbr=function(e){var t=[{name:"United States",abbreviation:"United States of America"}];return _.each(t,function(t){t.name.toLowerCase()===e.toLowerCase()&&(e=t.abbreviation)}),e},this.stateToAbbr=function(e){var t;if(e){var n=[{name:"Alabama",abbreviation:"AL"},{name:"Alaska",abbreviation:"AK"},{name:"American Samoa",abbreviation:"AS"},{name:"Arizona",abbreviation:"AZ"},{name:"Arkansas",abbreviation:"AR"},{name:"California",abbreviation:"CA"},{name:"Colorado",abbreviation:"CO"},{name:"Connecticut",abbreviation:"CT"},{name:"Delaware",abbreviation:"DE"},{name:"District Of Columbia",abbreviation:"DC"},{name:"Federated States Of Micronesia",abbreviation:"FM"},{name:"Florida",abbreviation:"FL"},{name:"Georgia",abbreviation:"GA"},{name:"Guam",abbreviation:"GU"},{name:"Hawaii",abbreviation:"HI"},{name:"Idaho",abbreviation:"ID"},{name:"Illinois",abbreviation:"IL"},{name:"Indiana",abbreviation:"IN"},{name:"Iowa",abbreviation:"IA"},{name:"Kansas",abbreviation:"KS"},{name:"Kentucky",abbreviation:"KY"},{name:"Louisiana",abbreviation:"LA"},{name:"Maine",abbreviation:"ME"},{name:"Marshall Islands",abbreviation:"MH"},{name:"Maryland",abbreviation:"MD"},{name:"Massachusetts",abbreviation:"MA"},{name:"Michigan",abbreviation:"MI"},{name:"Minnesota",abbreviation:"MN"},{name:"Mississippi",abbreviation:"MS"},{name:"Missouri",abbreviation:"MO"},{name:"Montana",abbreviation:"MT"},{name:"Nebraska",abbreviation:"NE"},{name:"Nevada",abbreviation:"NV"},{name:"New Hampshire",abbreviation:"NH"},{name:"New Jersey",abbreviation:"NJ"},{name:"New Mexico",abbreviation:"NM"},{name:"New York",abbreviation:"NY"},{name:"North Carolina",abbreviation:"NC"},{name:"North Dakota",abbreviation:"ND"},{name:"Northern Mariana Islands",abbreviation:"MP"},{name:"Ohio",abbreviation:"OH"},{name:"Oklahoma",abbreviation:"OK"},{name:"Oregon",abbreviation:"OR"},{name:"Palau",abbreviation:"PW"},{name:"Pennsylvania",abbreviation:"PA"},{name:"Puerto Rico",abbreviation:"PR"},{name:"Rhode Island",abbreviation:"RI"},{name:"South Carolina",abbreviation:"SC"},{name:"South Dakota",abbreviation:"SD"},{name:"Tennessee",abbreviation:"TN"},{name:"Texas",abbreviation:"TX"},{name:"Utah",abbreviation:"UT"},{name:"Vermont",abbreviation:"VT"},{name:"Virgin Islands",abbreviation:"VI"},{name:"Virginia",abbreviation:"VA"},{name:"Washington",abbreviation:"WA"},{name:"West Virginia",abbreviation:"WV"},{name:"Wisconsin",abbreviation:"WI"},{name:"Wyoming",abbreviation:"WY"}];_.each(n,function(n){n.name.toLowerCase()===e.toLowerCase()&&(t=n.abbreviation)})}return t||!1},this.mergeLiveTrafficData=function(e){var t=_.filter(e,function(e){return e["referrer.domain"]&&0===e["referrer.domain"].indexOf("www.")}),n=_.filter(e,function(e){return!e["referrer.domain"]||0!==e["referrer.domain"].indexOf("www.")});return _.each(t,function(e){var t=_.find(n,function(t){return t["referrer.domain"]==e["referrer.domain"].replace("www.","")});t?t.result+=e.result:n.push({"referrer.domain":e["referrer.domain"],result:e.result})}),n};moment().subtract(60,"days").format(),moment().subtract(30,"days").format();this.setGraunularity=function(e){this.granularity="days","hours"===e&&(this.granularity="hours")},this.queryReports=function(e,t,n){return{}},this.runIndividualMongoReports=function(t,n,a){e.runIndividualReports(t.startDate,t.endDate,null,!1,!1,function(e){a(e)})},this.runMongoReports=function(t,n,a){e.runReports(t.startDate,t.endDate,function(e){a(e)})},this.runCustomerReports=function(t,n,a){e.runCustomerReports(t.startDate,t.endDate,n,function(e){a(e)})},this.runIndividualAdminMongoReports=function(t,n,a){e.runIndividualReports(t.startDate,t.endDate,null,!0,!1,function(e){a(e)})},this.runAdminMongoReports=function(t,n,a){e.runAdminReports(t.startDate,t.endDate,function(e){a(e)})},this.getFrontrunnerSitesPageviews=function(t,n,a,o){e.getFrontrunnerSitesPageviews(t.startDate,t.endDate,a,function(e){o(e)})},this.getPlatformTraffic=function(t){e.runPlatformTraffic(t)},this.getPlatformTrafficDetails=function(t){e.runPlatformTrafficDetails(t)},this.getSiteAnalyticsTraffic=function(t){e.runSiteAnlyticsTraffic(t)},this.runReports=function(e,t,n){this.getHostName(t),this.getCommaSeparatedHostNames(t);n({})},this.runPagedReports=function(e,t,n){var a=[],o=(this.getHostName(t),this.getCommaSeparatedHostNames(t));a.push({property_name:"url.domain",operator:"in",property_value:o.split(",")});var i={};e.startDate,e.endDate;n(i)},this.visitorsReport=function(e,t,n){this.getHostName(t);n({})},this.queryVisitorReports=function(e,t){return{}},this.getDailyActiveUsers=function(t,n,a,o){e.getDailyActiveUsers(n,a,t,!0,!1,function(e){o(e)})},this.getUserTopSearches=function(t,n,a,o){e.getUserTopSearches(n,a,t,!1,!1,function(e){o(e)})},this.getMostActiveUsers=function(t,n,a,o){e.getMostActiveUsers(n,a,t,!1,!1,function(e){o(e)})},this.getVisitorOverviewChartData=function(n,a,o,i,s){var r,c,l,u,d,p=[];p.push(e.getPageviews(n.startDate,n.endDate,a,o,i,function(e){r=e})),p.push(e.getUsers(n.startDate,n.endDate,a,o,i,function(e){c=e})),p.push(e.getSessions(n.startDate,n.endDate,a,o,i,function(e){l=e})),p.push(e.getDailyActiveUsers(n.startDate,n.endDate,a,o,i,function(e){u=e})),p.push(e.getFourOFours(n.startDate,n.endDate,a,o,i,function(e){d=e})),t.all(p).then(function(e){s(null,r,c,l,u,d)})},this.getPageAnalyticsChartData=function(t,n,a,o,i){e.getPageAnalytics(t.startDate,t.endDate,n,a,o,function(e){i(e)})},this.getVisitorLocationsChartData=function(n,a,o,i,s){var r,c,l=[];l.push(e.getVisitorLocations(n.startDate,n.endDate,a,o,i,function(e){r=e})),l.push(e.getVisitorLocationsByCountry(n.startDate,n.endDate,a,o,i,function(e){c=e})),t.all(l).then(function(e){s(null,r,c)})},this.getContentInteractionAndTrafficeSourcesChartData=function(n,a,o,i,s){var r,c,l=[];l.push(e.getSessionLength(n.startDate,n.endDate,a,o,i,function(e){r=e})),l.push(e.getTrafficSources(n.startDate,n.endDate,a,o,i,function(e){c=e})),t.all(l).then(function(e){s(null,r,c)})},this.getDeviceNewReturningChartData=function(n,a,o,i,s){var r,c,l=[];l.push(e.getVisitorDevices(n.startDate,n.endDate,a,o,i,function(e){r=e})),l.push(e.getNewVsReturning(n.startDate,n.endDate,a,o,i,function(e){c=e})),t.all(l).then(function(e){s(null,r,c)})},this.getUserAgentsOSRevenueEmailsChartData=function(n,a,o,i,s){var r,c,l,u,d=[];d.push(e.getUserAgents(n.startDate,n.endDate,a,o,i,function(e){r=e})),d.push(e.getOS(n.startDate,n.endDate,a,o,i,function(e){c=e})),d.push(e.getRevenue(n.startDate,n.endDate,a,o,i,function(e){l=e})),d.push(e.getEmails(n.startDate,n.endDate,a,o,i,function(e){u=e})),t.all(d).then(function(e){s(null,r,c,l,u)})},this.getUserAgentsAndOSChartData=function(n,a,o,i,s){var r,c,l=[];l.push(e.getUserAgents(n.startDate,n.endDate,a,o,i,function(e){r=e})),l.push(e.getOS(n.startDate,n.endDate,a,o,i,function(e){c=e})),t.all(l).then(function(e){s(null,r,c)})},this.getRevenueChartData=function(n,a,o,i,s){var r,c=[];c.push(e.getRevenue(n.startDate,n.endDate,a,o,i,function(e){r=e})),t.all(c).then(function(e){s(null,r)})},this.getEmailChartData=function(n,a,o,i,s){var r,c=[];c.push(e.getEmails(n.startDate,n.endDate,a,o,i,function(e){r=e})),t.all(c).then(function(e){s(null,r)})},this.pageDepth=function(){return{options:{chart:{plotBackgroundColor:null,plotBorderWidth:0,plotShadow:!1,spacing:[25,25,25,25]},title:{text:""},tooltip:{pointFormat:"{point.x}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{dataLabels:{enabled:!0,distance:-50,style:{fontWeight:"bold",color:"white",textShadow:"0px 1px 2px black"}},colors:["#41b0c7","#fcb252","#309cb2","#f8cc49","#f8d949"]}},exporting:{enabled:!1}},series:[{type:"pie",name:"Gender",innerSize:"40%",data:[["Male",44.3],["Female",55.7]]}],credits:{enabled:!1}}},this.analyticsOverview=function(e,t,n,a,o,i,s,r){var c={options:{chart:{spacing:[25,25,25,25],zoomType:"x",pinchType:"x"},colors:["#41b0c7","#fcb252","#993300"],title:{text:null},subtitle:{text:""},tooltip:{headerFormat:"<b>{point.x:%b %d}</b><br>",pointFormat:'<b class="text-center">{point.y}</b>'},legend:{enabled:!0},exporting:{enabled:!1},plotOptions:{series:{marker:{enabled:!0,radius:3},events:{legendItemClick:function(e){s("analytics",this.name,!this.visible)}}}}},xAxis:{type:"datetime",labels:{format:"{value:%b %d}"}},yAxis:{min:0,title:{text:""}},series:[{name:"Visitors",data:n,visible:i("Visitors","analytics")},{name:"Visits",data:t,visible:i("Visits","analytics")},{name:"Pageviews",data:e,visible:i("Pageviews","analytics")},{name:"404views",data:o,visible:i("404views","analytics")}],credits:{enabled:!1}};a&&(c.series.push({name:"Daily Active Users",data:a,visible:i("Daily Active Users","analytics")}),c.options.colors.push("#f8cc49")),"hours"===this.granularity&&(c.xAxis.labels.format="{value:%b %d %H:%M}",c.options.tooltip.headerFormat="<b>{point.x:%b %d %H:%M}</b><br>"),r(c)},this.getActiveUserConfig=function(e,t){var n={options:{chart:{spacing:[25,25,25,25],zoomType:"x",pinchType:"x"},colors:["#41b0c7"],title:{text:null},subtitle:{text:""},tooltip:{headerFormat:"<b>{point.x:%b %d}</b><br>",pointFormat:'<b class="text-center">{point.y}</b>'},legend:{enabled:!0},exporting:{enabled:!1},plotOptions:{series:{marker:{enabled:!0,radius:3},events:{legendItemClick:function(e){}}}}},xAxis:{type:"datetime",labels:{format:"{value:%b %d}"}},yAxis:{min:0,title:{text:""}},series:[{name:"Daily Active Users",data:e}],credits:{enabled:!1}};"hours"===this.granularity&&(n.xAxis.labels.format="{value:%b %d %H:%M}",n.options.tooltip.headerFormat="<b>{point.x:%b %d %H:%M}</b><br>"),t(n)},this.emailsOverview=function(e,t,n,a,o){var i={options:{chart:{spacing:[25,25,25,25],zoomType:"x",pinchType:"x"},colors:["#41b0c7","#fcb252","#993300","#f8cc49","#f8d949"],title:{text:null},subtitle:{text:""},tooltip:{headerFormat:"<b>{point.x:%b %d}</b><br>",pointFormat:'<b class="text-center">{point.y}</b>'},legend:{enabled:!0},exporting:{enabled:!1},plotOptions:{series:{marker:{enabled:!0,radius:3}}}},xAxis:{type:"datetime",labels:{format:"{value:%b %d}"}},yAxis:{allowDecimals:!1,min:0,title:{text:""}},series:[{name:"Emails",data:e},{name:"Opens",data:n},{name:"Clicks",data:a},{name:"Campaigns",data:t}],credits:{enabled:!1}};"hours"===this.granularity&&(i.xAxis.labels.format="{value:%b %d %H:%M}",i.options.tooltip.headerFormat="<b>{point.x:%b %d %H:%M}</b><br>"),o(i)},this.frontrunnerSitesPageviews=function(e,t,n){var a={options:{chart:{spacing:[25,25,25,25,25],zoomType:"x",pinchType:"x"},colors:["#41b0c7","#fcb252","#993300","#f8cc49","#008000"],title:{text:null},subtitle:{text:""},tooltip:{headerFormat:"<b>{point.x:%b %d}</b><br>",pointFormat:'<b class="text-center">{point.y}</b>'},legend:{enabled:!0},exporting:{enabled:!1},plotOptions:{series:{marker:{enabled:!0,radius:3}}}},xAxis:{type:"datetime",labels:{format:"{value:%b %d}"}},yAxis:{allowDecimals:!1,min:0,title:{text:""}},series:t,credits:{enabled:!1}};"hours"===this.granularity&&(a.xAxis.labels.format="{value:%b %d %H:%M}",a.options.tooltip.headerFormat="<b>{point.x:%b %d %H:%M}</b><br>"),n(a)},this.timeOnSite=function(e,t,n){var a={options:{chart:{spacing:[25,25,25,25],height:360,zoomType:"x",pinchType:"x"},colors:["#41b0c7","#fcb252"],title:{text:""},subtitle:{text:""},tooltip:{headerFormat:"<b>{point.x:%b %d}</b><br>",pointFormat:'<b class="text-center">{point.y}</b>'},legend:{enabled:!0},exporting:{enabled:!1},plotOptions:{series:{marker:{enabled:!0,radius:3}}}},xAxis:{type:"datetime",labels:{format:"{value:%b %d}"}},yAxis:{title:{text:""}},series:[{name:"Visitors",data:e},{name:"Bounces",data:t}],credits:{enabled:!1}};"hours"===this.granularity&&(a.xAxis.labels.format="{value:%b %d %H:%M}",a.options.tooltip.headerFormat="<b>{point.x:%b %d %H:%M}</b><br>"),n(a)},this.trafficSources=function(e,t){t({options:{chart:{plotBackgroundColor:null,plotBorderWidth:0,plotShadow:!1,spacing:[25,25,25,25],height:300},title:{text:""},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{dataLabels:{enabled:!0,distance:-50,style:{fontWeight:"bold",color:"white",textShadow:"0px 1px 2px black"}},colors:["#41b0c7","#fcb252","#309cb2","#f8cc49","#f8d949"]}},exporting:{enabled:!1}},series:[{type:"pie",name:"Traffic Source",innerSize:"40%",data:e}],credits:{enabled:!1}})},this.newVsReturning=function(e,t){t({options:{chart:{height:300},colors:["#41b0c7","#fcb252","#309cb2","#f8cc49","#f8d949"],title:{text:""},legend:{enabled:!0},exporting:{enabled:!1}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:"Browser share",data:e}],yAxis:{title:{text:"Visitors"}},credits:{enabled:!1}})},this.visitorLocationsGlobal=function(e,t,n,a){var o={data:n,mapData:Highcharts.maps["custom/world"],joinBy:["name","code"],animation:!0,name:"# of Visitors",states:{hover:{color:"#BADA55"}},tooltip:{pointFormat:"{point.code}: {point.value}"}};if($("#visitor_locations_global").length)new Highcharts.Map({chart:{renderTo:"visitor_locations_global",height:360,zoomType:!1},title:{text:""},exporting:{enabled:!1},legend:{enabled:!1},mapNavigation:{buttonOptions:{align:"right",verticalAlign:"bottom"},enableButtons:!1,enableDoubleClickZoom:!1,enableTouchZoom:!1},colorAxis:{min:1,type:"logarithmic",minColor:"#4cb0ca",maxColor:"#224f5b"},series:[o],xAxis:{},credits:{enabled:!1}})},this.visitorLocations=function(e,t,n,a){var o={animation:{duration:1e3},data:e,mapData:t,joinBy:["postal-code","code"],dataLabels:{enabled:!1},name:"# of Visitors",tooltip:{pointFormat:"{point.code}: {point.value}"}};if($("#visitor_locations").length)new Highcharts.Map({chart:{renderTo:"visitor_locations",height:360,zoomType:!1},title:{text:""},exporting:{enabled:!1},legend:{enabled:!1},mapNavigation:{buttonOptions:{align:"right",verticalAlign:"bottom"},enableButtons:!1,enableDoubleClickZoom:!1,enableTouchZoom:!1},colorAxis:{min:1,type:"logarithmic",minColor:"#4cb0ca",maxColor:"#224f5b"},series:[o],xAxis:{},credits:{enabled:!1}})},this.visitorLocationsPlatform=function(e,t,n,a){var o={animation:{duration:0},data:e,mapData:t,joinBy:["postal-code","code"],dataLabels:{enabled:!1},name:"# of Visitors",tooltip:{pointFormat:"{point.code}: {point.value}"}};if($("#live-platform-visitor-locations").length)new Highcharts.Map({chart:{renderTo:"live-platform-visitor-locations",height:240,zoomType:!1,backgroundColor:"rgba(255, 255, 255, 0.1)"},title:{text:""},exporting:{enabled:!1},legend:{enabled:!1},mapNavigation:{enableButtons:!1,enableDoubleClickZoom:!1,enableTouchZoom:!1},colorAxis:{min:1,type:"logarithmic",minColor:"#7cb5ec",maxColor:"#224f5b"},series:[o],xAxis:{},credits:{enabled:!1}})},this.visitorLocationsDOHY=function(e,t,n,a){var o={animation:{duration:0},data:e,mapData:t,joinBy:["postal-code","code"],dataLabels:{enabled:!1},name:"# of Visitors",tooltip:{pointFormat:"{point.code}: {point.value}"}};if($("#visitor_locations").length)new Highcharts.Map({chart:{renderTo:"visitor_locations",height:240,zoomType:!1,backgroundColor:"rgba(255, 255, 255, 0.1)"},title:{text:""},exporting:{enabled:!1},legend:{enabled:!1},mapNavigation:{enableButtons:!1,enableDoubleClickZoom:!1,enableTouchZoom:!1},colorAxis:{min:1,type:"logarithmic",minColor:"#7cb5ec",maxColor:"#224f5b"},series:[o],xAxis:{},credits:{enabled:!1}})},this.userAgentChart=function(e,t){t({options:{chart:{height:300},colors:["#41b0c7","#fcb252","#309cb2","#f8cc49","#f8d949"],title:{text:""},legend:{enabled:!0},exporting:{enabled:!1}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:"User Agents",data:e}],yAxis:{title:{text:"Visitors"}},credits:{enabled:!1}})},this.osChart=function(e,t){t({options:{chart:{height:300},colors:["#41b0c7","#fcb252","#309cb2","#f8cc49","#f8d949"],title:{text:""},legend:{enabled:!0},exporting:{enabled:!1}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:"OS",data:e}],yAxis:{title:{text:"Visitors"}},credits:{enabled:!1}})},this.revenueOverview=function(e,t){var n={options:{chart:{spacing:[25,25,25,25],zoomType:"x",pinchType:"x"},colors:["#41b0c7","#fcb252","#993300","#f8cc49","#f8d949"],title:{text:null},subtitle:{text:""},tooltip:{headerFormat:"<b>{point.x:%b %d}</b><br>",pointFormat:'<b class="text-center">{point.y}</b>'},legend:{enabled:!0},exporting:{enabled:!1},plotOptions:{series:{marker:{enabled:!0,radius:3}}}},xAxis:{type:"datetime",labels:{format:"{value:%b %d}"},minTickInterval:4,categories:e.xData},yAxis:[{labels:{format:"{value}"},title:{text:"Number Orders"},opposite:!0},{title:{text:"Revenue"},labels:{format:"${value:.2f} USD"}}],series:[{name:"Orders",type:"bar",yAxis:0,data:e.orderData,tooltip:{valueSuffix:" orders"}},{name:"Revenue",type:"spline",yAxis:1,data:e.amountData,tooltip:{valueSuffix:" USD",valuePrefix:"$",pointFormat:"${point.y:.2f} USD"}}],credits:{enabled:!1}};"hours"===this.granularity&&(n.xAxis.labels.format="{value:%b %d %H:%M}",n.options.tooltip.headerFormat="<b>{point.x:%b %d %H:%M}</b><br>"),t(n)},this.liveTraffic=function(e,t){return{options:{chart:{type:"column",backgroundColor:"rgba(255, 255, 255, 0.1)"},colors:["#7cb5ec"],title:{text:""},legend:{enabled:!1},exporting:{enabled:!1},tooltip:{formatter:function(){return moment(new Date).subtract("minutes",60-this.x).format("hh:mma")+": <b>"+this.y+"</b>"}}},xAxis:{labels:{enabled:!1,step:5}},yAxis:{allowDecimals:!1,min:0,minTickInterval:1,title:{text:"Visitors"}},size:{height:240},plotOptions:{},credits:{enabled:!1},series:[{name:"Visitors",data:e}]}},this.salesDemoChart=function(e){e({options:{chart:{type:"column",backgroundColor:"rgba(255, 255, 255, 0.1)"},colors:["#32CD32","#30D1E1"],title:{text:""},legend:{enabled:!1},exporting:{enabled:!1},tooltip:{},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!1,color:Highcharts.theme&&Highcharts.theme.dataLabelsColor||"white"}}}},xAxis:{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},yAxis:{allowDecimals:!1,min:0,minTickInterval:1,title:{text:""}},series:[{name:"Views",data:[5,3,4,7,2,8,10,6,8,9,2,1]},{name:"Sales",data:[3,4,4,2,5,6,4,9,2,8,3,6]}]})},Highcharts.setOptions({lang:{thousandsSep:","}})}]),angular,app.service("ChartCommerceService",["PaymentService",function(e){this.calculatePercentage=function(e,t){var n;return e=parseInt(e,10),t=parseInt(t,10),0===e&&0===t?0:(n=t<e?(e-t)/e*100:(t-e)/t*100,t===e&&(n=100),Math.round(100*n)/100)},this.queryReports=function(){return{}},this.runReports=function(t){var n=this,a={};e.getCustomers(function(e){n.customers=e,n.totalCustomers=e.length,t(a)})},this.queryNetRevenueReport=function(){var e={};return e.netRevenueThisMonth=new Keen.Query("sum",{eventCollection:"Stripe_Events",targetProperty:"data.object.amount",timeframe:"this_month",interval:"daily",filters:[{property_name:"type",operator:"eq",property_value:"charge.succeeded"},{property_name:"accountId",operator:"eq",property_value:$$.server.accountId}]}),e.netRevenueCharges=new Keen.Query("count",{eventCollection:"Stripe_Events",timeframe:"this_month",filters:[{property_name:"type",operator:"eq",property_value:"charge.succeeded"},{property_name:"accountId",operator:"eq",property_value:$$.server.accountId}]}),e.lastCharge=new Keen.Query("extraction",{eventCollection:"Stripe_Events",latest:1,filters:[{property_name:"type",operator:"eq",property_value:"charge.succeeded"},{property_name:"accountId",operator:"eq",property_value:$$.server.accountId}]}),e},this.runNetRevenuReport=function(t){var n=this;e.getCustomers(function(e){n.customers=e,n.totalCustomers=e.length,t(e)})},this.customerOverview=function(e,t,n,a,o){o({options:{chart:{spacing:[25,25,25,25]},colors:["#41b0c7","#fcb252","#309cb2","#f8cc49"],title:{text:""},tooltip:{pointFormat:"<b>{point.y}</b>"},exporting:{enabled:!1}},xAxis:{type:"datetime",labels:{format:"{value:%b %d}"},minRange:2592e6},yAxis:{min:0,max:Math.max.apply(Math,e)+100,title:{text:""}},series:[{type:"area",name:"Customers",pointInterval:864e5,pointStart:Date.parse(t),data:e},{type:"area",name:"Cancellations",pointInterval:864e5,pointStart:Date.parse(a),data:n}],credits:{enabled:!1}})}}]),angular,app.service("ChartEmailService",["$q",function(e){this.queryMandrillData=function(t,n){return e.defer().promise},this.formatEmails=function(e,t){return _.each(e,function(e){var n,a,o,i=_.find(t.emailsSent,function(t){return t["msg.metadata.emailId"]===e._id});i&&(n=i.result);var s=_.find(t.emailsOpen,function(t){return t["msg.metadata.emailId"]===e._id});s&&(a=s.result);var r=_.find(t.emailsClick,function(t){return t["msg.metadata.emailId"]===e._id});r&&(o=r.result),n&&a&&(e.openRate=Math.round(a/n*100)+"%",e.sent=n),n&&!a&&(e.openRate="0%",e.sent=n),o&&n&&(e.clickRate=Math.round(o/n*100)+"%",e.clicks=o),n&&!o&&(e.clickRate="0%",e.clicks=o||0)}),e}}]),function(e){app.service("CommonService",["$http",function(t){this.generateUniqueAlphaNumericShort=function(){return this.generateUniqueAlphaNumeric()},this.generateUniqueAlphaNumeric=function(t,n,a){e.isDefined(t)&&null!==t&&0!==t||(t=10);var o;if(t<=10&&!0!==n)return t<=10&&(NaN==(o=(new Date).getTime()*parseInt(Math.random()+1,10)*1e3+(new Date).getTime().toString(36))||void 0===o)?this.generateUniqueAlphaNumeric():o.substring(0,t);var i,s={min:49,max:57},r={min:65,max:90},c={min:97,max:122},l=[];for(i=c.min;i<=c.max;i++)l.push(String.fromCharCode(i));if(!0!==a)for(i=r.min;i<=r.max;i++)l.push(String.fromCharCode(i));if(!0!==n){var u=l.length/10/2,d=0;for(d;d<u;d++)for(i=s.min;i<=s.max;i++)l.push(String.fromCharCode(i))}for(var p="",m=l.length,g=null;p.length<t;)null!==(g=l[Math.round(Math.random()*m)])&&(p+=g);return p},this.getUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}}])}(angular),function(e){app.service("ContactService",["$http","$rootScope","$cacheFactory","ImportContactService","contactConstant","userConstant","formValidations","$q",function(t,n,a,o,i,s,r,c){var l="/api/1.0/";this.getCache=function(){var e=a.get("ContactService");return e||a("ContactService")},this.getContacts=function(e){var n=l+["contact"].join("/");return t.get(n).success(function(t){e(t)})},this.getContactsCount=function(e){var n=l+["contact","count"].join("/");return t.get(n).success(function(t){e(t)})},this.getPagedContacts=function(n,a,o){var i=["contact","paged","list"],s="GET",r="?limit="+n.limit+"&skip="+n.skip;n.sortBy&&(r+="&sortBy="+n.sortBy+"&sortDir="+n.sortDir),n.globalSearch&&(r+="&term="+encodeURIComponent(n.globalSearch)),a&&(s="GET",i.push("filter"),_.each(n.fieldSearch,function(e,t){null!=e&&(r+="&"+t+"="+encodeURIComponent(e))}));var c=l+i.join("/")+r;return t({url:c,method:s,data:e.toJson(n.fieldSearch)}).success(function(e){o(e)})},this.getTotalContacts=function(e){var n=l+["contact","count"].join("/");return t({url:n,method:"GET"}).success(function(t){e(t)})},this.getContactsShortForm=function(e,n){var a=l+["contact","shortform"].join("/"),o=this.getCache().get("contacts"),i=this.getCache();o?n(o):t({url:a,method:"GET",params:{fields:e}}).success(function(e){i.put("contacts",e),n(e)})},this.getContact=function(e,n){var a=l+["contact",e].join("/");t.get(a).success(function(e){n(e)}).error(function(e){n(null,e)})},this.deleteContact=function(e,n){var a=this.getCache().get("contacts");a&&(a.forEach(function(t,n){t._id===e&&a.splice(n,1)}),this.getCache().put("contacts",a));var o=l+["contact",e].join("/");t.delete(o).success(function(e){n(e)})},this.deleteContactPromise=function(e){var n=this.getCache().get("contacts");n&&(n.forEach(function(t,a){t._id===e&&n.splice(a,1)}),this.getCache().put("contacts",n));var a=l+["contact",e].join("/");return t.delete(a)},this.postContact=function(e,n,a){var o=e.get("contacts"),i=l+["contact"].join("/");t.post(i,n).success(function(t){o&&(o.push(t),e.put("contacts",o)),a(t)})},this.putContact=function(e,n,a){var o=e.get("contacts"),i=l+["contact"].join("/");t.put(i,n).success(function(t){o&&(o.forEach(function(e,t){e._id===n._id&&(o[t]=n)}),e.put("contacts",o)),a(t)})},this.putContactPromise=function(e){var n=this.getCache(),a=c.defer(),o=n.get("contacts"),i=l+["contact"].join("/");return t.put(i,e).success(function(t){o&&(o.forEach(function(t,n){t._id===e._id&&(o[n]=e)}),n.put("contacts",o)),a.resolve(t)}).error(function(e){a.reject(e)}),a.promise},this.saveContact=function(e,t){(e._id?this.putContact:this.postContact)(this.getCache(),e,t)},this.addContactNote=function(e,n){var a=l+"contact/"+e.data_contact+"/contactDetail";t.post(a,{note:e.email_send}).success(function(e){n(e)})};var u=0,d=[];this.resetCount=function(){u=0},this.importCsvContacts=function(t,a){var o=this;t&&(d=function t(n){_.each(n,function(a,o){""===a||null===a?delete n[o]:"[object Object]"===Object.prototype.toString.call(a)?t(a):e.isArray(a)&&_.each(a,function(e,n){t(e)})})}(t),d=t),a&&(o.passedFn=a),o.postContact(o.getCache(),d[u],function(){u<d.length-1&&(n.$broadcast("importingContacts",{current:u+1,total:d.length}),u++,o.importCsvContacts()),u===d.length-1&&n.$broadcast("importingContacts",{current:u+1,total:d.length})})},this.getGeoSearchAddress=function(e,n){var a=l+["geo","search","address",e].join("/");t.get(a).success(function(e){n(e)})},this.postFullContact=function(e,n){var a=l+["contact",e,"fullcontact"].join("/");t.post(a,{_id:e}).success(function(e){n(e)})},this.contactTags=function(e){var t=i.contact_tags.dp;t=t.concat(s.contact_types.dp);var n=[];return e.tags&&(n=_.map(e.tags,function(e){var n=_.findWhere(t,{data:e});return n?n.label:e})),n.join(", ")},this.checkBestEmail=function(e){if(e&&e.details&&e.details.length>0){var t=_.findWhere(e.details,{type:s.social_types.GOOGLE});if(t&&t.emails.length>0&&t.emails[0].email)return e.email=t.emails[0].email,e.email;var n=e.details[0];return!!(n&&n.emails&&n.emails.length>0&&n.emails[0].email)&&(e.email=n.emails[0].email,e.email)}},this.checkContactBestEmail=function(e){if(e&&e.details&&e.details.length>0){var t=_.findWhere(e.details,{type:s.social_types.GOOGLE});if(t&&t.emails.length>0&&t.emails[0].email)return t.emails[0].email;var n=e.details[0];return!!(n&&n.emails&&n.emails.length>0&&n.emails[0].email)&&n.emails[0].email}},this.checkFacebookId=function(e){if(e&&e.details&&e.details.length>0){var t=_.findWhere(e.details,{type:s.social_types.FACEBOOK});return!(!t||null===t)&&(e.facebookId=t.socialId,!0)}},this.checkTwitterId=function(e){if(e&&e.details&&e.details.length>0){var t=_.findWhere(e.details,{type:s.social_types.TWITTER});return!!t&&(e.twitterId=t.socialId,!0)}},this.checkLinkedInId=function(e){if(e&&e.details&&e.details.length>0){var t=_.findWhere(e.details,{type:s.social_types.LINKEDIN});if(t){if(null!==t.websites&&t.websites.length>0){var n=_.find(t.websites,function(e){return null!==e});if(n)return e.linkedInUrl=n,!0}return e.linkedInId=t.socialId,!0}return!1}},this.checkGoogleId=function(e){if(e.details&&e.details.length>0){var t=_.findWhere(e.details,{type:s.social_types.GOOGLE});if(t){if(t.websites&&t.websites.length>0){var n=_.find(t.websites,function(e){return null!==e});if(n)return e.googleUrl=n,!0}return e.googleId=t.socialId,!0}return!1}},this.checkAddress=function(e){var t=null;if(e&&e.details&&e.details.length>0&&e.details&&e.details[0].addresses&&e.details[0].addresses.length>0){var n="";return(t=e.details[0].addresses[0]).lat&&""!==t.lat&&""!==t.lon&&(n=t.lat.concat(",",t.lon)),e.address=encodeURIComponent(n),e.address}return!1},this.getContactActivities=function(e,n){var a=l+["contact",e,"activity"].join("/");t.get(a).success(function(e){n(e)})},this.getContactUnreadActivities=function(e,n){var a=l+["contact",e,"activity","unread"].join("/");t.get(a).success(function(e){n(e)})},this.getAllContactActivities=function(e){var n=l+["contact","activities"].join("/");t.get(n).success(function(t){e(t)})},this.getAllContactActivitiesWithLimit=function(e,n){var a=l+["contact","activities"].join("/");t({url:a,method:"GET",params:e}).success(function(e){n(e)})},this.getAllContactUnreadActivities=function(e){var n=l+["contact","activities","unread"].join("/");t.get(n).success(function(t){e(t)})},this.postContactActivity=function(e,n){var a=l+["contact","activity"].join("/");t.post(a,e).success(function(e){n(e)})},this.getActivityTypes=function(e){e(i.contact_activity_types.dp)},this.getContactTags=function(e){e(i.contact_tags.dp)},this.getTagFromLabel=function(e){var t=e,n=i.contact_tags.dp;return"No Tag"===e?t="NOTAG":_.each(n,function(n){n.label===e&&(t=n.data)}),t},this.getAllContactTags=function(e,t){var n=i.contact_tags.dp,a=[];_.each(e,function(e){e.tags&&_.each(e.tags,function(e){_.find(n,function(t){return t.data===e})||a.push({label:e.replace(/^\s+|\s+$|\s+(?=\s)/g,""),data:e.replace(/^\s+|\s+$|\s+(?=\s)/g,"")})})}),t(n=_.uniq(n.concat(a),function(e){return e.label}))},this.tagToContact=function(e,t){if(r.contactTags.test(e))var n={label:e,data:e};return n},this.importFacebookFriends=function(e){o.importContacts(s.social_types.FACEBOOK,e,function(t,n){e(t,n)})},this.importLinkedInConnections=function(e){o.importContacts(s.social_types.LINKEDIN,e,function(t,n){e(t,n)})},this.importGmailContacts=function(e){o.importContacts(s.social_types.GOOGLE,e,function(t,n){e(t,n)})},this.createContact=function(e){var n=l+["contact"].join("/");return t.post(n,e)},this.checkDuplicateEmail=function(e,n,a){if(n&&e){var o=l+["contact","search","email",e].join("/");t.get(o).success(function(e){a(e)})}else a(null)},this.exportCsvContacts=function(e,t){var n=l+["contact","export","csv"].join("/");if(e)n=n+"?"+_.map(e,function(e){return"ids="+e}).join("&");else{var a="skip=0";t.sortBy&&(a+="&sortBy="+t.sortBy+"&sortDir="+t.sortDir),t.globalSearch&&(a+="&term="+encodeURIComponent(t.globalSearch)),t.fieldSearch&&_.each(t.fieldSearch,function(e,t){null!=e&&(a+="&"+t+"="+encodeURIComponent(e))}),n=n+"?"+a}window.location=n},this.listAllContactTags=function(e){var n=l+["contact","tags"].join("/");t.get(n).success(function(t){e(t)})},this.getContactTagCounts=function(e){var n=l+["contact","tagcounts"].join("/");t.get(n).success(function(t){e(t)})},this.fomatContactTags=function(e,t){var n=i.contact_tags.dp,a=[];_.each(e,function(e){_.find(n,function(t){return t.data===e})||a.push({label:e.replace(/^\s+|\s+$|\s+(?=\s)/g,""),data:e.replace(/^\s+|\s+$|\s+(?=\s)/g,"")})}),t(n=_.uniq(n.concat(a),function(e){return e.label}))}}])}(angular),function(){function e(e,t,n){var a={skip:0,page:1,fieldSearch:{}};return a.setTotalCount=function(e){angular.isDefined(a.totalCount)||(a.totalCount=e)},a}app.factory("ContactPagingService",e),e.$inject=["$http","$q","$timeout"]}(),angular,app.service("CustomerService",["$http","$rootScope","$cacheFactory","$q",function(e,t,n,a){var o="/api/2.0/customers",i="/api/1.0/admin",s="/api/1.0/integrations/aws";this.getCache=function(){var e=n.get("CustomerService");return e||n("CustomerService")},this.getCustomers=function(t,n,a,i,s){var r=o,c=[];t&&c.push("sortBy="+t),n&&c.push("sortDir="+n),a&&c.push("skip="+a),i&&c.push("limit="+i),c.length>0&&(r+="?"+c.join("&"));var l=this.getCache().get("customers"),u=this.getCache();l?s(l):e({url:r,method:"GET"}).success(function(e){u.put("customers",e),s(e)})},this.loadAllCustomers=function(t){var n=[o,"all"].join("/"),a=this.getCache().get("customers"),i=this.getCache();a?t(a):e({url:n,method:"GET"}).success(function(e){i.put("customers",e),t(e)})},this.refreshCustomers=function(t){var n=[o,"all"].join("/"),a=this.getCache();e({url:n,method:"GET"}).success(function(e){a.put("customers",e),t(e)})},this.getCustomer=function(t,n){var a=[o,t].join("/"),i=this.getCache().get(t),s=this.getCache();i?n(null,i):e({url:a,method:"GET"}).success(function(e){s.put(t,e),n(null,e)}).error(function(e){n(e)})},this.getSingleCustomer=function(t,n){var a=[o,"single",t].join("/");e({url:a,method:"GET"}).success(function(e){n(null,e)}).error(function(e){n(e)})},this.extendTrial=function(t,n,a){var o=[i,"account",t,"trial",n].join("/");e({url:o,method:"POST"}).success(function(e){a(null,e)}).error(function(e){a(e)})},this.addNewUser=function(t,n,a,o){var s=[i,"user","account",t].join("/"),r={username:n,password:a};e.post(s,r).success(function(e){o(null,e)}).error(function(e){o(e)})},this.removeUserFromAccount=function(t,n,a){var o=[i,"user","account",t,"user",n].join("/");e.delete(o).success(function(e){a(null,e)}).error(function(e){a(e)})},this.excludeUserFromCustomerView=function(t,n,a){var o=[i,"user",t,"exclude"].join("/"),s={excludeUser:n};e.post(o,s).success(function(e){a(null,e)}).error(function(e){a(e)})},this.setUserPassword=function(t,n,a){var o=[i,"user",t,"password"].join("/"),s={password:n};e.post(o,s).success(function(e){a(null,e)}).error(function(e){a(e)})},this.viewNameServers=function(t,n){var a=[s,"route53",t,"nameservers"].join("/");e.get(a).success(function(e){n(null,e)}).error(function(e){n(e)})},this.addDomainToAccount=function(t,n,a){var o=[s,"route53",t,"account",n].join("/");e.put(o).success(function(e){a(null,e)}).error(function(e){a(e)})},this.addCustomerNotes=function(t,n,a){var i=[o,"customer",t,"notes"].join("/"),s={notes:n},r=this.getCache();e.post(i,s).success(function(e){r&&(r.get(t).notes=e.notes),a(e)}).error(function(e){a(e)})},this.generateInsightReport=function(t,n){var a=["/api/2.0/insights"],o={accountId:t};e.post(a,o).success(function(e){n(null,e)}).error(function(e){n(e)})},this.updateCustomerTemplateAccount=function(t,n,a){var i=t._id,s=[o,"customer",i,"templateAccount"].join("/"),r={isTemplateAccount:t.isTemplateAccount,templateImageUrl:t.templateImageUrl,generateScreenCap:n},c=this.getCache();e.post(s,r).success(function(e){c&&(c.get(i).isTemplateAccount=e.isTemplateAccount,c.get(i).templateImageUrl=e.templateImageUrl),a(null,e)}).error(function(e){a(e)})},this.updateCustomerReceiveInsights=function(t,n,a){var i=t._id,s=[o,"customer",i,"insights"].join("/"),r={receiveInsights:n},c=this.getCache();e.post(s,r).success(function(e){c&&(c.get(i).email_preferences.receiveInsights=n),a(null,e)}).error(function(e){a(e)})},this.updateCustomerShowHide=function(t,n){var a=t._id,i=[o,"customer",a,"showhide"].join("/"),s={showhide:t.showhide},r=this.getCache();e.post(i,s).success(function(e){r&&(r.get(a).showHide=t.showHide),n(null,e)}).error(function(e){n(e)})},this.cancelAccountSubscription=function(t,n,a,o){var s=[i,"account",t,"cancel"].join("/"),r={reason:n,cancelNow:a};e.post(s,r).success(function(e){o(null,e)}).error(function(e){o(e)})},this.makeEvergreen=function(t,n){var a=[i,"user","account",t,"evergreen"].join("/");e.post(a).success(function(e){n(null,e)}).error(function(e){n(e)})},this.addUserToAccountTo=function(t,n,a){var o=[i,"user","account",t,"user",n].join("/");e.post(o).success(function(e){a(null,e)}).error(function(e){a(e)})},this.addNewCustomer=function(t,n,a,o,i){var s={orgId:t,subdomain:n,username:a,password:o};e.post("/api/1.0/account",s).success(function(e){i(null,e)}).error(function(e){i(e)})}}]),angular,app.service("GeocodeService",["$http",function(e){this.stringifyAddress=function(e,t){if(e&&(e.address||e.address2||e.city||e.state||e.zip)){var n=" ",a=_.filter([e.address,e.address2],function(e){return""!==e}).join(", "),o=_.filter([e.city,e.state,e.zip],function(e){return""!==e}).join(", ");return a?(t&&(n=" <br> "),a+n+o):o}},this.validateAddress=function(e,t,n){var a=new google.maps.Geocoder,o=null;o=t?new google.maps.LatLng(t.geometry.location.lat(),t.geometry.location.lng()):new google.maps.LatLng(e.lat,e.lon);var i=t?t.formatted_address:this.stringifyAddress(e);e.city||e.state||e.zip?a.geocode({latLng:o,address:i},function(e,t){t===google.maps.GeocoderStatus.OK?(e.length>1&&i&&(e=_.where(e,{formatted_address:i})),n(!0,e)):n(!1,null)}):n(!1,null)},this.getGeoSearchAddress=function(t,n){var a="/api/1.0/"+["geo","search","address",t].join("/");e.get(a).success(function(e){n(e)})},this.getAllLocations=function(t){return e.get("/api/1.0/geo/all/locations")}}]),angular,app.service("ImportContactService",["$http",function(e){this.importContacts=function(t,n){var a="social/";switch(t){case $$.constants.social.types.FACEBOOK:a+="facebook/";break;case $$.constants.social.types.GOOGLE:a+="google/";break;case $$.constants.social.types.LINKEDIN:a+="linkedin/"}var o="/api/1.0/"+a+["checkaccess"].join("/");e.get(o).success(function(){var i="";switch(a="social/",t){case $$.constants.social.types.FACEBOOK:a+="facebook/",i="friends/import/";break;case $$.constants.social.types.GOOGLE:a+="google/",i="contacts/import/";break;case $$.constants.social.types.LINKEDIN:a+="linkedin/",i="connections/import/"}o="/api/1.0/"+a+i,e.get(o).success(function(e){n(e,!0)})}).error(function(e){n(e,!1)})}}]),angular,app.service("OrderService",["$http","orderConstant",function(e,t){var n="/api/1.0/orders/";this.getOrders=function(t){e.get("/api/1.0/orders/").success(function(e,n,a,o){t(e)})},this.getOrdersWithoutCustomers=function(t){e.get("/api/1.0/orders/nocustomers").success(function(e,n,a,o){t(e)})},this.getOrderAndDonationStatus=function(t){e.get("/api/1.0/orders/types").success(function(e,n,a,o){t(e)})},this.getCustomerOrders=function(t,a){var o=n+["customer",t].join("/");e.get(o).success(function(e,t,n,o){a(e)})},this.getOrder=function(t,a){var o=n+t;e.get(o).success(function(e,t,n,o){a(e)})},this.createOrder=function(t,n){e({url:"/api/1.0/orders/",method:"POST",data:t}).success(function(e,t,a,o){n(e)}).error(function(e){})},this.updateOrder=function(t,a){var o=n+[t._id,"update"].join("/");e({url:o,method:"POST",data:{order:t}}).success(function(e,t,n,o){a(e)}).error(function(e){})},this.refundOrder=function(t,a,o){var i=n+[t,"refund"].join("/");e({url:i,method:"POST",data:a}).success(function(e,t,n,a){o(e,null)}).error(function(e){o(null,e)})},this.completeOrder=function(t,a,o){var i=n+[t,"complete"].join("/");e({url:i,method:"POST",data:{note:a}}).success(function(e,t,n,a){o(e)}).error(function(e){})},this.addOrderNote=function(t,a,o){var i=n+[t,"note"].join("/");e({url:i,method:"POST",data:{note:a}}).success(function(e,t,n,a){o(e)}).error(function(e){})},this.exportToCSV=function(){var t=n+["order","export"].join("/");e({url:t,method:"POST"})},this.formatOrderStatus=function(e){var n=t.order_status.dp;if(e)return _.find(n,function(t){return t.data===e}).label}}]),angular,app.service("PaymentService",["$http","ToasterService","ENV",function(e,t,n){var a="/api/1.0/";try{Stripe.setPublishableKey(n.stripeKey)}catch(e){}this.getStripeCardToken=function(e,n,a){Stripe.card.createToken(e,function(e,o){200!==e?t.show("error",o.error.message):a||t.show("success","Card added successfully."),n(o.id)})},this.postStripeCustomer=function(t,n){var o=a+["integrations","payments","customers"].join("/");e.post(o,{cardToken:t}).success(function(e,t,a,o){n(e)})},this.getCustomers=function(t){var n=a+["integrations","payments","customers"].join("/");e.get(n).success(function(e,n,a,o){t(e)})},this.putCustomerCard=function(n,o,i){var s=a+["integrations","payments","customers",n,"cards",o].join("/");e.put(s).success(function(e,n,a,o){t.show("success","Card saved."),i(e)})},this.deleteCustomerCard=function(n,o,i,s){var i=i||!1,r=a+["integrations","payments","customers",n,"cards",o].join("/");e.delete(r).success(function(e,n,a,o){i&&t.show("success","Card deleted."),s(e)})},this.getCustomerCards=function(t,n,o){var i=a+["integrations","payments","customers",t,"cards"].join("/");e.get(i).success(function(e,t,a,o){n(e)}).error(function(e,t,n,a){o(e)})},this.getStripeCustomer=function(t){var n=a+["integrations","payments","customers"].join("/");e.get(n).success(function(e,n,a,o){t(e)})},this.getUpcomingInvoice=function(t,n){var o=a+["integrations","payments","upcomingInvoice"].join("/");e.get(o).then(function(e){n(e.data)},function(e){})},this.getUpcomingInvoiceForCustomer=function(t,n){var o=a+["integrations","payments","customers",t,"upcomingInvoice"].join("/");e.get(o).success(function(e,t,a,o){n(e)})},this.getAllInvoices=function(t){var n=a+["integrations","payments","invoices"].join("/");e.get(n).success(function(e,n,a,o){t(e)})},this.getInvoicesForAccount=function(t){var n=a+["integrations","payments","account","invoices"].join("/");e.get(n).success(function(e,n,a,o){t(e)})},this.getTransactionsForAccount=function(t){var n=a+["integrations","payments","account","charges"].join("/");e.get(n).success(function(e,n,a,o){t(e)})},this.postCreatePlan=function(n,o,i){var i=i||!1,s=a+["integrations","payments","plans"].join("/");e.post(s,n).success(function(e,n,a,s){i&&t.show("success","Plan product created."),o(e)})},this.getListPlans=function(t){var n=a+["integrations","payments","plans"].join("/");e.get(n).success(function(e,n,a,o){t(e)})},this.getPlanPromise=function(t){var n=a+["integrations","payments","plans",t].join("/");return e.get(n)},this.getIndigenousPlanPromise=function(t){var n=a+["integrations","payments","indigenous","plans",t].join("/");return e.get(n)},this.getIndigenousStripePlan=function(t,n){var o=a+["integrations","payments","indigenous","plans",t].join("/");e.get(o).success(function(e,t,a,o){n(e)})},this.getPlan=function(t,n){var o=a+["integrations","payments","plans",t].join("/");e.get(o).success(function(e,t,a,o){n(e)})},this.postUpdatePlan=function(n,o,i){var s=a+["integrations","payments","plans",n].join("/");e.post(s,o).success(function(e,n,a,o){t.show("success","Plan updated."),i(e)})},this.deletePlan=function(n,o,i){var o=o||!1,s=a+["integrations","payments","plans",n].join("/");e.delete(s).success(function(e,n,a,s){o&&t.show("warning","Plan deleted."),i(e)})},this.getListStripeSubscriptions=function(t,n){var o=a+["integrations","payments","customers",t,"subscriptions"].join("/");e.get(o).success(function(e,t,a,o){n(e)})},this.getStripeSubscription=function(t,n,o){var i=a+["integrations","payments","customers",t,"subscriptions",n].join("/");e.get(i).then(function(e){o(e.data)},function(e){})},this.postCreateStripeSubscription=function(n,o,i){var s=a+["integrations","payments","customers",n,"subscriptions"].join("/");e.post(s,{plan:o}).success(function(e,n,a,o){t.show("success","Subscribed to plan."),i(e)})},this.postSubscribeToIndigenous=function(t,n,o,i,s,r,c,l){var u=a+["integrations","payments","indigenous","plans",n,"subscribe"].join("/"),d={customerId:t};o&&(d.accountId=o),i&&(d.setupFee=i),s&&(d.addOns=s),r&&(d.coupon=r),e.post(u,d).success(function(e,t,n,a){c(e)}).error(function(e){l&&l(e)})},this.deleteStripeSubscription=function(n,o,i){var s=a+["integrations","payments","customers",n,"subscriptions",o].join("/");e.delete(s).success(function(e,n,a,o){t.show("warning","Unsubscribed from old plan."),i(e)})},this.validateCoupon=function(t,n){var o=a+["integrations","payments","coupon",t,"validate"].join("/");e.get(o).success(function(e,t,a,o){n(e)})}}]),function(e){app.service("ProductService",["$http","productConstant","$q",function(t,n,a){var o="/api/1.0/";this.getProducts=function(e){var n=o+["products"].join("/");t.get(n).success(function(t,n,a,o){e(t)})},this.getProductsWithSort=function(e,n){var a=o+["products"].join("/");t({url:a+"?hash_id="+Math.random(),params:{sortFields:_.keys(e),sortDirections:_.values(e)}}).success(function(e,t,a,o){n(e)})},this.postProduct=function(n,a){var i=o+["products"].join("/");t({url:i,method:"POST",data:e.toJson(n)}).success(function(e,t,n,o){a(e)}).error(function(e){})},this.getProduct=function(e,n){var a=o+["products",e].join("/");t.get(a).success(function(e,t,a,o){n(e)})},this.getSingleProduct=function(e,n){var i=a.defer(),s=o+["products",e].join("/");return t.get(s+"?hash_id="+Math.random()).success(function(e,t,a,o){i.resolve(n(e))}).error(function(e){n(e,null)}),i.promise},this.getIndigenousProducts=function(e){var n=o+["products","indigenous"].join("/");t.get(n).success(function(t,n,a,o){e(t)})},this.saveProduct=function(n,a){var i=o+["products",n._id].join("/");t({url:i,method:"POST",data:e.toJson(n)}).success(function(e,t,n,o){a(e)})},this.getTax=function(e,n){var a=o+["tax",e].join("/");t.get(a).success(function(e,t,a,o){n(e)})},this.deleteProduct=function(e,n){var a=o+["Products",e].join("/");t.delete(a).success(function(e,t,a,o){n(e)})},this.getActiveProducts=function(e){var n=o+["products","active"].join("/");t.get(n).success(function(t,n,a,o){e(t)})},this.productStatusTypes=function(e){e(n.product_status_types.dp)},this.getAllOrdersForProduct=function(e,n){var a=o+["products",e,"orders"].join("/");t.get(a).success(function(e,t,a,o){n(e)})},this.getDonationOrdersForProduct=function(e,n){var a=o+["products",e,"donation","orders"].join("/");t.get(a).success(function(e,t,a,o){n(e)})},this.cloneProduct=function(e,n){var a=o+["products",e,"clone"].join("/");t.post(a).success(function(e){n(e)})}}])}(angular),angular,app.service("SocialConfigService",["$http","$log",function(e,t){var n="/api/1.0/";this.getAllSocialConfig=function(t){var a=n+["social","socialconfig"].join("/");e({method:"GET",url:a,ignoreAuthModule:!0}).success(function(e,n,a,o){t(e)})},this.getTrackedObject=function(t,a,o){var i=n+["social","socialconfig","tracked",t].join("/");e({method:"GET",url:i,ignoreAuthModule:!0}).success(function(e,t,n,i){o(e,a)})},this.getTrackedObjectPromise=function(t,a,o){var i=n+["social","socialconfig","tracked",t].join("/");return e({method:"GET",url:i,ignoreAuthModule:!0})},this.postFBPost=function(t,a,o){var i=n+["social","socialconfig","facebook",t,"post"].join("/");e.post(i,{post:a}).success(function(e,t,n,a){o(e)}).error(function(e,t,n,a){506==e.code&&o({error:e.message})})},this.likeFBPost=function(t,a,o){var i=n+["social","socialconfig","facebook",t,"post",a,"like"].join("/");e.post(i).success(function(e,t,n,a){o(e)})},this.unlikeFBPost=function(t,a,o){var i=n+["social","socialconfig","facebook",t,"post",a,"like"].join("/");e.delete(i).success(function(e,t,n,a){o(e)})},this.deleteSocialConfigEntry=function(t,a){var o=n+["social","socialconfig","socialaccount",t].join("/");e.delete(o).success(function(e,t,n,o){a(e)})},this.getFBPages=function(t,a){var o=n+["social","socialconfig","facebook",t,"pages"].join("/");e({method:"GET",url:o,ignoreAuthModule:!0}).success(function(e,t,n,o){a(e)})},this.getFBPagesPromise=function(t,a){var o=n+["social","socialconfig","facebook",t,"pages"].join("/");return e({method:"GET",url:o,ignoreAuthModule:!0})},this.getFBPageInfo=function(t,a,o){var i=n+["social","socialconfig","facebook",t,"page",a].join("/");e({method:"GET",url:i,ignoreAuthModule:!0}).success(function(e,t,n,a){o(e)})},this.postSocialAccount=function(t,a){var o=n+["social","socialconfig","socialaccount"].join("/");e({url:o,method:"POST",data:t}).success(function(e,t,n,o){a(e)}).error(function(e){a(e)})},this.getTwitterFeed=function(t,a){var o=n+["social","socialconfig","twitter",t,"feed"].join("/");e({method:"GET",url:o,ignoreAuthModule:!0}).success(function(e,t,n,o){a(e)})},this.getTwitterFollowers=function(t,a){var o=n+["social","socialconfig","twitter",t,"followers"].join("/");e({method:"GET",url:o,ignoreAuthModule:!0}).success(function(e,t,n,o){a(e)})},this.getTwitterProfile=function(t,a){var o=n+["social","socialconfig","twitter",t,"profile"].join("/");e({method:"GET",url:o,ignoreAuthModule:!0}).success(function(e,t,n,o){a(e)})},this.postTwitterPost=function(t,a,o){var i=n+["social","socialconfig","twitter",t,"post"].join("/");e.post(i,{post:a}).success(function(e,t,n,a){o(e)})},this.addTwitterPostReply=function(t,a,o,i){var s=n+["social","socialconfig","twitter",t,"post",a,"reply"].join("/");e.post(s,{post:o}).success(function(e,t,n,a){i(e)})},this.addTwitterPostRetweet=function(t,a,o){var i=n+["social","socialconfig","twitter",t,"post",a,"retweet"].join("/");e.post(i).success(function(e,t,n,a){o(e)})},this.addTwitterDirectMessage=function(t,a,o,i){var s=n+["social","socialconfig","twitter",t,"user",a,"dm"].join("/");e.post(s,{msg:o}).success(function(e,t,n,a){i(e)})},this.favTwitterPost=function(t,a,o){var i=n+["social","socialconfig","twitter",t,"post",a,"favorite"].join("/");e.post(i,{}).success(function(e,t,n,a){o(e)})},this.unfavTwitterPost=function(t,a,o){var i=n+["social","socialconfig","twitter",t,"post",a,"favorite"].join("/");e.delete(i,{}).success(function(e,t,n,a){o(e)})},this.followTwitterUser=function(a,o,i){var s=n+["social","socialconfig","twitter",a,"follow",o,"follow"].join("/");t.debug("xxx followTwitterUser"),e.post(s,{}).success(function(e,t,n,a){i(e)})},this.unfollowTwitterUser=function(t,a,o){var i=n+["social","socialconfig","twitter",t,"follow",a,"unfollow"].join("/");e.delete(i,{}).success(function(e,t,n,a){o(e)})},this.getFBPosts=function(t,a){var o=n+["social","socialconfig","facebook",t,"posts"].join("/");e({method:"GET",url:o,ignoreAuthModule:!0}).success(function(e,t,n,o){a(e)})},this.getFBProfile=function(t,a){var o=n+["social","socialconfig","facebook",t,"profile"].join("/");e({method:"GET",url:o,ignoreAuthModule:!0}).success(function(e,t,n,o){a(e)})},this.importLinkedinContact=function(t,a){var o=n+["social","socialconfig","linkedin",t,"importcontacts"].join("/");e({url:o,method:"GET"}).success(function(e,t,n,o){a(e)})},this.importGoogleContact=function(t,a){var o=n+["social","socialconfig","google",t,"importcontacts"].join("/");e({url:o,method:"GET"}).success(function(e,t,n,o){a(e)})},this.importGoogleContactsForGroup=function(t,a,o){var i=n+["social","socialconfig","google",t,"importcontacts"].join("/");"All"!==a&&(i+="?groupId="+a),e({url:i,method:"GET"}).success(function(e,t,n,a){o(e)})},this.getGoogleGroups=function(t,a){var o=n+["social","socialconfig","google",t,"groups"].join("/");e({url:o,method:"GET"}).success(function(e,t,n,o){a(e)})},this.addFacebookPostComment=function(t,a,o,i){var s=n+["social","socialconfig","facebook",t,"post",a,"comment"].join("/");e.post(s,{comment:o}).success(function(e,t,n,a){i(e)})},this.addTwitterReply=function(t,a,o,i,s){var r=n+["social","socialconfig","twitter",t,"post",a,"reply"].join("/");e.post(r,{post:"@"+o+" "+i}).success(function(e,t,n,a){s(e)})},this.addTrackedAccount=function(t,a){var o=n+["social","socialconfig","trackedAccounts"].join("/");e.post(o,{trackedAccount:t}).success(function(e,t,n,o){a(e)})},this.updateTrackedAccount=function(t,a){var o=n+["social","socialconfig","trackedAccount",t.id].join("/");e.post(o,{trackedAccount:t}).success(function(e,t,n,o){a(e)})},this.deleteTrackedAccount=function(t,a){var o=n+["social","socialconfig","trackedAccount",t].join("/");e.delete(o).success(function(e,t,n,o){a(e)})}}]),angular,app.service("ToasterService",["toaster",function(e){var t=[],n=[];this.show=function(t,n){e.pop(t,n)},this.showWithTitle=function(t,n,a){e.pop(t,n,a)},this.clearAll=function(){e.clear("*")},this.setPending=function(e,n){t.push([e,n])},this.processPending=function(){t.forEach(function(t,n){e.pop(t[0],t[1])}),t=[]},this.setHtmlPending=function(e,t,a,o,i){n.push([e,t,a,o,i])},this.processHtmlPending=function(){n.forEach(function(t,n){e.pop(t[0],t[1],t[2],t[3],t[4])}),n=[]}}]),function(e){app.service("UserService",["$http","$q",function(t,n){var a=this,o="/api/1.0/";this.getUser=function(e){var n=o+["user"].join("/");t.get(n).success(function(t,n,a,o){e(t)})},this.getUsers=function(e){var n=o+["user","members"].join("/");t.get(n).success(function(t,n,a,o){e(t)})},this.putUser=function(e,n){var a=o+["user",$$.server.userId].join("/");t.put(a,e).success(function(e,t,a,o){n(e)})},this.editUser=function(e,n,a){var i=o+["user",n].join("/");t.put(i,e).success(function(e,t,n,o){a(e)})},this.setPassword=function(e,n){var a=o+["user","password"].join("/"),i={password:e};t.post(a,i).then(function(e){n(e.data)},function(e){})},this.getSingleAccount=function(e,n){var a=o+["account",e].join("/");t.get(a).success(function(e,t,a,o){n(e)})},this.getAccount=function(e){var n=o+["account",$$.server.accountId].join("/");t.get(n).success(function(t,n,o,i){a.account=t,e(t)})},this.getAccounts=function(e){var n=o+["user","accounts"].join("/");t.get(n).success(function(t,n,a,o){e(t)})},this.putAccount=function(e,n){var a=o+["account",$$.server.userId].join("/");t.put(a,e).success(function(e,t,a,o){n(e)})},this.postAccountBilling=function(e,n,a,i){var s=o+["account","billing"].join("/");t.post(s,{stripeCustomerId:e,cardToken:n}).success(function(e,t,n,o){a(e)}).error(function(e){i&&i(e)})},this.getAccountBilling=function(e){var n=o+["account","billing"].join("/");t.get(n).success(function(t,n,a,o){e(t)})},this.postUserSubscribe=function(e){var n=o+["account","billing"].join("/");t.get(n).success(function(t,n,a,o){e(t)})},this.getUserSubscriptions=function(e,n){var a=o+["customers",e,"subscriptions"].join("/");t.get(a).success(function(e,t,a,o){n(e)})},this.postSubscribeToIndigenous=function(e,n,a,i){var s=o+["integrations","payments","indigenous","plans",n,"subscribe"].join("/"),r={customerId:e};a&&(r.accountId=a),t.post(s,r).success(function(e,t,n,a){i(e)})},this.postUserSubscriptions=function(e,n,a){var i=o+["integrations","payments","customers",e,"subscriptions"].join("/");t.post(i,{plan:n}).success(function(e,t,n,o){a(e)})},this.postUserDashboard=function(e,n){var a=o+["dashboard"].join("/");t.post(a,{config:e}).success(function(e,t,a,o){n(e)})},this.getUserDashboard=function(e){var n=o+["dashboard"].join("/");t.get(n).success(function(t,n,a,o){e(t)})},this.postUserDashboardUpdate=function(e,n,a){var i=o+["dashboard",e].join("/");t.post(i,{config:n}).success(function(e,t,n,o){a(e)})},this.checkDuplicateSubdomain=function(e,n,a){var i=o+["account",e,"duplicate"].join("/");t.get(i).success(function(e,t,n,o){a(e)})},this.getUserPreferences=function(e){var n=o+["user","preferences"].join("/");t.get(n).success(function(t,n,a,o){e(t)})},this.updateUserPreferences=function(e,n,a){var i=o+["user","preferences"].join("/");t.post(i,e).success(function(e,t,n,o){a(e)})},this.getUserSocial=function(e){var n=o+["user","social"].join("/");t.get(n).success(function(t,n,a,o){e(t)})},this.deleteUserSocial=function(e,n){var a=o+["user","social",e].join("/");t.delete(a).success(function(e,t,a,o){n(e)})},this.getUserActivity=function(e){var n=o+["useractivity"].join("/");t.get(n).success(function(t,n,a,o){e(t)})},this.getLoggedInUserActivity=function(e){var n=o+["useractivity","user"].join("/");t.get(n).success(function(t,n,a,o){e(t)})},this.findUserByUsername=function(e,n){var a=o+["user","email",e].join("/");t.get(a).success(function(e){n(null,e)}).error(function(e){n(e)})},this.checkUserByUsername=function(e,n){var a=o+["user","exists",e].join("/");t.get(a).success(function(e){n(e)}).error(function(e){n(e)})},this.getUserOrganizationConfig=function(e){var n=o+["user","orgConfig"].join("/");t.get(n).success(function(t){e(null,t)}).error(function(t){e(t)})},this.getAccountUsers=function(e){var n=o+["user","members"].join("/");t.get(n).success(function(t){e(t)}).error(function(t){e(t)})},this.updateUserPermisions=function(e,n,a){var i=o+["user",e,"permissions"].join("/");t.post(i,{roleAry:n}).success(function(e,t,n,o){a(e)})},this.updateUserProfileImage=function(n,a,i){var s=new FormData;s.append("file",n);var r=o+["user","profile",a].join("/");t.post(r,s,{transformRequest:e.identity,headers:{"Content-Type":void 0}}).success(function(e,t,n,a){i(e)})},this.getVendors=function(e){t.get(["/api/1.0/integrations/zi","vendors"].join("/")).success(function(t){e(t)}).error(function(t){e(t)})},this.customerExists=function(e,n){var a="?codes="+e.join(",");t.get(["/api/1.0/integrations/zi","vars","exists"].join("/")+a).success(function(e){n(e)}).error(function(e){n(e)})},this.downloadUserActivities=function(e,t){var n="?offset="+moment().utcOffset(),a=o+["useractivity","user",e,"csv"].join("/")+n;window.location=a},this.getUsersForAutocomplete=function(e){var a=n.defer(),i=o+["admin","user","search"].join("/")+"?term="+e;return t({url:i,method:"get"}).success(function(e){a.resolve(e)}).error(function(e){fn(e)}),a.promise}}])}(angular),angular,app.service("UtilService",[function(){function e(e){var t=!1;if(!_.isEmpty(e))for(var n=0;n<=Object.keys(e).length-1;n++)e[Object.keys(e)[n]]&&(t=!0);return t}this.flyoverout="",this.checkIfFieldSearch=e,this.flyoverhide=function(e){this.flyoverout=e},this.flyoverhideonclick=function(){this.flyoverout&&(this.flyoverout.openSidebarPanel="")},this.showFilteredRecords=function(t,n){return!(!t&&!e(n))}}]),function(e){app.service("WebsiteService",["$http","$cacheFactory","$timeout","$q","ChartEmailService","pageConstant",function(t,n,a,o,i,s){var r="/api/1.0/";this.editPageHandle=null;var c=n("pages"),l=n("emails");this.getEditedPageHandle=function(){return this.editPageHandle},this.setEditedPageHandle=function(e){this.editPageHandle=e},this.getWebsite=function(e){var n=r+["cms","website",$$.server.websiteId].join("/");t.get(n).success(function(t,n,a,o){e(t)})},this.updateWebsite=function(n,a){var o=r+["cms","website"].join("/");t({url:o,method:"POST",data:e.toJson(n)}).success(function(e,t,n,o){a(e)}).error(function(e){a(e,null)})},this.getSinglePage=function(e,n){var a=c.get("pages"),o=_.find(a,function(t){return t.handle===e});if(o)n(o);else{var i=r+["cms","website",$$.server.websiteId,"page",e].join("/");t.get(i).success(function(e,t,a,o){n(e)}).error(function(e){n(null,e)})}},this.checkDuplicatePage=function(e,n,a){var o=c.get("pages"),i=!1,s=_.filter(o,function(t){return t.handle===e});if(s.length)s.length>1?i=!0:1===s.length&&(i=s[0]._id!==n),a(i);else{var l=r+["cms","website",$$.server.websiteId,"page",e].join("/");t.get(l).success(function(e,t,o,s){e&&e._id&&(i=e._id!==n),a(i)}).error(function(e){e&&e.code&&404===e.code?a(!1):a(e,null)})}},this.getSingleEmail=function(e,n){var a=l.get("emails"),o=_.find(a,function(t){return t._id===e});if(o)n(o);else{var i=r+["cms","email",e].join("/");t.get(i).success(function(e,t,a,o){n(e)}).error(function(e){n(e,null)})}},this.getSinglePost=function(e,n){var a=r+["cms","website",$$.server.websiteId,"blog",e].join("/");t.get(a).success(function(e,t,a,o){n(e)}).error(function(e){n(e,null)})},this.getPageVersions=function(e,n){var a=r+["cms","page",e,"versions"].join("/");t.get(a).success(function(e,t,a,o){n(e)}).error(function(e){n(e,null)})},this.revertPageVersion=function(e,n,a){var o=r+["cms","page",e,"revert",n].join("/");t({url:o,method:"POST"}).success(function(e,t,n,o){a(e)}).error(function(e){a(e,null)})};var u=!1;this.getEmails=function(e,n){var a=l.get("emails");if(!a||!a.length||u){var s=o.defer(),c=r+["cms","website",$$.server.websiteId.replace(/&quot;/g,""),"emails"].join("/");return t.get(c).success(function(t,a,o,r){u=!1,l.put("emails",t),e?i.queryMandrillData(t,function(e){n&&s.resolve(n(e))}):s.resolve(n(t))}).error(function(e){n(e,null)}),s.promise}n&&n(a)},this.updateEmailCache=function(e,t){var n=l.get("emails");if(n){if(t){var a=_.findIndex(n,function(t){return t._id===e._id});a>-1&&(n[a]=e)}else n.push(e);l.put("emails",n)}};var d=!1;this.getPages=function(e){var n=c.get("pages");if(n&&!d)e&&e(n);else{var a=r+["cms","website",$$.server.websiteId.replace(/&quot;/g,""),"pages"].join("/");t.get(a).success(function(t){d=!1,c.put("pages",t),e&&e(t)}).error(function(e,t){})}};this.getPagesHeartbeat=function(){function e(){a.cancel(n.heartrepeater);var o=r+["cms","website",$$.server.websiteId.replace(/&quot;/g,""),"pagesheartbeat"].join("/");t.get(o).success(function(e,t,a,o){e.pagelength>_.size(c.get("pages"))&&(d=!0,n.getPages(null))}).error(function(e){}),n.heartrepeater=a(e,6e4)}var n=this;e()},this.getPagesWithLimit=function(e,n,a){var o=r+["cms","website",e,"pages"].join("/");t({url:o,method:"GET",params:n}).success(function(e,t,n,o){a(e)}).error(function(e){a(e,null)})},this.getPosts=function(e){var n=r+["cms","editor","blog"].join("/");t.get(n).success(function(t,n,a,o){e(t.results)}).error(function(t){e(t,null)})},this.getPostsWithLimit=function(e,n){var a=r+["cms","editor","blog"].join("/");t({url:a,method:"GET",params:e}).success(function(e,t,a,o){n(e)}).error(function(e){n(e,null)})},this.updatePage=function(n,a,o){n.modified||(n.modified={}),n.modified.date=new Date;var i=r+["cms","website",$$.server.websiteId,"page",n._id].join("/");t({url:i,method:"POST",data:e.toJson(n)}).success(function(e,t,i,s){if("page"===n.type){var r=c.get("pages");r&&(e.handle!==a&&delete r[a],r[e.handle]=e,c.put("pages",r))}o(e)}).error(function(e){o(null,e)})},this.updateComponentOrder=function(e,n,a,o){var i=r+["cms","page",e,"components",n,"order",a].join("/");t({url:i,method:"POST"}).success(function(e,t,n,a){o(e)}).error(function(e){o(e,null)})},this.sendTestEmail=function(n,a,o){var i=e.toJson({address:n,content:a}),s=r+["cms","testemail"].join("/");t({url:s,method:"POST",data:i}).success(function(e,t,n,a){o(e)}).error(function(e){o(e,null)})},this.updateAllComponents=function(n,a,o){var i=r+["cms","page",n,"components","all"].join("/");t({url:i,method:"POST",data:e.toJson(a)}).success(function(e,t,n,a){o(e)}).error(function(e){o(e)})},this.updateComponent=function(n,a,o,i){var s=r+["cms","page",n,"components",a].join("/");t({url:s,method:"POST",data:e.toJson(o)}).success(function(e,t,n,a){i(e)}).error(function(e){i(e)})},this.addNewComponent=function(n,a,o,i,s){var c=r+["cms","page",n,"components"].join("/"),l={title:a,type:o,cmpVersion:i};t({url:c,method:"POST",data:e.toJson(l)}).success(function(e,t,n,a){s(e)}).error(function(e){})},this.deleteComponent=function(e,n,a){var o=r+["cms","page",e,"components",n].join("/");t({url:o,method:"DELETE"}).success(function(e,t,n,o){a(e)}).error(function(e){})},this.createPage=function(n,a,o){var i=r+["cms","website",n,"page"].join("/");t({url:i,method:"POST",data:e.toJson(a)}).success(function(e,t,n,a){var i=c.get("pages");i[e.handle]=e,c.put("pages",i),o(e)}).error(function(e){})},this.createEmail=function(n,a){var o=r+["cms","email"].join("/");t({url:o,method:"POST",data:e.toJson(n)}).success(function(e,t,n,o){var i=l.get("emails");i&&(i.push(e),l.put("emails",i)),a(e,null)}).error(function(e){a(null,e)})},this.updateEmail=function(n,a){var o=r+["cms","email",n._id].join("/");t({url:o,method:"PUT",data:e.toJson(n)}).success(function(e,t,n,o){var i=l.get("emails");if(i){var s=_.find(i,function(t){return t._id===e._id});s&&(i[_.indexOf(i,s)]=e),l.put("emails",i)}a(e,null)}).error(function(e){a(null,e)})},this.deleteEmail=function(e,n){var a=r+["cms","email",e._id].join("/");t.delete(a).success(function(t,a,o,i){var s=l.get("emails");s=_.reject(s,function(t){return t._id===e._id}),l.put("emails",s),n(t)}).error(function(e){n(e)})},this.createDuplicatePage=function(n,a){var o=r+["cms","website",$$.server.websiteId,"duplicate","page"].join("/");t({url:o,method:"POST",data:e.toJson(n)}).success(function(e,t,o,i){if("page"===n.type){var s=c.get("pages");s&&(s[e.handle]=e,c.put("pages",s))}a(e)}).error(function(e){})},this.createPageFromTemplate=function(n,a,o){var i=r+["cms","template",n,"website",$$.server.websiteId,"page"].join("/");t({url:i,method:"POST",data:e.toJson(a)}).success(function(e,t,n,a){var i=c.get("pages");i[e.handle]=e,c.put("pages",i),o(e)}).error(function(e){o(null,e)})},this.createPost=function(n,a,o){a.created||(a.created={}),a.modified||(a.modified={}),a.created.date=(new Date).getTime(),a.modified.date=(new Date).getTime();var i=r+["cms","page",n,"blog"].join("/");t({url:i,method:"POST",data:e.toJson(a)}).success(function(e,t,n,a){o(e)}).error(function(e){})},this.deletePage=function(e,n,a,o){var i=r+["cms","website",n,"page",e._id,a].join("/");t.delete(i).success(function(t,n,a,i){var s=c.get("pages");_.find(s,function(t){return t.handle===e.handle})&&(delete s[e.handle],c.put("pages",s)),o(t)}).error(function(e){o(e)})},this.deletePost=function(e,n,a){var o=r+["cms","page",e,"blog",n].join("/");t.delete(o).success(function(e,t,n,o){a(e)}).error(function(e){a(e)})},this.bulkDeletePosts=function(e,n,a){var o=r+["cms","page",e,"blogposts"].join("/");t({url:o,method:"POST",data:{id:n}}).success(function(e,t,n,o){a(e)}).error(function(e){a(e)})},this.getTemplates=function(e){var n=r+["cms","template"].join("/");t.get(n).success(function(t,n,a,o){e(t)})},this.updateTemplate=function(n,a,o){var i=r+["cms","template",n].join("/");t({url:i,method:"POST",data:e.toJson(a)}).success(function(e,t,n,a){o(e)}).error(function(e){o(null,e)})},this.getTopics=function(e){var n=r+["cms","topic"].join("/");t.get(n).success(function(t,n,a,o){e(t)})},this.createTopic=function(n,a){var o=r+["cms","topic"].join("/");t({url:o,method:"POST",data:e.toJson(n)}).success(function(e,t,n,o){a(e)}).error(function(e){})},this.updateTopic=function(n,a){var o=r+["cms","topic",n._id].join("/");t({url:o,method:"PUT",data:e.toJson(n)}).success(function(e,t,n,o){a(e)}).error(function(e){a(null,e)})},this.deleteTopic=function(e,n){var a=r+["cms","topic",e._id].join("/");t.delete(a).success(function(e,t,a,o){n(e)}).error(function(e){n(e)})},this.createDuplicateTopic=function(n,a){var o=r+["cms","topic","duplicate"].join("/");t({url:o,method:"POST",data:e.toJson(n)}).success(function(e,t,n,o){a(e)}).error(function(e){})},this.getPageComponents=function(e,n){var a=r+["cms","page",e,"components"].join("/");t.get(a).success(function(e,t,a,o){n(e)})},this.getComponentVersions=function(e,n){var a=r+["cms","component",e,"versions"].join("/");t.get(a).success(function(e,t,a,o){n(e)})},this.setWebsiteTheme=function(e,n,a){var o=r+["cms","theme",e,"website",n].join("/");t.post(o).success(function(e,t,n,o){a(e)})},this.createPageFromTheme=function(e,n,a,o){var i=r+["cms","theme",e,"website",n,"page",a].join("/");t.post(i).success(function(e,t,n,a){o(e)})},this.updateLinkList=function(e,n,a,o){var i=r+["cms","website",n,"linklists",a].join("/");t({url:i,method:"POST",data:e}).success(function(e,t,n,a){o(e)}).error(function(e){o(e,null)})},this.getComponent=function(n,a,o){var i=r+["cms","component",n.type].join("/");t({url:i,method:"POST",data:e.toJson({version:a})}).success(function(e,t,n,a){o(e)})},this.getPageScreenShot=function(e,n){var a=r+["cms","page",e,"savedscreenshot"].join("/");t.get(a).success(function(e,t,a,o){n(e)})},this.updatePost=function(n,a,o,i){var s=r+["cms","page",n,"blog",a].join("/");t({url:s,method:"POST",data:e.toJson(o)}).success(function(e,t,n,a){i(e)}).error(function(e){i(null,e)})},this.publishPost=function(e,n,a){var o=r+["cms","page",e,"blog","status",n].join("/");t({url:o,method:"PUT"}).success(function(e,t,n,o){a(e)}).error(function(e){a(e,null)})},this.checkEmailTitleExists=function(e,t){this.getEmails(function(n){var a=_.find(n,function(t){return t.title===e});t(a?!0:!1)})},this.isImage=function(e){var t=o.defer(),n=new Image;return n.onerror=function(){t.resolve(!1)},n.onload=function(){t.resolve(!0)},n.src=e,t.promise},this.checkSystemRoute=function(e){return!!s.inValidPageHandles[e.toLowerCase()]&&"Page handle cannot be a system route."},this.getEmailStatsPromise=function(e){var n=r+["cms","email",e,"stats"].join("/");return t.get(n)},this.getAccountEmailStatsPromise=function(){var e=r+["cms","email","stats"].join("/");return t.get(e)}}])}(angular),function(){function e(e){function t(t,n){e(n,t,{expires:7300,path:"/"})}var n={};return n.plateformAnalyticsWidgetStateConfig={overview:!1,locations:!1,interactions:!1,device:!1,newVReturning:!1,trafficSources:!1,pageanalytics:!1,ua:!1,userAgentsTable:!1,rev:!1,os:!1,campaigns:!1,locationsGlobal:!1,frontrunnerSite:!1,analytics_visitors_legend:!0,analytics_visits_legend:!0,analytics_pageviews_legend:!0,analytics_daily_active_users_legend:!0},n.siteAnalyticsWidgetStateConfig={overview:!1,locations:!1,interactions:!1,device:!1,newVReturning:!1,trafficSources:!1,pageanalytics:!1,analytics404:!1,ua:!1,userAgentsTable:!1,rev:!1,locationsGlobal:!1,analytics_visitors_legend:!0,analytics_visits_legend:!0,analytics_pageviews_legend:!0,analytics_daily_active_users_legend:!0},n.customerAnalyticsWidgetStateConfig={overview:!1,locations:!1,interactions:!1,device:!1,newVReturning:!1,trafficSources:!1,pageanalytics:!1,ua:!1,userAgentsTable:!1,rev:!1,campaigns:!1,locationsGlobal:!1,analytics_visitors_legend:!0,analytics_visits_legend:!0,analytics_pageviews_legend:!0,analytics_daily_active_users_legend:!0},n.getSiteAnalyticsWidgetStates=function(){e("siteAnalyticsWidgetState")?n.siteAnalyticsWidgetStateConfig=e("siteAnalyticsWidgetState"):t(n.siteAnalyticsWidgetStateConfig,"siteAnalyticsWidgetState")},n.getPlateformAnalyticsWidgetStates=function(){e("plateformAnalyticsWidgetState")?n.plateformAnalyticsWidgetStateConfig=e("plateformAnalyticsWidgetState"):t(n.plateformAnalyticsWidgetStateConfig,"plateformAnalyticsWidgetState")},n.getCustomerAnalyticsWidgetStates=function(){e("customerAnalyticsWidgetState")?n.customerAnalyticsWidgetStateConfig=e("customerAnalyticsWidgetState"):t(n.customerAnalyticsWidgetStateConfig,"customerAnalyticsWidgetState")},n.setSiteAnalyticsWidgetStates=function(n,a){var o=e("siteAnalyticsWidgetState");o&&(o[n]=a,e.remove("siteAnalyticsWidgetState",{path:"/"}),t(o,"siteAnalyticsWidgetState"))},n.setPlateformAnalyticsWidgetStates=function(n,a){var o=e("plateformAnalyticsWidgetState");o&&(o[n]=a,e.remove("plateformAnalyticsWidgetState",{path:"/"}),t(o,"plateformAnalyticsWidgetState"))},n.setCustomerAnalyticsWidgetStates=function(n,a){var o=e("customerAnalyticsWidgetState");o&&(o[n]=a,e.remove("customerAnalyticsWidgetState",{path:"/"}),t(o,"customerAnalyticsWidgetState"))},n.getNamedSiteAnalyticsWidgetState=function(t){var a=n.siteAnalyticsWidgetStateConfig[t],o=e("siteAnalyticsWidgetState");return o&&(a=o[t]),a},n.getNamedPlateformAnalyticsWidgetState=function(t){var a=n.plateformAnalyticsWidgetStateConfig[t],o=e("plateformAnalyticsWidgetState");return o&&(a=o[t]),a},n.getNamedCustomerAnalyticsWidgetState=function(t){var a=n.customerAnalyticsWidgetStateConfig[t],o=e("customerAnalyticsWidgetState");return o&&(a=o[t]),a},n}app.factory("AnalyticsWidgetStateService",e),e.$inject=["ipCookie"]}(),function(e){app.controller("siteAnalyticsCtrl",["$scope","$modal","SiteAnalyticsService","$timeout",function(t,n,a,o){t.analyticsOverviewConfig={},t.timeonSiteConfig={},t.trafficSourcesConfig={},t.newVsReturningConfig={},t.customerOverviewConfig={},t.analyticsOverviewConfig.title={text:""},t.timeonSiteConfig.title={text:""},t.trafficSourcesConfig.loading=!0,t.newVsReturningConfig.loading=!0,t.customerOverviewConfig.loading=!0,t.displayVisitors=!0,t.visitors=null,t.date={startDate:moment().subtract(29,"days").format(),endDate:moment().format()},t.displayDatePicker=function(){$(".deshboard-date-picker").click()};var i=!1;t.$watch("selectedDate",function(){t.date.startDate=moment(t.selectedDate.startDate).format(),t.date.endDate=moment(t.selectedDate.endDate).format(),i&&(t.analyticsOverviewConfig={},t.timeonSiteConfig={},t.trafficSourcesConfig={},t.newVsReturningConfig={},t.customerOverviewConfig={},t.analyticsOverviewConfig.title={text:""},t.timeonSiteConfig.title={text:""},t.locationData=null,t.pagedformattedTopPages=null,t.runAnalyticsReports(t.analyticsAccount)),i=!0}),t.selectedDate={startDate:moment().subtract(29,"days").startOf("day"),endDate:moment()},t.pickerOptions={startDate:moment().subtract(29,"days").toDate(),endDate:moment().toDate(),format:"YYYY-MM-DD",opens:"left",ranges:{Today:[moment().startOf("day"),moment()],Yesterday:[moment().subtract(1,"days").startOf("day"),moment().subtract(1,"days").endOf("day")],"Last 7 Days":[moment().subtract(6,"days").startOf("day"),moment().endOf("day")],"Last 30 Days":[moment().subtract(29,"days").startOf("day"),moment().endOf("day")],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}},t.runAnalyticsReports=function(){a.runReports(function(){}),ChartAnalyticsService.runPagedReports(t.date,t.analyticsAccount,function(n){t.formattedTopPages=_.reject(n.formattedTopPages,function(t){return!e.isDefined(t.page)}),t.pagedformattedTopPages=_.reject(n.pagedformattedTopPages,function(t){return!e.isDefined(t.page)})}),ChartAnalyticsService.runReports(t.date,t.analyticsAccount,function(e){t.setReportData(e)})},t.visitorDataReport=function(e,n){var a=[],o=0;_.each(e,function(e){var t=[],n=e.value||0;o+=n,t.push(new Date(e.timeframe.start).getTime()),t.push(n),a.push(t)}),t.visitorsData=a;var i=0;_.each(n,function(e){var t=e.value||0;i+=t});var s=ChartAnalyticsService.calculatePercentage(i,o);t.$apply(function(){t.visitors=o,t.visitorsPercent=s})},t.locationReportData=function(e){var n=[];if(e){var a=[];_.each(e,function(e){e["ip_geo_info.province"]&&a.push(e)}),t.mostPopularState=_.max(a,function(e){return e.result}),_.each(e,function(e){var t=ChartAnalyticsService.stateToAbbr(e["ip_geo_info.province"]);if(t){var a={};a.code=t,a.value=e.result,!_.find(n,function(t){return t.code===e.code})&&a.value&&n.push(a)}})}t.$apply(function(){t.locationData=n})},t.contentInteractionsReportData=function(e,n,a){var o=[];_.each(e,function(e){var t=[],n=e.value||0;t.push(new Date(e.timeframe.start).getTime()),t.push(n),o.push(t)}),t.avgSessionData=o;var i=[],s=0;_.each(n,function(e){var t=[],n=e.value||0;s+=n,t.push(new Date(e.timeframe.start).getTime()),t.push(n),i.push(t)}),t.bouncesData=i,ChartAnalyticsService.timeOnSite(t.avgSessionData,t.bouncesData,function(e){t.timeonSiteConfig=e,t.timeonSiteConfig.loading=!1});var r=ChartAnalyticsService.calculatePercentage(s,a);t.$apply(function(){t.bounces=s,t.bouncesPercent=r})},t.setReportData=function(e){var n,a;_.each(e[1].result,function(e){var t=e["user_agent.device"];"desktop"===t&&(n=e.result),a="mobile"===t?e.result:0}),t.desktop=n,t.mobile=a,t.device_data_loaded=!0,t.visitorDataReport(e[2].result,e[3].result);var o=[],i=0;_.each(e[4].result,function(e){var t=[],n=e.value||0;i+=n,t.push(new Date(e.timeframe.start).getTime()),t.push(n),o.push(t)}),t.pageviews=i,t.pageviewsData=o;var s=0;_.each(e[5].result,function(e){var t=e.value||0;s+=t}),t.pageviewsPreviousData=s;var r=ChartAnalyticsService.calculatePercentage(i,s);t.pageviewsPercent=r;var c=[],l=0;_.each(e[6].result,function(e){var t=[],n=e.value||0;l+=n,t.push(new Date(e.timeframe.start).getTime()),t.push(n),c.push(t)}),t.sessions=l,t.sessionsData=c,ChartAnalyticsService.analyticsOverview(t.pageviewsData,t.sessionsData,t.visitorsData,null,function(e){t.$apply(function(){t.analyticsOverviewConfig=e}),t.analyticsOverviewConfig.loading=!1});var u=0;_.each(e[7].result,function(e){var t=e.value||0;u+=t});var d=ChartAnalyticsService.calculatePercentage(l,u);t.sessionsPercent=d;var p=0;e[9].result&&(p=e[9].result/1e3);var m=ChartAnalyticsService.secToTime(p);null===e[15].result&&(e[15].result=0),t.visitDuration=m;var g=e[15].result,f=ChartAnalyticsService.calculatePercentage(e[9].result,g);t.visitDurationPercent=f,t.contentInteractionsReportData(e[8].result,e[10].result,e[11].result),t.trafficSourceData=e[12].result;var h=[["New",e[14].result],["Returning",e[13].result]];t.newVsReturning=h,ChartAnalyticsService.newVsReturning(t.newVsReturning,function(e){t.newVsReturningConfig=e,t.newVsReturningConfig.loading=!1}),t.locationReportData(e[0].result),t.displayVisitors=t.visitors>0,t.renderAnalyticsCharts()},t.renderAnalyticsCharts=function(){$("#visitor_locations").length&&(o(function(){var n=e.copy(t.locationData);ChartAnalyticsService.visitorLocations(n,Highcharts.maps["countries/us/us-all"])},100),t.displayVisitors)}}])}(angular),function(){function e(e,t,n,a,o,i){function s(e){return l.loading.value=l.loading.value+1,e.finally(function(){l.loading.value=l.loading.value-1}),e}function r(e,t,a,o,i,r,c){var m=moment.utc(e).format("YYYY-MM-DD[T]HH:mm:ss"),g=moment.utc(t).format("YYYY-MM-DD[T]HH:mm:ss");if(e&&t)f="/"+r+"?start="+m+"&end="+g;else var f="/"+r;return f=o?d+f:i?p+f+"&accountId="+a:u+f,s(n.get(f).success(function(e){l.reports=l.reports||{},l.reports[r]=e,c(e)}).error(function(e){}))}function c(e,t,a,o){var i=moment.utc(e).format("YYYY-MM-DD[T]HH:mm:ss"),r=moment.utc(t).format("YYYY-MM-DD[T]HH:mm:ss");return s(n.get(p+"/all?accountId="+a+"&start="+i+"&end="+r).success(function(e){l.reports=e,o(e)}).error(function(e){}))}var l={},u="/api/1.0/analytics/reports",d="/api/1.0/analytics/admin/reports",p="/api/1.0/analytics/customer/reports",m="/api/1.0/analytics/admin/live",g="/api/1.0/analytics/admin/liveDetails",f="/api/1.0/analytics/live",h="/api/1.0/analytics/admin/pageViewPerformance";return l.runReports=function(e,t,a){var o=moment.utc(e).format("YYYY-MM-DD[T]HH:mm:ss"),i=moment.utc(t).format("YYYY-MM-DD[T]HH:mm:ss");return s(n.get(u+"/all?start="+o+"&end="+i).success(function(e){l.reports=e,a(e)}).error(function(e){}))},l.runAdminReports=function(e,t,a){var o=moment.utc(e).format("YYYY-MM-DD[T]HH:mm:ss"),i=moment.utc(t).format("YYYY-MM-DD[T]HH:mm:ss");return s(n.get(d+"/all?start="+o+"&end="+i).success(function(e){l.reports=e,a(e)}).error(function(e){}))},l.runCustomerReports=c,l.runPlatformTraffic=function(e){return s(n.get(m).success(function(t){e(t)}).error(function(e){}))},l.runPlatformTrafficDetails=function(e){return s(n.get(g).success(function(t){e(t)}).error(function(e){}))},l.runSiteAnlyticsTraffic=function(e){return s(n.get(f).success(function(t){e(t)}).error(function(e){}))},l.getFrontrunnerSitesPageviews=function(e,t,a,o){var i=moment.utc(e).format("YYYY-MM-DD[T]HH:mm:ss"),r=moment.utc(t).format("YYYY-MM-DD[T]HH:mm:ss"),c=a.join(",");return s(n.get(h+"?accountIds="+c+"&start="+i+"&end="+r).success(function(e){o(e)}).error(function(e){}))},l.runIndividualReports=function(e,t,a,o,i,r){function p(e){}var m=["users","pageviews","sessions","visitors","visitorLocations","visitorLocationsByCountry","visitorDevices","sessionLength","trafficSources","newVsReturning","pageAnalytics","userAgents","revenue","daily404s","404s"],g=["pageviews","users","sessions","dau"],f=["pageAnalytics","visitorLocations","visitorLocationsByCountry","visitorDevices","sessionLength","trafficSources","newVsReturning","userAgents","revenue","os","emails"],h=moment.utc(e).format("YYYY-MM-DD[T]HH:mm:ss"),v=moment.utc(t).format("YYYY-MM-DD[T]HH:mm:ss");l.reports={},!0===o?(_.each(g,function(e){var t=d+"/"+e+"?start="+h+"&end="+v;s(n.get(t).success(function(t){l.reports[e]=t,r(l.reports)}).error(p))}),_.delay(function(){_.each(f,function(e){var t=d+"/"+e+"?start="+h+"&end="+v;s(n.get(t).success(function(t){l.reports[e]=t,r(l.reports)}).error(p))})},6e3)):!0===i?c(e,t,a,r):_.each(m,function(e){var t=u+"/"+e+"?start="+h+"&end="+v;s(n.get(t).success(function(t){l.reports[e]=t,r(l.reports)}).error(p))})},l.getPageviews=function(e,t,n,a,o,i){return r(e,t,n,a,o,"pageviews",i)},l.getUsers=function(e,t,n,a,o,i){return r(e,t,n,a,o,"users",i)},l.getSessions=function(e,t,n,a,o,i){return r(e,t,n,a,o,"sessions",i)},l.getDailyActiveUsers=function(e,t,n,a,o,i){return r(e,t,n,a,o,"dau",i)},l.getFourOFours=function(e,t,n,a,o,i){return r(e,t,n,a,o,"daily404s",i)},l.getPageAnalytics=function(e,t,n,a,o,i){return r(e,t,n,a,o,"pageAnalytics",i)},l.getVisitorLocations=function(e,t,n,a,o,i){return r(e,t,n,a,o,"visitorLocations",i)},l.getVisitorLocationsByCountry=function(e,t,n,a,o,i){return r(e,t,n,a,o,"visitorLocationsByCountry",i)},l.getVisitorDevices=function(e,t,n,a,o,i){return r(e,t,n,a,o,"visitorDevices",i)},l.getSessionLength=function(e,t,n,a,o,i){return r(e,t,n,a,o,"sessionLength",i)},l.getTrafficSources=function(e,t,n,a,o,i){return r(e,t,n,a,o,"trafficSources",i)},l.getNewVsReturning=function(e,t,n,a,o,i){return r(e,t,n,a,o,"newVsReturning",i)},l.getUserAgents=function(e,t,n,a,o,i){return r(e,t,n,a,o,"userAgents",i)},l.getRevenue=function(e,t,n,a,o,i){return r(e,t,n,a,o,"revenue",i)},l.getOS=function(e,t,n,a,o,i){return r(e,t,n,a,o,"os",i)},l.getEmails=function(e,t,n,a,o,i){return r(e,t,n,a,o,"emails",i)},l.getUserTopSearches=function(e,t,n,a,o,i){return r(e,t,n,a,o,"topSearches",i)},l.getMostActiveUsers=function(e,t,n,a,o,i){return r(e,t,n,a,o,"mostActiveUsers",i)},l.loading={value:0},this.userAgentChart=function(e,t){t({options:{chart:{height:300},colors:["#41b0c7","#fcb252","#309cb2","#f8cc49","#f8d949"],title:{text:""},legend:{enabled:!0},exporting:{enabled:!1}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:"User Agents",data:e}],yAxis:{title:{text:"Visitors"}},credits:{enabled:!1}})},this.osChart=function(e,t){t({options:{chart:{height:300},colors:["#41b0c7","#fcb252","#309cb2","#f8cc49","#f8d949"],title:{text:""},legend:{enabled:!0},exporting:{enabled:!1}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},series:[{type:"pie",name:"OS",data:e}],yAxis:{title:{text:"Visitors"}},credits:{enabled:!1}})},this.revenueOverview=function(e,t){t({options:{chart:{spacing:[25,25,25,25]},colors:["#41b0c7","#fcb252","#993300","#f8cc49","#f8d949"],title:{text:null},subtitle:{text:""},tooltip:{headerFormat:"<b>{point.x:%b %d}</b><br>",pointFormat:'<b class="text-center">{point.y}</b>'},legend:{enabled:!0},exporting:{enabled:!1},plotOptions:{series:{marker:{enabled:!0,radius:3}}}},xAxis:{type:"datetime",labels:{format:"{value:%b %d}"},categories:e.xData},yAxis:[{labels:{format:"{value}"},title:{text:"Number Orders"},opposite:!0},{title:{text:"Revenue"},labels:{format:"${value} USD"}}],series:[{name:"Orders",type:"bar",yAxis:0,data:e.orderData,tooltip:{valueSuffix:" orders"}},{name:"Revenue",type:"spline",yAxis:1,data:e.amountData,tooltip:{valueSuffix:" usd",valuePrefix:"$"}}],credits:{enabled:!1}})},i.getAccount(function(e){l.account=e}),l}app.factory("SiteAnalyticsService",e),e.$inject=["$rootScope","$compile","$http","$q","$timeout","AccountService"]}(),function(){app.directive("ssbAccountTemplates",function(){return{restrict:"E",scope:{},templateUrl:"assets/js/ssb-site-builder/ssb-account-templates/ssb-account-templates.component.html",controller:"SiteBuilderAccountTemplatesController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r,c,l,u){function d(){i.getPages().then(function(e){p.state.pages=e.data,i.getAccount(),i.getSite(p.state.website._id).then(function(){i.setupTheme(p.state.website).then(function(){i.setPermissions(),p.redirectToEditor(),o(function(){p.uiState.loading=!1},5e3)})})})}var p=this;p.init=function(e){p.element=e,p.getAccountTemplates(),null===i.pages&&i.getPages()},p.selectAccountTemplate=function(e){p.uiState.loading=!0,e.isBlankTemplate?i.setSiteTemplate(e).then(function(e){e.data&&d()}):i.copyAccountTemplate(e._id).then(function(e){e.data&&d()})},p.getAccountTemplates=function(){i.getAccountTemplates().then(function(e){var t=e.data?e.data.reverse():[];i.getSiteTemplates().then(function(e){if(e.data){var e=e.data,n=_.find(e,function(e){return"Blank Page Template"===e.name});n&&(n.templateImageUrl=n.previewUrl,n.isBlankTemplate=!0,t.splice(0,0,n))}p.state.accountTemplates=t})})},p.redirectToEditor=function(){var e="",t=null,n=[];p.state.pages&&(n=Object.keys(p.state.pages)),n.length&&(e=(t=_.filter(p.state.pages,function(e){return"index"===e.handle})[0])&&t._id?t._id:p.state.pages[n[0]]._id),e?c.path("/website/site-builder/pages/"+e):p.uiState.loading=!1},p.state={},p.uiState={loading:!0};var m=e.$watchGroup([function(){return i.pages},function(){return i.website}],function(e){var t=e[0];t&&(t=_.reject(t,function(e){return"blog"===e.handle||"single-post"===e.handle||"coming-soon"===e.handle||"signup"===e.handle||"blog-list"===e.handle||"blog-post"===e.handle}));var n=e[1];t&&n&&n._id&&(m(),p.state.pages=t,p.state.website=n,0!==Object.keys(t).length||n.siteTemplateId?p.redirectToEditor():p.uiState.loading=!1)},!0)}app.controller("SiteBuilderAccountTemplatesController",e),e.$inject=["$scope","$attrs","$filter","$document","$timeout","SimpleSiteBuilderService","$modal","editableOptions","$location","SweetAlert","ContactService"]}(),function(){"use strict";function e(e){return{restrict:"E",controller:"SiteBuilderComponentLoaderController",controllerAs:"vm",bindToController:!0,scope:{component:"=",website:"=",state:"=",uiState:"=",componentClass:"&",componentStyle:"&",componentControl:"=",componentMedia:"=",sectionIndex:"=",componentIndex:"=",showComponent:"="},replace:!0,link:function(t,n,a,o){var i,s,r="<div "+o.component.type+'-component id="component_'+o.component._id+'" component="vm.component" class="ssb-component ssb-{{vm.component.type}} {{vm.componentClass(vm.component)}}" ng-attr-style="{{vm.componentStyle(vm.component)}}"  ng-if="vm.showComponent"></div>';o.uiState&&(r='<ssb-edit-control class="ssb-edit-control ssb-edit-control-component" component="vm.component" state="vm.state" ui-state="vm.uiState" section-index="vm.sectionIndex" component-index="vm.componentIndex"></ssb-edit-control>\n'+("<div "+o.component.type+'-component id="component_'+o.component._id+'" component="vm.component" website="vm.website" state="vm.state" ui-state="vm.uiState" ssb-editor="true" class="ssb-component ssb-{{vm.component.type}} {{vm.componentClass(vm.component)}}" ng-attr-style="{{vm.componentStyle(vm.component)}}" control="vm.componentControl"media="vm.componentMedia(componentId, index, update, fields)" ng-mouseenter="vm.hover($event);" ng-if="vm.showComponent"></div>')),s=e(r)(t),n.replaceWith(s),i=angular.element("#component_"+o.component._id),o.init(i)}}}app.directive("ssbComponentLoader",e),e.$inject=["$compile"]}(),function(){function e(e,t,n,a){var o=this;o.init=function(e){o.element=e}}app.controller("SiteBuilderComponentLoaderController",e),e.$inject=["$rootScope","$scope","$attrs","$filter"]}(),function(){"use strict";app.directive("ssbNavigationComponentLoader",function(){return{restrict:"E",scope:{link:"=",isSubLink:"=",currentpagehandle:"="},templateUrl:"/admin/assets/js/ssb-site-builder/ssb-components/shared/link_2.html",replace:!0,controller:["$scope",function(e){var t;window.indigenous&&window.indigenous.precache&&window.indigenous.precache.siteData&&window.indigenous.precache.siteData.pages&&(t=window.indigenous.precache.siteData.pages),e.toggleNavClass=function(e){var t=$(e.target).parents("li");t&&(t.hasClass("nav-active")?(t.removeClass("nav-active"),t.parents("section").remove("overflow_visible")):(t.parents("section").addClass("overflow_visible"),t.siblings().removeClass("nav-active"),t.addClass("nav-active")))},e.checkIfReloadPage=function(e){if(e&&e.data){if("blog"===e.data)return!0;if(t&&t[e.data]&&t[e.data].isBlogCopy)return!0}return!1}}]}})}(),function(){"use strict";app.directive("ssbNavigationComponentCssLoader",function(){return{restrict:"E",scope:{component:"="},templateUrl:"/admin/assets/js/ssb-site-builder/ssb-components/shared/navigation_style.html",replace:!0,controller:["$scope",function(e){e.defalultHover="#939597"}]}})}(),app.controller("SiteBuilderContactUsModalController",["$scope","$timeout","parentVm","toaster","SimpleSiteBuilderService","GeocodeService","hoursConstant",function(e,t,n,a,o,i,s){"use strict";var r=this;r.parentVm=n,r.component=n.state.page.sections[n.uiState.activeSectionIndex].components[n.uiState.activeComponentIndex],r.originalContactMap=angular.copy(r.component.location),r.place={},r.place.address=null,r.errorMapData=!1,r.showAddress=!1,r.hours=s,r.saveComponent=function(e){e&&(r.place.address=i.stringifyAddress(r.component.location))},r.updateContactUsAddress=function(){angular.equals(r.originalContactMap,r.component.location)||(r.locationAddress=null,r.setLatLon(),r.validateGeoAddress())},r.setLatLon=function(e,t){r.component.location.lat=e,r.component.location.lon=t},r.validateGeoAddress=function(n){i.validateAddress(r.component.location,r.locationAddress,function(a,o){a&&1===o.length?t(function(){e.$apply(function(){r.setLatLon(o[0].geometry.location.lat(),o[0].geometry.location.lng()),r.errorMapData=!1,angular.copy(r.component.location,r.originalContactMap)})},0):t(function(){e.$apply(function(){r.errorMapData=!0})},0),n&&n()})},r.validateHours=function(e,t){if(r.contactHours[t].valid=!0,!e.closed){var n=e.start,a=e.end;if(n&&a&&(n="pm"===n.split(" ")[1]&&"12"!==n.split(":")[0]?parseInt(n.split(":")[0],10)+12:parseInt(n.split(":")[0],10),a="pm"===a.split(" ")[1]&&"12"!==a.split(":")[0]?parseInt(a.split(":")[0],10)+12:parseInt(a.split(":")[0],10),n=30===parseInt(e.start.split(":")[1],10)?n+.5:n,a=30===parseInt(e.end.split(":")[1],10)?a+.5:a),e.split&&r.component.splitHours){angular.element("#business_hours_start_"+t).removeClass("has-error"),angular.element("#business_hours_start2_"+t).removeClass("has-error"),angular.element("#business_hours_end_"+t).removeClass("has-error");var o=e.start2,i=e.end2;o&&i&&(o="pm"===o.split(" ")[1]&&"12"!==o.split(":")[0]?parseInt(o.split(":")[0],10)+12:parseInt(o.split(":")[0],10),i="pm"===i.split(" ")[1]&&"12"!==i.split(":")[0]?parseInt(i.split(":")[0],10)+12:parseInt(i.split(":")[0],10),o=30===parseInt(e.start2.split(":")[1],10)?o+.5:o,i=30===parseInt(e.end2.split(":")[1],10)?i+.5:i),(n>a||n>o||n>i)&&(n>a?angular.element("#business_hours_start_"+t).addClass("has-error"):n>o?angular.element("#business_hours_start_"+t).addClass("has-error"):n>i&&angular.element("#business_hours_start_"+t).addClass("has-error"),r.contactHours[t].valid=!1),(a>o||a>i)&&(a>o?angular.element("#business_hours_end_"+t).addClass("has-error"):a>i&&angular.element("#business_hours_end_"+t).addClass("has-error"),r.contactHours[t].valid=!1),o>i&&(angular.element("#business_hours_start2_"+t).addClass("has-error"),r.contactHours[t].valid=!1)}else e.wholeday||(angular.element("#business_hours_start_"+t).removeClass("has-error"),n>a&&(angular.element("#business_hours_start_"+t).addClass("has-error"),r.contactHours[t].valid=!1))}var s=_.where(r.contactHours,{valid:!1});s&&s.length?r.contactHoursInvalid=!0:r.contactHoursInvalid=!1},r.setContactShowInfo=function(e,t){e.hideBusinessInfo=!t},r.contactHoursInvalid=!1,r.contactHours=[];var c=0;for(c;c<=6;c++)r.contactHours.push({valid:!0});var l={street_number:"short_name",route:"long_name",locality:"long_name",administrative_area_level_1:"short_name",postal_code:"short_name",country:"short_name"},u=function(){r.component.location.address="",r.component.location.address2="",r.component.location.city="",r.component.location.state="",r.component.location.zip="",r.component.location.country=""},d=function(e){u();var t,n,a=0;for(a;a<e.address_components.length;a++)t=e.address_components[a].types[0],l[t]&&(n=e.address_components[a][l[t]],"street_number"===t?r.component.location.address=n:"route"===t?r.component.location.address2=n:"locality"===t?r.component.location.city=n:"administrative_area_level_1"===t?r.component.location.state=n:"postal_code"===t?r.component.location.zip=n:"country"===t&&(r.component.location.country=n));r.component.location.lat=e.geometry.location.lat(),r.component.location.lon=e.geometry.location.lng()};r.place.address=i.stringifyAddress(r.component.location),e.$watch("vm.place.address",function(e){e&&angular.isObject(e)&&(d(e),r.locationAddress=e,r.setLatLon(),r.validateGeoAddress())})}]),app.controller("ssbPostSettingsModalCtrl",["$scope","$rootScope","$http","$timeout","$q","$compile","$filter","SimpleSiteBuilderBlogService",function(e,t,n,a,o,i,s,r){"use strict";e.availablePostTags=[],e.availablePostCategories=[];var c,l=r.blog.posts||[],u=[],d=[];u.push(_.pluck(l,"post_tags")),d.push(_.pluck(l,"post_categories")),u=_.uniq(_.flatten(u)),u=_.map(u,function(e){return e.text||e}),e.availablePostTags=_.uniq(u),c=_.uniq(_.without(_.flatten(d),null)),e.availablePostCategories=_.uniq(_.without(_.pluck(c,"text"),null))}]),app.controller("SiteBuilderSocialLinkModalController",["$timeout","parentVm",function(e,t){"use strict";var n=this;n.parentVm=t,n.setSelectedLink=function(e){n.social=e;var t=_.findWhere(n.component.networks,{name:e.name});n.social.selectedLink=t?e.name:null},n.saveSocialLink=function(e,t,a){angular.element("#social-link-name .error").html(""),angular.element("#social-link-name").removeClass("has-error"),angular.element("#social-link-url .error").html(""),angular.element("#social-link-url").removeClass("has-error");var o,i=_.findWhere(n.component.networks,{name:n.social.selectedLink}),s=function(e,t){angular.element("#"+e+" .error").html(t),angular.element("#"+e).addClass("has-error")};switch(a){case"add":if(!e||!e.name)return s("social-link-url","Please enter link url."),void s("social-link-url","Please select link icon.");if(!e.url||""===e.url)return void s("social-link-url","Link url can not be blank.");if(e.url&&!1===/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e.url))return void s("social-link-url","Link url incorrect format");if(o=_.findWhere(n.component.networks,{name:e.name}))return void s("social-link-name","Link icon already exists");if(_.findWhere(n.component.networks,{url:e.url}))return void s("social-link-url","Link url already exists");angular.element("#social-link-name .error").html(""),angular.element("#social-link-name").removeClass("has-error"),angular.element("#social-link-url .error").html(""),angular.element("#social-link-url").removeClass("has-error");break;case"update":if(e&&e.name&&e.url){var r=angular.copy(n.component.networks);(o=_.findWhere(r,{name:i.name})).name=e.name,o.url=e.url,o.icon=e.icon;var c=_.where(r,{name:e.name}),l=_.where(r,{url:e.url});if(c.length>1)return void s("social-link-name","Link icon already exists");if(l.length>1)return void s("social-link-name","Link url already exists")}}n.updateSocialNetworks(i,a,e),n.social={},n.meetTeamIndex=null,n.parentVm.closeModal()},n.updateSocialNetworks=function(t,a,o){var i;switch(a){case"add":o&&o.name&&o.url&&n.component.networks.push({name:o.name,url:o.url,icon:o.icon});break;case"update":o&&o.name&&o.url&&((i=_.findWhere(n.component.networks,{name:t.name})).name=o.name,i.url=o.url,i.icon=o.icon);break;case"delete":e(function(){if(i=_.findWhere(n.component.networks,{name:t.name})){var e=n.component.networks.indexOf(i);n.component.networks.splice(e,1)}},500)}},n.component=t.state.page.sections[t.uiState.activeSectionIndex].components[t.uiState.activeComponentIndex],n.social={}}]),function(){"use strict";app.directive("ssbBlogPostCardComponent",function(){return{restrict:"A",controller:"SiteBuilderBlogPostCardComponentController",controllerAs:"vm",bindToController:!0,scope:{ssbEditor:"=",componentClass:"&",component:"=",post:"=?",compactView:"=?",filteredPostView:"=?"},templateUrl:"/admin/assets/js/ssb-site-builder/ssb-components/ssb-blog-post/ssb-blog-post-card/ssb-blog-post-card.component.html",replace:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o){var i=this;i.init=function(e){i.element=e,i.post||i.initData()},i.getPublishedDate=function(e){if(e)return Date.parse(e)},i.initData=function(){var e=o.loadDataFromPage("script#indigenous-precache-sitedata-posts");e&&e.length&&(i.post=e[0])},i.getFeaturedImageUrl=function(e){if(e)return e.replace(/^(http|https):/i,"")},i.encodeUrlText=function(e){return encodeURI(e)},i.titleStyle=function(){var e=" ";return i.component&&i.component.settings&&i.component.settings.title&&i.component.settings.title.fontSize&&(e+="font-size: "+i.component.settings.title.fontSize+"px !important;"),i.component&&i.component.settings&&i.component.settings.title&&i.component.settings.title.fontFamily&&(e+="font-family: "+i.component.settings.title.fontFamily+"px !important;"),i.component&&i.component.settings&&i.component.settings.title&&i.component.settings.title.color&&(e+="color: "+i.component.settings.title.color+"!important;"),e},i.descriptionStyle=function(){var e=" ";return i.component&&i.component.settings&&i.component.settings.description&&i.component.settings.description.fontSize&&(e+="font-size: "+i.component.settings.description.fontSize+"px !important;"),i.component&&i.component.settings&&i.component.settings.description&&i.component.settings.description.fontFamily&&(e+="font-family: "+i.component.settings.description.fontFamily+"px !important;"),i.component&&i.component.settings&&i.component.settings.description&&i.component.settings.description.color&&(e+="color: "+i.component.settings.description.color+"!important;"),e}}app.controller("SiteBuilderBlogPostCardComponentController",e),e.$inject=["$scope","$attrs","$filter","$location","SimpleSiteBuilderBlogService"]}(),function(){"use strict";app.directive("ssbBlogPostDetailComponent",function(){return{restrict:"A",controller:"SiteBuilderBlogPostDetailComponentController",controllerAs:"vm",bindToController:!0,scope:{ssbEditor:"=",componentClass:"&",component:"=",post:"=?"},templateUrl:"/admin/assets/js/ssb-site-builder/ssb-components/ssb-blog-post/ssb-blog-post-detail/ssb-blog-post-detail.component.html",replace:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s){var r=this;r.init=function(e){r.element=e,r.showSocialShareif=window.indigenous&&window.indigenous.blogSocialSharing,s.has("AccountService")&&s.get("AccountService").getAccount(function(e){e&&e.showhide&&!1!==e.showhide.blogSocialSharing&&(r.showSocialShare=!0)}),r.post||r.initData()},r.initData=function(){window.indigenous.precache=window.indigenous.precache||{},window.indigenous.precache.siteData=window.indigenous.precache.siteData||{};var e=i.loadDataFromPage("#indigenous-precache-sitedata-posts")||window.indigenous.precache.siteData.posts,t=window.indigenous.precache.siteData.post;t?r.post=t:e&&(r.post=e[0])},r.getFeaturedImageUrl=function(e){if(e)return e.replace(/^(http|https):/i,"")},r.encodeUrlText=function(e){return encodeURI(e)},r.floatSocialShareLinks=function(){return $(window).width()>600&&window.indigenous&&window.indigenous.precache&&window.indigenous.precache.siteData&&(window.indigenous.precache.siteData.posts||window.indigenous.precache.siteData.post)},r.showSocialShare=!1}app.controller("SiteBuilderBlogPostDetailComponentController",e),e.$inject=["$scope","$attrs","$filter","$transclude","$location","SimpleSiteBuilderBlogService","$injector"]}(),function(){"use strict";app.directive("ssbBlogPostListComponent",function(){return{restrict:"A",controller:"SiteBuilderBlogPostListComponentController",controllerAs:"vm",bindToController:!0,scope:{ssbEditor:"=",componentClass:"&",component:"=",blog:"=?",website:"="},templateUrl:"/admin/assets/js/ssb-site-builder/ssb-components/ssb-blog-post/ssb-blog-post-list/ssb-blog-post-list.component.html",replace:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a){var o=this,i=a.$$url.replace("/page/","");o.init=function(e){o.element=e,o.blog.posts.length||o.initData()},o.initData=function(){var t=e.loadDataFromPage("#indigenous-precache-sitedata-posts")||window.indigenous.precache.siteData.posts;t&&(o.filteredPostView&&(o.blog.currentAuthor&&(t=t.filter(function(e){return e.post_author===o.blog.currentAuthor})),o.blog.currentTag&&(t=t.filter(function(e){if(e.post_tags)return _.some(e.post_tags,function(e){return e.toLowerCase()===o.blog.currentTag.toLowerCase()})})),o.blog.currentCategory&&(t=t.filter(function(e){if(e.post_categories)return _.some(e.post_categories,function(e){return e.text?e.text.toLowerCase()===o.blog.currentCategory.toLowerCase():e.toLowerCase()===o.blog.currentCategory.toLowerCase()})}))),o.blog.posts=t)},o.hasFeaturedPosts=!1,i&&(i=decodeURI(i)),o.blog=e.blog||{},o.sortBlogPosts=function(e){return new Date(e.publish_date||e.created.date).getTime()},o.filteredPostView=!1,o.listArticleStyle=function(e){var t=" ";return e&&e.articleBorder&&e.articleBorder.show&&e.articleBorder.color&&(t+="border-color: "+e.articleBorder.color+";",t+="border-width: "+e.articleBorder.width+"px;",t+="border-style: "+e.articleBorder.style+";",t+="border-radius: "+e.articleBorder.radius+"%;"),t},i.indexOf("tag/")>-1&&(o.blog.currentTag=i.replace("/tag/",""),o.filteredPostView=!0),i.indexOf("author/")>-1&&(o.blog.currentAuthor=i.replace("/author/",""),o.filteredPostView=!0),i.indexOf("category/")>-1&&(o.blog.currentCategory=i.replace("/category/",""),o.filteredPostView=!0),t.$watchCollection("vm.filtered.posts",function(e){e&&(o.website?(n(function(){o.featuredPosts=angular.copy(_.filter(e,function(e){return e.featured})),t.$broadcast("$refreshSlickSlider")},0),n(function(){$(window).resize()},2e3)):(o.featuredPosts=angular.copy(_.filter(e,function(e){return e.featured})),0===a.$$path.indexOf("/preview/")&&n(function(){t.$broadcast("$refreshSlickSlider"),$(window).resize()},1e3)))},!0),t.$watch("vm.website.settings.defaultBlogTemplateWidth",function(e){angular.isDefined(e)&&n(function(){t.$broadcast("$refreshSlickSlider")},0)})}app.controller("SiteBuilderBlogPostListComponentController",e),e.$inject=["SimpleSiteBuilderBlogService","$scope","$timeout","$location"]}(),function(){"use strict";function e(e,t,n){function a(e){return e.finally(function(){}),e}var o={},i="/api/2.0/cms/blog";return o.loadDataFromPage=function(e){var t,n=$(e).html();if(angular.isDefined(n))return t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#x2F;":"/","&apos;":"'"},JSON.parse(function(e){return String(e).replace(/(&amp;|&lt;|&gt;|&quot;|&#39;|&#x2f;|&apos;)/g,function(e){return t[e]||e})}(n))},o.getPost=function(e){return a(n({url:i+"/post/"+e._id,method:"GET"}).success(function(e){var t=_.findIndex(o.blog.posts,{_id:e._id});t>-1&&(o.blog.posts[t]=e)}).error(function(e){}))},o.getPosts=function(){},o.savePost=function(e){function t(e){var t=_.findIndex(o.blog.posts,{_id:e._id});t>-1?o.blog.posts[t]=e:o.blog.posts.push(e)}function s(e){}return a(e._id?n({url:i+"/post/"+e._id,method:"PUT",data:angular.toJson(e)}).success(t).error(s):n({url:i+"/post/",method:"POST",data:angular.toJson(e)}).success(t).error(s))},o.deletePost=function(e){var t=e._id;return a(n({url:i+"/post/"+e._id,method:"delete",data:angular.toJson(e)}).success(function(e){o.blog.posts=_.without(o.blog.posts,_.findWhere(o.blog.posts,{_id:t}))}).error(function(e){}))},o.duplicatePost=function(e){return a(n({url:i+"/duplicate/post/",method:"POST",data:angular.toJson(e)}).success(function(e){o.blog.posts.push(e)}).error(function(e){}))},o.blog={posts:[],postFilters:["all","published","draft","featured"]},o}app.factory("SimpleSiteBuilderBlogService",e),e.$inject=["$rootScope","$compile","$http"]}(),function(){"use strict";function e(e,t,n){return{restrict:"A",link:function(a){angular.element(document).ready(function(){var o=a.$watch(function(){return angular.element(".ssb-theme-btn").length},function(i,s){i&&(o(),e(function(){var o=angular.element(".ssb-theme-btn"),i=angular.element("a[href]");o.each(function(){var e=$(this),t={hover:{bg:{color:null}},pressed:{bg:{color:null}}},n={bg:{color:e.css("background-color")},txtcolor:e.css("color")},a=e.attr("data-ssb-hover-style"),o=e.attr("data-ssb-active-style");if(a){var i=$('<div style="'+a+'"></div>').get(0).style,s=i.backgroundColor,r=i.color;t.hover.bg.color=s,t.hover.txtcolor=r}if(o){var c=$('<div style="'+o+'"></div>').get(0).style,l=c.backgroundColor,u=c.color;t.pressed.bg.color=l,t.pressed.txtcolor=u}(a||o)&&(e.hover(function(){this.style.setProperty("background-color",t.hover.bg.color,"important"),this.style.setProperty("color",t.hover.txtcolor,"important")},function(){this.style.setProperty("background-color",n.bg.color,"important"),this.style.setProperty("color",n.txtcolor,"important")}),e.on("mousedown touchstart",function(){this.style.setProperty("background-color",t.pressed.bg.color,"important"),this.style.setProperty("color",t.pressed.txtcolor,"important")}))}),i.each(function(){var o=$(this);if(o.attr("href")&&void 0===o.attr("target")&&o.attr("href").indexOf("/blog")>-1&&o.attr("href").indexOf(t.host())>-1&&o.attr("target","_self"),o.attr("href")&&"emikagifts.indigenous.io"===t.$$host&&("/shop"===o.attr("href")||o.attr("href").match("emikagifts.indigenous.io/shop"))&&o.attr("target","_self"),o.attr("href")&&"emikagifts.com"===t.$$host&&("/shop"===o.attr("href")||o.attr("href").match("emikagifts.com/shop"))&&o.attr("target","_self"),o.attr("href")&&o.attr("href").indexOf("#")>=0&&o.attr("href").length>1){var i=0===o.attr("href").indexOf("#");if(i||(i=o.attr("href").indexOf(window.location.href)>-1),i)if(o.attr("du-smooth-scroll",""),o.hasClass("ssb-theme-btn")){var s=o.css("background-color"),r=o.css("color"),c=o.css("border"),l=o.css("padding"),u=o.css("margin");n(o)(a),e(function(){o.css("background-color",s),o.css("color",r),o.css("border",c),o.css("padding",l),o.css("margin",u)},0)}else n(o)(a)}})},1500))})})}}}app.directive("ssbDataStyles",e),e.$inject=["$timeout","$location","$compile"]}(),app.filter("ssbPostFilter",function(){"use strict";return function(e,t,n){function a(e){var n=t.postTags;if(!(n&&n.length>0))return!0;if(e.post_tags){var a=_.map(e.post_tags,function(e){return e.text||e});return _.intersection(n,a).length>0}}function o(e){var n=t.postCategories;return!(n&&n.length>0)||(e.post_categories?_.intersection(n,_.pluck(e.post_categories,"text")).length>0:void 0)}return function(e){var t=[];return _.each(e,function(e){a(e)&&o(e)&&t.push(e)}),n&&(t=_.filter(t,function(e){return e.featured})),t}(e)}}),app.controller("SiteBuilderFormBuilderModalController",["$scope",function(e){"use strict";var t=this,n=e.$parent.vm;t.addCustomField=n.addCustomField,t.checkDuplicateField=n.checkDuplicateField,t.closeModal=n.closeModal,t.component=n.state.page.sections[n.uiState.activeSectionIndex].components[n.uiState.activeComponentIndex]}]),function(){"use strict";app.directive("ssbFormBuilderComponent",function(){return{restrict:"A",controller:"SiteBuilderFormBuilderComponentController",controllerAs:"vm",bindToController:!0,scope:{ssbEditor:"=",componentClass:"&",component:"="},templateUrl:"/admin/assets/js/ssb-site-builder/ssb-components/shared/ssb-component-wrap.html",replace:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r){function c(e){e.style.setProperty("border-color","none","important"),e.style.setProperty("border-width","0px","important"),e.style.setProperty("border-radius","none%","important"),e.style.setProperty("border-style","none","important")}function l(e){return e.replace(/[^\w-\s]/gi,"")}function u(){d.component.campaignId&&o.has("campaignService")&&(campaignService=o.get("campaignService"),campaignService.getCampaign(d.component.campaignId,function(e){d._campaignObj=e}))}var d=this;d.init=function(e){d.element=e,u()},d.userExists=!1,d.formBuilder={},d.originalData={bg:{}},d.elementClass=".form-builder-"+d.component._id+" .form-submit-button",d.fieldClass=function(){var e="col-sm-12";return d.component.formSettings&&d.component.formSettings.fieldsPerRow>0&&(e="col-sm-"+Math.floor(12/d.component.formSettings.fieldsPerRow),d.component.formSettings.spacing&&d.component.formSettings.spacing.pr&&(d.nthRow="nth-row"+d.component.formSettings.fieldsPerRow)),e},d.fieldStyle=function(e){var t=" ";return e&&(e.spacing&&e.spacing.mb&&(t+="margin-bottom: "+e.spacing.mb+"px;"),e.fieldsPerRow&&(t+="min-width:"+Math.floor(100/e.fieldsPerRow)+"%")),t},d.inputStyle=function(e){var t=" ";return e&&(e.inputTextSize&&(t+="font-size: "+e.inputTextSize+"px !important;"),e.inputFontFamily&&(t+="font-family: "+e.inputFontFamily+"!important;"),e.inputBgColor&&(t+="background-color: "+e.inputBgColor+"!important;"),e.inputBorderColor&&(t+="border-color: "+e.inputBorderColor+";"),e.inputTextColor&&(t+="color: "+e.inputTextColor+";")),t},d.inputContainerStyle=function(e){var t=" ";return e&&("left"===e.align||"right"===e.align?t+="float: "+e.align+" !important;":"center"===e.align&&(t+="margin: 0 auto !important; float:none !important;")),t},d.buttonStyle=function(e){var t="";return e&&(e.align&&("left"===e.align||"right"===e.align?t+="float: "+e.align+" !important;":"center"===e.align&&(t+="margin: 0 auto !important; float:none !important;")),e.bg&&e.bg.color&&(t+=" background-color: "+e.bg.color+"!important;",t+=" border-color: "+e.bg.color+";",d.originalData.bg.color=e.bg.color,d.originalData.borderColor=e.bg.color),e.txtcolor&&(t+=" color: "+e.txtcolor+"!important;",d.originalData.txtcolor=e.txtcolor),e.border&&e.border.show&&(e.border.color&&(t+=" border-color: "+e.border.color+"  !important;",d.originalData.btn={},d.originalData.btn.border=e.border),e.border.width&&(t+=" border-width: "+e.border.width+"px   !important;"),e.border.radius||(e.border.radius=0),t+=" border-radius: "+e.border.radius+"%  !important;",e.border.style?t+=" border-style: "+e.border.style+" !important;":t+=" border-style: none !important;")),t},d.formStyle=function(e){var t="";return e&&(e.formFontFamily&&(t+="font-family: "+e.formFontFamily+";"),e.formTextColor&&(t+="color: "+e.formTextColor+";")),t},d.addCustomField=function(e){},d.addPattern=function(e){if("email"===e.name)return d.formValidations.email},d.inputFieldClass=function(e){if("phone"===e.name)return"ind-international-tel-number"},d.checkDuplicateEmail=function(e){return"email"===e.name&&d.userExists},d.formValidations=i,d.formFiedlsCHange=function(t){"email"===t.name&&(d.userExists&&(e.setinvalid=!1),d.userExists=!1)},d.nthRow="nth-row",d.isEditing=e.$parent.vm&&e.$parent.vm.uiState,d._campaignObj=null,d.removeBorderStyle=function(e){e.style.setProperty("border-color","transparent","important"),e.style.setProperty("border-width","1px","important"),e.style.setProperty("border-radius","4px","important"),e.style.setProperty("border-style","solid","important")},d.setBorderStyle=function(e,t){d.removeBorderStyle(e),t.border&&t.border.show&&(c(e),t.border.color&&e.style.setProperty("border-color",t.border.color,"important"),t.border.width&&e.style.setProperty("border-width",t.border.width+"px","important"),t.border.radius||(t.border.radius=0),e.style.setProperty("border-radius",t.border.radius+"%","important"),t.border.style&&e.style.setProperty("border-style",t.border.style,"important"))},d.createUser=function(t){if(e.setinvalid=!0,!e.$parent.vm.state){o.has("userService")&&(userService=o.get("userService")),o.has("ipCookie")&&(ipCookie=o.get("ipCookie"));var n,a,i,c,u=(new Fingerprint).get(),p="",m="";if(sessionId=ipCookie("session_cookie")?ipCookie("session_cookie").id:null,d.component.skipWelcomeEmail&&(a=!0),n="true"===d.component.sendEmail,!d.component.campaignId||n?d.component.campaignId="":i=d.component.campaignId,c=[],d._campaignObj&&angular.isDefined(d._campaignObj.searchTags)&&d._campaignObj.searchTags.tags.length&&(c=_.uniq(_.pluck(d._campaignObj.searchTags.tags,"data"))),d.formBuilder.name){var g=d.formBuilder.name.split(/ (.+)?/);p=g[0],g.length>1&&(m=g[1])}var f=[];_.filter(d.component.contactInfo,function(e){return 1==e.custom||"message"===e.name}).forEach(function(e){f.push({name:e.name,label:e.label,value:d.formBuilder[e.name]||null})});var h,v=r.$$search,b=angular.copy(d.formBuilder);angular.isObject(v)&&Object.keys(v).length&&_.each(v,function(e,t){f.push({name:l(t),value:l(e)}),b[t]=e}),h={fingerprint:u,sessionId:sessionId,first:p,last:m,details:[{emails:[],phones:[],addresses:[]}],campaignId:i,campaignTags:c,emailId:d.component.emailId,sendEmail:d.component.sendEmail,skipWelcomeEmail:a,fromEmail:d.component.fromEmail,fromName:d.component.fromName,contact_type:d.component.tags,uniqueEmail:d.component.uniqueEmail||!1,activity:{activityType:"CONTACT_FORM",note:d.formBuilder.Message||"Contact form data.",sessionId:ipCookie("session_cookie")?ipCookie("session_cookie").id:null,contact:b},extra:f},d.formBuilder.email&&h.details[0].emails.push({email:d.formBuilder.email}),d.formBuilder.phone&&h.details[0].phones.push({number:d.formBuilder.phone,type:"m"}),(d.formBuilder.address||d.formBuilder.city||d.formBuilder.state||d.formBuilder.zip||d.formBuilder.country)&&h.details[0].addresses.push({address:d.formBuilder.address,city:d.formBuilder.city,state:d.formBuilder.state,country:d.formBuilder.country,zip:d.formBuilder.zip,ssb:!0}),h.optIn=d.formBuilder._optin,userService.addContact(h,function(n,a){if(a&&409===a.code)d.userExists=!0;else if(a&&409!==a.code)d.formError=!0,s(function(){d.formError=!1},5e3);else if(n){if(d.component.facebookConversionCode){var o=window._fbq||(window._fbq=[]);if(!o.loaded){var i=document.createElement("script");i.async=!0,i.src="//connect.facebook.net/en_US/fbds.js";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(i,r),o.loaded=!0}window._fbq=window._fbq||[],window._fbq.push(["track",d.component.facebookConversionCode,{value:"0.00",currency:"USD"}])}d.formSuccess=!0,d.formBuilder={},t.$setPristine(!0),s(function(){d.formSuccess=!1},3e3),d.component.redirect&&s(function(){"page"===d.component.redirectType?window.location.href=d.component.redirectUrl:"external"===d.component.redirectType&&(window.location.href="http://"+d.component.redirectUrl)},2e3),e.setinvalid=!1}})}},angular.element(document).ready(function(){var t=e.$watch(function(){return angular.element(d.elementClass).length},function(e,n){e&&(t(),s(function(){var e=angular.element(d.elementClass),t={bg:{color:e.css("background-color")},txtcolor:e.css("color"),borderColor:e.css("border-color")},n=null;e&&(e.hover(function(){var e=null;d.component.formSettings&&d.component.formSettings.btnStyle&&d.component.formSettings.btnStyle.hover&&(e=d.component.formSettings.btnStyle.hover),e?(e.bg&&e.bg.color&&(this.style.setProperty("background-color",e.bg.color,"important"),this.style.setProperty("border-color",e.bg.color,"important")),d.setBorderStyle(this,e)):d.removeBorderStyle(this),e&&e.txtcolor&&this.style.setProperty("color",e.txtcolor,"important")},function(){this.style.setProperty("background-color",d.originalData.bg.color||t.bg.color,"important"),this.style.setProperty("color",d.originalData.txtcolor||t.txtcolor,"important"),this.style.setProperty("border-color",d.originalData.borderColor||t.borderColor,"important");var e=d.originalData.btn||d.component.btn;e?d.setBorderStyle(this,e):d.removeBorderStyle(this)}),e.on("mousedown touchstart",function(){d.component.formSettings&&d.component.formSettings.btnStyle&&d.component.formSettings.btnStyle.pressed&&(n=d.component.formSettings.btnStyle.pressed),n?(n.bg&&n.bg.color&&(this.style.setProperty("background-color",n.bg.color,"important"),this.style.setProperty("border-color",n.bg.color,"important")),d.setBorderStyle(this,n)):d.removeBorderStyle(this),n&&n.txtcolor&&this.style.setProperty("color",n.txtcolor,"important")}),e.on("mouseup touchend",function(){var e=this;s(function(){e.style.setProperty("background-color",d.originalData.bg.color||t.bg.color,"important"),e.style.setProperty("color",d.originalData.txtcolor||t.txtcolor,"important"),e.style.setProperty("border-color",d.originalData.borderColor||t.borderColor,"important");var n=d.originalData.btn||d.component.btn;n?d.setBorderStyle(e,n):d.removeBorderStyle(e)},1e3)}))},500))})})}app.controller("SiteBuilderFormBuilderComponentController",e),e.$inject=["$scope","$attrs","$filter","$transclude","$injector","formValidations","$timeout","$location"]}(),function(){"use strict";app.directive("ssbFormDonateComponent",function(){return{restrict:"A",controller:"SiteBuilderFormDonateComponentController",controllerAs:"vm",bindToController:!0,scope:{ssbEditor:"=",componentClass:"&",component:"="},templateUrl:"/admin/assets/js/ssb-site-builder/ssb-components/shared/ssb-component-wrap.html",replace:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r,c,l,u,d){function p(){o.has("ipCookie")&&(ipCookie=o.get("ipCookie"));var e,t=(new Fingerprint).get(),n=ipCookie("session_cookie")?ipCookie("session_cookie").id:null;y.component.skipWelcomeEmail&&(e=!0);var a;y.component.campaignId?a=y.component.campaignId:y.component.campaignId="";var i="",s="";if(y.formBuilder.name){var r=y.formBuilder.name.split(/ (.+)?/);i=r[0],r.length>1&&(s=r[1])}else y.formBuilder.FirstName&&(i=y.formBuilder.FirstName),y.formBuilder.LastName&&(s=y.formBuilder.LastName);var l=[];_.filter(y.component.contactInfo,function(e){return 1==e.custom}).forEach(function(e,t){l.push({name:e.name,label:e.label,value:e.name?y.formBuilder[e.name]||y.formBuilder[e.name.toLowerCase()]:null})}),y.product.tags&&(y.product.tags=_.map(y.product.tags,function(e){return e.toLowerCase()})),y.component.tags&&(y.component.tags=_.map(y.component.tags,function(e){return e.toLowerCase()}));var u={fingerprint:t,sessionId:n,first:i,last:s,details:[{emails:[],phones:[],addresses:[]}],campaignId:a,emailId:y.component.emailId,sendEmail:y.component.sendEmail,skipWelcomeEmail:e,fromEmail:y.component.fromEmail,fromName:y.component.fromName,contact_type:y.component.contact_type,tags:y.product.tags?_.uniq(_.flatten([y.product.tags,y.component.tags])):_.uniq(y.component.tags),uniqueEmail:y.component.uniqueEmail||!1,activity:{activityType:"DONATE_FORM",note:y.formBuilder.Message||"Donate form data.",sessionId:ipCookie("session_cookie")?ipCookie("session_cookie").id:null,contact:y.formBuilder},extra:l};y.formBuilder.email&&u.details[0].emails.push({email:y.formBuilder.email}),y.formBuilder.phone&&u.details[0].phones.push({number:y.formBuilder.phone,type:"m"}),(y.formBuilder.address||y.formBuilder.city||y.formBuilder.state||y.formBuilder.zip||y.formBuilder.country)&&u.details[0].addresses.push({address:y.formBuilder.address,city:y.formBuilder.city,state:y.formBuilder.state,country:y.formBuilder.country,zip:y.formBuilder.zip});var d=c.absUrl().split("?")[0],p={cancelUrl:d+"?state=2&comp=donation",returnUrl:d+"?state=5&comp=donation&amount="+y.formBuilder.amount,isAnonymous:y.isAnonymous,customer:u,session_id:null,status:"pending_payment",cart_discount:0,total_discount:0,total_shipping:0,total_tax:0,shipping_tax:0,cart_tax:0,currency:"usd",line_items:[],total_line_items_quantity:1,payment_details:{method_title:"Credit Card Payment",method_id:"cc",card_token:null,charge_description:null,statement_description:null,paid:!0},shipping_methods:"",shipping_address:{first_name:u.first,last_name:u.last,phone:y.formBuilder.phone||"",city:u.details[0].addresses.length?u.details[0].addresses[0].city:"",country:"US",address_1:u.details[0].addresses.length?u.details[0].addresses[0].address:"",company:"",postcode:u.details[0].addresses.length?u.details[0].addresses[0].zip:"",email:u.details[0].emails.length?u.details[0].emails[0].email:"",address_2:u.details[0].addresses.length?u.details[0].addresses[0].address2:"",state:u.details[0].addresses.length?u.details[0].addresses[0].state:""},billing_address:{first_name:u.first,last_name:u.last,phone:y.formBuilder.phone||"",city:u.details[0].addresses.length?u.details[0].addresses[0].city:"",country:"US",address_1:u.details[0].addresses.length?u.details[0].addresses[0].address:"",company:"",postcode:u.details[0].addresses.length?u.details[0].addresses[0].zip:"",email:u.details[0].emails.length?u.details[0].emails[0].email:"",address_2:u.details[0].addresses.length?u.details[0].addresses[0].address2:"",state:u.details[0].addresses.length?u.details[0].addresses[0].state:""},notes:[]},m=parseFloat(y.formBuilder.amount),g={product_id:y.product._id,quantity:1,sale_price:m,regular_price:m,variation_id:"",tax_class:null,sku:"",total:m,name:y.product.name,total_tax:"0.00",type:y.product.type};return p.line_items.push(g),p}function m(){y.component.campaignId&&o.has("campaignService")&&(campaignService=o.get("campaignService"),campaignService.getCampaign(y.component.campaignId,function(e){y._campaignObj=e}))}var g=null,f=null,h=null,v=null,b="order_cookie";o.has("ProductService")&&(g=o.get("ProductService")),o.has("productService")&&(g=o.get("productService")),o.has("localStorageService")&&(f=o.get("localStorageService"),v=f.get(b)),o.has("$routeParams")&&(h=o.get("$routeParams"));var y=this;y.init=function(t){y.element=t,$(y.element).find(".modal").on("hidden.bs.modal",function(){5==y.checkoutModalState&&y.close()}),e.$watch("vm.component.productSettings.product",function(e){e&&y.getProduct()}),y.component.productSettings&&(y.getProduct(),y.getCredentials(),y.setInitialCheckoutState()),m()},y.userExists=!1,y.formBuilder={},y.checkoutModalState=1,y.showPaypalErrorMsg=!1,y.showPaypalLoading=!1,y.isAnonymous=!1,y.paypalLoginClickFn=function(){screen.width<769?(new PAYPAL.apps.DGFlowMini({trigger:"submitBtn"}),$("#payPalDonateform").submit()):new PAYPAL.apps.DGFlow({expType:null}).startFlow(c.absUrl());y.closeModalFn(),angular.element("body").hide(),s(function(){angular.element("body").show()},3e3)},y.paypalURL=r.trustAsResourceUrl(u.paypalCheckoutURL),y.facebookClientID=u.facebookClientID,y.fieldClass=function(e){var t="col-sm-12";return y.component.formSettings&&y.component.formSettings.fieldsPerRow>0&&(t="col-sm-"+Math.floor(12/y.component.formSettings.fieldsPerRow),y.component.formSettings.spacing&&y.component.formSettings.spacing.pr&&(y.nthRow="nth-row"+y.component.formSettings.fieldsPerRow)),t},y.fieldStyle=function(e){var t=" ";return e&&e.spacing&&e.spacing.mb&&(t+="margin-bottom: "+e.spacing.mb+"px;"),e&&e.fieldsPerRow&&(t+="min-width:"+Math.floor(100/e.fieldsPerRow)+"%"),t},y.inputStyle=function(e){var t=" ";return e&&(e&&e.inputTextSize&&(t+="font-size: "+e.inputTextSize+"px !important;"),e&&e.inputFontFamily&&(t+="font-family: "+e.inputFontFamily+"!important;"),e&&e.inputBgColor&&(t+="background-color: "+e.inputBgColor+"!important;"),e&&e.inputBorderColor&&(t+="border-color: "+e.inputBorderColor+";"),e&&e.inputTextColor&&(t+="color: "+e.inputTextColor+";")),t},y.inputContainerStyle=function(e){var t=" ";return e&&("left"!==e.align&&"right"!==e.align||(t+="float: "+e.align+" !important;"),"center"===e.align&&(t+="margin: 0 auto !important; float:none !important;")),t},y.buttonStyle=function(e){var t="";return e&&e.align&&("left"!==e.align&&"right"!==e.align||(t+="float: "+e.align+" !important;"),"center"===e.align&&(t+="margin: 0 auto !important; float:none !important;")),t},y.formStyle=function(e){var t="";return e&&(e.formFontFamily&&(t+="font-family: "+e.formFontFamily+";"),e.formTextColor&&(t+="color: "+e.formTextColor+";")),t},y.addCustomField=function(e){},y.addPattern=function(e){return"phone"===e.name?y.formValidations.phone:"email"===e.name?y.formValidations.email:void 0},y.formValidations=i,y.setCheckoutState=function(e){y.checkoutModalState=e},y.paypalPayment=function(){if(y.showPaypalLoading=!0,o.has("orderService")){var e=o.get("orderService"),t=p();e.createPaypalOrder(t,function(e){if(y.order=e,y.showPaypalLoading=!1,e&&!e._id){var t="Error in order processing";return e.message&&(t=e.message),y.checkoutModalState=5,void(y.failedOrderMessage=t)}y.checkoutModalState=3,f.set(b,e),y.paypalKey=e.payment_details.payKey,y.checkoutExpType=screen.width<769?"mini":"light"})}},y.checkCardNumber=function(){y.failedOrderMessage="",$(".donation-v1 #number").val()?($(".donation-v1 #card_number .error").html(""),$(".donation-v1 #card_number").removeClass("has-error").addClass("has-success"),$(y.element).find("#card_number .glyphicon").removeClass("glyphicon-remove").addClass("glyphicon-ok")):($(".donation-v1 #card_number .error").html("Card Number Required"),$(".donation-v1 #card_number").addClass("has-error"),$(".donation-v1 #card_number .glyphicon").addClass("glyphicon-remove"))},y.checkCardName=function(){y.failedOrderMessage="",$(".donation-v1 #card_name #name").val()?($(".donation-v1 #card_name .error").html(""),$(".donation-v1 #card_name").removeClass("has-error").addClass("has-success"),$(".donation-v1 #card_name .glyphicon").removeClass("glyphicon-remove").addClass("glyphicon-ok")):($(".donation-v1 #card_name .error").html("Card Name Required"),$(".donation-v1 #card_name").addClass("has-error"),$(".donation-v1 #card_name .glyphicon").addClass("glyphicon-remove"))},y.checkCardCvv=function(){y.failedOrderMessage="",$(".donation-v1 #cvc").val()?($(".donation-v1 #card_cvc .error").html(""),$(".donation-v1 #card_cvc").removeClass("has-error").addClass("has-success"),$(".donation-v1 #card_cvc .glyphicon").removeClass("glyphicon-remove").addClass("glyphicon-ok")):($(".donation-v1 #card_cvc .error").html("CVC Required"),$(".donation-v1 #card_cvc").addClass("has-error"),$(".donation-v1 #card_cvc .glyphicon").addClass("glyphicon-remove"))},y.checkCardExpiry=function(){y.isCardExpired=!1,y.failedOrderMessage="";var e,t=$(".donation-v1 #expiry").val(),n=t.split("/"),a=n[0].trim();if(n.length>1&&(e=n[1].trim()),t&&a&&e){if(y.yearLength=e.length,2==y.yearLength){if(parseInt(e)<parseInt(y.currentYear))return $(".donation-v1 #card_expiry .error").html("Card Year has Expired"),$(".donation-v1 #card_expiry").addClass("has-error"),$(".donation-v1 #card_expiry .glyphicon").addClass("glyphicon-remove"),void(y.isCardExpired=!0)}else if(4==y.yearLength){if(parseInt(e)<parseInt(y.fullCurrentYear))return $(".donation-v1 #card_expiry .error").html("Card Year has Expired"),$(".donation-v1 #card_expiry").addClass("has-error"),$(".donation-v1 #card_expiry .glyphicon").addClass("glyphicon-remove"),void(y.isCardExpired=!0)}else if(3==y.yearLength)return $(".donation-v1 #card_expiry .error").html("Card Year is not valid"),$(".donation-v1 #card_expiry").addClass("has-error"),$(".donation-v1 #card_expiry .glyphicon").addClass("glyphicon-remove"),void(y.isCardExpired=!0);a<y.currentMonth&&parseInt(e)<=y.currentYear?($(".donation-v1 #card_expiry .error").html("Card Month has Expired"),$(".donation-v1 #card_expiry").addClass("has-error"),$(".donation-v1 #card_expiry .glyphicon").addClass("glyphicon-remove"),y.isCardExpired=!0):a>12?($(".donation-v1 #card_expiry .error").html("Card Month is invalid"),$(".donation-v1 #card_expiry").addClass("has-error"),$(".donation-v1 #card_expiry .glyphicon").addClass("glyphicon-remove"),y.isCardExpired=!0):($(".donation-v1 #card_expiry .error").html(""),$(".donation-v1 #card_expiry .glyphicon").removeClass("glyphicon-remove").addClass("glyphicon-ok"),$(".donation-v1 #card_expiry").removeClass("has-error").addClass("has-success"),y.isCardExpired=!1)}else t?a?e||$(".donation-v1 #card_expiry .error").html("Expiry Year Required"):$(".donation-v1 #card_expiry .error").html("Expiry Month Required"):$(".donation-v1 #card_expiry .error").html("Expiry Required"),$(".donation-v1 #card_expiry").addClass("has-error"),$(".donation-v1 #card_expiry .glyphicon").addClass("glyphicon-remove"),y.isCardExpired=!0},y.makeCartPayment=function(){if(o.has("orderService")){y.failedOrderMessage="",y.checkoutModalState=6;var e=$(".donation-v1 #expiry").val().split("/"),t=e[0].trim(),n="";e.length>1&&(n=e[1].trim());var a={name:$(".donation-v1 #card_name #name").val(),number:$(".donation-v1 #number").val(),cvc:$(".donation-v1 #cvc").val(),exp_month:t,exp_year:n};if(!(a.number&&a.cvc&&a.exp_month&&a.exp_year&&a.name))return y.checkCardName(),y.checkCardNumber(),y.checkCardExpiry(),y.checkCardCvv(),void(y.checkoutModalState=4);if(!a.number||!a.cvc||!a.exp_month||!a.exp_year||y.isCardExpired)return void(y.checkoutModalState=4);var i=o.get("orderService"),s=p();s.customer&&(a.name=s.customer.first+" "+s.customer.last),o.has("paymentService")&&o.get("paymentService").getStripeCardToken(a,function(e,t){if(t){switch(t.param){case"number":$(".donation-v1 #card_number .error").html(t.message),$(".donation-v1 #card_number").addClass("has-error"),$(".donation-v1 #card_number .glyphicon").addClass("glyphicon-remove");break;case"exp_month":case"exp_year":$(".donation-v1 #card_expiry .error").html(t.message),$(".donation-v1 #card_expiry").addClass("has-error"),$(".donation-v1 #card_expiry .glyphicon").addClass("glyphicon-remove");break;case"cvc":$(".donation-v1 #card_cvc .error").html(t.message),$(".donation-v1 #card_cvc").addClass("has-error"),$(".donation-v1 #card_cvc .glyphicon").addClass("glyphicon-remove");break;case"name":$(".donation-v1 #card_name .error").html(t.message),$(".donation-v1 #card_name").addClass("has-error"),$(".donation-v1 #card_name .glyphicon").addClass("glyphicon-remove")}y.checkoutModalState=4}else s.payment_details.card_token=e,i.createOrder(s,function(e){if(e&&!e._id){var t="Error in order processing";return e.message&&(t=e.message),y.checkoutModalState=4,void(y.failedOrderMessage=t)}y.checkoutModalState=5,y.isAnonymous=!1})})}},y.deleteOrderFn=function(e){o.has("orderService")&&o.get("orderService").deletePaypalOrder(e,function(e){e.deleted&&(y.closeModalFn(),y.checkoutModalState=1)})},y.getDonations=function(e){y.component.productSettings.goal?g.getDonationOrdersForProduct(e,function(e){if(e.total){var t=e.total/y.component.productSettings.goal*100;y.augmentCompletePercentage(t),y.total=e.total,y.percentage=t.toFixed(0)}else y.setDefaultValues()}):y.setDefaultValues()},y.augmentCompletePercentage=function(e){y.completePercentageStyle=e>100?"100%":e+"%"},y.total=null,y.percentage=null,y.product={},y.close=function(){y.formBuilder={},y.getDonations(y.product._id),y.component.redirect&&5==y.checkoutModalState?(y.checkoutModalState=1,"page"===y.component.redirectType&&(window.location.href=y.component.redirectUrl),"external"===y.component.redirectType&&(window.location.href="http://"+y.component.redirectUrl)):$("#donation-card-details").find("input[type=text]").val(""),y.checkoutModalState=1},y.shareUrl=c.url,y.getProduct=function(){g&&(y.component.productSettings.product?g.getProduct(y.component.productSettings.product.data,function(e){y.product=e,y.getDonations(y.product._id)}):y.setDefaultValues())},y.getCredentials=function(){o.has("accountService")&&o.get("accountService")(function(e,t){y.account=t,y.paypalInfo=null,y.stripeInfo=null,t.credentials.forEach(function(e,t){"stripe"==e.type&&(y.stripeInfo=e)}),y.paypalInfo=t.commerceSettings.paypal})},y.setInitialCheckoutState=function(){h&&h.state&&"donation"==h.comp&&(y.checkoutModalState=parseInt(h.state),s(function(){y.openModalFn(),y.formBuilder||(y.formBuilder={}),h.amount&&(y.formBuilder.amount=parseFloat(h.amount),y.donationAmout=angular.copy(y.formBuilder.amount))},1e3),5==y.checkoutModalState&&v&&o.has("orderService")&&o.get("orderService").setOrderPaid(v,function(e){if(e&&!e._id){var t="Error in order processing";return e.message&&(t=e.message),void(y.failedOrderMessage=t)}f.remove(b)}),2==y.checkoutModalState&&(y.showPaypalErrorMsg=!0))},y.setDefaultValues=function(){y.total="0",y.percentage="0"},y.checkDateValidityFn=function(){return!angular.isDefined(y.component.productSettings.timePeriod)||!$("#form-donate-modal-amount-"+y.component._id).hasClass("ng-invalid")&&(!y.component.productSettings.timePeriod.enabled||(y.component.productSettings.timePeriod.startDate&&y.component.productSettings.timePeriod.endDate?moment().isAfter(y.component.productSettings.timePeriod.startDate)&&moment().isBefore(y.component.productSettings.timePeriod.endDate)||moment().isSame(y.component.productSettings.timePeriod.endDate,"day")&&moment().isSame(y.component.productSettings.timePeriod.endDate,"month")&&moment().isSame(y.component.productSettings.timePeriod.endDate,"year"):y.component.productSettings.timePeriod.startDate?moment().isAfter(y.component.productSettings.timePeriod.startDate):!y.component.productSettings.timePeriod.endDate||moment().isBefore(y.component.productSettings.timePeriod.endDate)||moment().isSame(y.component.productSettings.timePeriod.endDate,"day")&&moment().isSame(y.component.productSettings.timePeriod.endDate,"month")&&moment().isSame(y.component.productSettings.timePeriod.endDate,"year")))},y.formInvalidFn=function(e){return!y.formBuilder.amount||!y.isAnonymous&&!e.$valid},y.openModalFn=function(){y.modalInstance=d.open({templateUrl:"donation-modal",keyboard:!0,size:"lg",scope:e}),s(function(){$("#donation-card-details-"+y.component._id).card({container:"#card-wrapper-"+y.component._id}),angular.element("#donation-modal-component").parents(".modal").addClass("donation-component-modal")},200)},y.closeModalFn=function(){y.close(),s(function(){y.modalInstance.close()},0)},y.nthRow="nth-row",y.isEditing=e.$parent.vm&&e.$parent.vm.uiState,y._campaignObj=null,y.setDonationAmount=function(e){e&&(y.formBuilder.amount=parseFloat(e))},y.createUser=function(t){if(!e.$parent.vm.state){o.has("userService")&&(userService=o.get("userService")),o.has("ipCookie")&&(ipCookie=o.get("ipCookie"));var n,a=(new Fingerprint).get(),i=ipCookie("session_cookie")?ipCookie("session_cookie").id:null;y.component.skipWelcomeEmail&&(n=!0);var r,c="true"===y.component.sendEmail;!y.component.campaignId||c?y.component.campaignId="":r=y.component.campaignId;var l=[];y._campaignObj&&angular.isDefined(y._campaignObj.searchTags)&&y._campaignObj.searchTags.tags.length&&(l=_.uniq(_.pluck(y._campaignObj.searchTags.tags,"data")));var u="",d="";if(y.formBuilder.name){var p=y.formBuilder.name.split(/ (.+)?/);u=p[0],p.length>1&&(d=p[1])}else y.formBuilder.FirstName&&(u=y.formBuilder.FirstName),y.formBuilder.LastName&&(d=y.formBuilder.LastName);var m={fingerprint:a,sessionId:i,first:u,last:d,details:[{emails:[],phones:[],addresses:[]}],campaignId:r,campaignTags:l,emailId:y.component.emailId,sendEmail:y.component.sendEmail,skipWelcomeEmail:n,fromEmail:y.component.fromEmail,fromName:y.component.fromName,contact_type:y.component.tags,uniqueEmail:y.component.uniqueEmail||!1,activity:{activityType:"CONTACT_FORM",note:y.formBuilder.Message||"Contact form data.",sessionId:ipCookie("session_cookie")?ipCookie("session_cookie").id:null,contact:y.formBuilder}};y.formBuilder.email&&m.details[0].emails.push({email:y.formBuilder.email}),y.formBuilder.phone&&m.details[0].phones.push({number:y.formBuilder.phone,type:"m"}),(y.formBuilder.address||y.formBuilder.city||y.formBuilder.state||y.formBuilder.zip||y.formBuilder.country)&&m.details[0].addresses.push({address:y.formBuilder.address,city:y.formBuilder.city,state:y.formBuilder.state,country:y.formBuilder.country,zip:y.formBuilder.zip}),userService.addContact(m,function(e,n){if(n&&409===n.code)y.userExists=!0;else if(n&&409!==n.code)y.formError=!0,s(function(){y.formError=!1},5e3);else if(e){y.formBuilder.name;if(y.component.facebookConversionCode){var a=window._fbq||(window._fbq=[]);if(!a.loaded){var o=document.createElement("script");o.async=!0,o.src="//connect.facebook.net/en_US/fbds.js";var i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(o,i),a.loaded=!0}window._fbq=window._fbq||[],window._fbq.push(["track",y.component.facebookConversionCode,{value:"0.00",currency:"USD"}])}y.formSuccess=!0,y.formBuilder={},$("#donation-card-details").find("input[type=text]").val(""),t.$setPristine(!0),s(function(){y.formSuccess=!1},3e3),y.component.redirect||s(function(){"page"===y.component.redirectType&&(window.location.href=y.component.redirectUrl),"external"===y.component.redirectType&&(window.location.href="http://"+y.component.redirectUrl)},2e3)}})}},y.currentYear=(new Date).getYear()-100,y.fullCurrentYear=(new Date).getFullYear(),y.currentMonth=(new Date).getMonth()+1}app.controller("SiteBuilderFormDonateComponentController",e),e.$inject=["$scope","$attrs","$filter","$transclude","$injector","formValidations","$timeout","$sce","$location","$interval","ENV","$modal"]}(),function(){"use strict";app.directive("ssbImageComponent",function(){return{restrict:"A",controller:"SiteBuilderImageComponentController",controllerAs:"vm",bindToController:!0,scope:{ssbEditor:"=",componentClass:"&",component:"="},templateUrl:"/admin/assets/js/ssb-site-builder/ssb-components/ssb-image/ssb-image.component.html",replace:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){"use strict";app.controller("SiteBuilderImageComponentController",function(){var e=this;e.init=function(t){e.element=t}})}(),function(){"use strict";app.directive("ssbImageGalleryComponent",function(){return{restrict:"A",controller:"SiteBuilderImageGalleryComponentController",controllerAs:"vm",bindToController:!0,scope:{ssbEditor:"=",componentClass:"&",component:"="},templateUrl:"/admin/assets/js/ssb-site-builder/ssb-components/ssb-image-gallery/ssb-image-gallery.component.html",replace:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a){var o=this;o.init=function(e){o.element=e}}app.controller("SiteBuilderImageGalleryComponentController",e),e.$inject=["$scope","$attrs","$filter","$transclude"]}(),function(){"use strict";app.directive("ssbLocationFinderComponent",function(){return{restrict:"A",controller:"SiteBuilderLocationFinderComponentController",controllerAs:"vm",bindToController:!0,scope:{ssbEditor:"=",componentClass:"&",component:"="},templateUrl:"/admin/assets/js/ssb-site-builder/ssb-components/ssb-location-finder/ssb-location-finder.component.html",replace:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a){function o(){c.loading=!0,r.getAllLocations().then(function(e){c.searchResults=e.data,c.setMapCenter(41.8853195,-87.6285088),c.displayMarkers(),c.showLocations=!1}).catch(function(e){}).finally(function(){c.loading=!1})}function i(){var e=c.component.staticLocations;e||(e=[{name:"Helms Brewing Co",address:"5640 Kearny Mesa Road",address2:"",city:"San Diego",state:"CA",zip:"92111",lat:32.837377,lng:-117.138966},{name:"Tasting Room",address:"4896 Newport Ave",address2:"",city:"San Diego",state:"CA",zip:"92107",lat:32.7458203,lng:-117.24903540000003}]),e.forEach(function(e,t){c.setupInfoWindowCallback(new google.maps.InfoWindow({content:'<div class="ssb-infowindow-content"><ul><li><b>'+e.name+"</b></li><li>"+e.address+"</li><li>"+e.address2+"</li><li>"+e.city+", "+e.state+" "+e.zip+'</li><li><a href="'+c.getDirectionsLink(e)+' class="btn ssb-theme-btn" target="_blank">Directions</a></ul></div>'}),new google.maps.Marker({position:new google.maps.LatLng(e.lat,e.lng),map:c.map,draggable:!1,icon:c.helmsMarkerIcon,title:e.name}),0===t)})}function s(){c.submitBtn.button("reset")}var r;a.has("geocodeService")&&(r=a.get("geocodeService")),a.has("GeocodeService")&&(r=a.get("GeocodeService"));var c=this;c.map={},c.submitBtn={},c.mapId="ssb-map-canvas-"+c.component._id,c.searchAddress="",c.searchLat="",c.searchLong="",c.searchResults={},c.loading=!1,c.markers=[],c.infowindow={},c.helmsMarkerIcon={},c.searchBasisMarkerIcon={},c.locationMarkerIcon={},c.clusterOptions={},c.geolocationEnabled=!1,c.showLocations=!0,c.helmsMarker={},c.searchBasisMarker={},c.init=function(e){c.element=e,c.setupMap(),c.setupSubmitBtn(),navigator.geolocation&&(c.geolocationEnabled=!0),c.element.on("$destroy",c.onDestroy)},c.setupMap=function(){"object"==typeof google&&"object"==typeof google.maps?n(c.initMap,2e3):(window["initialize"+c.component._id]=n(c.initMap,1e3),c.loadScript("http://maps.googleapis.com/maps/api/js?v=3&callback=initialize"+c.component._id,function(){}))},c.setupSubmitBtn=function(){c.submitBtn=c.element.find('input[type="submit"]'),c.submitBtn.on("click",function(){c.submitBtn.button("loading")})},c.loadScript=function(e,t){var n=document.createElement("script");n.type="text/javascript",t&&(n.onload=t),document.getElementsByTagName("head")[0].appendChild(n),n.src=e},c.initMap=function(){var e=11;c.component&&c.component.settings&&c.component.settings.mapZoom&&(e=c.component.settings.mapZoom);var t=[];c.initIcons();var a={zoom:e,center:c.mapCenterLocation,mapTypeControl:!1,scrollwheel:!1,zoomControl:!0,mapTypeId:"HYBRID"};c.map=new google.maps.Map(angular.element("#"+c.mapId)[0],a);var s=new google.maps.StyledMapType(t);i(),c.map.mapTypes.set("HYBRID",s),google.maps.event.addDomListener(window,"resize",function(){var e=c.map.getCenter();google.maps.event.trigger(c.map,"resize"),c.map.setCenter(e)}),!1===c.component.isHelm&&r&&n(function(){o()},0)},c.initIcons=function(){!1===c.component.isHelm?c.helmsMarkerIcon={url:"/images/indi-location-marker.default.png"}:c.helmsMarkerIcon={url:"/images/indi-location-marker-small-helms.png"},c.searchBasisMarkerIcon={url:"/images/indi-location-marker-home.png"},c.locationMarkerIcon={url:"/images/indi-location-marker-small.png"},c.clusterOptions={styles:[{textColor:"white",url:"/images/indi-location-marker-small.png",width:75,height:75,fontFamily:"inherit",textSize:15},{textColor:"white",url:"/images/indi-location-marker-medium.png",width:100,height:100,fontFamily:"inherit",textSize:18},{textColor:"white",url:"/images/indi-location-marker-large.png",width:125,height:125,fontFamily:"inherit",textSize:20}]}},c.search=function(){c.searchAddress.length?(c.loading=!0,c.geocoder=c.geocoder||new google.maps.Geocoder,c.geocoder.geocode({address:c.searchAddress},function(e,t){t==google.maps.GeocoderStatus.OK?(c.setMapCenter(e[0].geometry.location.lat(),e[0].geometry.location.lng()),c.getLocations(),c.showLocations=!0):c.loading=!1})):s()},c.setMapCenter=function(e,t){c.map.setCenter({lat:e,lng:t}),c.searchLat=e,c.searchLong=t,c.searchBasisMarker.setMap&&c.searchBasisMarker.setMap(null),c.searchBasisMarker=new google.maps.Marker({position:new google.maps.LatLng(c.searchLat,c.searchLong),map:c.map,draggable:!1,icon:c.searchBasisMarkerIcon,title:"Your search location",opacity:.8})},c.getLocations=function(){r.getLocations(c.searchLat,c.searchLong,c.searchRadius).then(function(e){c.searchResults=e.data,c.displayMarkers()}).catch(function(e){}).finally(function(){c.loading=!1})},c.searchMyLocation=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){c.setMapCenter(e.coords.latitude,e.coords.longitude),c.getLocations()},function(){})},c.clearMarkers=function(){for(var e=0;e<c.markers.length;e++)c.markers[e].setMap(null);c.markers=[]},c.displayMarkers=function(){c.clearMarkers(),c.bounds=new google.maps.LatLngBounds;for(var e=0;e<c.searchResults.results.length;e++){var t=c.searchResults.results[e],n=new google.maps.LatLng(t.lat,t.lng);c.displayMarker(t,n)}c.markerCluster=new MarkerClusterer(c.map,c.markers,c.clusterOptions),c.searchResults.results.length&&(c.bounds.extend(c.searchBasisMarker.getPosition()),c.map.fitBounds(c.bounds)),c.loading=!1},c.displayMarker=function(e,t){var n=new google.maps.Marker({map:c.map,position:t,draggable:!1,icon:c.locationMarkerIcon,title:e.name,opacity:.8}),a='<div class="ssb-infowindow-content"><ul><li><b>'+e.name+"</b></li><li>"+e.address+"</li><li>"+e.address2+"</li><li>"+e.city+", "+e.state+" "+e.zip+'</li><li><a href="'+c.getDirectionsLink(e)+' class="btn ssb-theme-btn" target="_blank">Directions</a></ul></div>',o=new google.maps.InfoWindow({content:a});c.bounds.extend(n.getPosition()),c.setupInfoWindowCallback(o,n),c.markers.push(n)},c.setupInfoWindowCallback=function(e,t,a){google.maps.event.addListener(t,"click",function(){c.infowindow&&c.infowindow.close&&c.infowindow.close(),c.infowindow=e,c.infowindow.open(c.map,t)}),a&&n(function(){c.infowindow=e,c.infowindow.open(c.map,t)},1e3)},c.getDirectionsLink=function(e){var t=e.name+" "+e.address+" "+e.address2+" "+e.city+" "+e.state+" "+e.zip+" "+e.country;return r&&r.getDirectionsLinkGoogle&&r.getDirectionsLinkGoogle(c.searchAddress,t)},c.onDestroy=function(){window["initialize"+c.component._id]=angular.noop},c.addStaticLocations=i,c.searchRadius=5,c.component.settings&&c.component.settings.locationFinderRange&&(c.searchRadius=angular.copy(c.component.settings.locationFinderRange)),!1===c.component.isHelm?c.mapCenterLocation=new google.maps.LatLng(41.8853195,-87.6285088):c.mapCenterLocation=new google.maps.LatLng(32.837377,-117.138966),e.$watch("vm.loading",function(e){e||s()}),e.$watch("vm.component.settings.locationFinderRange",function(e){e&&(c.searchRadius=angular.copy(e))}),e.$watch("vm.component.settings.mapZoom",function(e){e&&c.map&&Object.keys(c.map).length&&c.map.setZoom(e)}),c.locationFinderOptions=[{description:"5 miles",value:5},{description:"10 miles",value:10},{description:"25 miles",value:25},{description:"50 miles",value:50},{description:"100 miles",value:100},{description:"200 miles",value:200}]}app.controller("SiteBuilderLocationFinderComponentController",e),e.$inject=["$scope","$q","$timeout","$injector"]}(),function(){"use strict";app.directive("ssbPageSection",function(){return{restrict:"E",controller:"SiteBuilderPageSectionController",controllerAs:"vm",bindToController:!0,scope:{section:"=",index:"=",state:"=",uiState:"=",sectionLayoutName:"=?",sectionLayoutIndex:"=?"},templateUrl:function(e,t){var n="/admin/assets/js/ssb-site-builder/ssb-components/ssb-page-section/ssb-page-section.component.html";return t.uiState&&(n="/admin/assets/js/ssb-site-builder/ssb-components/ssb-page-section/ssb-page-section.edit.html"),n},replace:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r,c){function l(e){if(e){var t=angular.element("#section_"+e._id);if(t.hasClass("ssb-page-section-layout-nav-hero-v2")||t.hasClass("ssb-page-section-layout-nav-hero-v3")||t.hasClass("ssb-page-section-layout-nav-hero-v4")){var n,a=120,o=t.find(".navigation-header");if(o.length&&(a+=o.height()),n=t.find(".ssb-nav-hero-text"),o.length&&(a+=n.height()),t.hasClass("ssb-page-section-layout-nav-hero-v3")){var i=t.find(".ssb-nav-hero-text-full-wdith");i.length&&(a+=i.height())}t.find(".single-testimonial .component-slider-image img").css("min-height",a)}}}function u(e,t,n){for(var a=[],o=0;o<=e;o++)n?a.push(o*parseInt(t)):a.push(o*parseInt(t)+parseInt(t)-1);return a}function d(e){if(e){var t=angular.element("#section_"+e._id);if(t.length){var n=t.find(".fr-video>iframe");n.length&&_.each(n,function(e){var t=$(e).width()/16*9;$(e).height(t+"px")})}}}function p(){angular.element(s).width()>767&&m.section.bg.video&&m.section.bg.video.id&&(m.playerObject.destroy&&m.playerObject.destroy(),YT&&YT.Player?m.playerObject=new YT.Player("section_video_"+m.section._id,{height:"100%",width:"100%",videoId:m.section.bg.video.id,events:{onReady:m.onPlayerReady,onStateChange:m.onPlayerStateChange,onError:m.onPlayerError},playerVars:{autohide:1,loop:1,rel:0,enablejsapi:1,controls:0,autoplay:1,showinfo:0,modestbranding:1,playlist:m.section.bg.video.id}}):i(p,500))}var m=this;m.init=function(t){m.element=t,i(function(){m.sectionInitDelayDone=!0},0);var n=!1,a=0===m.index;if(!m.uiState&&m.section&&m.section.fixedLeftNavigation&&a&&m.showSection(m.section)&&(n=!0,angular.element(".ssb-layout__header_2-col_footer").length?angular.element(".ssb-wrap-left-fixed-left-nav").length||(angular.element(".ssb-page-layout-row:first").addClass("ssb-wrap-left-fixed-left-nav"),angular.element(".ssb-page-layout-row").slice(1).wrapAll("<div class='ssb-wrap-fixed-right-nav' />"),i(function(){angular.element(".ssb-wrap-fixed-right-nav").length||angular.element(".ssb-page-layout-row").slice(1).wrapAll("<div class='ssb-wrap-fixed-right-nav' />")},0)):angular.element(".ssb-wrap-left-fixed-left-nav").length||(angular.element(".ssb-page-section:first").addClass("ssb-wrap-left-fixed-left-nav"),angular.element(".ssb-page-section").slice(1).wrapAll("<div class='ssb-wrap-fixed-right-nav' />"),i(function(){angular.element(".ssb-wrap-fixed-right-nav").length||angular.element(".ssb-page-section").slice(1).wrapAll("<div class='ssb-wrap-fixed-right-nav' />")},0)),e.$watch(function(){return angular.element(".ssb-wrap-left-fixed-left-nav").width()},function(e){angular.element(".ssb-wrap-fixed-right-nav").css("margin-left",e+"px"),i(function(){angular.element(".ssb-wrap-fixed-right-nav").css("margin-left",e+"px")},0)})),!m.uiState&&m.section&&m.section.layoutModifiers&&m.section.layoutModifiers.fixed&&i(function(){m.setFixedPosition(n)},0),m.uiState&&m.section)var o=e.$watch(function(){return angular.element('div[id^="px-ele-"]').length},function(t,n){if(t&&t>0&&!m.uiState.backgroundImagesLoaded){var a=angular.element('div[id^="px-ele-"]').first();m.uiState.backgroundImagesLoaded=!0,i(function(){a.waitForImages(!0).done(function(){e.$broadcast("parallaxCall",{}),$(window).scroll(),i(function(){e.$broadcast("parallaxCall",{}),$(window).scroll()},1e3)})},500),o()}})},m.sectionClass=function(e){var t="container-fluid ";if(e){var a=e.title||e.name,o=e.version;a&&(t+=" ssb-page-section-"+n("slugify")(a),o&&(t+=" ssb-page-section-"+n("slugify")(a))),e.layout&&(t+=" ssb-page-section-layout-"+e.layout,o&&(t+=" ssb-page-section-layout-"+e.layout+"-v"+o)),e.layoutModifiers&&(e.layoutModifiers.fixed&&(t+=" ssb-page-section-layout-"+e.layout+"-fixed",m.elementLoaded&&((!e.fixedLeftNavigation||e.fixedLeftNavigation&&m.index>0)&&(t+=" ssb-fixed sticky fixedsection"),0!==m.index||e.fixedLeftNavigation||(t+=" ssb-fixed-first-element"))),e.layoutModifiers.grid&&e.layoutModifiers.grid.isActive&&(t+=" ssb-page-section-layout-"+e.layout+"-grid",e.layoutModifiers.grid.height&&e.layoutModifiers.grid.height<0&&(e.layoutModifiers.grid.height=350)),e.layoutModifiers.columns&&angular.isDefined(e.layoutModifiers.columns.columnsNum)&&(t+=" ssb-text-column-layout ssb-text-column-"+(e.layoutModifiers.columns.columnsNum||1))),m.sectionHasFooter(e)&&(t+=" ssb-page-section-layout-overflow-visible"),m.sectionHasLegacyUnderNavSetting(e)&&(t+=" ssb-page-section-layout-legacy-undernav"),e.bg&&e.bg.video&&e.bg.video.show&&e.bg.video.urlProcessed&&(angular.equals(m.playerObject,{})||(t+=" ssb-page-section-layout-video-bg")),e.bg&&e.bg.img&&e.bg.img.blur&&(t+=" ssb-page-section-layout-blur-image"),e.spacing&&e.spacing.default&&(t+=" no-component-vertical-space"),!e.title||"nav + hero"!==e.title.toLowerCase()&&"hero"!==e.title.toLowerCase()||e.bg&&e.bg.img&&!1===e.bg.img.show&&(t+=" hide-hero-bg-image"),e.filter&&(t+=" ssb-section-filter-"+e.filter.replace(/[^0-9a-z]/gi,"-")),e.hideOnlyMobile&&(t+=" ssb-section-o-desktop"),e.showOnlyMobile&&(t+=" ssb-section-o-moblie")}return t},m.sectionBGClass=function(e){var t=" ";return e&&e.bg&&e.bg.img&&(e.bg.img.blur&&(t+=" blur-image"),e.bg.img.parallax&&(t+=" parallax")),t},m.sectionStyle=function(e){var t=" ";return e&&e.spacing&&(e.spacing.pt&&(t+="padding-top: "+e.spacing.pt+"px;"),e.spacing.pb&&(t+="padding-bottom: "+e.spacing.pb+"px;"),e.spacing.pl&&(t+="padding-left: "+e.spacing.pl+"px;"),e.spacing.pr&&(t+="padding-right: "+e.spacing.pr+"px;"),e.spacing.mt&&(t+="margin-top: "+e.spacing.mt+"px;"),e.spacing.mb&&(t+="margin-bottom: "+e.spacing.mb+"px;"),e.spacing.ml&&(t+="auto"==e.spacing.ml?"margin-left: "+e.spacing.ml+";float: none;":"margin-left: "+e.spacing.ml+"px;"),e.spacing.mr&&(t+="auto"==e.spacing.mr?"margin-right: "+e.spacing.mr+";float: none;":"margin-right: "+e.spacing.mr+"px;"),e.spacing.mw&&(t+="100%"==e.spacing.mw?"max-width: "+e.spacing.mw+";":"max-width: "+e.spacing.mw+"px;margin-left:auto!important;margin-right:auto!important;"),e.spacing.lineHeight&&(t+="line-height: "+e.spacing.lineHeight)),e&&e.txtcolor&&(t+="color: "+e.txtcolor+";"),e&&e.border&&e.border.show&&e.border.color&&(t+="border-color: "+e.border.color+";",t+="border-width: "+e.border.width+"px;",t+="border-style: "+e.border.style+";",t+="border-radius: "+e.border.radius+"%;"),e&&e.fixedLeftNavigation&&angular.forEach(e.components,function(e,t){"navigation"==e.type&&e.navigation&&(e.navigation.wideMobileMode=!1,e.navigation.alwaysmobileMode=!1)}),e&&e.layoutModifiers&&e.layoutModifiers.grid&&e.layoutModifiers.grid.isActive?(angular.forEach(e.components,function(t,n){e.components[n].gridHeight=e.layoutModifiers.grid.height}),e.layoutModifiers.grid&&e.layoutModifiers.grid.overlay&&e.layoutModifiers.grid.overlay.isOverlayActive?angular.forEach(e.components,function(t,n){e.components[n].isGrid=!0,e.components[n].isOverlayActive=!0,e.components[n].overlayBackground=e.layoutModifiers.grid.overlay.overlayColor,e.components[n].overlayOpacity=e.layoutModifiers.grid.overlay.overlayOpacity,e.components[n].gridHeight=e.layoutModifiers.grid.height}):angular.forEach(e.components,function(t,n){e.components[n].isOverlayActive=!1,e.components[n].isGrid=e.layoutModifiers.grid})):e&&_.each(e.components,function(e){e.isOverlayActive=!1,e.isGrid=!1}),d(e),l(e),t},m.sectionBGStyle=function(e){var t=" ";return e&&e.bg&&(e.bg.color&&(t+="background-color: "+e.bg.color+";"),e.bg.img&&e.bg.img.show&&e.bg.img.url&&""!==e.bg.img.url&&(t+='background-image: url("'+e.bg.img.url+'")')),t},m.sectionBackgroundUrl=function(e){var t=" ";return e&&e.bg&&e.bg.img&&e.bg.img.url&&(t="background: url("+e.bg.img.url+") repeat-y"),t},m.componentClass=function(e,t){var n="container-fluid ";if("2-col"===m.section.layout?n+=" col-md-6 ":"2-col-right"===m.section.layout?(n+=" col-md-6 ",t>1&&(n+=" ssb-col-md-float-right")):"3-col"===m.section.layout?n+=" col-md-4 ":"4-col"===m.section.layout&&(n+=" col-md-3"),void 0!==t&&(n+=" ssb-component-index-"+t+" "),e.slider&&e.slider.sliderDotShape&&(n+=" square-dot "),e.hideOnlyMobile&&(n+=" ssb-component-o-desktop"),e.showOnlyMobile&&(n+=" ssb-component-o-moblie"),m.section.layoutModifiers&&m.section.layoutModifiers.columns){var a;if(angular.isDefined(m.section.layoutModifiers.columns.columnsNum)){var o,i,s,r,c,l=m.section.layoutModifiers.columns.rowsNum?parseInt(m.section.layoutModifiers.columns.rowsNum):1,d=u(l,m.section.layoutModifiers.columns.columnsNum,!0),p=u(l,m.section.layoutModifiers.columns.columnsNum,!1),g=!1,f=[];if(m.section.layoutModifiers.columns.ignoreColumns&&m.section.layoutModifiers.columns.ignoreColumns.length){var h=m.section.layoutModifiers.columns.ignoreColumns;_.each(h,function(e){"last"===e?(f.push(m.section.components.length-1),g=!0):f.push(e-1)})}a=f.indexOf(t)>-1,i=(o=parseInt(m.section.layoutModifiers.columns.columnsNum)||1)*(l=m.section.layoutModifiers.columns.rowsNum?parseInt(m.section.layoutModifiers.columns.rowsNum):1),s=" col-xs-12 col-sm-"+Math.floor(12/o),a||(n+=s,5==o&&(n+=" col-xs-15 col-md-15")),r=i,c=[];for(var v=0;v<=m.section.components.length-1;v++)c.push(v);f.length&&(r+=f.length,c=_.difference(c,f)),void 0!==t&&t>=r&&!a&&(n+=" ssb-col-hide"),m.section.layoutModifiers.columns.columnsSpacing&&!a&&parseInt(m.section.layoutModifiers.columns.columnsNum)>1&&(0==c.indexOf(t)?n+=" ssb-component-layout-columns-spacing-first-column-"+m.section.layoutModifiers.columns.columnsSpacing+" ":c.indexOf(t)==m.section.layoutModifiers.columns.columnsNum-1?n+=" ssb-component-layout-columns-spacing-last-column-"+m.section.layoutModifiers.columns.columnsSpacing+" ":_.contains(p,c.indexOf(t))?n+=" ssb-component-layout-columns-spacing-last-column-"+m.section.layoutModifiers.columns.columnsSpacing+" ":_.contains(d,c.indexOf(t))?n+=" ssb-component-layout-columns-spacing-first-column-"+m.section.layoutModifiers.columns.columnsSpacing+" ":n+=" ssb-component-layout-columns-spacing-"+m.section.layoutModifiers.columns.columnsSpacing+" "),m.section.layoutModifiers.columns.rowsSpacing&&!a&&parseInt(m.section.layoutModifiers.columns.columnsNum)>1&&(c.indexOf(t)>m.section.layoutModifiers.columns.columnsNum-1&&(n+=" ssb-component-layout-rows-spacing-"+m.section.layoutModifiers.columns.rowsSpacing+" "),c.indexOf(t)>0&&(n+=" ssb-component-layout-rows-mobile-spacing-"+m.section.layoutModifiers.columns.rowsSpacing+" ")),a||parseInt(m.section.layoutModifiers.columns.columnsNum)>1&&_.contains(d,c.indexOf(t))&&(n+=" ssb-clear-left "),t===m.section.components.length-1&&g&&(n+=" ssb-text-last-column-full-width")}if(!a&&parseInt(m.section.layoutModifiers.columns.columnsNum)>1){var b=angular.element(".inner-component-style."+e.type+e._id);m.section.columnBorder&&m.section.columnBorder.show&&m.section.columnBorder.color?b&&b.css({"border-color":m.section.columnBorder.color,"border-width":m.section.columnBorder.width+"px","border-style":m.section.columnBorder.style,"border-radius":m.section.columnBorder.radius+"%"}):b&&b.css({border:"none"})}}return e.layoutModifiers&&e.layoutModifiers.columns&&(e.layoutModifiers.columnsNum&&(n+=" ssb-component-layout-columns-"+e.layoutModifiers.columnsNum+" "),e.layoutModifiers.columnsSpacing&&(n+=" ssb-component-layout-columns-spacing-"+e.layoutModifiers.columnsSpacing+" ")),e.slider&&e.slider.stretchImage&&(n+=" ssb-component-stretch-image"),e.navigation&&(e.navigation.wideMobileMode&&(e.navigation.alwaysmobileMode=!1,n+=" ssb-component-wmm"),e.navigation.alwaysmobileMode&&(e.navigation.wideMobileMode=!1,n+=" ssb-component-amm")),n},m.componentStyle=function(e){var t=" ";return 0===e.type.indexOf("ssb-")&&"ssb-form-builder"!=e.type&&"ssb-rss-feed"!=e.type&&"ssb-form-donate"!=e.type&&(e.spacing&&(e.spacing.pt&&(t+="padding-top: "+e.spacing.pt+"px;"),e.spacing.pb&&(t+="padding-bottom: "+e.spacing.pb+"px;"),e.spacing.pl&&(t+="padding-left: "+e.spacing.pl+"px;"),e.spacing.pr&&(t+="padding-right: "+e.spacing.pr+"px;"),e.spacing.mt&&(t+="margin-top: "+e.spacing.mt+"px;"),e.spacing.mb&&(t+="margin-bottom: "+e.spacing.mb+"px;"),e.spacing.ml&&(t+="auto"==e.spacing.ml?"margin-left: "+e.spacing.ml+";float: none;":"margin-left: "+e.spacing.ml+"px;"),e.spacing.mr&&(t+="auto"==e.spacing.mr?"margin-right: "+e.spacing.mr+";float: none;":"margin-right: "+e.spacing.mr+"px;"),e.spacing.mw&&(t+="100%"==e.spacing.mw?"max-width: "+e.spacing.mw+";":"max-width: "+e.spacing.mw+"px;margin:0 auto!important;"),e.spacing.lineHeight&&(t+="line-height: "+e.spacing.lineHeight)),e.txtcolor&&m.section&&m.section.txtcolor&&(t+="color: "+e.txtcolor+";"),!1===e.visibility&&"ssb-rss-feed"!=e.type&&(t+="display: none!important;"),e.bg&&(e.bg.color&&(t+="background-color: "+e.bg.color+";"),e.bg.img&&e.bg.img.show&&""!==e.bg.img.url&&(t+='background-image: url("'+e.bg.img.url+'");')),e.src&&e.src&&""!==e.src&&(t+='background-image: url("'+e.src+'");')),e.layoutModifiers&&e.layoutModifiers.columns&&e.layoutModifiers.columnsMaxHeight&&(t+=" max-height: "+e.layoutModifiers.columnsMaxHeight+"px"),e.border&&e.border.show&&e.border.color&&!1!==e.visibility&&(t+="border-color: "+e.border.color+";",t+="border-width: "+e.border.width+"px;",t+="border-style: "+e.border.style+";",t+="border-radius: "+e.border.radius+"%;"),t},m.sectionHasFooter=function(e){return _.findWhere(e.components,{type:"footer"})},m.sectionHasLegacyUnderNavSetting=function(e){var t=!1,n=_.findWhere(e.components,{type:"masthead"});return n&&n.bg&&n.bg.img&&n.bg.img.undernav&&(t=!0),t},m.getTrustedUrl=function(e){return o.trustAsResourceUrl(e)},m.setupVideoBackground=p,m.playerObject={},m.player={},m.sectionInitDelayDone=!1,m.setFixedPosition=function(t){if(!t){var n=0===m.index;if(c.has("SsbPageSectionService")&&(ssbPageSectionService=c.get("SsbPageSectionService")),n){var a;0==r.$$path.indexOf("/preview/")?((a=m.element.clone()).addClass("ssb-fixed-clone-element"),a.attr("id","clone_of_"+m.section._id),a.insertAfter(m.element),e.$watch(function(){return angular.element(".ssb-fixed-first-element").height()},function(e){a&&a.css("min-height",e+"px"),ssbPageSectionService&&ssbPageSectionService.setSectionOffset(e)})):((a=m.element.clone()).addClass("ssb-fixed-clone-element"),a.attr("id","clone_of_"+m.section._id),a.insertAfter(m.element),ssbPageSectionService&&e.$watch(function(){return angular.element(".ssb-fixed-first-element").height()},function(e){ssbPageSectionService.setSectionOffset(e)}))}else i(function(){$(m.element[0]).sticky({zIndex:999}),ssbPageSectionService&&e.$watch(function(){return $(m.element[0]).height()},function(e){ssbPageSectionService.setSectionOffset(e)})},1e3)}m.elementLoaded=!0},e.$watch("vm.section.bg.video.id",function(e){e&&m.section.bg.video.show&&i(function(){m.setupVideoBackground()},1e3)}),m.onPlayerReady=function(e){m.player=e.target,m.player.playVideo(),m.player.mute()},m.onPlayerStateChange=function(){},m.onPlayerError=function(e){},m.showSection=function(t){var n=!1;if(t&&(n=!1!==t.visibility,t.global&&t.hiddenOnPages)){var a;a=m.state?m.state.page.handle:e.$root.pageHandle,n=!t.hiddenOnPages[a],t.visibility=n}return n}}app.controller("SiteBuilderPageSectionController",e),e.$inject=["$scope","$attrs","$filter","$transclude","$sce","$timeout","$window","$location","$injector"]}(),function(){app.directive("ssbRecentCategoryComponent",function(){return{restrict:"A",controller:"ssbBolgRecentCategoryComponentController",controllerAs:"vm",bindToController:!0,scope:{component:"="},templateUrl:"/admin/assets/js/ssb-site-builder/ssb-components/shared/ssb-component-wrap.html",replace:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o){function i(){var e=[];return s.blog.posts.length>0&&angular.forEach(s.blog.posts,function(t,n){t.post_categories&&t.post_categories.length>0&&angular.forEach(t.post_categories,function(t,n){e.length<20&&0==_.filter(e,function(e){return e.text==t.text}).length&&e.push(t)})}),e}var s=this;s.init=function(e){s.element=e,s.blog_categories=i(),s.blog_categories.length<1&&e.closest("div.ssb-page-section").css({display:"none"})},s.hasFeaturedPosts=!1,s.blog=e.blog||{},s.blog_categories=[],s.filteredPostView=!1,s.encodeUrlText=function(e){return encodeURI(e)},s.titleStyle=function(){var e=" ";return s.component&&s.component.settings&&s.component.settings.title&&s.component.settings.title.fontSize&&(e+="font-size: "+s.component.settings.title.fontSize+"px !important;"),s.component&&s.component.settings&&s.component.settings.title&&s.component.settings.title.fontFamily&&(e+="font-family: "+s.component.settings.title.fontFamily+"px !important;"),s.component&&s.component.settings&&s.component.settings.title&&s.component.settings.title.color&&(e+="color: "+s.component.settings.title.color+"!important;"),e},s.descriptionStyle=function(){var e=" ";return s.component&&s.component.settings&&s.component.settings.description&&s.component.settings.description.fontSize&&(e+="font-size: "+s.component.settings.description.fontSize+"px !important;"),s.component&&s.component.settings&&s.component.settings.description&&s.component.settings.description.fontFamily&&(e+="font-family: "+s.component.settings.description.fontFamily+"px !important;"),s.component&&s.component.settings&&s.component.settings.description&&s.component.settings.description.color&&(e+="color: "+s.component.settings.description.color+"!important;"),e},t.$watchCollection("vm.blog.posts",function(e){e&&(s.blog_categories=i(),s.blog_categories.length<1?s.element.closest("div.ssb-page-section").css({display:"none"}):s.element.closest("div.ssb-page-section").css({display:"block"}))})}app.controller("ssbBolgRecentCategoryComponentController",e),e.$inject=["SimpleSiteBuilderBlogService","$scope","$timeout","$location","$filter"]}(),function(){app.directive("ssbRecentPostComponent",function(){return{restrict:"A",controller:"SiteBuilderBolgRecentPostComponentController",controllerAs:"vm",bindToController:!0,scope:{component:"="},templateUrl:"/admin/assets/js/ssb-site-builder/ssb-components/shared/ssb-component-wrap.html",replace:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a){function o(){i.hasFeaturedPosts=i.blog.posts.filter(function(e){return e.featured}).length}var i=this;i.init=function(e){i.element=e,o(),i.blog.posts.length||i.initData()},i.initData=function(){var t=e.loadDataFromPage("#indigenous-precache-sitedata-posts")||window.indigenous.precache.siteData.posts;t&&(i.filteredPostView&&(i.blog.currentAuthor&&(t=t.filter(function(e){return e.post_author===i.blog.currentAuthor})),i.blog.currentTag&&(t=t.filter(function(e){if(e.post_tags)return _.some(e.post_tags,function(e){return e.toLowerCase()===i.blog.currentTag.toLowerCase()})})),i.blog.currentCategory&&(t=t.filter(function(e){if(e.post_categories)return _.some(e.post_categories,function(e){return e.text?e.text.toLowerCase()===i.blog.currentCategory.toLowerCase():e.toLowerCase()===i.blog.currentCategory.toLowerCase()})}))),o())},i.hasFeaturedPosts=!1,i.showNumberOfPosts=function(){var e=6;return i.component.post_count&&(e=i.showFirstPost()?parseInt(i.component.post_count):parseInt(i.component.post_count)+1),e>i.blog.posts.length&&(e=i.blog.posts.length),e},i.showFirstPost=function(){return i.filterCategoryOrTagsView=i.component.postTags&&i.component.postTags.length||i.component.postCategories&&i.component.postCategories.length};var s=a.$$url.replace("/page/","");s&&(s=decodeURI(s)),i.blog=e.blog||{},i.sortBlogPosts=function(e){return new Date(e.publish_date||e.created.date).getTime()},i.filteredPostView=!1,i.titleStyle=function(){var e=" ";return i.component&&i.component.settings&&i.component.settings.title&&i.component.settings.title.fontSize&&(e+="font-size: "+i.component.settings.title.fontSize+"px !important;"),i.component&&i.component.settings&&i.component.settings.title&&i.component.settings.title.fontFamily&&(e+="font-family: "+i.component.settings.title.fontFamily+"px !important;"),i.component&&i.component.settings&&i.component.settings.title&&i.component.settings.title.color&&(e+="color: "+i.component.settings.title.color+"!important;"),e},i.descriptionStyle=function(){var e=" ";return i.component&&i.component.settings&&i.component.settings.description&&i.component.settings.description.fontSize&&(e+="font-size: "+i.component.settings.description.fontSize+"px !important;"),i.component&&i.component.settings&&i.component.settings.description&&i.component.settings.description.fontFamily&&(e+="font-family: "+i.component.settings.description.fontFamily+"px !important;"),i.component&&i.component.settings&&i.component.settings.description&&i.component.settings.description.color&&(e+="color: "+i.component.settings.description.color+"!important;"),e},s.indexOf("tag/")>-1&&(i.blog.currentTag=s.replace("/tag/",""),i.filteredPostView=!0),s.indexOf("author/")>-1&&(i.blog.currentAuthor=s.replace("/author/",""),i.filteredPostView=!0),s.indexOf("category/")>-1&&(i.blog.currentCategory=s.replace("/category/",""),i.filteredPostView=!0),t.$watchCollection("vm.blog.posts",function(e){e&&(i.blog.posts.length>1?i.element.closest("div.ssb-page-section").css({display:"block"}):i.element.closest("div.ssb-page-section").css({display:"none"}))})}app.controller("SiteBuilderBolgRecentPostComponentController",e),e.$inject=["SimpleSiteBuilderBlogService","$scope","$timeout","$location"]}(),function(){"use strict";app.directive("ssbRecentTagComponent",function(){return{restrict:"A",controller:"SiteBuilderBolgRecentTagComponentController",controllerAs:"vm",bindToController:!0,scope:{component:"="},templateUrl:"/admin/assets/js/ssb-site-builder/ssb-components/shared/ssb-component-wrap.html",replace:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t){function n(){var e=[];return a.blog.posts.length>0&&angular.forEach(a.blog.posts,function(t){t.post_tags&&t.post_tags.length>0&&angular.forEach(t.post_tags,function(t){e.length<20&&(angular.isObject(t)&&t.text?-1===e.indexOf(t.text)&&e.push(t):-1===e.indexOf(t)&&e.push(t))})}),e}var a=this;a.init=function(e){a.element=e,a.blog_tags=n(),a.blog_tags.length<1&&e.closest("div.ssb-page-section").css({display:"none"})},a.hasFeaturedPosts=!1,a.blog=e.blog||{},a.blog_tags=[],a.filteredPostView=!1,a.encodeUrlText=function(e){return encodeURI(e)},a.titleStyle=function(){var e=" ";return a.component&&a.component.settings&&a.component.settings.title&&a.component.settings.title.fontSize&&(e+="font-size: "+a.component.settings.title.fontSize+"px !important;"),a.component&&a.component.settings&&a.component.settings.title&&a.component.settings.title.fontFamily&&(e+="font-family: "+a.component.settings.title.fontFamily+"px !important;"),a.component&&a.component.settings&&a.component.settings.title&&a.component.settings.title.color&&(e+="color: "+a.component.settings.title.color+"!important;"),e},a.descriptionStyle=function(){var e=" ";return a.component&&a.component.settings&&a.component.settings.description&&a.component.settings.description.fontSize&&(e+="font-size: "+a.component.settings.description.fontSize+"px !important;"),a.component&&a.component.settings&&a.component.settings.description&&a.component.settings.description.fontFamily&&(e+="font-family: "+a.component.settings.description.fontFamily+"px !important;"),a.component&&a.component.settings&&a.component.settings.description&&a.component.settings.description.color&&(e+="color: "+a.component.settings.description.color+"!important;"),e},t.$watchCollection("vm.blog.posts",function(e){e&&(a.blog_tags=n(),a.blog_tags.length<1?a.element.closest("div.ssb-page-section").css({display:"none"}):a.element.closest("div.ssb-page-section").css({display:"block"}))})}app.controller("SiteBuilderBolgRecentTagComponentController",e),e.$inject=["SimpleSiteBuilderBlogService","$scope"]}(),function(){"use strict";app.directive("ssbRssFeedComponent",function(){return{restrict:"A",controller:"SiteBuilderRssFeedComponentController",controllerAs:"vm",bindToController:!0,scope:{ssbEditor:"=",componentClass:"&",component:"="},templateUrl:"/admin/assets/js/ssb-site-builder/ssb-components/shared/ssb-component-wrap.html",replace:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o){function i(){s.loading=!0,o.parseFeed(s.component.settings.source).then(function(e){e&&e.data?(s.feeds=e.data,s.loading=!1):(s.feeds=[],s.loading=!1)}).catch(function(){s.feeds=[],s.loading=!1})}var s=this;s.loadFeed=i,s.init=function(e){s.element=e},s.titleStyle=function(){var e=" ";return s.component&&s.component.settings&&s.component.settings.title&&s.component.settings.title.fontSize&&(e+="font-size: "+s.component.settings.title.fontSize+"px !important;"),s.component&&s.component.settings&&s.component.settings.title&&s.component.settings.title.fontFamily&&(e+="font-family: "+s.component.settings.title.fontFamily+"px !important;"),s.component&&s.component.settings&&s.component.settings.title&&s.component.settings.title.color&&(e+="color: "+s.component.settings.title.color+"!important;"),e},s.descriptionStyle=function(){var e=" ";return s.component&&s.component.settings&&s.component.settings.description&&s.component.settings.description.fontSize&&(e+="font-size: "+s.component.settings.description.fontSize+"px !important;"),s.component&&s.component.settings&&s.component.settings.description&&s.component.settings.description.fontFamily&&(e+="font-family: "+s.component.settings.description.fontFamily+"px !important;"),s.component&&s.component.settings&&s.component.settings.description&&s.component.settings.description.color&&(e+="color: "+s.component.settings.description.color+"!important;"),e},s.isEditing=e.$parent&&e.$parent.vm&&e.$parent.vm.uiState,e.$watch("vm.component.settings.source",function(e){angular.isDefined(e)&&i()})}app.controller("SiteBuilderRssFeedComponentController",e),e.$inject=["$scope","$attrs","$filter","$transclude","RssFeedService"]}(),function(){"use strict";function e(e){function n(e){return e.finally(function(){}),e}var a={};return a.parseFeed=function(a){var o=[t].join("/");return n(e({url:o,method:"POST",data:{feedUrl:a}}).success(function(){}).error(function(){}))},a}app.factory("RssFeedService",e),e.$inject=["$http"];var t="/api/2.0/cms/feed/rss"}(),function(){"use strict";app.directive("ssbTextComponent",function(){return{restrict:"A",controller:"SiteBuilderTextComponentController",controllerAs:"vm",bindToController:!0,scope:{ssbEditor:"=",componentClass:"&",component:"="},templateUrl:"/admin/assets/js/ssb-site-builder/ssb-components/ssb-text/ssb-text.component.html",replace:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a){var o=this;o.init=function(e){o.element=e}}app.controller("SiteBuilderTextComponentController",e),e.$inject=["$scope","$attrs","$filter","$transclude"]}(),function(){"use strict";app.directive("ssbTextSettings",function(){return{restrict:"C",controller:"SiteBuilderTextSettingsController",controllerAs:"vm",bindToController:!0,scope:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s){function r(){h={},f.parentComponent&&f.parentComponent.scope()&&(h.component=f.parentComponent.scope().vm.component,f.elementData=d())}function c(){for(;(!b.vm||b.vm&&!b.vm.uiState)&&v>0;)b=b.$parent,v--;return h=b.vm,t.pvm=h,h&&t.$watch("pvm.uiState.activeElement",function(e){e&&e.id===f.elementData.id&&(angular.equals(f.elementDataOriginal,e)||(f.elementData=e,u()))},!0),h}function l(){var e={};if(!c())return!1;if(f.parentSection.hasClass("ssb-page-section-layout-hero")&&o(function(){var e=f.element[0];e.style.display="none",e.offsetHeight,e.style.display=""},4e3),f.elementId="text-element_"+f.parentSectionId+"-"+f.parentComponentId+"-"+f.elementModelName,f.isNestedModelProp){if(f.parentNgRepeat.length||f.parentRepeatIndex.length)if(f.parentRepeatIndex.length)f.elementModelIndex=f.parentRepeatIndex.attr("data-repeat-index-id");else if(f.parentNgRepeat.hasClass("thumbnail-image-slider-collection")){var t=f.parentNgRepeat.scope().$parent.$index,n=f.parentNgRepeat.scope().$index,a=4;angular.element(s).width()<768&&(a=1),f.elementModelIndex=t>0?t*a+n:n}else f.elementModelIndex=f.parentNgRepeat.scope().$index;void 0!==f.elementModelIndex&&null!==f.elementModelIndex&&(f.elementId=f.elementId+"-i"+f.elementModelIndex)}return e={id:f.elementId,_id:f.elementId,anchor:f.elementId},f.parentTextElementClassNameAttribute&&"btn-form-text"===f.parentTextElementClassNameAttribute&&(e.disableTextSpacing=!0),f.elementData=angular.extend(f.elementData,e),f.elementData=angular.extend(f.elementData,d()),f.elementDataOriginal=angular.copy(f.elementData),f.elementData}function u(){p()}function d(){var e={};if(h.component.elementStyles&&h.component.elementStyles[f.elementModelName])if(f.isNestedModelProp){if(f.parentNgRepeat.length||f.parentRepeatIndex.length)if(f.parentRepeatIndex.length)f.elementModelIndex=f.parentRepeatIndex.attr("data-repeat-index-id");else if(f.parentNgRepeat.hasClass("thumbnail-image-slider-collection")){var t=f.parentNgRepeat.scope().$parent.$index,n=f.parentNgRepeat.scope().$index,a=4;angular.element(s).width()<768&&(a=1),f.elementModelIndex=t>0?t*a+n:n}else f.elementModelIndex=f.parentNgRepeat.scope().$index;void 0!==f.elementModelIndex&&null!==f.elementModelIndex&&(e=h.component.elementStyles[f.elementModelName][f.elementModelIndex])}else e=h.component.elementStyles[f.elementModelName];return e&&e.bg&&e.bg.img&&null===e.bg.img.url&&(e.bg.img.url=""),e}function p(){if(h.component.elementStyles=h.component.elementStyles||{},f.isNestedModelProp){if(h.component.elementStyles[f.elementModelName]=h.component.elementStyles[f.elementModelName]||{},f.parentNgRepeat.length||f.parentRepeatIndex.length)if(f.parentRepeatIndex.length)f.elementModelIndex=f.parentRepeatIndex.attr("data-repeat-index-id");else if(f.parentNgRepeat.hasClass("thumbnail-image-slider-collection")){var e=f.parentNgRepeat.scope().$parent.$index,t=f.parentNgRepeat.scope().$index,n=4;angular.element(s).width()<768&&(n=1),f.elementModelIndex=e>0?e*n+t:t}else f.elementModelIndex=f.parentNgRepeat.scope().$index;if(void 0===f.elementModelIndex||null===f.elementModelIndex)return new Error("can't find parent ng-repeat");h.component.elementStyles[f.elementModelName][f.elementModelIndex]=f.elementData}else h.component.elementStyles[f.elementModelName]=f.elementData;return h.component.elementStyles}function m(){var e=f.element.parents("[data-ng-repeat]:first");return e.length||(e=f.element.parents("[ng-repeat]:first")),e}function g(){return f.element.closest("[data-repeat-index-id]")}var f=this,h=null,v=10,b=t.$parent;f.init=function(e){f.element=e,f.parentTextElement=f.element.parent(),f.parentTextElementModelAttribute=f.parentTextElement.attr("ng-model"),f.parentTextElementClassNameAttribute=f.parentTextElement.attr("class-name"),f.elementModelName=f.parentTextElementModelAttribute.replace("component.","").replace("vm.","").replace(/\./g,"/"),f.isNestedModelProp=!f.applyStylesToSiblingTextElements&&-1!==f.elementModelName.indexOf("/"),f.parentComponent=f.element.closest(".ssb-component"),f.parentNgRepeat=m(),f.parentRepeatIndex=g(),n.isEdit?f.element.closest("indi-email-builder").length||(f.parentComponentId=f.parentComponent.attr("id"),f.parentSection=f.element.closest(".ssb-section-layout"),f.parentSectionId=f.parentSection.attr("id"),l()):r()},f.element=null,f.elementId=null,f.parentTextElement=null,f.showHideClass=function(){var e="";return f.elementData&&(f.elementData.hideOnlyMobile&&(e+=" ssb-text-o-desktop"),f.elementData.showOnlyMobile&&(e+=" ssb-text-o-moblie")),e},f.parentTextElementModelAttribute=null,f.parentTextElementClassNameAttribute=null,f.parentComponent=null,f.parentComponentId=null,f.elementModelName=null,f.elementModelIndex=null,f.parentNgRepeat=null,f.parentRepeatIndex=null,f.applyStylesToSiblingTextElements=!1,f.elementClass=function(){if(f.elementData&&f.elementData.type){var e={};return e["ssb-element"]=!0,e[f.elementData.type]=!0,e}return""},f.elementStyle=function(e){if(f.elementData&&f.elementData.type){var t=" ",n=f.elementData;return n.spacing&&(n.spacing.pt&&(t+="padding-top: "+n.spacing.pt+"px;"),n.spacing.pb&&(t+="padding-bottom: "+n.spacing.pb+"px;"),n.spacing.pl&&(t+="padding-left: "+n.spacing.pl+"px;"),n.spacing.pr&&(t+="padding-right: "+n.spacing.pr+"px;"),n.spacing.mt&&(t+="margin-top: "+n.spacing.mt+"px;"),n.spacing.mb&&(t+="margin-bottom: "+n.spacing.mb+"px;"),n.spacing.ml&&(t+="auto"===n.spacing.ml?"margin-left: "+n.spacing.ml+";float: none;":"margin-left: "+n.spacing.ml+"px;"),n.spacing.mr&&(t+="auto"===n.spacing.mr?"margin-right: "+n.spacing.mr+";float: none;":"margin-right: "+n.spacing.mr+"px;"),n.spacing.mw&&(t+="100%"===n.spacing.mw?"max-width: "+n.spacing.mw+";":"max-width: "+n.spacing.mw+"px;margin:0 auto!important;"),n.spacing.lineHeight&&(t+="line-height: "+n.spacing.lineHeight)),n.txtcolor&&(t+="color: "+n.txtcolor+";"),e||!1!==n.visibility||(t+="display: none!important;"),n.bg&&(n.bg.color&&(t+="background-color: "+n.bg.color+";"),n.bg.img&&n.bg.img.show&&""!==n.bg.img.url&&(t+='background-image: url("'+n.bg.img.url+'");')),n.border&&n.border.show&&n.border.color&&(t+="border-color: "+n.border.color+";",t+="border-width: "+n.border.width+"px;",t+="border-style: "+n.border.style+";",t+="border-radius: "+n.border.radius+"%;"),t}return""},f.elementDataOriginal,f.elementData={name:"Text Element",type:"ssb-element-text",title:"Text Element",version:null,bg:{img:{url:"",width:null,height:null,parallax:!1,blur:!1,overlay:!1,show:!1},color:""},txtcolor:"",hideOnlyMobile:!1,showOnlyMobile:!1,visibility:!0,spacing:{}},f.showHide=function(){return!1!==f.elementData.visibility}}app.controller("SiteBuilderTextSettingsController",e),e.$inject=["$rootScope","$scope","$attrs","$filter","$timeout","$compile","$window"]}(),function(){"use strict";app.directive("ssbThemeBtn",function(){return{restrict:"C",controller:"SiteBuilderThemeBtnController",controllerAs:"vm",bindToController:!0,scope:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r,c,l){function u(){var e=C.element.attr("data-ssb-style"),t=C.element.attr("data-ssb-hover-style"),n=C.element.attr("data-ssb-active-style"),a=C.element.attr("data-ssb-class"),o=C.element.attr("data-show-border"),i={id:"button-element_"+S,_id:"button-element_"+S,anchor:"button-element_"+S,bg:{},hover:{bg:{}},pressed:{bg:{}},border:{},spacing:{}};if(e){var s=$('<div style="'+e+'"></div>').get(0).style,r=s.backgroundColor,c=s.color,l="none"!==s.display,u=s.paddingTop.replace("px",""),d=s.paddingLeft.replace("px",""),p=s.paddingRight.replace("px",""),m=s.paddingBottom.replace("px",""),g=s.marginTop.replace("px",""),f=s.marginLeft.replace("px",""),h=s.marginRight.replace("px",""),v=s.marginBottom.replace("px",""),b=s.maxWidth.replace("px",""),y=s.borderColor,w=s.borderWidth.replace("px",""),T=s.borderRadius.replace("%",""),P=s.borderStyle;i.bg.color=r,i.txtcolor=c,i.visibility=l,i.spacing.pt=u,i.spacing.pl=d,i.spacing.pr=p,i.spacing.pb=m,i.spacing.mt=g,i.spacing.ml=f,i.spacing.mr=h,i.spacing.mb=v,i.spacing.mw=b,i.border.color=y,i.border.width=w,i.border.style=P,i.border.radius=T}if(i.border.show=o,t){var D=$('<div style="'+t+'"></div>').get(0).style,A=D.backgroundColor,x=D.color;i.hover.bg.color=A,i.hover.txtcolor=x}if(n){var I,E=$('<div style="'+n+'"></div>').get(0).style,M=E.backgroundColor,B=E.color;i.pressed.bg.color=M,i.pressed.txtcolor=B}if(a){try{I=JSON.parse(a)}catch(e){}I&&(i.version=_.each(I,function(e,t,n){if(0===t.indexOf("ssb-theme-btn-style-"))return t.replace("ssb-theme-btn-style-","")}))}C.element.hover(function(){var e=C.elementData;e.hover.txtcolor&&this.style.setProperty("color",i.hover.txtcolor,"important"),e.hover.bg&&this.style.setProperty("background-color",e.hover.bg.color,"important")},function(){C.elementStyle(C.element)}),C.element.on("mousedown touchstart",function(){var e=C.elementData;e.pressed.txtcolor&&this.style.setProperty("color",i.pressed.txtcolor,"important"),e.pressed.bg&&this.style.setProperty("background-color",e.pressed.bg.color,"important")}),angular.extend(C.elementData,i),k=!0}function d(){return C.element.attr("class")&&C.element.attr("class").indexOf("ssb-theme-btn-style-")>-1}function p(e){D.uiState.activeElement=e?{}:C.elementData}function m(){angular.element(".ssb-edit-wrap, .editable-title, .editable-cover, [data-edit]",".ssb-main").removeClass("ssb-on"),angular.element(".ssb-main").find(".ssb-active-edit-control").removeClass("ssb-active-edit-control"),angular.element(".ssb-main").find(".ssb-on").removeClass("ssb-on"),angular.element(".ssb-main").find(".ssb-active-component").removeClass("ssb-active-component"),angular.element(".ssb-main").find(".ssb-theme-btn-active-element").removeClass("ssb-theme-btn-active-element"),angular.element(".ssb-main").find(".ssb-edit-control-component-btn").removeClass("on")}function g(e){e.stopPropagation(),m(),D.uiState.activeSectionIndex=null,D.uiState.activeComponentIndex=null;var n=l.getCompiledElement(b.attr("id"),w,S);if(s(function(){b.find("[data-compiled]").removeClass("ssb-theme-btn-active-element"),n.addClass("ssb-theme-btn-active-element"),$(".ssb-edit-control[data-compiled-control-id]").removeClass("on")}),l.getCompiledElementEditControl(b.attr("id"),w,S))s(function(){p(),h();var e=$('.ssb-edit-control[data-compiled-control-id="control_'+S+'"]');e.addClass("on"),D.uiState.showSectionPanel&&s(function(){e.find(".ssb-settings-btn").click()},0),(D.uiState.showSectionPanel||l.isIENotEdge)&&s(function(){e.find(".ssb-settings-btn").click()})});else{t.component={title:"Button_"+S,type:"Button"};var a=v();r(a)(t,f);var o=angular.copy(D.uiState.showSectionPanel);D.uiState.showSectionPanel=!1,s(function(){D.uiState.showSectionPanel=o,p(),h();var e=$('.ssb-edit-control[data-compiled-control-id="control_'+S+'"]');e.addClass("on"),D.uiState.showSectionPanel&&s(function(){e.find(".ssb-settings-btn").click()},0),(D.uiState.showSectionPanel||l.isIENotEdge)&&s(function(){e.find(".ssb-settings-btn").click()})})}}function f(e,t){var n;s(function(){e.prependTo(b.parent()),(n=$('.ssb-edit-control[data-compiled-control-id="control_'+S+'"]')).addClass("on"),l.addCompiledElementEditControl(b.attr("id"),w,S,n),p(),h(),D.uiState.showSectionPanel&&n.find(".ssb-settings-btn").click()})}function h(){var e=angular.element(c).width(),t=document.querySelector(".ssb-site-builder-container")||document.querySelector(".email-builder-container"),n=0,a=0,o=140,i=t?t.scrollTop:0,s=35;e<768&&(o=0,s=20);var r=l.getCompiledElement(b.attr("id"),w,S),u=l.getCompiledElementEditControl(b.attr("id"),w,S);r.length&&document.querySelector(".ssb-site-builder-container")&&(n=r[0].getBoundingClientRect().top-35-125+i,a=r[0].getBoundingClientRect().left-s-o),r.length&&document.querySelector(".email-builder-container")&&(n=r[0].getBoundingClientRect().top-35,a=r[0].getBoundingClientRect().left-s),u&&u.length&&u.css({top:n,left:a})}function v(){var e='data-compiled-control-id="control_'+S+'" class="ssb-edit-control ssb-edit-control-component ssb-edit-control-component-btn on" component="component" state="pvm.state" ui-state="pvm.uiState" section-index="null" component-index="null">';return null!==document.querySelector(".email-builder-container")?"<email-edit-control "+e+"</email-edit-control>":"<ssb-edit-control "+e+"</ssb-edit-control>"}var b,y,w,C=this,S="",k=!1;C.init=function(e){C.element=e,D&&e.data("compiled")?(S=e.data("compiled"),b=e.closest("[component]"),y=e.closest(".editable"),w=y.froalaEditor().data("froala.editor").id,u(),s(function(){$("[data-compiled="+S+"]").on("click",g),$("[data-compiled-control-id=control_"+S+"]").on("click",p)})):(C.elementClass=angular.noop(),A())},C.elementClass=function(){var e={},t=parseInt(C.elementData.version),n="number"==typeof parseInt(C.elementData.version),a=isNaN(parseInt(C.elementData.version));return e["ssb-element"]=!0,e[C.elementData.type]=!0,e["ssb-hide-during-load"]=!k,n&&!a&&(e["ssb-theme-btn-style-"+t]=!0),C.element&&C.element.attr("data-ssb-class",JSON.stringify(e)),e},C.elementStyle=function(e){var t=" ",n=" ",a=" ",o=C.elementData;return o.spacing&&(o.spacing.pt&&(t+="padding-top: "+o.spacing.pt+"px;"),o.spacing.pb&&(t+="padding-bottom: "+o.spacing.pb+"px;"),o.spacing.pl&&(t+="padding-left: "+o.spacing.pl+"px;"),o.spacing.pr&&(t+="padding-right: "+o.spacing.pr+"px;"),o.spacing.mt&&(t+="margin-top: "+o.spacing.mt+"px;"),o.spacing.mb&&(t+="margin-bottom: "+o.spacing.mb+"px;"),o.spacing.ml&&(t+="auto"==o.spacing.ml?"margin-left: "+o.spacing.ml+";float: none;":"margin-left: "+o.spacing.ml+"px;"),o.spacing.mr&&(t+="auto"==o.spacing.mr?"margin-right: "+o.spacing.mr+";float: none;":"margin-right: "+o.spacing.mr+"px;"),o.spacing.mw&&(t+="100%"===o.spacing.mw?"max-width: "+o.spacing.mw+";":"max-width: "+o.spacing.mw+"px;margin:0 auto!important;"),o.spacing.lineHeight&&(t+="line-height: "+o.spacing.lineHeight)),o.txtcolor?t+="color: "+o.txtcolor+";":C.defaultBtnStyles.primaryBtnTextColor&&(t+="color: "+C.defaultBtnStyles.primaryBtnTextColor+";"),!1===o.visibility&&(t+="display: none!important;"),o.bg&&(o.bg.color?(t+="background-color: "+o.bg.color+";",t+="border-color: transparent;"):C.defaultBtnStyles.primaryBtnBackgroundColor&&C.element&&!d()&&(t+="background-color: "+C.defaultBtnStyles.primaryBtnBackgroundColor+";",t+="border-color: transparent;")),o.hover&&(o.hover.txtcolor&&(n+="color: "+o.hover.txtcolor+";"),o.hover.bg&&(n+="background-color: "+o.hover.bg.color+";",n+="border-color: transparent;")),o.pressed&&(o.pressed.txtcolor&&(a+="color: "+o.pressed.txtcolor+";"),o.pressed.bg&&(a+="background-color: "+o.pressed.bg.color+";",a+="border-color: transparent;")),o.border&&o.border.show&&o.border.color&&o.border.style&&(t+="border-color: "+o.border.color+";",t+="border-width: "+o.border.width+"px;",t+="border-style: "+o.border.style+";",t+="border-radius: "+o.border.radius+"%;"),C.element&&(C.element.attr("data-show-border",o.border.show),C.element.attr("data-ssb-style",t),C.element.attr("data-ssb-hover-style",n),C.element.attr("data-ssb-active-style",a)),e&&e.attr("style",t),t},C.elementDataOriginal,C.elementData={name:"Button",type:"ssb-element-button",title:"Button",version:null,bg:{img:{url:"",width:null,height:null,parallax:!1,blur:!1,overlay:!1,show:!1},color:""},txtcolor:"",visibility:!0,spacing:{},hover:{txtcolor:"",bg:{color:""}},pressed:{txtcolor:"",bg:{color:""}},border:{}};for(var T=10,P=t.$parent;(!P.vm||P.vm&&!P.vm.uiState)&&T>0;)P=P.$parent,T--;var D=P.vm;t.pvm=D,C.defaultBtnStyles={},t.pvm&&t.pvm.state&&t.pvm.state.emails&&t.pvm.state.website&&t.pvm.state.website.themeOverrides&&t.pvm.state.website.themeOverrides.styles&&t.pvm.state.website.themeOverrides.styles&&(C.defaultBtnStyles.primaryBtnBackgroundColor=t.pvm.state.website.themeOverrides.styles.primaryBtnBackgroundColor,C.defaultBtnStyles.primaryBtnTextColor=t.pvm.state.website.themeOverrides.styles.primaryBtnTextColor,C.defaultBtnStyles.primaryBtnBorderColor=t.pvm.state.website.themeOverrides.styles.primaryBtnBackgroundColor),e.$on("$ssbElementsChanged",function(e,t,n){w&&w===n&&b&&t===b.attr("id")&&h()});var A=t.$watch("vm.elementData",function(e){k&&(h(),C.elementDataOriginal=C.elementDataOriginal||angular.copy(C.elementData),angular.equals(C.elementDataOriginal,C.elementData)||(D.state.pendingPageChanges=!0,y.froalaEditor&&y.froalaEditor("events.trigger","contentChanged")),e&&y.froalaEditor&&y.froalaEditor("events.trigger","contentChanged"))},!0)}app.controller("SiteBuilderThemeBtnController",e),e.$inject=["$rootScope","$scope","$attrs","$filter","$transclude","$sce","$timeout","$compile","$window","SimpleSiteBuilderService"]}(),function(){app.directive("ssbActionButtons",function(){return{restrict:"E",scope:{state:"=",saveAction:"&",cancelAction:"&",revertAction:"&",publishAction:"&"},templateUrl:"assets/js/ssb-site-builder/ssb-controls/ssb-action-buttons/ssb-action-buttons.component.html",controller:"SiteBuilderActionButtonsController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o){var i=this;i.pageVersions=[],i.hideHistoryTT=!1,i.spinTimeoutPromise=null,i.init=function(e){i.element=e},i.save=function(){i.saveAction()},i.cancel=function(){i.cancelAction()},i.revert=function(e){i.revertAction({versionId:e})},i.publish=function(){i.publishAction()},i.historyDropdownFn=function(e){i.hideHistoryTT=e,e?($(".tooltip").hide(),a.getPageVersions(i.state.page._id,function(e){i.pageVersions=e})):(i.pageVersions=[],$(".tooltip").show())},e.$watch(i.state,function(e,t){angular.isDefined(i.state.page.published)&&i.state.page.published&&i.state.page.published.date<i.state.page.modified.date&&(i.spinTimeoutPromise&&o.cancel(i.spinTimeoutPromise),i.spinTimeoutPromise=o(function(){$(".fa.fa-globe.fa-spin").removeClass("fa-spin")},1e4))},!0)}app.controller("SiteBuilderActionButtonsController",e),e.$inject=["$scope","$attrs","$filter","SimpleSiteBuilderService","$timeout"]}(),app.controller("SiteBuilderAddSectionModalController",["$timeout","parentVm","SimpleSiteBuilderService",function(e,t,n){var a,o=this;o.parentVm=t,o.enabledPlatformSections=_.where(o.parentVm.state.platformSections,{enabled:!0}),o.enabledUserSections=_.where(o.parentVm.state.userSections,{enabled:!0}),o.sections=o.enabledPlatformSections,o.sectionType="enabledPlatformSections",o.sectionFilters=_.without(_.uniq(_.pluck(_.sortBy(o.enabledPlatformSections,"filter"),"filter")),"misc"),_.each(o.sectionFilters,function(e,t){a=e.charAt(0).toUpperCase()+e.substring(1).toLowerCase(),o.sectionFilters[t]={capitalized:a,lowercase:e},a=null}),o.sectionFilters.unshift({capitalized:"All",lowercase:"all"}),o.sectionFilters.push({capitalized:"Misc",lowercase:"misc"}),o.setFilterType=function(e){o.typefilter=e},o.setSectionType=function(e){n.getUserSections().then(function(){o.sectionType=e,o.sections=o[e]})}}]),function(){app.directive("ssbBlogEditor",function(){return{restrict:"E",scope:{state:"=",uiState:"="},templateUrl:"assets/js/ssb-site-builder/ssb-controls/ssb-blog-editor/ssb-blog-editor.component.html",controller:"SiteBuilderBlogEditorController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r,c){function l(e){return e?e.post_title:m.state.post&&m.state.post.post_title}function u(e){return r("slugify")(e)}function d(e,t){var n=angular.equals(e,t);if(!n){var a=DeepDiff(e,t),o=a.filter(function(e){return e.lhs&&e.rhs&&(e.lhs.text===e.rhs||e.lhs===e.rhs.text)});a.length===o.length&&(n=!0)}return n}function p(e){angular.element(this).hasClass("clickable-link")||(e.preventDefault(),e.stopPropagation())}var m=this;m.init=function(e){m.element=e,m.state.blog||(m.state.blog=a.blog),m.state.blog.posts.length||(m.state.blog.posts=a.loadDataFromPage("#indigenous-precache-sitedata-posts")),angular.element(".ssb-sidebar-section-panel-scrollable").on("click","article a",p)},m.ssbEditor=!0,m.ssbBlogEditor=!0,m.closeBlogPanel=function(){m.state.pendingBlogChanges?m.savePost().then(m.uiState.cleanBlogPanel):m.uiState.cleanBlogPanel()},m.backBlogPanel=function(){m.savePost().then(m.uiState.navigation.blogPanel.back)},m.state.pendingBlogChanges=m.state.pendingBlogChanges||!1,m.uiState.activePostFilter="all",m.uiState.froalaEditorActive=!1,m.editableElementSelectors=".ssb-blog-editor-post-title, .ssb-blog-editor-post-body",m.editableElements=[],m.blogListPageTemplate=s.getBlogListPage(),m.blogPostPageTemplate=s.getBlogPostPage(),m.toggleFeatured=function(e){e.featured=!e.featured,m.savePost(e)},m.togglePublished=function(e){e.post_status="PUBLISHED"!==e.post_status?"PUBLISHED":"DRAFT",m.savePost(e)},m.filter=function(e){var t=!1;return"all"!==m.uiState.activePostFilter&&""!==m.uiState.activePostFilter||(t=!0),"published"===m.uiState.activePostFilter&&(t="published"===e.post_status.toLowerCase()),"draft"===m.uiState.activePostFilter&&(t="draft"===e.post_status.toLowerCase()),"featured"===m.uiState.activePostFilter&&(t=e.featured),t},m.duplicatePost=function(e){a.duplicatePost(e).then(function(){i.pop("success","Duplicate Post Created","The post was created successfully.")}).catch(function(e){i.pop("error","Error","Error creating duplicate post. Please try again.")})},m.viewPost=function(e){if(m.blogPostPageTemplate[0]){var t=c.open();t.opener=null,t.location="/preview/"+m.blogPostPageTemplate[0]._id+"/"+e._id}},m.deletePost=function(e){o.swal({title:"Are you sure?",text:"Do you want to delete this post?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"Cancel",closeOnConfirm:!0,closeOnCancel:!0},function(t){t&&a.deletePost(e).then(function(){i.pop("success","Post Deleted","The post was deleted successfully.")}).catch(function(e){i.pop("error","Error","Error deleting post. Please try again.")})})},m.editPost=function(e){m.state.post=e,m.uiState.navigation.blogPanel.loadPanel({name:"Edit Post",id:"edit"})},m.publishPost=function(e){e.post_status="PUBLISHED",e.publish_date||(e.publish_date=r("date")(new Date,"MM/dd/yyyy")),m.savePost(e)},m.retractPost=function(e){e.post_status="DRAFT",m.savePost(e)},m.savePost=function(e,t,n){if(!(e=e||m.state.post)||!l(e))return s.returnInvalidPost();e.publish_date||"PUBLISHED"!==e.post_status||(e.publish_date=Date.parse(r("date")(new Date,"MM/dd/yyyy")));var o={};return m.uiState.saveLoading=!0,e.websiteId=m.state.website._id,e.display_title=angular.element("<div>"+e.post_title+"</div>").text().trim(),e.post_url=u(angular.element("<div>"+e.post_title+"</div>").text().trim()),a.savePost(e).then(function(e){m.state.post=e.data,m.state.pendingBlogChanges=!1,o={type:"success",title:"Post Saved",message:"The post was saved successfully."}}).catch(function(t){o={type:"error",title:"Error",message:t.data?t.data.message:"Error updating post. Please try again."},e._id&&n?(a.getPost(e),m.handleSaveErrors(t)):m.handleSaveErrors(t)}).finally(function(){m.uiState.saveLoading=!1,t||i.pop(o.type,o.title,o.message)})},m.isValidPost=l,m.setFeaturedImage=function(e){e&&s.openMediaModal("media-modal","MediaModalCtrl",null,"lg").result.then(function(){s.asset&&s.isImage(s.asset.url).then(function(e){!1!==e?(m.state.post.featured_image=s.asset.url,s.asset=null):s.asset=null})})},m.removeFeaturedImage=function(e){e.featured_image=null},m.handleSaveErrors=function(e){e.data&&"A post with this title already exists"===e.data.message&&angular.element("input.ssb-blog-editor-post-title").focus()},m.autoSave=function(e,t){var n=angular.copy(e),a=angular.copy(t);n&&n.modified&&delete n.modified,a&&a.modified&&delete a.modified,a&&m.state.post&&""!==m.state.post.post_title&&(angular.equals(n,a)||m.uiState.saveLoading||m.savePost(m.state.post,!0))},m.checkPendingChanges=function(e,t){if(e=e||{},t=t||{},angular.equals(e._id,t._id)){var n=angular.copy(e),a=angular.copy(t);n&&n.modified&&delete n.modified,a&&a.modified&&delete a.modified,a&&m.state.post&&""!==m.state.post.post_title&&(m.state.pendingBlogChanges||(d(n,a)?m.state.pendingBlogChanges=!1:m.state.pendingBlogChanges=!0))}},m.refreshPost=function(){m.state.post=angular.copy(m.defaultPost)},m.draftPost=function(e){e.post_status="DRAFT",e.publish_date=null,m.savePost(e)},m.tagsAdded=function(e){e&&e.text&&(e.text=e.text.replace(/#|\//g,""))},m.sortBlogPosts=function(e){return new Date(e.publish_date||e.created.date).getTime()},m.uiState.cleanBlogPanel=function(){n(function(){m.uiState.openBlogPanel={name:"",id:""},m.uiState.openSidebarPanel="",m.state.post=null},500)},m.defaultPost={post_title:"",post_content:"",post_author:function(){if(m.state.account&&m.state.account.business)return m.state.account.business.name}()},e.$watch("vm.state.post.post_author",function(e,t){e&&e!==t&&(m.state.post.post_author=e.replace(/#|\//g,""))}),e.$watchGroup(["vm.uiState.openSidebarPanel.id","vm.uiState.openBlogPanel.id"],_.debounce(function(e){n(function(){m.ssbBlogLoaded=!0},0),m.state.post&&m.state.pendingBlogChanges&&"edit"!==e[1]&&m.savePost(null,null,!0)},1e3),!0),e.$watch("vm.state.post",m.checkPendingChanges,!0)}app.controller("SiteBuilderBlogEditorController",e),e.$inject=["$scope","$rootScope","$timeout","SimpleSiteBuilderBlogService","SweetAlert","toaster","SimpleSiteBuilderService","$filter","$window"]}(),function(){app.directive("ssbEditControl",function(){return{restrict:"E",scope:{state:"=",uiState:"=",sectionIndex:"=",sectionLayoutName:"=?",sectionLayoutIndex:"=?",component:"=",componentIndex:"=?",compiledControlId:"@?"},templateUrl:"assets/js/ssb-site-builder/ssb-controls/ssb-edit-control/ssb-edit-control.component.html",controller:"SiteBuilderEditControlController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r,c,l){function u(e,t,n){return m()}function d(e,t,n){if(t&&t===b.element.attr("data-control-id")&&"component-partial-area"===n)return m()}function p(e,t,n){if(t&&t===b.element.attr("data-control-id")&&"element"===n)return m()}function m(){var e=b.uiState.activeElement&&angular.isDefined(b.uiState.activeElement.type);if(l.flyoverhideonclick(),b.uiState.hoveredSectionIndex===b.sectionIndex&&b.uiState.hoveredComponentIndex===b.componentIndex||e&&!r.isIENotEdge){var t=0,n=0,a=0,o=0,s=document.querySelector(".ssb-site-builder-container").scrollTop,c=35,u=35,d=b.uiState.hoveredComponentEl,p=b.uiState.hoveredComponentEditControl;d.length&&(d.hasClass("no-offset-top")&&(c=0,u=0),a=d[0].getBoundingClientRect().top,o=d[0].getBoundingClientRect().left,t=d[0].getBoundingClientRect().top-c-125+s,n=d[0].getBoundingClientRect().left-u-140),n<0&&(n=0),140===o&&(n=0),a-125<30&&t<20&&(t=20,n+=36),p&&p.length&&(n>800&&(n-=10),p.css({top:t,left:n}),i(function(){p.addClass("ssb-on")},500))}else b.element.data("compiled-control-id")||b.element.removeClass("on")}function g(e){var t=b.state.page.sections[e],n=o("cleanType")(t.title||t.name).toLowerCase().trim().replace(" ","-")+" Section";i(function(){r.setActiveSection(e),r.setActiveComponent(void 0),b.uiState.navigation.sectionPanel.loadPanel({id:"",name:n}),void 0!==e&&(b.uiState.showSectionPanel=!0)})}function f(e,t){var n=b.state.page.sections[e].components[t],a={name:o("cleanType")(n.type).toLowerCase().trim().replace(" ","-"),id:n._id,componentId:n._id};i(function(){r.setActiveSection(e),r.setActiveComponent(t),b.uiState.navigation.sectionPanel.loadPanel(a),void 0!==e&&void 0!==t&&(b.uiState.showSectionPanel=!0)})}function h(){var e=b.uiState.activeElementHistory[b.uiState.activeElementHistory.length-1];if(b.uiState.activeElement&&b.uiState.activeElement.type?b.uiState.activeElementHistory.push(b.uiState.activeElement):b.uiState.activeElement=e,b.uiState.activeElement){var t={name:b.uiState.activeElement.name,id:b.uiState.activeElement.id};b.uiState.navigation.sectionPanel.loadPanel(t),b.uiState.showSectionPanel=!0}}function v(){i(function(){var e=document.querySelector(".ssb-site-builder-container"),t=document.querySelector(".ssb-active-section");t&&(e.scrollTop=t.offsetTop)},500)}var b=this;b.init=function(e){b.element=e,b.isComponentControl=b.element.hasClass("ssb-edit-control-component")&&!b.element.hasClass("ssb-edit-control-element")&&!b.element.hasClass("ssb-edit-control-component-area"),b.isComponentPartialAreaControl=b.element.hasClass("ssb-edit-control-component-area"),b.isElementControl=b.element.hasClass("ssb-edit-control-element"),b.isComponentControl?t.$on("$ssbMenuPenVisibleForComponent",u):b.isComponentPartialAreaControl?t.$on("$ssbMenuPenVisibleForComponentPartialArea",d):b.isElementControl&&t.$on("$ssbMenuPenVisibleForElement",p)},b.isElementControl=!1,b.isComponentControl=!1,b.isComponentPartialAreaControl=!1,b.setActive=function(e,t,n){b.uiState.showSectionPanel=!1,b.uiState.navigation.sectionPanel.reset(),r.setActiveSection(void 0),r.setActiveComponent(void 0),n||null===t&&null===e?h():void 0!==t?f(e,t):g(e)},b.moveSection=function(e,t,n){var a,o=b.state.page.sections,i=n;"up"===e&&(a=i-1),"down"===e&&(a=i+1),o.splice(a,0,o.splice(i,1)[0]),b.setActive(a),v()},b.duplicateSection=function(e,t){b.state.page.sections;var n=t>=0?t+1:t;(e=r.setTempUUIDForSection(e)).accountId=0,r.addSectionToPage(e,null,null,null,n).then(function(){},function(e){})},b.removeSectionFromPage=function(e){b.state.page.sections[e].global?c.swal({title:"Are you sure?",text:"You are removing a global section. Changes made to global sections on this page will be reflected on all other pages. Consider removing from this page only.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Remove from all pages",cancelButtonText:"Hide on this page",showNoActionButton:!0,noActionButtonText:"Cancel",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?r.removeSectionFromPage(e):angular.isDefined(t)&&!1===t&&(b.state.page.sections[e].visibility=!1,b.uiState.toggleSection(b.state.page.sections[e]))}):c.swal({title:"Are you sure?",text:"Do you want to delete this section?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, do not delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t&&r.removeSectionFromPage(e)})},b.scrollToActiveSection=v,b.uiState.activeElementHistory=[]}app.controller("SiteBuilderEditControlController",e),e.$inject=["$scope","$rootScope","$interval","$attrs","$filter","$timeout","$q","SimpleSiteBuilderService","SweetAlert","UtilService"]}(),function(){function e(e,t,n,a,o){return{restrict:"C",link:function(i,s,r,c){$(".ssb-main").length>0&&function(){function i(e){if($(e.target).hasClass("ssb-edit-control")||$(e.target).hasClass("ssb-theme-btn")||$(e.target).hasClass("ssb-settings-btn")||$(e.target).parent().hasClass("ssb-settings-btn"))return!1;var t=s.children().find(".ssb-edit-wrap.on").length>0;!s.hasClass("ssb-active-edit-control")&&(C&&!t||S)?(e.stopPropagation(),angular.element(".ssb-edit-wrap, .editable-title, .editable-cover, [data-edit]",".ssb-main").removeClass("ssb-on"),s.addClass("ssb-on"),s.find("> .editable-title:first").addClass("ssb-on"),s.find("> .editable-cover:first").addClass("ssb-on")):k&&r(e)}function r(e){var n=angular.element(e.currentTarget);if(!n.hasClass("ssb-active-edit-control")){e.stopPropagation(),y(),n.is("ul")||n.is("ol");var o=n.closest(".ssb-component").scope();if(!o)return;if(o.vm.component.type,n.addClass("ssb-on"),!(angular.element('[data-control-id="control_'+n.attr("data-edit-id")+'"]').length>0||T)){T=!0;var i=a.getTempUUID();n.attr("data-edit-id",i);var s='<ssb-edit-control data-control-id="control_'+i+'" class="ssb-edit-control ssb-edit-control-component ssb-edit-control-element" component="ssbElement" state="vm.state" ui-state="vm.uiState" section-index="null" component-index="null"></ssb-edit-control>';o.ssbElement={title:"Text Element",type:"Text Element"},t(s)(o,function(e,t){v(n,e)})}}}function c(e){var n=angular.element(e.currentTarget);if(!n.hasClass("ssb-active-edit-control")){e.stopPropagation(),y();var o=n.is("ul")||n.is("ol"),i=n.closest(".ssb-component").scope();if(!i)return;var s=i.vm.component.type,r=n.children(".editable-cover").length>0;if(n.addClass("ssb-on"),r||(o?n.append('<li id="editable_cover_'+i.vm.component._id+'"class="editable-cover"></li><li id="editable_title_'+i.vm.component._id+'"class="editable-title">'+s+"</li>"):n.append('<span id="editable_cover_'+i.vm.component._id+'" class="editable-cover"></span><span id="editable_title_'+i.vm.component._id+'"class="editable-title">'+s+"</span>")),!(angular.element('[data-control-id="control_'+n.attr("data-edit-id")+'"]').length>0||T)){T=!0;var c=a.getTempUUID();n.attr("data-edit-id",c),t('<ssb-edit-control data-control-id="control_'+c+'" class="ssb-edit-control ssb-edit-control-component ssb-edit-control-component-area" component="vm.component" state="vm.state" ui-state="vm.uiState" section-index="vm.sectionIndex" component-index="vm.componentIndex"></ssb-edit-control>')(i,function(e,t){v(n,e)})}}}function l(e){s.removeClass("ssb-on"),s.find(".editable-title:first").removeClass("ssb-on"),s.find(".editable-cover:first").removeClass("ssb-on")}function u(e){var t=angular.element(e.currentTarget);t.removeClass("ssb-on"),t.find(".editable-title:first").removeClass("ssb-on"),t.find(".editable-cover:first").removeClass("ssb-on")}function d(){return"ontouchstart"in window}function p(e){if(o.flyoverhideonclick(),!($(e.target).hasClass("ssb-edit-control")||$(e.target).hasClass("ssb-theme-btn")||$(e.target).hasClass("ssb-settings-btn")||$(e.target).hasClass("no-edit")||$(e.target).parent().hasClass("ssb-settings-btn")||$(e.target).parent().hasClass("ssb-edit-control-active-title"))){d&&i(e),e.preventDefault();var t=angular.element(e.currentTarget);if(C||S){var n=t.closest(".ssb-section-layout"),a=t.closest(".ssb-component");if(S&&a.prev().hasClass("ssb-on"))return void e.stopPropagation();w();var s=n.scope(),r=a.scope();if(s&&r){var c=s.vm.section,l=r.vm.component;r.vm.uiState.hoveredSectionIndex=void 0,r.vm.uiState.hoveredComponentIndex=void 0,r.vm.uiState.hoveredComponentEl=void 0,r.vm.uiState.activeElement={}}C?m(0,t):S&&g(e,t,c,a,0,r,l)}else k&&0===t.find(".ssb-active-component").length&&(e.stopPropagation(),b(t,t.closest(".ssb-component")))}}function m(e,t){o.flyoverhideonclick(),t.scope().vm.uiState.hoveredSectionIndex=void 0,t.scope().vm.uiState.hoveredComponentIndex=void 0,t.scope().vm.uiState.hoveredComponentEl=void 0,t.addClass("ssb-active-edit-control"),n(function(){t.find("> .ssb-edit-control").addClass("ssb-on")},500),(t.scope().vm.uiState.showSectionPanel||a.isIENotEdge)&&n(function(){t.find("> .ssb-edit-control .ssb-settings-btn").click()})}function g(t,i,s,r,c,l,u){o.flyoverhideonclick(),t.stopPropagation(),n(function(){var t=i.parent().prevAll(".ssb-edit-control-component:not(.ssb-edit-control-element):first"),o=t.attr("data-control-id"),c={};t.addClass("ssb-active-edit-control"),r.addClass("ssb-active-component"),c.hoveredComponentEditControl=t,c.hoveredSectionIndex=_(l.vm.state.page.sections).chain().findIndex(function(e){return e._id===s._id}).value(),c.hoveredComponentIndex=_(l.vm.state.page.sections[c.hoveredSectionIndex].components).chain().findIndex(function(e){return e._id===u._id}).value(),c.hoveredComponentEl=i,e.$broadcast("$ssbUpdateUiState",c),e.$broadcast("$ssbMenuPenVisibleForComponent",o,"component"),(l.vm.uiState.showSectionPanel||a.isIENotEdge)&&n(function(){t.find(".ssb-settings-btn").click()})},100)}function f(e){o.flyoverhideonclick(),e.preventDefault();var t=angular.element(e.currentTarget),a=angular.element(e.target);if(t.hasClass("ssb-active-edit-control")||a.hasClass("ssb-active-edit-control")||t.hasClass("ssb-element"))return e.stopPropagation(),!1;d?(c(e),n(function(){h(e)},500)):h(e)}function h(t){o.flyoverhideonclick();var i=angular.element(t.currentTarget),s=(angular.element(t.target),i.find("[data-edit]").length>0);if(!S||!s){t.stopPropagation();var r=i.closest(".ssb-section-layout").scope().vm.section,c=i.closest(".ssb-component").scope(),l=c.vm.component,u=angular.element('[data-control-id="control_'+i.attr("data-edit-id")+'"]'),d=u.attr("data-control-id"),p={};w(),p.hoveredSectionIndex=void 0,p.hoveredComponentIndex=void 0,p.hoveredComponentEl=void 0,p.hoveredComponentEditControl=void 0,p.activeElement={},p.hoveredComponentEditControl=u,p.hoveredSectionIndex=_(c.vm.state.page.sections).chain().findIndex(function(e){return e._id===r._id}).value(),p.hoveredComponentIndex=_(c.vm.state.page.sections[p.hoveredSectionIndex].components).chain().findIndex(function(e){return e._id===l._id}).value(),p.hoveredComponentEl=i,e.$broadcast("$ssbUpdateUiState",p),e.$broadcast("$ssbMenuPenVisibleForComponentPartialArea",d,"component-partial-area"),i.addClass("ssb-active-edit-control"),n(function(){u.addClass("ssb-on")},500),(c.vm.uiState.showSectionPanel||a.isIENotEdge)&&n(function(){u.find(".ssb-settings-btn").click()})}}function v(e,t){n(function(){e.hasClass("ssb-element")?e.closest(".ssb-component").before(t):e.before(t),T=!1})}function b(t,i){o.flyoverhideonclick();var s=i.scope(),r=t.find(".ssb-text-settings:first");0===r.length&&(r=t.closest(".ssb-text-settings")),w(),n(function(){var o=t.attr("data-edit-id");o||(o=t.closest("[data-edit-id]").attr("data-edit-id"));var i=angular.element('[data-control-id="control_'+o+'"]'),c=i.attr("data-control-id"),l={};r&&r.scope()&&r.scope().vm&&(l.hoveredComponentEl=r,l.hoveredComponentEditControl=i,l.activeElement=r.scope().vm.elementData),e.$broadcast("$ssbUpdateUiState",l),e.$broadcast("$ssbMenuPenVisibleForElement",c,"element"),i.addClass("ssb-active-edit-control ssb-on"),r.addClass("ssb-active-component"),s&&(s.vm.uiState.showSectionPanel||a.isIENotEdge)&&n(function(){i.find(".ssb-settings-btn").click()})},100)}function y(){angular.element(".ssb-edit-wrap, .editable-title, .editable-cover, [data-edit]",".ssb-main").removeClass("ssb-on")}function w(){angular.element(".ssb-edit-wrap, .editable-title, .editable-cover, [data-edit]",".ssb-main").removeClass("ssb-on"),angular.element(".ssb-main").find(".ssb-active-edit-control").removeClass("ssb-active-edit-control"),angular.element(".ssb-main").find(".ssb-on").removeClass("ssb-on"),angular.element(".ssb-main").find(".ssb-active-component").removeClass("ssb-active-component"),angular.element(".ssb-main").find(".ssb-theme-btn-active-element").removeClass("ssb-theme-btn-active-element"),angular.element(".ssb-main").find(".ssb-edit-control-component-btn").removeClass("on")}var C=s.hasClass("ssb-page-section"),S=s.hasClass("component-wrap"),k=s.hasClass("ssb-element"),T=!1;s.on("mouseover",i),s.on("mouseleave",l),$(s).on("click",p),$(s).on("mouseover","[data-edit]",c),$(s).on("mouseleave","[data-edit]",u),$(s).on("click","[data-edit]",f)}()}}}app.directive("ssbEditWrap",e),e.$inject=["$rootScope","$compile","$timeout","SimpleSiteBuilderService","UtilService"]}(),function(){function e(e,t,n,a,o,i,s){}app.controller("SiteBuilderEditWrapController",e),e.$inject=["$scope","$attrs","$filter","$timeout","$q","SimpleSiteBuilderService","SweetAlert"]}(),app.controller("SiteBuilderPageSettingsModalController",["$scope","$timeout","parentVm","pageId","toaster","SimpleSiteBuilderService","SweetAlert","$location","$filter","WebsiteService",function(e,t,n,a,o,i,s,r,c,l){function u(){d(f.page,!1)}function d(e,n){return f.saveLoading=!0,p().then(function(){i.savePage(e,!0).then(function(a){i.getSite(e.websiteId).then(function(){i.getPages().then(function(e){if(f.saveLoading=!1,o.pop("success","Setting Saved","The page settings saved successfully."),n)f.page.mainmenu=!1,angular.element(".modal.in").show();else{if(f.page._id===f.parentVm.state.page._id)i.page=a.data,t(function(){f.parentVm.state.pendingPageChanges=!1,f.parentVm.uiState&&f.parentVm.uiState.selectedPage&&(f.parentVm.uiState.selectedPage=f.parentVm.state.page)},0);else if(f.page.homePage&&"index"===f.parentVm.state.page.handle&&f.page._id!==f.parentVm.state.page._id){var s=angular.copy(f.parentVm.state.pendingPageChanges),r=_.find(e.data,function(e){return e._id===f.parentVm.state.page._id});r&&(f.parentVm.state.page.handle=r.handle,t(function(){f.parentVm.state.pendingPageChanges=s},500))}f.parentVm.closeModal()}})})})}).catch(function(e){f.saveLoading=!1,e.message?o.pop("error",e.message):o.pop("error","Setting not saved","Error while saving page settings")})}function p(){return i.saveWebsite(f.parentVm.state.website).then(function(e){f.parentVm.state.account&&f.parentVm.state.account.showhide&&f.parentVm.state.account.showhide.userScripts&&f.parentVm.state.website.resources.toggles&&f.parentVm.state.website.resources.toggles.userScripts&&i.updateScriptResource(f.parentVm.state.website).then(function(e){f.parentVm.state.website=e.data})})}function m(e,t){var n=f.parentVm.state.originalPages.filter(function(t){return t.handle.toLowerCase()===e.toLowerCase()})[0];return n&&n._id!==f.page._id?"Page handles must be unique.":!f.isBlogPage&&i.inValidPageHandles[e.toLowerCase()]?"Page handle cannot be a system route.":void(t&&t!==e&&_.each(f.page.sections,function(n,a){n.hiddenOnPages&&n.hiddenOnPages[t]&&(delete n.hiddenOnPages[t],n.hiddenOnPages[e]=!0)}))}function g(e){return e?(e=e.replace(/[^\w\s-\/]/g,"").trim().toLowerCase()).replace(/[-\s]+/g,"-"):""}var f=this;f.parentVm=n,f.pageId=a,f.saveSettings=u,f.deletePage=function(){angular.element(".modal.in").hide();e="Do you want to delete this page";if("index"===f.page.handle)var e="This is home page of the website. Do you want to delete this page";s.swal({title:"Are you sure?",text:e,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?(f.saveLoading=!0,angular.element(".modal.in").show(),p().then(function(){i.deletePage(f.page).then(function(e){i.getSite(f.page.websiteId).then(function(){i.getPages().then(function(){o.pop("success","Page deleted","The page deleted successfully."),f.parentVm.closeModal(),f.saveLoading=!1,f.parentVm.state.page._id===f.page._id&&(f.parentVm.state.pendingPageChanges=!1,f.parentVm.state.pendingWebsiteChanges=!1,t(function(){r.path("/website/site-builder/pages/")},0))})})})})):(f.saveLoading=!1,angular.element(".modal.in").show())})},f.setAsHomePage=function(){f.page.homePage?f.parentVm.state.pages.index&&"index"!==f.page.handle?(angular.element(".modal.in").hide(),s.swal({title:"Are you sure?",text:"CAUTION: Home page already exists. Do you want to set this page as your new home page?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?(f.page.homePage=!0,angular.element(".modal.in").show()):(angular.element(".modal.in").show(),f.page.homePage=!1)})):f.page.homePage=!0:f.page.homePage=!1},f.duplicatePage=function(){angular.element(".modal.in").hide(),s.swal({title:"Are you sure?",text:"Do you want to create a duplicate page?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?(angular.element(".modal.in").show(),f.saveLoading=!0,p().then(function(){i.createDuplicatePage(f.page).then(function(e){i.getSite(f.page.websiteId).then(function(){f.parentVm.closeModal(),f.saveLoading=!1,f.parentVm.uiState.navigation.loadPage(e.data._id)})})})):angular.element(".modal.in").show()})},f.hideFromMenu=function(){angular.element(".modal.in").hide(),s.swal({title:"Are you sure?",text:"Do you want to hide this page from main menu",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, hide page!",cancelButtonText:"No, do not hide page!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?(f.page.mainmenu=!1,angular.element(".modal.in").show(),u()):(f.saveLoading=!1,angular.element(".modal.in").show())})},f.isBlogPage=!1,e.$watch("vm.page.handle",function(e,t){e?(f.page.handle=g(e),f.inValidPageHandle=m(e,t)):f.inValidPageHandle=null}),e.$watch("vm.originalPage",function(e){e&&(f.isBlogPage=f.parentVm.uiState.checkIfBlogPage(f.originalPage),f.isBlogCopy=f.parentVm.uiState.checkIfBlogCopy(f.originalPage),f.isBlogListPage="blog-list"===f.originalPage.handle,f.inValidPageHandle=m(f.page.handle))}),f.loading=!0,f.pageId===f.parentVm.state.page._id?(f.page=angular.copy(f.parentVm.state.page),f.originalPage=angular.copy(f.page),f.loading=!1):i.getPage(f.pageId,!0).then(function(e){f.page=e.data,f.originalPage=angular.copy(f.page),f.loading=!1})}]);var spectrum={options:{showPalette:!0,clickoutFiresChange:!0,showInput:!0,showButtons:!1,allowEmpty:!0,hideAfterPaletteSelect:!1,showPaletteOnly:!0,togglePaletteOnly:!0,togglePaletteMoreText:"more",togglePaletteLessText:"less",preferredFormat:"hex",appendTo:"body",palette:[["#C91F37","#DC3023","#9D2933","#CF000F","#E68364","#F22613","#CF3A24","#C3272B","#8F1D21","#D24D57"],["#f47998","#F47983","#DB5A6B","#C93756","#FCC9B9","#FFB3A7","#F62459","#F58F84","#875F9A","#5D3F6A"],["#89729E","#763568","#8D608C","#A87CA0","#5B3256","#BF55EC","#8E44AD","#9B59B6","#BE90D4","#4D8FAC"],["#5D8CAE","#22A7F0","#19B5FE","#59ABE3","#48929B","#317589","#89C4F4","#4B77BE","#1F4788","#003171"],["#044F67","#264348","#7A942E","#8DB255","#5B8930","#6B9362","#407A52","#006442","#87D37C","#26A65B"],["#26C281","#049372","#2ABB9B","#16A085","#36D7B7","#03A678","#4DAF7C","#D9B611","#F3C13A","#F7CA18"],["#E2B13C","#A17917","#F5D76E","#F4D03F","#FFA400","#E08A1E","#FFB61E","#FAA945","#FFA631","#FFB94E"],["#E29C45","#F9690E","#CA6924","#F5AB35","#BFBFBF","#F2F1EF","#BDC3C7","#ECF0F1","#D2D7D3","#757D75"],["#EEEEEE","#ABB7B7","#6C7A89","#95A5A6"]]}};!function(){function e(e,t,n,a){return{restrict:"E",scope:{component:"=",state:"=",uiState:"=",settingsTemplate:"@"},controller:"SiteBuilderSidebarSettingsPanelController",controllerAs:"vm",bindToController:!0,link:function(a,o,i,s){var r="";s.settingsTemplate&&(-1!==s.settingsTemplate.indexOf("#COMPONENTTYPE#")&&(s.settingsTemplate=s.settingsTemplate.replace("#COMPONENTTYPE#",a.component.type)),r=s.settingsTemplate,t.get(r,{cache:n}).success(function(t){o.empty().append(e(t)(a)),s.init(o)}))}}}app.directive("ssbSidebarSettingsPanel",e),e.$inject=["$compile","$http","$templateCache","$parse"]}(),function(){function e(e,t,n,a,o,i,s,r,c,l,u){var d=this;d.init=function(e){d.element=e,d.setTags(d.contactTags)};var p=e.$parent.vm;d.addBackground=p.addBackground,d.addBackgroundVideo=p.addBackgroundVideo,d.addImage=p.addImage,d.openModal=p.openModal,d.setActiveComponent=p.setActiveComponent,d.removeImage=p.removeImage,d.removeBackgroundImage=p.removeBackgroundImage,d.removeSectionFromPage=p.removeSectionFromPage,d.hideSectionFromPage=p.hideSectionFromPage,d.editSectionName=p.editSectionName,d.moveSection=p.moveSection,d.duplicateSection=p.duplicateSection,d.enabledPlatformSections=p.enabledPlatformSections,d.contactTags=p.contactTags,d.constructVideoUrl=p.constructVideoUrl,d.donationProductTags=p.donationProductTags,d.addSectionToPage=function(e,t,n){if(!d.isSelectedLayout(e))return p.addSectionToPage(e,t,n)},d.tagToCustomer=function(e){return u.tagToContact(e)},d.setTags=function(e){d.component&&d.component.tags&&(_.each(d.component.tags,function(t,n){var a=_.findWhere(d.contactTags,{data:t});a?e.push(a):e.push({data:t,label:t})}),d.contactTags=_.uniq(e,function(e){return e.label}))},d.filteredSections=function(){var e=d.state.page.sections[d.uiState.activeSectionIndex],t=_(e.components).pluck("type"),n=_.filter(d.state.platformSections,function(e){return"footer"===e.type||e.enabled});return _.filter(n,function(n){if("ssb-page-section"===n.type){if(e.title)return n.title===e.title;if(e.name)return n.name===e.name;if(1===e.components.length&&"navigation"===e.components[0].type)return"Header"===n.title}else if(1===e.components.length)return _.contains(t,n.type)})},d.isSelectedLayout=function(e){var t=!1,n=d.state.page.sections[d.uiState.activeSectionIndex];if("ssb-page-section"===e.type&&e.version===n.version)t=e.title===n.title;else{var a=_.map(n.components,function(e){return{type:e.type,version:e.version}}),o=_.findWhere(a,{type:e.type,version:parseInt(e.version,10)});o||(o=_.findWhere(a,{type:e.type,version:e.version})),t=angular.isObject(o)}return t},d.resizeWindow=function(){$(window).trigger("resize")},d.changeButtonDesign=function(e){var t=d.uiState.activeElement,n=d.uiState.activeElement._id.replace("button-element_","");if(n){var a=$(".ssb-theme-btn[data-compiled='"+n+"']");1===a.length&&$(a).removeClass(function(e,t){return t.match(/ssb-theme-btn-style-\d+/g)&&t.match(/ssb-theme-btn-style-\d+/g).join(" ")})}t.version=e},d.addCustomField=p.addCustomField,d.checkDuplicateField=p.checkDuplicateField,d.openCal=function(e,t){e.preventDefault(),e.stopPropagation(),"start"==t&&(d.startCalOpened=!0),"end"==t&&(d.endCalOpened=!0)},d.closeCal=function(t){t.preventDefault(),t.stopPropagation(),e.opened=!1},d.isHero=d.component.title&&"hero"===d.component.title.toLowerCase(),d.spectrum={options:i.getSpectrumColorOptions()},d.fontFamilyOptions=i.getFontFamilyOptions(),d.fontWeightOptions=i.getFontWeightOptions(),e.component=d.component,e.$watch(function(){return d.component?d.component.txtcolor:""},function(e){}),e.$watch(function(){return d.component&&d.component.bg?d.component.bg.color:""},function(e){}),e.$watch("component.bg.img.overlaycolor",function(t,n){t&&(angular.isDefined(e.component.bg.img.overlayopacity)&&!isNaN(e.component.bg.img.overlayopacity)||(e.component.bg.img.overlayopacity=100))})}app.controller("SiteBuilderSidebarSettingsPanelController",e),e.$inject=["$scope","$attrs","$filter","$document","$timeout","SimpleSiteBuilderService","$modal","editableOptions","$location","SweetAlert","ContactService"]}(),function(){app.directive("ssbSidebar",function(){return{restrict:"E",scope:{state:"=",uiState:"="},templateUrl:"assets/js/ssb-site-builder/ssb-controls/ssb-sidebar/ssb-sidebar.component.html",controller:"SiteBuilderSidebarController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r,c,l,u,d,p){function m(){return y.state.pendingWebsiteChanges=!1,i.saveWebsite(y.state.website).then(function(e){})}function g(){var t=e.$watch(function(){return i.platformSections},function(e,n){if(e){var a;y.uiState.contentSectionDisplayOrder=_.invert(_.object(_.pairs(i.contentSectionDisplayOrder))),y.enabledPlatformSections=_(y.state.platformSections).chain().sortBy(function(e){return y.uiState.contentSectionDisplayOrder[e.filter]}).filter(function(e){return e.enabled}).value(),y.enabledUserSections=_.where(y.state.userSections,{enabled:!0}),y.sectionFilters=_(y.enabledPlatformSections).chain().pluck("filter").uniq().without("misc").sortBy(function(e){return y.uiState.contentSectionDisplayOrder[e]&&parseInt(y.uiState.contentSectionDisplayOrder[e],10)}).value();var o=i.contentSectionIcons;_.each(y.sectionFilters,function(e,t){a=e.charAt(0).toUpperCase()+e.substring(1).toLowerCase(),y.sectionFilters[t]={capitalized:a,lowercase:e,icon:o[e]?o[e].icon:"fa-adjust"},a=null}),y.sectionFilters.push({capitalized:"Misc",lowercase:"misc",icon:o.misc.icon}),y.sectionFilters.push({capitalized:"All",lowercase:"all",icon:o.all.icon}),y.setFilterType=function(e){y.typefilter=e},y.sections=y.enabledPlatformSections,y.sectionType="enabledPlatformSections",y.setSectionType=function(e){i.getUserSections().then(function(){y.sectionType=e,y.sections=y[e]})},t()}},!0)}function f(e){_.each(y.state.website.linkLists,function(t,n){if("head-menu"===t.handle)if(e)t.links.push({label:y.state.page.menuTitle||y.state.page.title,type:"link",linkTo:{data:y.state.page.handle,type:"page"}});else{var a=[];_.each(t.links,function(e,t){if(e.linkTo.data!==y.state.page.handle||"page"!==e.linkTo.type&&"home"!==e.linkTo.type||"sub-nav"===e.linkTo.type){if("sub-nav"===e.linkTo.type){var n=_.reject(e.links,function(e){return e.linkTo.data===y.state.page.handle&&("page"===e.linkTo.type||"home"===e.linkTo.type)});e.links=n}a.push(e)}}),a&&(t.links=a)}})}function h(e,t){var n,a=/^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?.*?(?:v|list)=(.*?)(?:&|$)|^(?:https?:\/\/)?(?:www\.)?youtu\.?be(?:\.com)?(?:(?!=).)*\/(.*)$/;if(t){var o=t.match(a);o.length&&(o=_.filter(o,function(e){return void 0!==e}));var i=o&&o[1]?o[1]:null;n="//www.youtube.com/embed/#VIDEO_ID#?playlist=#VIDEO_ID#&autoplay=1&controls=0&loop=1&rel=0&showinfo=0&autohide=1&wmode=transparent&hd=1".replace(e,i).replace(e,i)}return{url:n,id:i}}function v(e,t){var n,a=/https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/;if(t){var o=t.match(a),i=o&&o[4]?o[4]:null;n="//vimeo.com/#VIDEO_ID#?autopause=0&autoplay=1&badge=0&byline=0&color=&loop=0&player_id=0&portrait=0&title=0".replace(e,i)}return{url:n,id:i}}function b(e){return e?(e=e.replace(/[^\w\s-\/]/g,"").trim().toLowerCase(),(e=e.replace("//","/")).replace(/[-\s]+/g,"-")):""}var y=this;y.init=function(e){y.element=e,g(),u.getContacts(function(e){u.getAllContactTags(e,function(e){y.contactTags=e})}),y.donationProductTags=[],p.getProducts(function(e){e.forEach(function(e,t){"DONATION"===e.type&&"active"===e.status.toLowerCase()&&y.donationProductTags.push({data:e._id,label:e.name})})})},y.savePage=function(){y.state.saveLoading=!0;var e=!y.state.page.ssb;!y.uiState.hasSeenWarning&&e?l.swal({title:"Are you sure?",text:"CAUTION: This editor is under active development. Pages saved in Site Builder will not render or be editable in the legacy Pages editor.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes  Use Site Builder editor.",cancelButtonText:"No  Use the legacy editor.",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?(y.uiState.hasSeenWarning=!0,y.state.pendingPageChanges=!1,y.uiState.showSectionPanel=!1,y.uiState.navigation.sectionPanel.reset(),m().then(function(){return i.savePage(y.state.page).then(function(e){i.getSite(y.state.website._id).then(function(){d.pop("success","Page Saved","The page was saved successfully."),y.state.saveLoading=!1,i.saveOtherPageLinks()})}).catch(function(e){y.state.saveLoading=!1,d.pop("error","Error","The page was not saved. Please try again.")})})):y.state.saveLoading=!1}):(y.state.pendingPageChanges=!1,y.uiState.showSectionPanel=!1,y.uiState.navigation.sectionPanel.reset(),m().then(function(){return i.savePage(y.state.page).then(function(e){i.getSite(y.state.website._id).then(function(){d.pop("success","Page Saved","The page was saved successfully."),y.state.saveLoading=!1,i.saveOtherPageLinks()})}).catch(function(e){d.pop("error","Error","The page was not saved. Please try again."),y.state.saveLoading=!1})}))},y.saveWebsite=m,y.cancelPendingEdits=function(){y.state.pendingPageChanges=!1,y.state.pendingWebsiteChanges=!1,i.website=angular.copy(y.state.originalWebsite),i.page=angular.copy(y.state.originalPage)},y.togglePageSectionAccordion=function(e){y.uiState.accordion.sections[e].isOpen&&i.setActiveSection(e)},y.setActiveComponent=function(e){i.setActiveComponent(e)},y.setActiveSection=function(e){y.uiState.showSectionPanel=!1,o(function(){if(i.setActiveSection(e),y.state.page.sections[e].visibility){y.uiState.navigation.sectionPanel.reset();var t=y.state.page.sections[e],a=n("cleanType")(t.title||t.name).toLowerCase().trim().replace(" ","-")+" Section";y.uiState.navigation.sectionPanel.loadPanel({id:"",name:a}),y.uiState.showSectionPanel=!0,y.scrollToActiveSection()}else y.uiState.activeSectionIndex=e})},y.getPlatformSections=function(){},y.getPlatformComponents=function(){i.getPlatformComponents()},y.addSectionToPage=function(e,t,n,a,o){return y.uiState.showSectionPanel=!1,i.addSectionToPage(e,t,n,y.state.page.sections[y.uiState.activeSectionIndex],o).then(function(){y.scrollToActiveSection()},function(e){})},y.addSectionToPageToIndex=function(e){var t=angular.element(".ssb-page-section.ssb-active-edit-control"),n=void 0;if(t.length){var a=t.attr("clicked-index");n=(a=parseInt(a))+1}return y.uiState.showSectionPanel=!1,i.addSectionToPageToIndex(e,n).then(function(){y.scrollToActiveSection()},function(e){})},y.scrollToActiveSection=function(){o(function(){var e=document.querySelector(".ssb-site-builder-container"),t=document.querySelector(".ssb-active-section");t&&(e.scrollTop=t.offsetTop)},500)},y.removeSectionFromPage=function(e){y.state.page.sections[e].global?l.swal({title:"Are you sure?",text:"You are removing a global section. Changes made to global sections on this page will be reflected on all other pages. Consider removing from this page only.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Remove from all pages",cancelButtonText:"Hide on this page",showNoActionButton:!0,noActionButtonText:"Cancel",closeOnConfirm:!0,closeOnCancel:!0},function(t){t?i.removeSectionFromPage(e):angular.isDefined(t)&&!1===t&&(y.state.page.sections[e].visibility=!1,y.uiState.toggleSection(y.state.page.sections[e]))}):l.swal({title:"Are you sure?",text:"Do you want to delete this section?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, do not delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t&&i.removeSectionFromPage(e)})},y.removeComponentFromSection=function(e){l.swal({title:"Are you sure?",text:"Do you want to delete this component?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, do not delete it!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t&&(y.state.page.sections[y.uiState.activeSectionIndex].components.splice(e,1),y.uiState.activeComponentIndex=void 0)})},y.addComponentToSection=function(e,t){return i.getComponent(e,1).then(function(e){y.state.page.sections[t].components.push(e.data)})},y.addBackground=function(e,t){y.openMediaModal("media-modal","MediaModalCtrl",null,"lg"),y.insertMediaCallback=function(n){void 0!==t&&null!==t?y.state.page.sections[y.uiState.activeSectionIndex].components[y.uiState.activeComponentIndex].bg.img.url=n.url:angular.isDefined(e)&&null!==e||!y.uiState.activeElement||!y.uiState.activeElement.hasOwnProperty("bg")?y.state.page.sections[y.uiState.activeSectionIndex].bg.img.url=n.url:y.uiState.activeElement.bg.img.url=n.url},i.setActiveSection(e),i.setActiveComponent(t)},y.addBackgroundVideo=function(e,t){y.openMediaModal("media-modal","MediaModalCtrl",null,"lg"),y.insertMediaCallback=function(e){void 0!==t&&null!==t?y.state.page.sections[y.uiState.activeSectionIndex].components[y.uiState.activeComponentIndex].bg.video.url=e.url:y.state.page.sections[y.uiState.activeSectionIndex].bg.video.url=e.url},i.setActiveSection(e),i.setActiveComponent(t)},y.addImage=function(e,t){y.openMediaModal("media-modal","MediaModalCtrl",null,"lg"),y.insertMediaCallback=function(e){void 0!==t&&null!==t?y.state.page.sections[y.uiState.activeSectionIndex].components[y.uiState.activeComponentIndex].src=e.url:y.state.page.sections[y.uiState.activeSectionIndex].src=e.url},i.setActiveSection(e),i.setActiveComponent(t)},y.openModal=function(t,n,a,o){var i={templateUrl:t,keyboard:!0,backdrop:"static",size:"md",scope:e,resolve:{parentVm:function(){return y}}};n&&(i.controller=n+" as vm"),o&&(i.size="lg"),y.modalInstance=s.open(i),y.modalInstance.result.then(null,function(){angular.element(".sp-container").addClass("sp-hidden")})},y.closeModal=function(){y.modalInstance.close()},y.openMediaModal=function(e,t,n,a){var o={templateUrl:e,keyboard:!0,backdrop:"static",size:"md",resolve:{vm:function(){return y}}};t&&(o.controller=t,o.resolve.showInsert=function(){return y.showInsert},o.resolve.insertMedia=function(){return y.insertMedia},o.resolve.isSingleSelect=function(){return!0}),a&&(o.size="lg"),y.modalInstance=s.open(o),y.modalInstance.result.then(null,function(){angular.element(".sp-container").addClass("sp-hidden")})},y.insertMedia=function(e){return y.insertMediaCallback(e),y.insertMediaCallback=function(){},!0},y.addToMainMenu=function(e){},y.showInsert=!0,y.applyThemeToSite=i.applyThemeToSite,y.insertMediaCallback=function(e){},y.removeBackgroundImage=function(e){e.bg.img.url=null},y.removeImage=function(e){e.src=null},y.createPage=function(e){y.state.saveLoading||(y.state.saveLoading=!0,y.saveWebsite().then(function(){return i.createPage(e._id).then(function(e){i.getSite(y.state.website._id).then(function(){y.closeModal(),y.state.saveLoading=!1,y.uiState.navigation.loadPage(e.data._id)})})}))},y.getTemplateById=function(e){i.getTemplateById(e)},y.editSectionName=function(e){o(function(){angular.element(document.getElementById(e)).click()},0)},y.hideSectionFromPage=function(e,t){e.visibility?l.swal({title:"Are you sure?",text:"Do you want to hide this section from the page?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, hide it!",cancelButtonText:"No, do not hide it!",closeOnConfirm:!0,closeOnCancel:!0},function(t){t&&(e.visibility=!1,y.uiState.activeSectionIndex=void 0,y.uiState.activeComponentIndex=void 0,y.uiState.toggleSection(e))}):(e.visibility=!0,y.uiState.toggleSection(e))},y.deletePage=function(){e="Do you want to delete this page";if("index"===y.state.page.handle)var e="This is home page of the website. Do you want to delete this page";l.swal({title:"Are you sure?",text:e,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&(y.state.saveLoading=!0,y.state.pendingPageChanges=!1,y.state.pendingWebsiteChanges=!1,i.deletePage(y.state.page).then(function(e){i.getSite(y.state.page.websiteId).then(function(){y.state.saveLoading=!1,d.pop("success","Page deleted","The page deleted successfully."),o(function(){var e=_.reject(y.state.pages,function(e){return e.handle===y.state.page.handle});e.length?y.uiState.navigation.loadPage(e[0]._id):i.getPages().then(function(e){c.path("/website/site-builder/pages/")})},0)})}))})},y.duplicatePage=function(){l.swal({title:"Are you sure?",text:"Do you want to create a duplicate page?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&(y.state.saveLoading=!0,m().then(function(){i.createDuplicatePage(y.state.page).then(function(e){i.getSite(y.state.website._id).then(function(){y.state.saveLoading=!1,y.uiState.navigation.loadPage(e.data._id)})})}))})},y.hideFromMenu=function(){l.swal({title:"Are you sure?",text:"Do you want to hide this page from main menu",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, hide page!",cancelButtonText:"No, do not hide page!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&(y.state.page.mainmenu=!1,f(!1))})},y.showPageOnMenu=function(){l.swal({title:"Are you sure?",text:"Do you want to show this page on main menu",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, show page!",cancelButtonText:"No, do not show page!",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&(y.state.page.mainmenu=!0,f(!0))})},y.moveSection=function(e,t,n){var a,o=y.state.page.sections,i=n;"up"===e&&(a=i-1),"down"===e&&(a=i+1),o.splice(a,0,o.splice(i,1)[0]),y.setActiveSection(a)},y.duplicateSection=function(e,t){var n=t>0?t+1:t;(e=i.setTempUUIDForSection(e)).accountId=0,y.addSectionToPage(e,null,null,null,t).then(function(){y.setActiveSection(n)})},y.validateDuplicatePage=function(e){e=b(e);var t=y.state.pages.filter(function(t){return t.handle.toLowerCase()===e.toLowerCase()})[0];return""===e?"Page handle is invalid.":t&&t._id!==y.state.page._id?"Page handles must be unique.":i.inValidPageHandles[e.toLowerCase()]?"Page handle cannot be a system route.":void _.each(y.state.page.sections,function(t,n){t.hiddenOnPages&&t.hiddenOnPages[y.state.page.handle]&&(delete t.hiddenOnPages[y.state.page.handle],t.hiddenOnPages[e]=!0)})},y.constructVideoUrl=function(e){var t={};return"youtube"===e.bg.video.type?t=h("#VIDEO_ID#",e.bg.video.url):"vimeo"===e.bg.video.type&&(t=v("#VIDEO_ID#",e.bg.video.url)),e.bg.video.urlProcessed=t.url,e.bg.video.id=t.id,t},y.closeSectionPanel=function(){y.uiState.activeElement={},y.uiState.showSectionPanel=!1,y.uiState.openSidebarSectionPanel={name:"",id:""}},y.initializeMapSlider=function(){o(function(){e.$broadcast("rzSliderForceRender")},0)},y.addCustomField=function(e,t){if(e){var n=e.replace(/[^\w\s]/gi,"").replace(/ /g,""),a={name:n,type:e,label:e,custom:!0,optional:!0,visible:!0};n&&y.state.page.sections[y.uiState.activeSectionIndex].components[y.uiState.activeComponentIndex].contactInfo.push(a),y.contactInfo={}}else y.state.page.sections[y.uiState.activeSectionIndex].components[y.uiState.activeComponentIndex].contactInfo.splice(t,1)},y.checkDuplicateField=function(e){var t=y.state.page.sections[y.uiState.activeSectionIndex].components[y.uiState.activeComponentIndex];return _.filter(t.contactInfo,function(t){return t.type.toLowerCase()===e.toLowerCase()}).length},y.showSection=function(e){var t=!1;if(e&&(t=e.visibility||void 0===e.visibility,e.global&&e.hiddenOnPages)){var n=n=y.state.page.handle;t=!e.hiddenOnPages[n],e.visibility=t}return t},r.theme="bs3",y.fontFamilyOptions=i.getFontFamilyOptions(),y.fontWeightOptions=i.getFontWeightOptions(),y.bodyFontWeightOptions=i.bodyFontWeightOptions(),y.checkIfSelected=function(e,t){if(e&&t)return e.replace(/'/g,"").replace(/, /g,",")==t.replace(/"/g,"").replace(/, /g,",")},y.sortableOptions={handle:".ssb-sidebar-move-handle",onSort:function(e){y.setActiveSection(e.newIndex)},onStart:function(e){y.dragging=!0},onEnd:function(e){y.dragging=!1}},y.spectrum={options:i.getSpectrumColorOptions()},y.social_links=[{name:"adn",icon:"adn",tooltip:"Adn",url:"http://www.adn.com"},{name:"bitbucket",icon:"bitbucket",tooltip:"BitBucket",url:"https://bitbucket.org"},{name:"dropbox",icon:"dropbox",tooltip:"Dropbox",url:"https://www.dropbox.com"},{name:"facebook",icon:"facebook",tooltip:"Facebook",url:"https://www.facebook.com"},{name:"flickr",icon:"flickr",tooltip:"Flickr",url:"https://www.flickr.com"},{name:"foursquare",icon:"foursquare",tooltip:"Four Square",url:"https://foursquare.com"},{name:"github",icon:"github",tooltip:"Github",url:"https://github.com"},{name:"google-plus",icon:"google-plus",tooltip:"Google Plus",url:"http://plus.google.com"},{name:"instagram",icon:"instagram",tooltip:"Instagram",url:"https://instagram.com"},{name:"linkedin",icon:"linkedin",tooltip:"Linkedin",url:"https://www.linkedin.com"},{name:"microsoft",icon:"windows",tooltip:"Microsoft",url:"http://www.microsoft.com"},{name:"openid",icon:"openid",tooltip:"Open Id",url:"http://openid.com"},{name:"pinterest",icon:"pinterest",tooltip:"Pinterest",url:"https://www.pinterest.com"},{name:"reddit",icon:"reddit",tooltip:"Reddit",url:"http://www.reddit.com"},{name:"comment-o",icon:"comment-o",tooltip:"Snapchat",url:"https://www.snapchat.com"},{name:"soundcloud",icon:"soundcloud",tooltip:"Sound Cloud",url:"https://soundcloud.com"},{name:"tumblr",icon:"tumblr",tooltip:"Tumblr",url:"https://www.tumblr.com"},{name:"twitter",icon:"twitter",tooltip:"Twitter",url:"https://twitter.com"},{name:"vimeo",icon:"vimeo-square",tooltip:"Vimeo",url:"https://vimeo.com"},{name:"vine",icon:"vine",tooltip:"Vine",url:"http://www.vinemarket.com"},{name:"vk",icon:"vk",tooltip:"Vk",url:"http://vk.com"},{name:"desktop",icon:"desktop",tooltip:"Website",url:"http://www.website.com"},{name:"yahoo",icon:"yahoo",tooltip:"Yahoo",url:"https://yahoo.com"},{name:"youtube",icon:"youtube",tooltip:"Youtube",url:"https://www.youtube.com"},{name:"yelp",icon:"yelp",tooltip:"Yelp",url:"http://www.yelp.com"}],e.$watch("vm.state.page.handle",function(e,t){e&&!angular.equals(t,e)&&(y.state.page.handle=b(e))})}app.config(["$provide",function(e){e.decorator("accordionDirective",["$delegate",function(e){return e[0].replace=!0,e}])}]),app.controller("SiteBuilderSidebarController",e),e.$inject=["$scope","$attrs","$filter","$document","$timeout","SimpleSiteBuilderService","$modal","editableOptions","$location","SweetAlert","ContactService","toaster","ProductService"]}(),function(){app.directive("ssbTopbar",function(){return{restrict:"E",scope:{state:"=",uiState:"="},templateUrl:"assets/js/ssb-site-builder/ssb-controls/ssb-topbar/ssb-topbar.component.html",controller:"SiteBuilderTopbarController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r,c,l,u,d){function p(){return f.state.pendingWebsiteChanges=!1,i.saveWebsite(f.state.website).then(function(e){}).finally(function(){f.hideActiveToolTips()})}function m(){return f.state.post&&f.state.post.post_title}function g(e){return o("slugify")(e)}var f=this;f.init=function(e){f.element=e,f.state.page||(f.state.page=i.page)},f.savePage=function(){f.state.saveLoading=!0;return f.state.pendingPageChanges=!1,f.uiState.showSectionPanel=!1,f.uiState.navigation.sectionPanel.reset(),p().then(function(){return i.savePage(f.state.page).then(function(e){f.uiState.pageSaving=!0,i.getSite(f.state.website._id).then(function(){f.uiState.pageSaving=!0,f.state.publishLoading||u.pop("success","Page Saved","The page was saved successfully."),f.state.saveLoading=!1,i.saveOtherPageLinks(),n(function(){f.uiState.pageSaving=!1},2e3)})}).catch(function(e){u.pop("error","Error","The page was not saved. Please try again."),f.state.saveLoading=!1,f.uiState.pageSaving=!1})})},f.cancelPendingEdits=function(){f.uiState.openSidebarPanel="",f.uiState.showSectionPanel=!1,f.uiState.openSidebarSectionPanel={name:"",id:""},f.state.pendingPageChanges=!1,f.state.pendingWebsiteChanges=!1,i.website=angular.copy(f.state.originalWebsite),i.page=angular.copy(f.state.originalPage),f.hideActiveToolTips()},f.revertPage=function(e){f.state.saveLoading=!0,i.revertPage(f.state.page._id,e,function(e){i.getPage(e._id).then(function(e){f.uiState.openSidebarPanel="",f.uiState.showSectionPanel=!1,f.uiState.openSidebarSectionPanel={name:"",id:""},f.state.pendingPageChanges=!1,f.state.pendingWebsiteChanges=!1,i.website=angular.copy(f.state.originalWebsite),f.state.originalPage=e.data,i.page=angular.copy(f.state.originalPage),f.state.saveLoading=!1}).finally(function(){f.hideActiveToolTips()})})},f.publishPage=function(){f.state.saveLoading=!0,f.state.publishLoading=!0,f.state.page.hideFromVisitors=!1;var e=f.savePage();e.then&&e.then(function(e){i.publishPage(f.state.page._id).then(function(e){i.getSite(f.state.website._id).then(function(){f.state.publishLoading=!1,f.state.page.modified=angular.copy(e.data.modified),f.state.page.published=angular.copy(e.data.published),f.state.pendingPageChanges=!1,f.state.pendingWebsiteChanges=!1,u.pop("success","Page Published","The page was published successfully.")})}).catch(function(e){f.state.publishLoading=!1,u.pop("error","Error","The page was not published. Please try again.")}).finally(function(){f.hideActiveToolTips()})})},f.hideActiveToolTips=function(){angular.element(".tooltip").remove()},f.closeBlogPanel=function(){f.state.pendingBlogChanges?f.savePost().then(f.uiState.cleanBlogPanel):f.uiState.cleanBlogPanel()},f.backBlogPanel=function(){f.state.pendingBlogChanges?f.savePost().then(f.uiState.navigation.blogPanel.back):f.uiState.navigation.blogPanel.back()},f.savePost=function(e,t){if(!(e=e||f.state.post)||!m())return i.returnInvalidPost();var n={};return f.uiState.saveLoading=!0,e.websiteId=f.state.website._id,e.display_title=angular.element("<div>"+e.post_title+"</div>").text().trim(),e.post_url=g(angular.element("<div>"+e.post_title+"</div>").text().trim()),s.savePost(e).then(function(e){f.state.post=e.data,f.state.pendingBlogChanges=!1,n={type:"success",title:"Post Saved",message:"The post was saved successfully."}}).catch(function(e){n={type:"error",title:"Error",message:e.data?e.data.message:"Error updating post. Please try again."},f.handleSaveErrors(e)}).finally(function(){f.uiState.saveLoading=!1,t||u.pop(n.type,n.title,n.message)})}}app.controller("SiteBuilderTopbarController",e),e.$inject=["$scope","$rootScope","$timeout","$attrs","$filter","SimpleSiteBuilderService","SimpleSiteBuilderBlogService","$modal","$location","SweetAlert","toaster","$q"]}(),function(){"use strict";app.directive("ssbSiteBuilder",function(){return{restrict:"E",scope:{},templateUrl:"assets/js/ssb-site-builder/ssb-site-builder.component.html",controller:"SiteBuilderController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r,c,l,u,d,p,m,g){function f(){return O.state.pendingWebsiteChanges=!1,o.saveWebsite(O.state.website).then(function(e){})}function h(e){void 0!==e?(O.uiState.accordion.sections={},O.uiState.activeSectionIndex=e,O.uiState.accordion.sections.isOpen=!0,O.uiState.accordion.sections[e]={components:{}},O.uiState.accordion.sections[e].isOpen=!0,O.state.page.sections[e]&&(O.uiState.isDuplicateGlobalHeader=o.checkDuplicateGlobalHeader(O.state.page.sections[e]))):(O.uiState.activeSectionIndex=void 0,O.uiState.activeComponentIndex=void 0,O.uiState.isDuplicateGlobalHeader=!1),d(function(){$(window).trigger("resize")},100)}function v(e){O.uiState.activeComponentIndex=e,void 0!==e&&O.uiState.accordion.sections[O.uiState.activeSectionIndex]&&(O.uiState.accordion.sections[O.uiState.activeSectionIndex].components[e]||(O.uiState.accordion.sections[O.uiState.activeSectionIndex].components[e]={}),O.uiState.accordion.sections[O.uiState.activeSectionIndex].components[e].isOpen=!0)}function b(e,t,n,a){var o={templateUrl:e,keyboard:!0,backdrop:"static",size:"md",resolve:{vm:function(){return O}}};t&&(o.controller=t,o.resolve.showInsert=function(){return O.showInsert},o.resolve.insertMedia=function(){return O.insertVideoMedia},o.resolve.isSingleSelect=function(){return!0}),a&&(o.size="lg"),O.modalInstance=c.open(o),O.modalInstance.result.then(null,function(){angular.element(".sp-container").addClass("sp-hidden")})}function y(e){d(function(){O.callBackOnVideoInsert(e.url,O.callBackVedio)},0)}function w(){d(function(){u.eqjs.refreshNodes(),u.eqjs.query()},3e3)}function C(e){angular.element(this).hasClass("clickable-link")||(e.preventDefault(),e.stopPropagation())}function S(e){}function k(e){$("body").innerWidth()>767?O.uiState.sidebarOrientation="vertical":O.uiState.sidebarOrientation="horizontal"}function T(){angular.element(".ssb-edit-wrap, .editable-title, .editable-cover, [data-edit]",".ssb-main").removeClass("ssb-on"),angular.element(".ssb-main").find(".ssb-active-edit-control").removeClass("ssb-active-edit-control"),angular.element(".ssb-main").find(".ssb-on").removeClass("ssb-on"),angular.element(".ssb-main").find(".ssb-active-component").removeClass("ssb-active-component"),angular.element(".ssb-main").find(".ssb-theme-btn-active-element").removeClass("ssb-theme-btn-active-element"),angular.element(".ssb-main").find(".ssb-edit-control-component-btn").removeClass("on")}function P(e,t){var n=!1;return e&&t&&(n=angular.isDefined(e)&&angular.isDefined(e.indexOf)&&-1===e.indexOf("data-compiled"),angular.isDefined(t)&&angular.isDefined(t.indexOf)&&t.indexOf("data-compiled")),n&&angular.isDefined(e)&&angular.isDefined(t)&&(n=angular.equals(e,t)),n}function D(e,t){return e&&t&&angular.isDefined(e)&&angular.isDefined(e.indexOf)&&-1!==e.indexOf("data-compiled")&&angular.isDefined(t)&&angular.isDefined(t.indexOf)&&-1===t.indexOf("data-compiled")}function A(e,t,n){var a=!1,o=!1,i=!1;return n&&n.indexOf("published")>-1&&(o=!0,n.indexOf("by")>-1&&(i=!0)),e&&o&&(e.length<30&&-1!==e.indexOf(":")&&-1!==e.indexOf("-")?moment(e).isValid()&&(a=!0):e.date&&!t?a=!0:i&&(a=!0)),a}function x(e,t){if(e&&t&&angular.isDefined(e)&&angular.isDefined(e.indexOf)&&-1!==e.indexOf("data-compiled")&&angular.isDefined(t)&&angular.isDefined(t.indexOf)&&-1!==t.indexOf("data-compiled")){var n=/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/g,a=e.replace(n,"").replace(/ ng-scope/g,"").replace(/undefined/g,""),o=t.replace(n,"").replace(/ ng-scope/g,"").replace(/undefined/g,"");return angular.equals(a,o)}}function I(e,t,n){var a=!1;return n&&n.indexOf("slider")>-1&&e&&null===e.sliderDotColorOpacity&&!t&&(a=!0),a}function E(e,t,n){if(e&&t&&angular.isDefined(e)&&angular.isDefined(t)){_.isString(e)||(e=""+e),_.isString(t)||(t=""+t);var a=e.replace(/ style=''/g,""),o=t.replace(/ style=''/g,"");return angular.equals(a,o)}}function M(){_.each(O.state.website.linkLists,function(e,t){if("head-menu"===e.handle){var n=_(e.links).chain().pluck("linkTo").where({type:"page"}).pluck("data").value(),a=_.invert(_.object(_.pairs(n)));O.state.pages=_.sortBy(O.state.pages,function(e){return a[e.handle]})}})}function B(t){t.components&&t.components.length>0&&"testimonials"===t.components[0].type&&2==t.components[0].version?d(function(){t.spacing&&t.spacing.mw&&t.components[0].customWidth&&"100%"!=t.spacing.mw&&"100%"!=t.components[0].customWidth&&t.spacing.mw<t.components[0].customWidth&&e.$apply(function(){t.components[0].customWidth=t.spacing.mw}),e.$broadcast("updatetestimonialHeight.component",{})},1e3):t&&"testimonials"===t.type&&2==t.version&&d(function(){e.$broadcast("updatetestimonialHeight.component",{})},500)}var O=this;O.init=function(e){O.element=e,angular.element("body").on("click",".ssb-page-section a",C),angular.element("body").on("click",".ssb-page-section",S),angular.element(".ssb-main").on("eqResize",k),w(),t.app.layout.isSidebarClosed=!0,t.app.layout.isMinimalAdminChrome=!0,O.uiStateOriginal=angular.copy(O.uiState),O.state.permissions=o.permissions},O.state={},O.updateActiveSection=h,O.updateActiveComponent=v,O.savePage=function(){O.state.saveLoading=!0;var e=!O.state.page.ssb;!O.uiState.hasSeenWarning&&e?l.swal({title:"Are you sure?",text:"CAUTION: This editor is under active development. Pages saved in Site Builder will not render or be editable in the legacy Pages editor.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes  Use Site Builder editor.",cancelButtonText:"No  Use the legacy editor.",closeOnConfirm:!0,closeOnCancel:!0},function(e){e?(O.uiState.hasSeenWarning=!0,O.state.pendingPageChanges=!1,O.uiState.showSectionPanel=!1,O.uiState.navigation.sectionPanel.reset(),f().then(function(){return o.savePage(O.state.page).then(function(e){O.uiState.pageSaving=!0,o.getSite(O.state.website._id).then(function(){m.pop("success","Page Saved","The page was saved successfully."),O.state.saveLoading=!1,o.saveOtherPageLinks(),d(function(){O.uiState.pageSaving=!1},2e3)})}).catch(function(e){O.state.saveLoading=!1,O.uiState.pageSaving=!1,m.pop("error","Error","The page was not saved. Please try again.")})})):O.state.saveLoading=!1}):(O.state.pendingPageChanges=!1,O.uiState.showSectionPanel=!1,O.uiState.navigation.sectionPanel.reset(),f().then(function(){return o.savePage(O.state.page).then(function(e){o.getSite(O.state.website._id).then(function(){o.getPages().then(function(){m.pop("success","Page Saved","The page was saved successfully."),O.state.saveLoading=!1,o.saveOtherPageLinks()})})}).catch(function(e){m.pop("error","Error","The page was not saved. Please try again."),O.state.saveLoading=!1})}),O.state.post&&O.state.pendingBlogChanges&&O.savePost(O.state.post))},O.saveWebsite=f,O.cancelPendingEdits=function(){O.pageSectionClick(),O.state.pendingPageChanges=!1,O.state.pendingWebsiteChanges=!1,o.website=angular.copy(O.state.originalWebsite),o.page=angular.copy(O.state.originalPage)},O.openMediaModal=function(e,t,n,a){var o={templateUrl:e,keyboard:!0,backdrop:"static",size:"md",resolve:{vm:function(){return O}}};t&&(o.controller=t,o.resolve.showInsert=function(){return O.showInsert},o.resolve.insertMedia=function(){return O.insertMedia},o.resolve.isSingleSelect=function(){return!0}),angular.isDefined(n)&&null!==n&&n>=0&&(o.resolve.clickedIndex=function(){return n},O.state.page&&(o.resolve.pageHandle=function(){return $vm.state.page.handle})),a&&(o.size="lg"),O.modalInstance=c.open(o),O.modalInstance.result.then(null,function(){angular.element(".sp-container").addClass("sp-hidden")})},O.openModal=function(t,n,a,o){var i={templateUrl:t,keyboard:!0,backdrop:"static",size:"md",scope:e,resolve:{parentVm:function(){return O}}};n&&(i.controller=n+" as vm"),o&&(i.size="lg"),O.modalInstance=c.open(i),O.modalInstance.result.then(null,function(){angular.element(".sp-container").addClass("sp-hidden")})},O.closeModal=function(){O.modalInstance.close()},O.insertMedia=function(e){O.addFroalaImage(e)},O.insertVideoMedia=function(e){y(e)},O.addFroalaImage=function(e){d(function(){o.isImage(e.url).then(function(t){!1===t?O.state.imageEditor.editor.video.insertByMediaAsset(e.url):O.callBackImage?O.callBackOnImageInsert(e.url,O.callBackImage):O.state.imageEditor.editor.image.insertByMediaCallback(e.url,O.state.imageEditor.img)})},0)},O.state.imageEditor={},O.applyThemeToSite=o.applyThemeToSite,O.addSectionToPage=function(e,t){o.addSectionToPage(e,t,O.modalInstance)},O.legacyComponentMedia=function(t,n,a,i){var s=_(O.state.page.sections).chain().pluck("components").flatten().findWhere({_id:t}).value();o.openMediaModal("media-modal","MediaModalCtrl",null,"lg",O,s,n,a,i).result.then(function(){"thumbnail-slider"===s.type&&e.$broadcast("refreshThumbnailSlider")})},O.checkIfDirty=function(){return O.state.pendingWebsiteChanges||O.state.pendingPageChanges||O.state.pendingBlogChanges},O.resetDirty=function(){O.state.pendingWebsiteChanges=!1,O.state.pendingPageChanges=!1,O.state.pendingBlogChanges=!1},O.pageChanged=function(e,t){if(angular.equals(e,t)||O.state.pendingPageChanges)return!0;var e=JSON.parse(angular.toJson(e)),t=JSON.parse(angular.toJson(t)),n=DeepDiff.diff(e,t),a=n.length;if(!a)return a>0;for(var o=0;o<a;o++){var i=n[o].lhs,s=n[o].rhs,r=n[o].path;if(!(P(i,s)||D(i,s)||A(i,s,r)||I(i,s,r)||x(i,s)||E(i,s)))return!0;d(function(){return DeepDiff.applyChange(e,t,n[o]),O.state.originalPage=e,--a>0})}},O.toggleSectionVisiblity=function(e,t,n){t?!1===e.global&&l.swal({title:"Are you sure?",text:"Turning off this setting will remove the section from all pages except for this one.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Remove from other pages",cancelButtonText:"Cancel",closeOnConfirm:!0,closeOnCancel:!0},function(t){t||(e.global=!0)}):e.global?(e.hiddenOnPages||(e.hiddenOnPages={}),!1===e.visibility?(e.hiddenOnPages[O.state.page.handle]=!0,T()):delete e.hiddenOnPages[O.state.page.handle]):!1===e.visibility&&T()},O.isBlogPage=function(e){return"blog-list"===e.handle||"blog-post"===e.handle||e.isBlogCopy},O.isBlogCopy=function(e){return e.isBlogCopy},O.isBlogEditMode=function(){return angular.isDefined(O.uiState.openBlogPanel.id)&&"blog"===O.uiState.openSidebarPanel},O.isBlogEditWritingMode=function(){return angular.isDefined(O.uiState.openBlogPanel.id)&&"blog"===O.uiState.openSidebarPanel&&"edit"===O.uiState.openBlogPanel.id},O.saveAndLoadPage=function(e){O.uiState.openSidebarPanel="",O.state.saveAndLoading=!0,O.state.pendingPageChanges||O.state.pendingWebsiteChanges?(O.state.saveLoading=!0,O.state.pendingWebsiteChanges=!1,O.state.pendingPageChanges=!1,f().then(function(){return o.savePage(O.state.page).then(function(t){o.getSite(O.state.website._id).then(function(){m.pop("success","Page Saved","The page was saved successfully."),O.state.saveLoading=!1,o.saveOtherPageLinks(),O.uiState.navigation.loadPage(e._id),o.getPages(),d(function(){O.state.saveAndLoading=!1},0)})}).catch(function(e){m.pop("error","Error","The page was not saved. Please try again."),O.state.saveLoading=!1,d(function(){O.state.saveAndLoading=!1},0)})})):(O.uiState.navigation.loadPage(e._id),o.getPages(),d(function(){O.state.saveAndLoading=!1},0))},O.openPageSettingsModal=function(t,n,a,o,i){var s={templateUrl:t,keyboard:!0,backdrop:"static",size:"md",scope:e,resolve:{parentVm:function(){return O}}};n&&(s.controller=n+" as vm"),o&&(s.size="lg"),s.resolve.pageId=function(){return i},O.modalInstance=c.open(s),O.modalInstance.result.then(null,function(){angular.element(".sp-container").addClass("sp-hidden")})},O.checkPageNavigation=function(e){return O.state.pendingPageChanges||O.state.pendingWebsiteChanges||O.state.pendingBlogChanges?"You have unsaved changes. Are you sure you want to leave Site Builder?":void 0},O.savePost=function(e){return i.savePost(e).then(function(e){O.state.pendingBlogChanges=!1}).error(function(e){})},O.updateColumnLayout=function(e){if(e&&e.layoutModifiers&&e.layoutModifiers.columns){var t=parseInt(e.layoutModifiers.columns.columnsNum);if(t*=e.layoutModifiers.columns.rowsNum?parseInt(e.layoutModifiers.columns.rowsNum):1,e.layoutModifiers.columns.ignoreColumns&&e.layoutModifiers.columns.ignoreColumns.length&&(t+=e.layoutModifiers.columns.ignoreColumns.length),e.components.length)if(e.components.length<t){var n=t-e.components.length,a=e.components[0];o.getTempComponent(a).then(function(t){for(;0!==n;){t._id=o.getTempUUID(),t.anchor=t._id;var a=angular.copy(t);e.layoutModifiers.columns.ignoreColumns&&e.layoutModifiers.columns.ignoreColumns.indexOf("last")>-1?e.components.splice(e.components.length-1,0,a):e.components.push(a),n--}})}else if(e.components.length>t)for(n=e.components.length-t;0!==n;)e.layoutModifiers.columns.ignoreColumns&&e.layoutModifiers.columns.ignoreColumns.indexOf("last")>-1?e.components.splice(e.components.length-2,1):e.components.splice(e.components.length-1,1),n--}},O.setDefaultSpacing=function(e,t){e.spacing||(e.spacing={}),e.spacing.default=!t},O.updatetestimonialWidth=B,O.onBorderChange=function(e){return{floor:0,ceil:100,onEnd:function(){B(e)}}},O.isNavHero=function(e){return e&&e.title&&"nav + hero"===e.title.toLowerCase()},O.isSortableDisabled=angular.element(u).width()<768,O.toggleSidebarPanel=function(e){O.state.saveAndLoading||(O.uiState.openSidebarPanel=e)},O.resizeWindow=function(){d(function(){$(window).trigger("resize")},500)},O.isTextColumnNum=function(e){return e&&e.layoutModifiers&&e.layoutModifiers.columns&&angular.isDefined(e.layoutModifiers.columns.columnsNum)},O.closeSidePanel=function(e){"BUTTON"!=e.target.nodeName&&(O.uiState.openSidebarPanel="")},O.showPageSection=function(t){var n=!1;if(t&&(n=!1!==t.visibility,t.global&&t.hiddenOnPages)){var a;a=O.state?O.state.page.handle:e.$root.pageHandle,n=!t.hiddenOnPages[a],t.visibility=n}return n},O.uiState={loading:0,activeSectionIndex:void 0,activeComponentIndex:void 0,show:{flyover:!0,sidebar:!0},accordion:{site:{},page:{},sections:{}},openSidebarPanel:"",openSidebarSectionPanel:{name:"",id:""},showSectionPanel:!1,componentControl:{},componentMedia:O.legacyComponentMedia,sidebarOrientation:"vertical",sortableListPageContentConfig:{sort:!1,filter:".fr-wrapper",group:"section",scroll:!0,animation:150,disabled:!0,ghostClass:"sortable-ghost",onAdd:function(e){O.uiState.draggedSection&&o.getSection(O.uiState.draggedSection,O.uiState.draggedSection.version||1).then(function(t){if(t){var n=o.setTempUUIDForSection(t);n=o.checkAndSetGlobalHeader(n),O.state.page.sections[e.newIndex]=n}})},onEnd:function(e){}},sortableListAddContentConfig:{sort:!1,disabled:O.isSortableDisabled,group:{name:"section",pull:"clone",model:"vm.uiState.filteredSections"},animation:150,ghostClass:"sortable-ghost",chosenClass:"list-add-sortable-chosen",scroll:!0,onStart:function(e){O.uiState.sortableListPageContentConfig.disabled=!1,angular.element(".sortable-page-content").addClass("dragging");var t=angular.element("ssb-topbar").offset().top,n=angular.element("ssb-topbar").height(),a=angular.element(window).height(),o=n+t;angular.element(".sortable-page-content").height(a-o)},onEnd:function(e,t){O.uiState.activeSectionIndex=e.newIndex,angular.element(".sortable-page-content").removeClass("dragging"),angular.element(".sortable-page-content").css("height","auto"),d(function(){O.uiState.sortableListPageContentConfig.disabled=!0,O.uiState.openSidebarPanel="";var e=document.querySelector(".ssb-site-builder-container"),t=document.querySelector(".ssb-active-section");t&&(e.scrollTop=t.offsetTop)})},onSort:function(e){},onMove:function(e){var t=e.dragged.attributes.sectionId.value;O.uiState.draggedSection=_.findWhere(O.uiState.filteredSections,{_id:t})}},toggleSection:O.toggleSectionVisiblity,openBlogPanel:{},isBlogPage:!1,isBlogCopy:!1,isBlogEditMode:!1,isBlogEditWritingMode:!1,saveAndLoadPage:O.saveAndLoadPage,openPageSettingsModal:O.openPageSettingsModal,checkIfBlogPage:O.isBlogPage,checkIfBlogCopy:O.isBlogCopy,isDuplicateGlobalHeader:!1,updateColumnLayout:O.updateColumnLayout,setDefaultSpacing:O.setDefaultSpacing,updatetestimonialWidth:O.updatetestimonialWidth,onBorderChange:O.onBorderChange,isNavHero:O.isNavHero,toggleSidebarPanel:O.toggleSidebarPanel,resizeWindow:O.resizeWindow,isTextColumnNum:O.isTextColumnNum,locationFinderOptions:o.getLocationFinderRanges(),alignmentOptions:["left","center","right"],closeSidePanel:O.closeSidePanel,showPageSection:O.showPageSection},g.flyoverhide(O.uiState),O.uiState.navigation={back:function(){O.uiState.navigation.index=0,O.uiState.navigation.indexClass="ssb-sidebar-position-0"},loadPage:function(e){e&&e!==O.state.page._id?(o.getPages(),O.state.pendingWebsiteChanges||O.state.pendingPageChanges||(O.uiState.loaded=!1),d(function(){O.state.saveAndLoading=!1},0),p.path("/website/site-builder/pages/"+e)):(O.uiState.navigation.index=1,O.uiState.navigation.indexClass="ssb-sidebar-position-1",d(function(){O.state.saveAndLoading=!1},0))},goToPagesListPage:function(){p.url("/website/site-builder/pages/")},index:0,indexClass:"ssb-sidebar-position-1",sectionPanel:{navigationHistory:[],loadPanel:function(e,t){t||O.uiState.navigation.sectionPanel.navigationHistory.push(e),O.uiState.openSidebarSectionPanel=e},back:function(){var e,t=O.uiState.navigation.sectionPanel.navigationHistory;t.pop(),e=t[t.length-1],O.uiState.navigation.sectionPanel.loadPanel(e,!0),e&&!e.id&&(T(),angular.element(".ssb-active-section").addClass("ssb-active-edit-control"))},reset:function(){O.uiState.openSidebarSectionPanel={name:"",id:""},O.uiState.navigation.sectionPanel.navigationHistory=[]}},componentPanel:{loadPanel:function(e,t){var n=O.state.page.sections[e].components[t],i={name:a("cleanType")(n.type).toLowerCase().trim().replace(" ","-"),id:n._id,componentId:n._id};d(function(){if(o.setActiveSection(e),o.setActiveComponent(t),O.uiState.navigation.sectionPanel.loadPanel(i),void 0!==e&&void 0!==t){O.uiState.showSectionPanel=!0;var a=angular.element("#component_"+n._id);T(),d(function(){1===a.find("[data-edit]").length?a.find("[data-edit]").addClass("ssb-active-component"):a.find(".ssb-edit-control-component-area").first().next("[data-edit]").addClass("ssb-active-component")},100)}})}},blogPanel:{navigationHistory:[],loadPanel:function(e,t){t||O.uiState.navigation.blogPanel.navigationHistory.push(e),O.uiState.openBlogPanel=e},back:function(){var e,t=O.uiState.navigation.blogPanel.navigationHistory;t.pop(),e=t[t.length-1],O.uiState.navigation.blogPanel.loadPanel(e,!0)}}},O.uiState.componentIcons=o.manageComponentIcons,t.$on("$stateChangeStart",function(e,n,a,o,i,s){t.$broadcast("$destroyFroalaInstances"),t.app.layout.isMinimalAdminChrome=!1}),t.$on("$locationChangeStart",function(e,t,n,a,o,i){}),t.$on("$ssbUpdateUiState",function(e,t){angular.extend(O.uiState,t)}),e.$on("$destroy",function(){angular.element("body").off("click",".ssb-page-section a",C),angular.element("body").off("click",".ssb-page-section",S),angular.element(".ssb-main").off("eqResize",k),angular.element(u).off("beforeunload",O.checkPageNavigation),L(),F(),j(),U(),R(),N(),V(),W(),z(),q(),H(),Y(),G(),J(),K(),X(),X()});var L=e.$watch(function(){return o.website},function(e){O.state.pendingWebsiteChanges=!1,e&&e.themeOverrides&&e.themeOverrides.styles&&!angular.isDefined(e.themeOverrides.styles.primarySliderDotColor)&&(e.themeOverrides.styles.primarySliderDotColor="#FFF"),e&&e.themeOverrides&&e.themeOverrides.styles&&!angular.isDefined(e.themeOverrides.styles.primarySliderActiveDotColor)&&(e.themeOverrides.styles.primarySliderActiveDotColor="#000"),e&&e.themeOverrides&&e.themeOverrides.styles&&!angular.isDefined(e.themeOverrides.styles.primarySliderDotColorOpacity)&&(e.themeOverrides.styles.primarySliderDotColorOpacity=.4),O.state.website=e,O.state.originalWebsite=null,d(function(){O.state.originalWebsite=angular.copy(e)},1e3)}),F=e.$watch(function(){return o.page},function(e){t.$broadcast("$destroyFroalaInstances"),O.state.pendingPageChanges=!1,O.state.page=e,O.state.originalPage=null,O.uiState.isBlogPage=O.isBlogPage(O.state.page),O.uiState.isBlogCopy=O.isBlogCopy(O.state.page),d(function(){O.state.originalPage=angular.copy(e)},1e3)}),j=e.$watch(function(){return o.activeSectionIndex},h,!0),U=e.$watch(function(){return o.activeComponentIndex},v,!0),R=e.$watch(function(){return o.loading},function(e){O.uiState.loading=e.value,O.uiState.loaded||d(function(){O.uiState.loaded=!0},2e3)},!0),N=e.$watch("vm.state.page",_.debounce(function(e){e&&O.state.originalPage&&O.pageChanged(e,O.state.originalPage)?(O.state.pendingPageChanges=!0,O.uiState&&O.uiState.selectedPage&&(O.uiState.selectedPage=O.state.page),w()):O.state.pendingPageChanges=!1},100),!0),V=e.$watch("vm.state.website",function(e){o.websiteLoading&&e&&O.state.originalWebsite&&!angular.equals(e,O.state.originalWebsite)?O.state.pendingWebsiteChanges=!0:O.state.pendingWebsiteChanges=!1},!0),W=e.$watch("vm.state.website.linkLists",function(e){e&&M()},!0),z=e.$watch(function(){return o.pages},function(e){O.state.originalPages=angular.copy(e),O.state.pages=angular.copy(e),e&&(O.state.pages=_.reject(e,function(e){return"blog"===e.handle||"single-post"===e.handle||"signup"===e.handle})),O.state.website&&M()},!0),q=e.$watch(function(){return o.themes},function(e){O.state.themes=e,q()},!0),H=e.$watch(function(){return o.templates},function(e){O.state.templates=e,H()},!0),Y=e.$watch(function(){return o.legacyTemplates},function(e){O.state.legacyTemplates=e,Y()},!0),G=e.$watch(function(){return o.platformSections},function(e){e&&(O.state.platformSections=e,G())},!0),J=e.$watch(function(){return o.userSections},function(e){O.state.userSections=e,J()},!0),K=e.$watch(function(){return o.account},function(e){O.state.account=e,O.uiState.hideSocialShare=!1,e&&e.showhide&&!1===e.showhide.blogSocialSharing&&(O.uiState.hideSocialShare=!0),K()},!0),X=e.$watch(function(){return O.uiState.openSidebarPanel},function(){O.uiState.isBlogEditMode=O.isBlogEditMode(),O.uiState.isBlogEditMode?angular.element("#intercom-container").hide():(angular.element("#intercom-container").show(),O.uiState.openBlogPanel={})},!0),X=e.$watch(function(){return O.uiState.openBlogPanel},function(){O.uiState.isBlogEditWritingMode=O.isBlogEditWritingMode()},!0);e.$watch("vm.uiState.loaded",function(n){angular.isDefined(n)&&(n?d(function(){t.app.layout.editorLoaded=!0,e.$broadcast("parallaxCall",{})},1e3):t.app.layout.editorLoaded=!1)}),window.clickandInsertImageButton=function(e,t,n){O.callBackOnImageInsert=n,O.callBackImage=t,e?(O.showInsert=!0,O.state.imageEditor.editor=e,O.state.imageEditor.img=t):O.state.imageEditor&&O.state.imageEditor.editor?O.showInsert=!0:O.showInsert=!1,O.openMediaModal("media-modal","MediaModalCtrl",null,"lg")},window.clickandInsertVideoButton=function(e,t,n){O.callBackOnVideoInsert=n,O.callBackVedio=t,e&&(O.showInsert=!0),b("media-modal","MediaModalCtrl",0,"lg")},e.$on("focusEditor",function(e,t){O.state.imageEditor.editor=t.editor,O.state.imageEditor.img=null}),e.$on("activeEditor",function(e,t){t.editor&&(O.state.imageEditor.editor=t.editor),t.editorImage&&(O.state.imageEditor.img=t.editorImage)}),e.$on("$refreshAccountSettings",function(e,t){t&&t._id&&(O.state.account=t,t&&t.showhide&&!1===t.showhide.blogSocialSharing&&(O.uiState.hideSocialShare=!0))})}app.controller("SiteBuilderController",e),e.$inject=["$scope","$rootScope","$attrs","$filter","SimpleSiteBuilderService","SimpleSiteBuilderBlogService","$state","$stateParams","$modal","SweetAlert","$window","$timeout","$location","toaster","UtilService"]}(),function(e){app.controller("SSBPagesCtrl",["$scope","$location","toaster","$filter","$modal","WebsiteService","pageConstant","$timeout","SimpleSiteBuilderService",function(t,n,a,o,i,s,r,c,l){var u=this;u.state={},t.$watch(function(){return l.themes},function(e){u.state.themes=e},!0),t.$watch(function(){return l.templates},function(e){u.state.templates=e},!0),t.$watch(function(){return l.legacyTemplates},function(e){u.state.legacyTemplates=e},!0),t.tableView="list",t.itemPerPage=40,t.showPages=15,t.showChangeURL=!1,t.createpage={},t.pageConstant=r,t.setHomePage=function(){t.createpage.homepage&&(t.createpage.title="Home",t.createpage.handle="index")},t.default_image_url="/admin/assets/images/default-page.jpg",t.filterPages=function(){t.showFilter=!t.showFilter,t.filterScreenshots(t.pages)},t.orderByFn=function(){t.pages=o("orderBy")(t.pages,"modified.date",!0)},t.filterScreenshots=function(e){_.each(e,function(e){e&&(e.hasScreenshot=!1,e.screenshot&&($("#screenshot_"+e._id).attr("src")===t.default_image_url?e.hasScreenshot=!1:e.hasScreenshot=!0))})},t.formatPages=function(e,n){var a=[];_.each(e,function(e){e&&(e.components?e.components=e.components.length:e.components=0,e.hasScreenshot=!1,e.screenshot&&($("#screenshot_"+e._id).attr("src")===t.default_image_url&&(e.hasScreenshot=!1),e.hasScreenshot=!0),"template"!==e.type&&"blog"!==e.handle&&"single-post"!==e.handle&&"blog-list"!==e.handle&&"blog-post"!==e.handle&&a.push(e))}),n&&n(a)},t.openModal=function(e){t.modalInstance=i.open({templateUrl:e,keyboard:!0,backdrop:"static",scope:t,resolve:{vm:function(){return u}}}),t.modalInstance.result.finally(t.closeModal())},t.closeModal=function(){t.modalInstance.close(),t.resetTemplateDetails(),t.createpage.showhomepage?(t.createpage.homepage=!0,t.createpage.title="Home",t.createpage.handle="index"):t.createpage={}},t.getters={components:function(e){return e.length},created:function(e){return e.created.date},modified:function(e){return e.modified.date}},t.setTemplateDetails=function(e){t.templateDetails=!0,t.selectedTemplate=e},t.resetTemplateDetails=function(){t.templateDetails=!1,t.selectedTemplate=null,t.showChangeURL=!1},t.slugifyHandle=function(e){e&&(t.createpage.handle=o("slugify")(e))},t.validateCreatePage=function(e,n){t.createPageValidated=!1,e&&(""===e.handle?t.handleError=!0:(t.handleError=!1,e.handle=n?o("slugify")(e.handle):o("slugify")(e.title)),e.title?t.titleError=!1:e.title=e.handle,e&&e.title&&""!==e.title&&e.handle&&""!==e.handle&&(t.createPageValidated=!0))},t.createPage=function(e){if(!t.saveLoading)return t.saveLoading=!0,l.createPage(e._id).then(function(e){t.saveLoading=!1,t.closeModal(),t.viewSimpleSiteBuilder(e.data)})},t.viewSingle=function(e){n.path("/website/pages/").search({pagehandle:e.handle})},t.viewSimpleSiteBuilder=function(e){var a;t.pages.length&&(a=(a=t.pages.filter(function(e){return"index"==e.handle})).length?a[0]._id:t.pages[0]._id),e&&(a=e._id),n.path("/website/site-builder/pages/"+a)},t.filterScreenshot={},t.pageScreenshotOptions=[{name:"Screenshot",value:!0},{name:"No Screenshot",value:!1}],t.triggerInput=function(t){e.element(t).trigger("input")},t.clearFilter=function(e,n){t.filterScreenshot={},t.triggerInput(n)},t.toggleHandle=function(e){t.showChangeURL=e};t.pages=[],t.checkAndSetIndexPage=function(e){_.find(e,function(e){return"index"===e.handle})?t.createpage.homepage=!1:(t.createpage.showhomepage=!0,t.createpage.homepage=!0,t.createpage.title="Home",t.createpage.handle="index")},t.getPages=function(){s.getPages(function(n){var a=e.copy(n);if(0===t.pages.length&&(t.checkAndSetIndexPage(a),t.formatPages(a,function(e){t.pages=e,t.orderByFn(),t.displayPages=!0})),a.length>t.pages.length&&0!==t.pages.length){var o=_.filter(a,function(e){return!_.find(t.pages,function(t){return t._id===e._id})});t.formatPages(o,function(e){_.each(e,function(e){t.pages.push(e)}),t.orderByFn(),t.displayPages=!0})}})},t.getPages()}])}(angular),function(){function e(e,t,n,a,o,i,s,r,c){function l(e,t){return t&&t.componentSortOrder?t.componentSortOrder:_.invert(_.object(_.pairs(_.pluck(e,"type"))))}function u(e){return A.loading.value=A.loading.value+1,e.finally(function(){A.loading.value=A.loading.value-1}),e}function d(e){var t=m(e);A.page=t,A.pages&&A.pages[t.handle]&&(A.pages[t.handle]=t)}function p(e){}function m(e){if(e.components&&e.components.length&&!e.ssb){e.sections=angular.copy(e.components);for(a=0;a<e.sections.length;a++){var t=angular.copy(e.sections[a]),n={_id:Math.random().toString(36).replace("0.",""),accountId:A.account._id,layout:"1-col",components:[t],visibility:!0};n.name=f(n)+" Section",e.sections[a]=n}}for(var a=0;a<e.sections.length;a++)e.sections[a]&&!e.sections[a].name&&(e.sections[a].name=f(e.sections[a])+" Section");return e.ssb=!0,e}function g(e,t){return t||(t=1),u(n({url:I+e.type,method:"POST",data:angular.toJson({version:t})}).success(function(e){}).error(function(e){}))}function f(e){var t=e.layout;return e.components&&(1===e.components.length&&e.components[0].header_title?t=e.components[0].header_title:e.components[0]&&(t=e.components[0].type)),t}function h(e,t){var n={layout:"1-col",txtcolor:void 0,bg:{img:{url:"",width:null,height:null,parallax:!1,blur:!1,overlay:!1,show:!1},color:void 0},visibility:!0,spacing:{mt:"0",ml:"0",mr:"0",mb:"0",pt:"0",pb:"0",pl:"0",pr:"0"}};return g(e,t).then(function(e){return n.components=[e.data],n.name=f(n),n.spacing||(n.spacing={mt:"0",ml:"0",mr:"0",mb:"0",pt:"0",pb:"0",pl:"0",pr:"0"}),n})}function v(e){return _.filter(e,function(e){return(!0===e.globalHeader||"Header"===e.title)&&!0===e.global})}function b(e){return 0!==v(e).length}function y(e){var t=!1,n=!1;return 0!==_.filter(e,function(e){return e&&e.name&&e.components&&(t="footer"===e.name.toLowerCase(),n=0!==_.where(e.components,{type:"footer"}).length),t||n}).length}function w(e){return(!0===e.globalHeader||"Header"===e.title)&&!0===e.global}function C(e){return w(e)&&b(A.page.sections)&&(e.global=!1),e}function S(e){var t=a.defer(),n=new Image;return n.onerror=function(){t.resolve(!1)},n.onload=function(){t.resolve(!0)},n.src=e,t.promise}function k(e,t,n){var a=A.compiledElements[e][t][n];a&&(a.remove(),a=null,delete A.compiledElements[e][t][n])}function T(e,t,n){var a;try{a=A.compiledElementEditControls[e][t][n]}catch(e){a=null}a&&(a.remove(),a=null,delete A.compiledElementEditControls[e][t][n])}function P(){A.deletedNavLinks=[]}function D(e){return e&&"Donate Button"===e.title}var A={},x="/api/1.0/cms/website/",I="/api/1.0/cms/component/",E="/api/1.0/cms/template/",M="/api/2.0/cms/websites/",B="/api/2.0/cms/pages/",O="/api/2.0/cms/templates/",L="/api/2.0/cms/sitetemplates/",F="/api/2.0/cms/themes/",j="/api/2.0/cms/sections/",U="/api/2.0/cms/components/",R="/api/2.0/cms/website/",N="/api/1.0/account/";return A.getSite=function(e){return u(n.get(M+e).success(function(e){A.website=e}).error(function(e){}))},A.getPage=function(e,t){return u(n.get(B+e).success(t?function(e){}:d).error(p))},A.getPages=function(){a.defer();return u(n.get(M+A.websiteId+"/pages").success(function(e){A.pages=e}).error(function(e){}))},A.loadDataFromPage=function(e){var t=$(e).html(),n={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#x2F;":"/","&apos;":"'"};return JSON.parse(function(e){return String(e).replace(/(&amp;|&lt;|&gt;|&quot;|&#39;|&#x2f;|&apos;)/g,function(e){return n[e]||e})}(t))},A.getPagesWithSections=function(){return u(n.get(R+A.websiteId+"/pages").success(function(e){}).error(function(e){}))},A.savePage=function(e,t){return t||(e.ssb=!0),u(n({url:B+e._id,method:"POST",data:angular.toJson(e)}).success(t?function(t){A.pages&&A.pages[e.handle]&&t.title&&(A.pages[e.handle].title=t.title)}:d).error(p))},A.saveWebsite=function(e){return u(n({url:M+e._id,method:"POST",data:angular.toJson(e)}).success(function(e){A.website=e}).error(function(e){}))},A.updateScriptResource=function(e){return u(n({url:M+e._id+"/userScripts",method:"POST",data:angular.toJson(e)}).success(function(e){A.website=e}).error(function(e){}))},A.setActiveSection=function(e){A.activeSectionIndex=e},A.setActiveComponent=function(e){A.activeComponentIndex=e},A.activeSectionIndex=void 0,A.activeComponentIndex=void 0,A.getPlatformSections=function(){return u(n({url:j+"platform",method:"GET"}).success(function(e){A.platformSections=e}).error(function(e){}))},A.getPlatformComponents=function(){return u(n({url:U,method:"GET"}).success(function(e){var t=[];e.forEach(function(e){t.push(g(e))}),a.all(t).then(function(e){A.platformComponents=e.map(function(e){return e.data})})}).error(function(e){}))},A.getComponent=g,A.getSection=function(e,t){var o=a.defer();return-1===e.type.indexOf("ssb-")?h(e,e.version).then(function(e){o.resolve(e)}):u(n({url:j+e._id,method:"GET"}).success(function(e){o.resolve(e)}).error(function(e){o.reject(e)})),u(o.promise)},A.getUserSections=function(){return u(n({url:j+"user",method:"GET"}).success(function(e){A.userSections=e}).error(function(e){}))},A.checkForDuplicatePage=function(e){return u(n({url:x+A.website._id+"/page/"+e,method:"GET"}).success(function(e){}).error(function(e){}))},A.loading={value:0},A.websiteLoading=!1,A.getThemes=function(){return u(n({url:F,method:"GET"}).success(function(e){A.themes=e}).error(function(e){}))},A.setupTheme=function(){return A.getThemes().then(function(e){var t,n=e.data.filter(function(e){return e._id===A.website.themeId})[0]||{};n._id?A.applyThemeToSite(n):(t=e.data.filter(function(e){return"default"===e.handle})[0]||{},A.applyThemeToSite(t,!1),A.website.themeId=t._id,A.saveWebsite(A.website))})},A.applyThemeToSite=function(t,n){var a=e.$watch(function(){return angular.isDefined(window.WebFont)},function(e,i){if(e){var s=["Roboto:200,400,700","Roboto Condensed:200,400,700","Roboto Slab:200,400,700","Oswald:200,400,700","Montserrat:200,400,700","Droid Serif:200,400,700","Open Sans:200,400,700","Open Sans Condensed:200,400,700","Lato:200,400,700","Raleway:200,400,700","Quicksand:200,400,700","Ubuntu:200,400,700","Merriweather:200,400,700","Quattrocento:200,400,700","Lora:200,400,700","Playfair Display:200,400,700","Pacifico:200,400,700","Satisfy:200,400,700","Parisienne:200,400,700","Petit Formal Script:200,400,700","Indie Flower:200,400,700","Shadows Into Light Two:200,400,700","Amatic SC:200,400,700","Delius Swash Caps:200,400,700","Itim:200,400,700","Neucha:200,400,700","Patrick Hand SC:200,400,700","Schoolbell:200,400,700","PT Sans:200,400,700","Nunito:200,400,700","Cinzel:200,400,700"];if(t.name&&t.hasCustomFonts){var r=t.defaultFontStack.split(",")[0].replace(/"/g,"");-1===s.indexOf(r)&&s.push(r)}window.WebFont.load({google:{families:s}}),a(),A.website.themeId=t._id,A.website.theme=t,(n||!A.website.themeOverrides||A.website.themeOverrides&&!angular.isDefined(A.website.themeOverrides.styles))&&o(function(){A.website.themeOverrides=t},0),A.websiteLoading||o(function(){A.websiteLoading=!0},100)}});window.WebFontConfig={active:function(){sessionStorage.fonts=!0}}},A.createPage=function(e){return u(n({url:M+A.website._id+"/page/",method:"POST",data:{templateId:e}}).success(function(e){}).error(function(e){}))},A.createDuplicatePage=function(e){return u(n({url:M+A.website._id+"/duplicate/page/",method:"POST",data:angular.toJson(e)}).success(function(e){}).error(function(e){}))},A.getTemplates=function(){return u(n({url:O,method:"GET"}).success(function(e){A.templates=e.sort(function(e,t){return e.modified.date>t.modified.date})}).error(function(e){}))},A.getSiteTemplates=function(){return u(n({url:L,method:"GET"}).success(function(e){A.siteTemplates=e}).error(function(e){}))},A.setSiteTemplate=function(e){return u(n({url:M+A.website._id+"/sitetemplates/"+e._id,method:"POST",data:{siteTemplateId:e._id,siteThemeId:e.siteThemeId,siteThemeOverrides:e.siteThemeOverrides}}).success(function(e){}).error(function(e){}))},A.getTemplateById=function(e){return _.where(A.templates,{_id:e})},A.getLegacyTemplates=function(){return u(n({url:E,method:"GET"}).success(function(e){A.legacyTemplates=e}).error(function(e){}))},A.addSectionToPage=function(e,t,n,o,i){var s,r,c,l=!1,u=a.defer();return A.page.sections?l=y(A.page.sections):A.page.sections=[],r=A.page.sections.length,s=l?r-1:r,void 0===i?c=A.getSection(e,t||1).then(function(e){if(e)if(angular.isDefined(n)){var t=A.extendComponentData(o,e);A.setActiveSection(null),A.page.sections.splice(n,1,t),A.setActiveSection(n),A.setActiveComponent(null)}else{var a=C(e),i=A.setTempUUIDForSection(a);A.page.sections.splice(s,0,i),A.setActiveSection(s),A.setActiveComponent(null)}}):(e=C(e),A.page.sections.splice(i,0,e),A.setActiveSection(i),u.resolve(),c=u.promise),c},A.addSectionToPageToIndex=function(e,t){var n,o,i=!1;a.defer();return A.page.sections?i=y(A.page.sections):A.page.sections=[],o=A.page.sections.length,n=i?o-1:o,angular.isDefined(t)&&(n=t),A.getSection(e,1).then(function(e){if(e){var t=C(e),a=A.setTempUUIDForSection(t);A.page.sections.splice(n,0,a),A.setActiveSection(n),A.setActiveComponent(null)}})},A.removeSectionFromPage=function(e){"ssb-layout__header_2-col_footer"===A.page.layout&&A.page.layoutModifiers&&A.removeSectionFromLayoutArea(e),A.page.sections.splice(e,1),A.setActiveSection(null),A.setActiveComponent(null)},A.removeSectionFromLayoutArea=function(e){var t=!1,n=_.filter(A.page.layoutModifiers._layoutAreas,function(t){return-1!==A.page.layoutModifiers[t].indexOf(e)})[0],a=A.page.layoutModifiers[n].indexOf(e);A.page.layoutModifiers[n].splice(a,1),_.each(A.page.layoutModifiers._layoutAreas,function(e){e===n&&(t=!0),t&&(A.page.layoutModifiers[e]=_.map(A.page.layoutModifiers[e],function(e){return e-1}))})},A.getSpectrumColorOptions=function(){return{showPalette:!0,showAlpha:!0,clickoutFiresChange:!0,showInput:!0,showButtons:!0,allowEmpty:!0,hideAfterPaletteSelect:!1,showPaletteOnly:!1,togglePaletteOnly:!0,togglePaletteMoreText:"more",togglePaletteLessText:"less",preferredFormat:"hex",appendTo:"body",palette:[["#C91F37","#DC3023","#9D2933","#CF000F","#E68364","#F22613","#CF3A24","#C3272B","#8F1D21","#D24D57"],["#f47998","#F47983","#DB5A6B","#C93756","#FCC9B9","#FFB3A7","#F62459","#F58F84","#875F9A","#5D3F6A"],["#89729E","#763568","#8D608C","#A87CA0","#5B3256","#BF55EC","#8E44AD","#9B59B6","#BE90D4","#4D8FAC"],["#5D8CAE","#22A7F0","#19B5FE","#59ABE3","#48929B","#317589","#89C4F4","#4B77BE","#1F4788","#003171"],["#044F67","#264348","#7A942E","#8DB255","#5B8930","#6B9362","#407A52","#006442","#87D37C","#26A65B"],["#26C281","#049372","#2ABB9B","#16A085","#36D7B7","#03A678","#4DAF7C","#D9B611","#F3C13A","#F7CA18"],["#E2B13C","#A17917","#F5D76E","#F4D03F","#FFA400","#E08A1E","#FFB61E","#FAA945","#FFA631","#FFB94E"],["#E29C45","#F9690E","#CA6924","#F5AB35","#BFBFBF","#F2F1EF","#BDC3C7","#ECF0F1","#D2D7D3","#757D75"],["#EEEEEE","#ABB7B7","#6C7A89","#95A5A6","#9ACCCB","#E8E7E7","#000000","#FFFFFF","#50c7e8"]]}},A.getFontFamilyOptions=function(){return{"'Arial',Helvetica,sans-serif":"Arial","'Amatic SC', cursive":"Amatic SC","'Berlin', sans-serif":"Berlin","'Calibri','Open Sans',sans-serif":"Calibri","'Cinzel',serif":"Cinzel","'Delius Swash Caps', cursive":"Delius Swash Caps","'Droid Serif',serif":"Droid Serif","'Georgia',serif":"Georgia","'Helvetica Neue', Helvetica, Arial, sans-serif":"Helvetica Neue","'Impact',Charcoal,sans-serif":"Impact","'Indie Flower', cursive":"Indie Flower","'Itim', cursive":"Itim","'Lato',sans-serif":"Lato","'Lora',serif":"Lora","'Merriweather',serif":"Merriweather","'Montserrat',sans-serif":"Montserrat","'Montserrat:200',sans-serif":"Montserrat Light","'Neucha',cursive":"Neucha","'Open Sans Condensed',sans-serif":"Open Sans Condensed","'Open Sans',sans-serif":"Open Sans","'Oswald',sans-serif":"Oswald","'Pacifico',cursive":"Pacifico","'Parisienne', cursive":"Parisienne","'Patrick Hand SC', cursive":"Patrick Hand SC","'Playfair Display',serif":"Playfair Display","'Petit Formal Script', cursive":"Petit Formal Script","'Quattrocento',serif":"Quattrocento","'Quicksand',sans-serif":"Quicksand","'PT Sans',sans-serif":"PT Sans","'Raleway',sans-serif":"Raleway","'Roboto Condensed',sans-serif":"Roboto Condensed","'Roboto Slab',serif":"Roboto Slab","'Roboto',sans-serif":"Roboto","'Satisfy', cursive":"Satisfy","'Schoolbell', cursive":"Schoolbell","'Shadows Into Light Two', cursive":"Shadows Into Light Two","'Tahoma',Geneva,sans-serif":"Tahoma","'Times New Roman',Times,serif":"Times New Roman","'Trebuchet MS'":"Trebuchet MS","'Ubuntu',sans-serif":"Ubuntu","'Verdana',Geneva,sans-serif":"Verdana"}},A.getFontWeightOptions=function(){return{bold:"bold",bolder:"bolder",normal:"normal",lighter:"Lighter"}},A.bodyFontWeightOptions=function(){return{200:"Light",400:"Normal",700:"Bold"}},A.getLocationFinderRanges=function(){return[{description:"5 miles",value:5},{description:"10 miles",value:10},{description:"25 miles",value:25},{description:"50 miles",value:50},{description:"100 miles",value:100},{description:"200 miles",value:200}]},A.deletePage=function(e){return u(n({url:B+e._id,method:"DELETE",data:angular.toJson(e)}).success(function(t){delete A.pages[e.handle]}).error(function(e){}))},A.openMediaModal=function(e,t,n,a,o,i,s,c,l){A.asset=void 0;var u={templateUrl:e,keyboard:!0,backdrop:"static",size:"md",resolve:{vm:function(){return o},showInsert:function(){return!0},insertMedia:function(){return function(e){i?A.setMediaForComponent(e,i,s,c,l):A.asset=e}},component:function(){return i},componentItemIndex:function(){return s},update:function(){return c},isSingleSelect:function(){return!0}}};return t&&(u.controller=t),a&&(u.size="lg"),r.open(u)},A.setMediaForComponent=function(t,n,a,o,i){var s=n.type;"image-text"===s?n.imgurl=t.url:"image-gallery"===s?S(t.url).then(function(s){!1!==s&&(o?n.images[a].url=t.url:(e.$broadcast("$refreshSlickSlider",a+1),n.images.splice(a+1,0,{url:t.url,title:'<span style="font-size: 30px;">Service Title Here</span>'}),i&&n.images[a+1]&&angular.forEach(i,function(e,t){n.images[a+1][t]=e})))}):"thumbnail-slider"===s?S(t.url).then(function(e){!1!==e&&(o?(n.thumbnailCollection[a].url=t.url,n.thumbnailCollection[a].img="<img src='"+t.url+"'/>"):n.thumbnailCollection.splice(a+1,0,{url:t.url,img:"<img src='"+t.url+"'/>"}))}):"meet-team"===s&&(n.teamMembers[a].profilepic=t.url)},A.extendComponentData=function(e,t){var n=["$$hashKey","anchor","version","type","layout","visibility","bg","border","layoutModifiers","componentSortOrder","thumbnailCollection"],a=["$$hashKey","anchor","accountId","version","type","layout","visibility","bg","border","layoutModifiers","componentSortOrder","thumbnailCollection","nav"],o=angular.copy(t.components),i=l(o,t),s=_(angular.copy(e.components)).chain().sortBy(function(e){return i[e.type]&&parseInt(i[e.type],10)}).value();if(t.componentSortOrder){var r=angular.copy(l(o));o=_(o).chain().sortBy(function(e){return i[e.type]&&parseInt(i[e.type],10)}).value()}return delete t.components,delete e.components,t.componentSortOrder?(t.components=_.map(o,function(e,t){var n=_.findWhere(s,{type:e.type});return $.extend({},e,_.omit(n||s[t],a))}),t.components=_(t.components).chain().sortBy(function(e){return r[e.type]&&parseInt(r[e.type],10)}).value()):D(t)?t.components=_.map(o,function(e,t){var n=_.findWhere(s,{type:e.type});return $.extend({},e,_.omit(n||s[t],a))}):t.components=_.map(o,function(e,t){return $.extend({},e,_.omit(s[t],a))}),$.extend({},t,_.omit(e,n))},A.getTempUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},A.setTempUUIDForSection=function(e){var t=angular.copy(e);return t._id=A.getTempUUID(),t.anchor=t._id,t.components.length&&t.components.forEach(function(e){e._id=A.getTempUUID(),e.anchor=e._id,angular.isObject(e.elementStyles)&&Object.keys(e.elementStyles).length&&_.each(e.elementStyles,function(e){e&&(delete e._id,delete e.id,delete e.anchor)})}),t=JSON.parse(angular.toJson(t))},A.setPermissions=function(){var t=e.$watch(function(){return angular.isDefined($.FroalaEditor)&&angular.isObject($.FroalaEditor.config)},function(e){e&&(t(),o(function(){!0===A.account.showhide.editHTML&&-1===$.FroalaEditor.config.toolbarButtons.indexOf("html")&&($.FroalaEditor.config.toolbarButtons.push("html"),A.permissions.html=!0,$.getScript("//cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/codemirror.min.js",function(){$.getScript("//cdnjs.cloudflare.com/ajax/libs/codemirror/5.12.0/mode/xml/xml.min.js",function(){})}))}))});A.account.showhide.ssbFeatureFixedElements&&(A.permissions.ssbFeatureFixedElements=!0)},A.addCompiledElement=function(e,t,n,a){A.compiledElements[e]=A.compiledElements[e]||{},A.compiledElements[e][t]=A.compiledElements[e][t]||{},A.compiledElements[e][t][n]=a},A.addCompiledElementEditControl=function(e,t,n,a){A.compiledElementEditControls[e]=A.compiledElementEditControls[e]||{},A.compiledElementEditControls[e][t]=A.compiledElementEditControls[e][t]||{},A.compiledElementEditControls[e][t][n]=a},A.getCompiledElement=function(e,t,n){return angular.element("#"+e+" [data-compiled="+n+"]")},A.getCompiledElementEditControl=function(e,t,n){return A.compiledElementEditControls[e]&&A.compiledElementEditControls[e][t]&&A.compiledElementEditControls[e][t][n]},A.compileEditorElements=function(n,a,o,i,s){a&&(A.compiledElements[o]=A.compiledElements[o]||{},A.compiledElements[o][i]={}),n.$el.find(".ssb-theme-btn").each(function(){var n,r=$(this);(a||void 0===r.attr("data-compiled"))&&(r.removeClass("ssb-theme-btn-active-element"),r.attr("ng-class","vm.elementClass()"),r.attr("ng-attr-style","{{vm.elementStyle()}}"),r.removeClass("ng-scope"),n=r.get(0).outerHTML.replace("ng-scope",""),t(n)(s,function(t,n){var a=A.getTempUUID();t.attr("data-compiled",a),r.replaceWith(t),A.addCompiledElement(o,i,a,angular.element("[data-compiled="+a+"]")),e.$broadcast("$ssbElementAdded",o,i,a)}))}),Object.keys(A.compiledElements[o][i]).forEach(function(t){0===n.$el.find("[data-compiled="+t+"]").length&&e.$broadcast("$ssbElementRemoved",o,i,t)}),e.$broadcast("$ssbElementsChanged",o,i)},A.addUnderNavSetting=function(e,t){var n={allowUndernav:!1,navComponent:null};A.page&&A.page.sections&&A.page.sections.forEach(function(t,a){t.components.forEach(function(t){if(t&&"masthead"===t.type&&t._id==e&&A.page.sections[a-1]){var o=_.findWhere(A.page.sections[a-1].components,{type:"navigation"});0!==a&&void 0!==o?(n.allowUndernav=!0,n.navComponent=o):n.allowUndernav=!1}})}),t(n)},A.contentComponentDisplayOrder=[],A.inValidPageHandles=c.inValidPageHandles,A.getPageVersions=function(e,t){return u(n({url:B+[e,"versions"].join("/"),method:"GET"}).success(function(e){t(e)}).error(function(e){}))},A.publishPage=function(e){return u(n({url:B+[e,"publish"].join("/"),method:"POST"}).success(function(e){}).error(function(e){}))},A.revertPage=function(e,t,a){return u(n({url:B+[e,"version",t].join("/"),method:"POST"}).success(function(e){a(e)}).error(function(e){}))},A.updateBlogPages=function(){return u(n({url:M+[A.websiteId,"updateBlogPages"].join("/"),method:"POST"}).success(function(e){}).error(function(e){}))},A.permissions={},A.compiledElements={},A.compiledElementEditControls={},A.detectIENotEdge=function(){var e=window.navigator.userAgent;if(e.indexOf("MSIE ")>0)return!0;if(e.indexOf("Trident/")>0)return!0;e.indexOf("Edge/");return!1},A.isIENotEdge=A.detectIENotEdge(),A.getBlogListPage=function(){return _.where(A.pages,{handle:"blog-list"})},A.getBlogPostPage=function(){return _.where(A.pages,{handle:"blog-post"})},A.returnInvalidPost=function(){var e=a.defer();return e.resolve(!1),e.promise},A.checkAndSetGlobalHeader=C,A.checkDuplicateGlobalHeader=function(e){var t=!1;if(e&&(!0===e.globalHeader||"Header"===e.title)){var n=v(A.page.sections);n&&n.length&&(t=-1===_.findIndex(n,{_id:e._id}))}return t},A.getTempComponent=function(e){return g(e,e.version||1).then(function(e){return e.data})},A.deletedNavLinks=[],A.setDeletedPageFromLinkList=function(e){"blog"===e&&(e="blog-list"),A.deletedNavLinks.push(e)},A.saveOtherPageLinks=function(){if(A.deletedNavLinks.length)return u(n({url:B+"update/linked/navigation",method:"POST",data:angular.toJson(A.deletedNavLinks)}).success(function(e){P()}).error(p))},A.getAccount=function(){i.getAccount(function(e){A.account=null,o(function(){A.account=e},0)})},A.isImage=S,A.getAccountTemplates=function(){return u(n({url:N+"templates",method:"GET"}).success(function(e){A.accountTemplates=e}).error(function(e){}))},A.copyAccountTemplate=function(e){return u(n({url:N+e+"/copy",method:"POST"}).success(function(e){}).error(function(e){}))},A.contentSectionDisplayOrder=["navigation","welcome hero","products & services","donations","forms","gallery","text","video","mixed content","team","testimonials","contact","social","footer","blog","misc"],A.contentSectionIcons={navigation:{icon:"fa-reorder"},"welcome hero":{icon:"fa-bullhorn"},"products & services":{icon:"fa-shopping-cart"},donations:{icon:"fa-heart-o"},forms:{icon:"fa-at"},gallery:{icon:"fa-file-image-o"},text:{icon:"fa-text-width"},video:{icon:"fa-video-camera"},"mixed content":{icon:"fa-object-ungroup"},team:{icon:"fa-users"},testimonials:{icon:"fa-commenting"},contact:{icon:"fa-map-marker"},social:{icon:"fa-thumbs-o-up"},footer:{icon:"fa-copyright"},blog:{icon:"fa-rss"},misc:{icon:"fa-puzzle-piece"},all:{icon:"fa-sort-amount-asc"}},A.manageComponentIcons={navigation:{icon:"fa-align-justify"},"social-link":{icon:"fa-bullhorn"},text:{icon:"fa-text-height"},image:{icon:"fa-file-image-o"},"ssb-image":{icon:"fa-file-image-o"},"ssb-text":{icon:"fa-text-height"}},e.$on("$ssbElementAdded",function(e,t,n,a){}),e.$on("$ssbElementRemoved",function(e,t,n,a){k(t,n,a),T(t,n,a)}),e.$on("$ssbAccountUpdated",function(e,t){i.getAccount(function(e){A.account=null,o(function(){A.account=e},0)})}),i.getAccount(function(e){A.account=e,A.setPermissions(),A.websiteId=e.website.websiteId,A.getSite(e.website.websiteId).then(function(e){A.setupTheme(e)}),A.getPages(),A.getTemplates(),A.getLegacyTemplates(),A.getPlatformSections()}),A}app.factory("SimpleSiteBuilderService",e),e.$inject=["$rootScope","$compile","$http","$q","$timeout","AccountService","WebsiteService","$modal","pageConstant"]}(),function(){"use strict";app.directive("ssbSiteTemplates",function(){return{restrict:"E",scope:{},templateUrl:"assets/js/ssb-site-builder/ssb-site-templates/ssb-site-templates.component.html",controller:"SiteBuilderSiteTemplatesController",controllerAs:"vm",bindToController:!0,link:function(e,t,n,a){a.init(t)}}})}(),function(){function e(e,t,n,a,o,i,s,r,c,l,u){var d=this;d.init=function(e){d.element=e,d.getSiteTemplates(),null===i.pages&&i.getPages()},d.selectSiteTemplate=function(e){d.uiState.loading=!0,i.setSiteTemplate(e).then(function(e){e.data.ok&&e.data.indexPageId&&(i.getPages(),i.getSite(d.state.website._id).then(function(){i.setupTheme(d.state.website).then(function(){o(function(){c.path("/website/site-builder/pages/"+e.data.indexPageId)},500),o(function(){d.uiState.loading=!1},5e3)})}))})},d.getSiteTemplates=function(){i.getSiteTemplates().then(function(e){e.data&&(d.state.siteTemplates=e.data.reverse())})},d.redirectToEditor=function(){var e="",t=null,n=[];d.state.pages&&(n=Object.keys(d.state.pages)),n.length&&(e=(t=_.filter(d.state.pages,function(e){return"index"===e.handle})[0])&&t._id?t._id:d.state.pages[n[0]]._id),e?c.path("/website/site-builder/pages/"+e):d.uiState.loading=!1},d.state={},d.uiState={loading:!0};var p=e.$watchGroup([function(){return i.pages},function(){return i.website}],function(e){var t=e[0],n=e[1];t&&(t=_.reject(t,function(e){return"blog"===e.handle||"single-post"===e.handle||"coming-soon"===e.handle||"signup"===e.handle||"blog-list"===e.handle||"blog-post"===e.handle})),t&&n&&n._id&&(p(),d.state.pages=t,d.state.website=n,0!==Object.keys(t).length||n.siteTemplateId?d.redirectToEditor():d.uiState.loading=!1)},!0)}app.controller("SiteBuilderSiteTemplatesController",e),e.$inject=["$scope","$attrs","$filter","$document","$timeout","SimpleSiteBuilderService","$modal","editableOptions","$location","SweetAlert","ContactService"]}(),function(e){app.controller("usersCtrl",["$scope","toaster","$filter","$modal","$timeout","AccountService","UserService","userConstant","formValidations","SweetAlert","pagingConstant",function(t,n,a,o,i,s,r,c,l,u,d){"use strict";function p(){s.getUsersByAccount(g.state.account._id,function(e){e=_.reject(e,function(e){return e.username==g.state.adminUserName}),g.state.users=e,g.uiState.loading=!1,g.uiState.isAdminUser=g.state.account.ownerUser==t.currentUser._id||t.currentUser.username==g.state.adminUserName||m()})}function m(){var e=_.find(t.currentUser.accounts,function(e){return e.accountId==g.state.account._id});return e&&e.permissions&&_.contains(e.permissions,"admin")}var g=this;g.state={adminUserName:c.admin_user.userName,adminUserEmailFilter:c.admin_user.emailDomain},g.uiState={loading:!0},g.openSimpleModal=function(n){var a={templateUrl:n,scope:t,keyboard:!0,backdrop:"static"};t.modalInstance=o.open(a),t.modalInstance.result.then(null,function(){e.element(".sp-container").addClass("sp-hidden")})},g.removeUserFromAccount=function(e){u.swal({title:"Are you sure?",text:"You want to delete this user.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0},function(t){t&&s.removeUserFromAccount(e,function(t,a){t?n.pop("warning",t.message):g.state.users=_.filter(g.state.users,function(t){if(t._id!==e)return!0})})})},s.getUpdatedAccount(function(e){g.state.account=e,p()}),g.pagingConstant=d,t.$watch("vm.state.users",function(e){e&&(g.state.filterUsers=_.filter(e,function(e){return-1===e.username.indexOf(g.state.adminUserEmailFilter)}))},!0),t.addNewUser=function(){r.findUserByUsername(t.newuser.username,function(e,a){e?n.pop("warning",e.message):a?s.copyExitingUser(a._id,function(e,a){e?n.pop("warning",e.message):(i(function(){g.state.users.push(a)},0),t.closeModal())}):s.addNewUser(g.state.account._id,t.newuser.username,t.newuser.password,function(e,a){e?n.pop("warning",e.message):(i(function(){g.state.users.push(a)},0),t.closeModal())}),t.newuser=null})},t.closeModal=function(){t.modalInstance.close()},t.openEditUserModal=function(e){t.currentUserId=e,g.openSimpleModal("edit-password-modal")},t.closeEditUserModal=function(){t.currentUserId=null,t.closeModal()},t.checkPasswordLength=function(){t.passwordInValid=!1,t.edituser&&t.edituser.password1&&t.edituser.password1.length<6?t.passwordInValid=!0:t.newuser&&t.newuser.password.length<6?t.passwordInValid=!0:t.passwordInValid=!1},t.setUserPassword=function(e){t.checkPasswordLength(),t.passwordInValid||s.setUserPassword(e,t.edituser.password1,function(e,a){e?n.pop("warning",e.message):(n.pop("info","Successfully changed password"),t.closeEditUserModal())})},t.checkIfValidUserName=function(e){return l.email.test(e)},g.getters={name:function(e){return e.first||""+e.last||""},ip:function(e){return e.lastLoginIP||""},loginDate:function(e){return e.lastLoginDate||""}}}])}();