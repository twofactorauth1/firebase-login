<div class="margin-top-20 activity-timeline">
    <h3>Activity Timeline</h3>
    <div class="activity-filter">
    	<span>Filter</span>
		<select ng-model="vm.state.activityFilter.type" class="form-control" ng-options="type.data as type.label for type in vm.state.contactConstant.contact_activity_types.dp" ng-change="vm.filterContactActivities()">
        </select>
    	<span>Sort</span>
    	<select id="select_activity_type" ng-model="vm.state.activityFilter.sort" class="form-control" ng-change="vm.filterContactActivities()">
			<option value="asc">ASC</option>
            <option value="desc">DESC</option>
        </select>
		<button type="button" class="btn btn-info btn-o pull-right" ng-click="vm.uiState.showNote = !vm.uiState.showNote">
            <span ng-show="!vm.uiState.showNote">Add a Note</span>
            <span ng-show="vm.uiState.showNote">Cancel</span>
        </button>
    </div>
    <hr />
	<div ng-if="vm.uiState.showNote">
        <label for="newNote"> New Note</label>
        <textarea id="newNote" class="form-control margin-bottom-15 autosize area-animated msd-elastic: \n;" ng-model="vm.newNote.text"></textarea>
        <div class="checkbox clip-check check-success margin-top-10" ng-if="vm.state.contact.details[0].emails[0].email">
            <input type="checkbox" id="note-editable" ng-model="vm.notesEmail.enable" >
            <label for="note-editable">
                Send New Note to Contact
            </label>
        </div>
        <button type="button" ng-disabled="!(vm.newNote.text)" class="btn btn-info btn-block btn-o btn-wide btn-scroll btn-scroll-top ti-plus" ng-click="vm.addNote(vm.newNote.text)">
            <span>Add</span>
        </button>
        <hr />
    </div>
    	
    <div>
		<div ng-if="!vm.state.filteredActivities.length">
            <div class="panel panel-transparent" ng-if="!vm.uiState.loading">
                <div class="panel-body">
                    <h4 class="center"><span class="fa fa-comment fa-2x"></span> <br><br> No Activity Availiable</h4>
                </div>
            </div>
            <div class="center" ng-if="vm.uiState.loading" style="
			    height: 200px;
			    margin-top: 100px;">
			    <h4>
			    	Loading activities...
			    </h4>
			</div>
        </div>
    	<div ng-if="vm.state.filteredActivities.length" ng-repeat="(key, value) in vm.state.groupedActivities">
    		<div id="panel_0">
    			<div class="panel-heading border-light padding-0 panel-activity">
		            <h4 class="">{{value[0].activityDate}}</h4>		            
		            <ct-paneltool class="panel-tools" tool-collapse="tool-collapse"></ct-paneltool>
	        	</div>
	        	<div collapse="panel_0">
	        		<ul class="timeline-xs">
		                <li class="timeline-item success padding-bottom-20 {{vm.getTimelineIcons(activity.activityType, false)}}" ng-repeat="activity in value | orderBy:activity.start:true">
		                	<i ng-if="activity.activityType !== 'USER_NOTES'" class="fa fa-1 fa-{{vm.getTimelineIcons(activity.activityType, true)}}"></i>
		                	<img ng-if="activity.activityType === 'USER_NOTES'" src="{{activity.user.user_profile_photo.url ? activity.user.user_profile_photo.url : activity.user.user_profile_photo ? activity.user.user_profile_photo : '/admin/assets/images/default-user.png'}}" class="img-circle">
		                    <div class="margin-left-30 padding-15 activity-content">
		                        <div class="text-muted text-small">
		                            {{activity.start | date:'MMM d, yy h:mm:ss a'}} {{getActivityName(activity.activityType)}}
		                        </div>
		                        <p>
		                            <div ng-switch on="activity.activityType">
		                                <div ng-switch-when="OTHER">
		                                    <p>
		                                        <span class="label label-default">OTHER</span> {{activity.detail}}
		                                    </p>
		                                </div>
		                                <div ng-switch-when="EMAIL">
		                                    <p>
		                                        <span class="label label-default">EMAIL SENT</span> {{activity.detail}}
		                                    </p>
		                                    <p>
		                                        An email was sent
		                                    </p>
		                                </div>

		                                <div ng-switch-when="CONTACT_CREATED">
		                                    <p>
		                                        <span class="label label-info">CONTACT CREATED</span> for
		                                        <span ng-if="!vm.state.contact">[deleted]</span>
		                                        <span ng-if="vm.state.contact.first">{{vm.state.contact.first.toString()+' '+vm.state.contact.last.toString()}}</span>
		                                        <span ng-if="!vm.state.contact.first">{{vm.state.contact.details[0].emails[0].email}}</span>.
		                                    </p>
		                                    <p ng-if="activity.detail">
		                                        {{activity.detail}}
		                                    </p>
		                                </div>
		                                <div ng-switch-when="ACCOUNT_CREATED">
		                                    <p>
		                                        <span class="label label-info">CONTACT CREATED</span> for
		                                        <span ng-if="!vm.state.contact">[deleted]</span>
		                                        <span ng-if="vm.state.contact.first">{{vm.state.contact.first.toString()+' '+vm.state.contact.last.toString()}}</span>
		                                        <span ng-if="!vm.state.contact.first">{{vm.state.contact.details[0].emails[0].email}}</span>.
		                                    </p>
		                                    <p ng-if="activity.detail">
		                                        {{activity.detail}}
		                                    </p>
		                                </div>
		                                <div ng-switch-when="SUBSCRIBE">
		                                    <p>
		                                        <span class="label label-success">SUBSCRIBE</span> for
		                                        <span ng-if="!vm.state.contact">[deleted]</span>
		                                        <span ng-if="vm.state.contact.first">{{vm.state.contact.first.toString()+' '+vm.state.contact.last.toString()}}</span>
		                                        <span ng-if="!vm.state.contact.first">{{vm.state.contact.details[0].emails[0].email}}</span>subscribed to <a href="">{{activity.extraFields.plan_name}}</a> for ${{activity.extraFields.amount}}.
		                                    </p>
		                                    <p ng-if="activity.detail">
		                                        {{activity.detail}}
		                                    </p>
		                                </div>
		                                <div ng-switch-when="TRIAL_CONVERSION">
		                                    <p>
		                                        <span class="label label-success">Trial Conversion</span>
		                                        <span ng-if="!vm.state.contact">[deleted]</span>
		                                        <span ng-if="vm.state.contact.first">{{vm.state.contact.first.toString()+' '+vm.state.contact.last.toString()}}</span>
		                                        <span ng-if="!vm.state.contact.first">{{vm.state.contact.details[0].emails[0].email}}</span> subscribed to <a href="">{{activity.extraFields.plan_name}}</a> for ${{activity.extraFields.amount}}.
		                                    </p>
		                                    <p ng-if="activity.detail">
		                                        {{activity.detail}}
		                                    </p>
		                                </div>
		                                <div ng-switch-when="SUBSCRIBE_CANCEL">
		                                    <p>
		                                        <span class="label label-danger">SUBSCRIPTION CANCELED</span> for
		                                        <span ng-if="!vm.state.contact">[deleted]</span>
		                                        <span ng-if="vm.state.contact.first">{{vm.state.contact.first.toString()+' '+vm.state.contact.last.toString()}}</span>
		                                        <span ng-if="!vm.state.contact.first">{{vm.state.contact.details[0].emails[0].email}}</span>.
		                                    </p>
		                                    <p ng-if="activity.detail">
		                                        {{activity.detail}}
		                                    </p>
		                                </div>
		                                <div ng-switch-when="PAGE_VIEW">
		                                    <p>
		                                        <span class="label label-default">PAGE VIEW</span>
		                                    </p>
		                                    <span ng-if="!vm.state.contact">[deleted]</span>
		                                    <p ng-if="vm.state.contact && vm.state.contact.first">
		                                        {{vm.state.contact.first.toString()+' '+vm.state.contact.last.toString()}} viewed {{activity.attributes.page}} for {{activity.attributes.timespent}}.</p>
		                                    <p ng-if="vm.state.contact && !vm.state.contact.first && vm.state.contact.details[0].emails[0]">
		                                        {{vm.state.contact.details[0].emails[0].email}} viewed {{activity.attributes.page}} for {{activity.attributes.timespent}}.</p>
		                                    <p ng-if="vm.state.contact && !vm.state.contact.first && !vm.state.contact.details[0].emails[0]">
		                                        Unknown viewed {{activity.attributes.page}} for {{activity.attributes.timespent}}.</p>
		                                    <p ng-if="activity.detail">
		                                        {{activity.detail}}
		                                    </p>
		                                </div>
		                                <div ng-switch-when="CONTACT_FORM">
		                                    <p>
		                                        <span class="label label-default">CONTACT FORM</span> was submitted with the data:
		                                        <ul class="form-values">
		                                            <li ng-repeat="(k,v) in activity.extraFields">
		                                                <b>{{k | formatText}}</b>: {{v}}
		                                            </li>
		                                        </ul>
		                                    </p>
		                                    <p ng-if="activity.detail">
		                                        {{activity.detail}}
		                                    </p>
		                                </div>
		                                <div ng-switch-when="FORM_SUBMISSION">
		                                    <p>
		                                        <span class="label label-info">FORM SUBMITTED</span> for
		                                        <span ng-if="!vm.state.contact">[deleted]</span>
		                                        <span ng-if="vm.state.contact.first">{{vm.state.contact.first.toString()+' '+vm.state.contact.last.toString()}}</span>
		                                        <span ng-if="!vm.state.contact.first">{{vm.state.contact.details[0].emails[0].email}}</span>.
		                                    </p>
		                                    <p ng-if="activity.detail">
		                                        {{activity.detail}}
		                                    </p>
		                                </div>
		                                <div ng-switch-when="EMAIL_DELIVERED">
		                                    <p>
		                                        <span class="label label-info">EMAIL DELIVERED</span>
		                                        <span ng-if='activity.extraFields[0].subject'>with subject "{{activity.extraFields[0].subject}}" to</span>
		                                        <span ng-if='!activity.extraFields[0].subject'>to</span>
		                                        <span ng-if="!vm.state.contact">[deleted]</span>
		                                        <span ng-if="vm.state.contact.first">{{vm.state.contact.first.toString()+' '+vm.state.contact.last.toString()}}</span>
		                                        <span ng-if="!vm.state.contact.first">{{vm.state.contact.details[0].emails[0].email}}</span>.
		                                    </p>
		                                    <p ng-if="activity.detail">
		                                        {{activity.detail}}
		                                    </p>
		                                </div>
		                                <div ng-switch-when="EMAIL_OPENED">
		                                    <p>
		                                        <span class="label label-info">EMAIL OPENED</span>
		                                        <span ng-if='activity.extraFields[0].subject'>with subject "{{activity.extraFields[0].subject}}" by</span>
		                                        <span ng-if='!activity.extraFields[0].subject'>by</span>
		                                        <span ng-if="!vm.state.contact">[deleted]</span>
		                                        <span ng-if="vm.state.contact.first">{{vm.state.contact.first.toString()+' '+vm.state.contact.last.toString()}}</span>
		                                        <span ng-if="!vm.state.contact.first">{{vm.state.contact.details[0].emails[0].email}}</span>.
		                                    </p>
		                                    <p ng-if="activity.detail">
		                                        {{activity.detail}}
		                                    </p>
		                                </div>
		                                <div ng-switch-when="EMAIL_CLICKED">
		                                    <p>
		                                        <span class="label label-info">EMAIL CLICKED</span>
		                                        <span ng-if='activity.extraFields[0].subject'>with subject "{{activity.extraFields[0].subject}}" by</span>
		                                        <span ng-if='!activity.extraFields[0].subject'>by</span>
		                                        <span ng-if="!vm.state.contact">[deleted]</span>
		                                        <span ng-if="vm.state.contact.first">{{vm.state.contact.first.toString()+' '+vm.state.contact.last.toString()}}</span>
		                                        <span ng-if="!vm.state.contact.first">{{vm.state.contact.details[0].emails[0].email}}</span>.
		                                    </p>
		                                    <p ng-if="activity.detail">
		                                        {{activity.detail}}
		                                    </p>
		                                </div>
		                                <div ng-switch-when="EMAIL_UNSUB">
		                                    <p>
		                                        <span class="label label-info">EMAIL UNSUBSCRIBE</span> for
		                                        <span ng-if="!vm.state.contact">[deleted]</span>
		                                        <span ng-if="vm.state.contact.first">{{vm.state.contact.first.toString()+' '+vm.state.contact.last.toString()}}</span>
		                                        <span ng-if="!vm.state.contact.first">{{vm.state.contact.details[0].emails[0].email}}</span>.
		                                    </p>
		                                    <p ng-if="activity.detail">
		                                        {{activity.detail}}
		                                    </p>
		                                </div>
		                                <div ng-switch-when="SUBSCRIPTION_PAID">
		                                    <p>
		                                        <span class="label label-info">SUBSCRIPTION PAID</span> for
		                                        <span ng-if="!vm.state.contact">[deleted]</span>
		                                        <span ng-if="vm.state.contact.first">{{vm.state.contact.first.toString()+' '+vm.state.contact.last.toString()}}</span>
		                                        <span ng-if="!vm.state.contact.first">{{vm.state.contact.details[0].emails[0].email}}</span>.
		                                    </p>
		                                    <p ng-if="activity.detail">
		                                        {{activity.detail}}
		                                    </p>
		                                </div>
		                                <div ng-switch-when="EMAIL_BOUNCED">
		                                    <p>
		                                        <span class="label label-info">EMAIL BOUNCED</span> for
		                                        
		                                        <span>{{activity.email}}</span>
		                                    </p>
		                                </div>
		                                <div ng-switch-when="CREATE_PAYPAL_ORDER">
		                                    <p>
		                                        <span class="label label-info">ORDER CREATED</span> with Order Id
		                                        
		                                        <span>'{{activity.extraFields.orderId}}'</span>
		                                    </p>
		                                </div>
		                                <div ng-switch-when="CREATE_ORDER">
		                                    <p>
		                                        <span class="label label-info">ORDER CREATED</span> with Order Id
		                                        
		                                        <span>'{{activity.extraFields.orderId}}'</span>
		                                    </p>
		                                </div>
		                                <div ng-switch-when="USER_NOTES">
		                                    <p>
		                                        <span class="label label-info">User Note</span> 
		                                        Note from 
		                                        <span ng-if="activity.user.first" class="text-bold">{{activity.user.first.toString()+' '+activity.user.last.toString()}}</span>
		                                        <span class="text-bold" ng-if="!activity.user.first">{{activity.user.username}}</span>
		                                        <span class="block">{{activity.note}}</span>
		                                    </p>
		                                </div>
		                                <div ng-switch-default>
		                                    <p>
		                                        <span class="label label-default">{{activity.activityType}}</span> {{activity.detail}}
		                                    </p>
		                                </div>

		                            </div>
		                        </p>
		                    </div>
		                </li>
		            </ul>
	        	</div>
    		</div>    		
  		</div>   
    </div>
</div>