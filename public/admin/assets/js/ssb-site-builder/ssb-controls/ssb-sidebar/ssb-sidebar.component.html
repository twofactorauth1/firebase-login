<div class="ssb-sidebar-inner" ng-class="vm.navigation.indexClass">

    <div class="ssb-sidebar-icons tabbable tabs-left margin-bottom-0 ng-isolate-scope">
        <ul class="nav nav-tabs">

            <li class="nav-tab" ng-class="{ 'nav-tab-is-active': vm.uiState.openSidebarPanel === 'add' }">
                <div ng-click="vm.uiState.openSidebarPanel = 'add'"><div class="ti-plus display-ib"></div>Add</div>
            </li>

            <li class="nav-tab" ng-class="{ 'nav-tab-is-active': vm.uiState.openSidebarPanel === 'pages' }">
                <div ng-click="vm.uiState.openSidebarPanel = 'pages'"><div class="ti-files display-ib"></div>Pages</div>
            </li>

            <li class="nav-tab" ng-class="{ 'nav-tab-is-active': vm.uiState.openSidebarPanel === 'content' }">
                <div ng-click="vm.uiState.openSidebarPanel = 'content'"><div class="ti-layout display-ib"></div>Content</div>
            </li>

            <li class="nav-tab" ng-class="{ 'nav-tab-is-active': vm.uiState.openSidebarPanel === 'design' }">
                <div ng-click="vm.uiState.openSidebarPanel = 'design'"><div class="ti-brush display-ib"></div>Design</div>
            </li>

        </ul>
    </div>


    <div ng-if="vm.uiState.openSidebarPanel === 'add'" class="site-editor-group site-editor-group-add editor-group tab-content">
        <div class="tab-pane" ng-class="{ 'active': vm.uiState.openSidebarPanel === 'add' }">
            <section>

                <h4 class="ssb-sidebar-sub-heading">
                    Add Sections
                </h4>

                <div class="close-panel ti-close"  ng-click="vm.uiState.openSidebarPanel = ''"></div>

                <!-- <h4 class="row">
                    <div class="col-xs-10 col-sm-4">
                        Add new page section
                    </div>

                    <div class="col-xs-12 col-sm-7">
                        <button
                            class="ssb-add-section-sort-btn btn pull-right margin-right-20"
                            ng-class="{ 'btn-primary disabled': vm.sectionType === 'enabledUserSections', 'btn-off': vm.sectionType !== 'enabledUserSections' }"
                            ng-click="vm.setSectionType('enabledUserSections')">
                            Browse Saved
                        </button>

                        <button
                            class="ssb-add-section-sort-btn btn pull-right margin-right-20"
                            ng-class="{ 'btn-primary disabled': vm.sectionType === 'enabledPlatformSections', 'btn-off': vm.sectionType !== 'enabledPlatformSections' }"
                            ng-click="vm.setSectionType('enabledPlatformSections')">
                            Browse Platform
                        </button>
                    </div>
                </h4> -->

                <div>
                    <tabset class="tabbable tabs-left margin-bottom-0" ng-class="{'email-sections' : isEmail}">
                        <tab ng-repeat="sectionFilter in vm.sectionFilters">
                            <tab-heading>
                                {{sectionFilter.capitalized}}
                            </tab-heading>

                            <div ng-repeat="section in vm.sections | orderBy:'title' | filter:{ featured: true, enabled: true }" ng-if="sectionFilter.lowercase === 'featured'" class="margin-bottom-15">
                                <div class="col-xs-6">
                                    <div class="img-wrap">
                                        <a ng-href="{{section.preview}}" title="" data-gallery="">
                                            <span style="  background: url('{{section.preview}}');background-size: cover;height: 115px;background-position: center;border-radius: 5px;border: 1px solid #e7e7e7;display: block;"></span>
                                        </a>
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <h4>{{section.title}}</h4>
                                    <p>{{section.description}}</p>
                                    <button type="button" class="btn btn-primary btn-wide btn-scroll btn-scroll-top ti-plus pull-right" ng-click="vm.addSectionToPage(section);vm.uiState.openSidebarPanel = '';">
                                        <span>Add section</span>
                                    </button>
                                </div>
                                <div class="clearfix"></div>
                            </div>

                            <div ng-repeat="section in vm.sections | orderBy:'title' | filter:{ filter: sectionFilter.lowercase, enabled: true }" ng-if="sectionFilter.lowercase != 'all' && sectionFilter.lowercase != 'featured'" class="margin-bottom-15">
                                <div class="col-xs-6">
                                    <div class="img-wrap">
                                        <a ng-href="{{section.preview}}" title="" data-gallery="">
                                            <span style="  background: url('{{section.preview}}');background-size: cover;height: 115px;background-position: center;border-radius: 5px;border: 1px solid #e7e7e7;display: block;"></span>
                                        </a>
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <h4>{{section.title}}</h4>
                                    <p>{{section.description}}</p>
                                    <button type="button" class="btn btn-primary btn-wide btn-scroll btn-scroll-top ti-plus pull-right" ng-click="vm.addSectionToPage(section);vm.uiState.openSidebarPanel = '';">
                                        <span>Add section</span>
                                    </button>
                                </div>
                                <div class="clearfix"></div>
                            </div>

                            <div ng-repeat="section in vm.sections | orderBy:'title' | filter:{ enabled: true }" ng-if="sectionFilter.lowercase == 'all'" class="margin-bottom-15">
                                <div class="col-xs-6">
                                    <div class="img-wrap">
                                        <a ng-href="{{section.preview}}" title="" data-gallery="">
                                            <span style="  background: url('{{section.preview}}');background-size: cover;height: 115px;background-position: center;border-radius: 5px;border: 1px solid #e7e7e7;display: block;"></span>
                                        </a>
                                    </div>
                                </div>
                                <div class="col-xs-6">
                                    <h4>{{section.title}}</h4>
                                    <p>{{section.description}}</p>
                                    <button type="button" class="btn btn-primary btn-wide btn-scroll btn-scroll-top ti-plus pull-right" ng-click="vm.addSectionToPage(section);vm.uiState.openSidebarPanel = '';">
                                        <span>Add section</span>
                                    </button>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </tab>
                    </tabset>
                </div>

                <!-- <h4 class="row modal-title">
                    <div class="col-xs-10 col-sm-4">
                        Re-use a section from another page
                    </div>
                </h4>

                <div>
                    <tabset class="tabbable tabs-left margin-bottom-0" ng-class="{'email-sections' : isEmail}">
                        <tab ng-repeat="sectionFilter in vm.sectionFilters">
                            <tab-heading>
                                {{sectionFilter.capitalized}}
                            </tab-heading>

                            <div ng-repeat="section in vm.enabledUserSections | orderBy:'title' | filter:{ enabled: true }" ng-if="vm.enabledUserSections.length" class="margin-bottom-15">
                                <div class="col-xs-4">
                                    <div class="img-wrap">
                                        <a ng-href="{{section.preview}}" title="" data-gallery="">
                                            <span style="  background: url('{{section.preview}}');background-size: cover;height: 115px;background-position: center;border-radius: 5px;border: 1px solid #e7e7e7;display: block;"></span>
                                        </a>
                                    </div>
                                </div>
                                <div class="col-xs-8">
                                    <h4>{{section.title}}</h4>
                                    <p>{{section.description}}</p>
                                    <button type="button" class="btn btn-primary btn-wide btn-scroll btn-scroll-top ti-plus pull-right" ng-click="vm.addSectionToPage(section);">
                                        <span>Add section</span>
                                    </button>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </tab>
                    </tabset>
                </div> -->


            </section>
        </div>
    </div>

    <div ng-if="vm.uiState.openSidebarPanel === 'pages'" class="site-editor-group site-editor-group-pages editor-group tab-content">
        <div class="tab-pane" ng-class="{ 'active': vm.uiState.openSidebarPanel === 'pages' }">

            <section>


                <h4 class="ssb-sidebar-sub-heading">
                    Current Page
                </h4>

                <ul class="list-unstyled ssb-settings-list">
                    <li>
                        <label>
                            Title:
                            <span editable-text="vm.state.page.title" onbeforesave="">{{vm.state.page.title}}</span>
                        </label>
                    </li>
                    <li>
                        <label>
                            URL:
                            <span editable-text="vm.state.page.handle" onbeforesave="">{{vm.state.page.handle}}</span>
                        </label>
                    </li>
                    <!-- <li>
                        <label>
                            Page Template:
                            {{vm.getTemplateById(vm.state.page.templateId)}}
                            <span>{{vm.getTemplateById(vm.state.page.templateId)[0].name}}</span>
                        </label>
                    </li> -->
                </ul>

                <h4 class="ssb-sidebar-sub-heading">
                    <span>All Pages ({{Object.keys(vm.state.pages).length || 0}})</span>
                    <!-- <div ng-click="vm.openModal('new-page-modal', null, null, 'lg');" class="ssb-sidebar-item-icon ti-plus display-ib" tooltip-placement="left" tooltip-html-unsafe="Create New Page"></div> -->
                </h4>

                <div class="close-panel ti-close"  ng-click="vm.uiState.openSidebarPanel = ''"></div>

                <button ng-click="vm.openModal('new-page-modal', null, null, 'lg');" class="btn btn-primary">Add Page</button>

                <ul class="list-unstyled">
                    <li ng-repeat="page in vm.state.pages track by $index" class="ssb-page-section-settings-item">
                        <div ng-click="vm.openPageSettingsModal('ssb-page-settings-modal', 'SiteBuilderPageSettingsModalController', null, 'lg', page._id);" class="ssb-sidebar-item-icon ti-settings display-ib" tooltip-placement="left" tooltip-html-unsafe="Page Settings"></div>
                        <div class="panel-group">
                            <div class="ssb-sidebar-sortable-item panel panel-default">
                                <div class="panel-heading">
                                    <h4 class="panel-title">
                                        <a href page-id="page._id" ng-click="vm.navigation.loadPage(page._id)">{{page.title}}</a>
                                    </h4>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </section>

        </div>
    </div>

    <div ng-if="vm.uiState.openSidebarPanel === 'content'" class="site-editor-group site-editor-group-content editor-group tab-content">
        <div class="tab-pane" ng-class="{ 'active': vm.uiState.openSidebarPanel === 'content' }">

            <section>
                <h4 class="ssb-sidebar-sub-heading">
                    <span>Page Sections ({{vm.state.page.sections.length || 0}})</span>
                    <!-- <div ng-click="vm.uiState.openSidebarPanel = 'add'" class="ssb-sidebar-item-icon ti-plus display-ib" tooltip-placement="left" tooltip-html-unsafe="Add Section"></div> -->
                </h4>

                <div class="close-panel ti-close"  ng-click="vm.uiState.openSidebarPanel = ''"></div>

                <button ng-click="vm.uiState.openSidebarPanel = 'add'" class="btn btn-primary">Add Section</button>

                <ul ng-if="vm.state.page.sections" class="list-unstyled" ng-sortable="vm.sortableOptions" ng-model="vm.state.page.sections">
                    <li ng-repeat="section in vm.state.page.sections track by $index" ng-init="sectionIndex = $index" class="ssb-page-section-settings-item">
                        <div class="ssb-sidebar-item-icon ssb-sidebar-move-handle ti-move display-ib"></div>
                        <div class="ssb-sidebar-item-icon ssb-sidebar-item-icon-offset-1 ti-close display-ib" ng-if="vm.uiState.accordion.sections[sectionIndex].isOpen" ng-click="vm.removeSectionFromPage(sectionIndex)" tooltip-placement="left" tooltip-html-unsafe="Remove section"></div>
                        <!-- <div ng-hide="!vm.uiState.accordion.sections[sectionIndex].isOpen" class="ssb-sidebar-item-icon ssb-sidebar-move-handle ti-angle-down display-ib"></div>
                        <div ng-hide="vm.uiState.accordion.sections[sectionIndex].isOpen" class="ssb-sidebar-item-icon ssb-sidebar-move-handle ti-angle-up display-ib"></div> -->

                        <div class="accordion panel-group">
                            <div class="ssb-sidebar-sortable-item panel panel-default" ng-click="vm.setActiveSection(sectionIndex)" ng-class="{ 'ssb-sidebar-section-open': vm.uiState.accordion.sections[sectionIndex].isOpen }">
                                <div class="panel-heading">
                                    <h4 class="panel-title">
                                        <a href="javascript:void(0)" class="accordion-toggle"><span>{{section.name}}</span></a>
                                    </h4>
                                </div>
                            </div>
                        </div>

                    </li>
                </ul>
            </section>

        </div>
    </div>

    <div ng-if="vm.uiState.openSidebarPanel === 'design'" class="site-editor-group site-editor-group-design editor-group tab-content">
        <div class="tab-pane" ng-class="{ 'active': vm.uiState.openSidebarPanel === 'design' }">

            <section>
                <h4 class="ssb-sidebar-sub-heading">Theme Settings</h4>

                <div class="close-panel ti-close"  ng-click="vm.uiState.openSidebarPanel = ''"></div>

                <ul class="list-unstyled">
                    <li class="ssb-page-section-settings-item">
                        <div class="ssb-sidebar-item-icon ti-settings display-ib"></div>
                        <accordion close-others="oneAtATime" class="accordion">
                            <accordion-group heading="{{vm.state.website.theme.name || 'Default'}}"
                                ng-class="{ 'ssb-sidebar-section-open': isOpen }"
                                class="ssb-sidebar-sortable-item">

                                <div class="form-group">
                                    <h5 class="ssb-sidebar-settings-heading">Theme - {{vm.state.website.theme.name}}</h5>

                                    <ui-select ng-model="vm.state.website.theme" ng-change="vm.applyThemeToSite($select.selected)" theme="bootstrap">
                                      <ui-select-match placeholder="Select a theme">
                                          <small ng-bind-html="$select.selected.name"></small>
                                      </ui-select-match>
                                      <ui-select-choices repeat="theme in vm.state.themes | filter: $select.search track by $index">
                                          <small ng-bind-html="theme.name | highlight: $select.search"></small>
                                      </ui-select-choices>
                                    </ui-select>

                                    <ul class="list-unstyled panel-body">
                                        <li class="clearfix">
                                            Header Background Color:
                                        <spectrum-colorpicker class="pull-right" format="'hex'" options="vm.spectrum.options" ng-model="vm.state.website.themeOverrides.styles.headerBackgroundColor"></spectrum-colorpicker>
                                        </li>
                                        <li class="clearfix">
                                            Body Background Color:
                                        <spectrum-colorpicker class="pull-right" format="'hex'" options="vm.spectrum.options" ng-model="vm.state.website.themeOverrides.styles.bodyBackgroundColor"></spectrum-colorpicker>
                                        </li>
                                        <li class="clearfix">
                                            Text Color (Primary):
                                        <spectrum-colorpicker class="pull-right" format="'hex'" options="vm.spectrum.options" ng-model="vm.state.website.themeOverrides.styles.primaryTextColor"></spectrum-colorpicker>
                                        </li>
                                        <li class="clearfix">
                                            Text Color (Buttons):
                                        <spectrum-colorpicker class="pull-right" format="'hex'" options="vm.spectrum.options" ng-model="vm.state.website.themeOverrides.styles.primaryBtnTextColor"></spectrum-colorpicker>
                                        </li>
                                        <li class="clearfix">
                                            Button Background Color:
                                        <spectrum-colorpicker class="pull-right" format="'hex'" options="vm.spectrum.options" ng-model="vm.state.website.themeOverrides.styles.primaryBtnBackgroundColor"></spectrum-colorpicker>
                                        </li>
                                        <li class="clearfix">
                                            Heading Size: <pre>{{vm.state.website.themeOverrides.styles.headingSize}}</pre>
                                        </li>
                                        <li class="clearfix">
                                            Paragraph Size: <pre>{{vm.state.website.themeOverrides.styles.paragraphSize}}</pre>
                                        </li>
                                        <li class="clearfix">
                                            Font Stack (Default): <pre>{{vm.state.website.themeOverrides.defaultFontStack}}</pre>
                                        </li>
                                        <li class="clearfix">
                                            Font Stack (Heading): <pre>{{vm.state.website.themeOverrides.headingFontStack}}</pre>
                                        </li>
                                        <li class="clearfix">
                                            Font Stack (Paragraph): <pre>{{vm.state.website.themeOverrides.paragraphFontStack}}</pre>
                                        </li>
                                    </ul>

                                </div>

                            </accordion-group>
                        </accordion>
                    </li>
                </ul>
            </section>

        </div>
    </div>

    <section
        ng-if="vm.uiState.showSectionPanel && vm.state.page.sections[vm.uiState.activeSectionIndex]"
        class="ssb-sidebar-section-panel draggable"
        ind-draggable>

        <h4 class="ssb-sidebar-sub-heading">
            {{vm.state.page.sections[vm.uiState.activeSectionIndex].name}}
        </h4>

        <div class="close-panel ti-close" ng-click="vm.uiState.showSectionPanel = false"></div>

        <!-- TODO: component-based settings buttons social-link -->

        <div class="clearfix overflow-auto" ng-include=" 'assets/js/ssb-site-builder/ssb-components/ssb-page-section/sidebar.settings.html' "></div>

        <div class="form-group padding-top-10">
            <h5 class="ssb-sidebar-settings-heading">Components ({{vm.state.page.sections[vm.uiState.activeSectionIndex].components.length}})</h5>
            <ul class="list-unstyled ssb-sidebar-section-components-list">
                <li ng-repeat="component in vm.state.page.sections[vm.uiState.activeSectionIndex].components track by $index" ng-init="componentIndex = $index">
                    <accordion close-others="oneAtATime" class="accordion">
                        <accordion-group
                            is-open="vm.uiState.accordion.sections[sectionIndex].components[componentIndex].isOpen"
                            ng-click="vm.togglePageSectionComponentAccordion(componentIndex)"
                            class="ssb-sidebar-sortable-item ssb-sidebar-sortable-item-component">

                            <accordion-heading>
                                <div ng-class="{ 'ssb-sidebar-component-open': vm.uiState.accordion.sections[sectionIndex].components[componentIndex].isOpen }">
                                    {{(componentIndex + 1)}} - {{component.header_title || component.type}}
                                </div>
                                <div class="ssb-sidebar-item-icon ssb-sidebar-move-handle ti-move display-ib"></div>
                                <div
                                    class="ssb-sidebar-item-icon ssb-sidebar-item-icon-offset-1 ti-close display-ib"
                                    ng-if="vm.uiState.accordion.sections[sectionIndex].components[componentIndex].isOpen"
                                    ng-click="vm.removeComponentFromSection(componentIndex)"
                                    tooltip-placement="left"
                                    tooltip-html-unsafe="Remove component">
                                </div>
                            </accordion-heading>

                            <div ng-include=" 'assets/js/ssb-site-builder/ssb-components/shared/basic.html' "></div>

                            <ul class="list-unstyled">
                                <li>
                                    <accordion close-others="oneAtATime" class="accordion">
                                        <div ng-if="component.type !== undefined" ng-include=" 'assets/js/ssb-site-builder/ssb-components/' + component.type + '/sidebar.settings.html' "></div>
                                        <ssb-action-buttons save-action="vm.savePage()" cancel-action="vm.cancelPendingEdits()" ng-show="vm.state.pendingChanges"></ssb-action-buttons>
                                    </accordion>
                                </li>
                            </ul>
                        </accordion-group>
                    </accordion>
                </li>
                <li ng-if="vm.state.page.sections[vm.uiState.activeSectionIndex].canAddComponents !== false" class="ssb-sidebar-component-list">
                    <accordion close-others="oneAtATime" class="accordion" ng-click="vm.getPlatformComponents()">
                        <accordion-group heading="Add + ">
                            <ul class="list-unstyled">
                                <li ng-repeat="component in vm.platformComponents track by $index" ng-click="vm.addComponentToSection(component, sectionIndex)" class="center">
                                    <img src="{{component.preview}}" alt="{{component.type}}" />
                                    {{component.header_title || component.title || component.type}}
                                </li>
                            </ul>
                        </accordion-group>
                    </accordion>
                </li>
            </ul>
        </div>
    </section>


	    <!-- <section ng-repeat="linkList in vm.state.website.linkLists track by $index">
	        <h4 class="ssb-sidebar-sub-heading">{{::linkList.name}}</h4>
	        <ul class="list-unstyled" ng-sortable="vm.sortableOptions" ng-model="linkList.links">
	        	<li ng-repeat="link in linkList.links track by $index" class="ssb-page-section-settings-item">
	        		<div class="ssb-sidebar-item-icon ssb-sidebar-move-handle ti-move display-ib"></div>
	        		<div class="ssb-sidebar-item-icon ssb-sidebar-item-icon-offset-1 ti-close display-ib" tooltip-placement="left" tooltip-html-unsafe="Remove from {{::linkList.name}}"></div>
	        		<div class="panel-group">
		        		<div class="ssb-sidebar-sortable-item panel panel-default">
			        		<div class="panel-heading">
				        		<h4 class="panel-title">
				        			<a href page-id="page._id" ng-click="vm.navigation.loadPage(page._id)">{{link.label}}</a>
				        		</h4>
				        	</div>
			        	</div>
			        </div>
	        	</li>
	        </ul>
	    </section> -->

	<!-- </div>

	<div class="page-editor-group editor-group"> -->

		<!-- <div class="ssb-sidebar-heading">
			<div class="ti-arrow-left" ng-click="vm.navigation.back()"></div>
			<h4>{{vm.state.page.title}}</h4>
		</div> -->





	<!-- </div> -->

</div>
