<script type="text/ng-template" id="donation-modal">
    <div class="donation-v1 donation-modal" id="donation-modal-component">
        <div class="modal-header">
            <button type="button" class="close" ng-click='vm.closeModalFn()' aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">
                                    <span class="fa fa-heart"></span>
                                    <span>Complete your donation</span>
                                </h4>
        </div>
        <div class="modal-body" stop-event="touchend">
            <div class='donate-step billing-shipping' ng-show="vm.checkoutModalState == 1">
                <h3 class="donate-step-header">Choose a donation amount below</h3>
                <div class='donate-flex-container'>
                    <button ng-repeat="amount in vm.component.productSettings.donateButtons track by $index" ng-if="amount > 0" class="flex-item btn ssb-theme-btn donate-amount-btn" ng-class="{ 'active': vm.formBuilder.amount == amount }" ng-click="vm.setDonationAmount(amount)">
                        {{amount | currency:undefined:0}}
                    </button>
                    <div class="flex-break">
                        <label class="donation-amount-other-label control-label padding-right-20">Your donation amount:</label>
                        <input type='number' id='form-donate-modal-amount-{{vm.component._id}}' class='donate-other-amount form-control' placeholder="Other amount" ng-model='vm.formBuilder.amount' min='{{vm.product.donationMinimumAmount || 0}}' max='{{vm.product.donationMaximumAmount || 9999999999}}' />
                    </div>
                </div>
                <hr />
                <form name="formBuilder" ng-submit="vm.createUser(formBuilder)">
                    <fieldset ng-disabled="vm.isAnonymous">
                        <div class="form-donate-layout-cart" ng-class="{'one-row-layout': vm.component.formSettings.fieldsPerRow == 1}" ng-switch="vm.component.layout">
                            <div ng-switch-when="1" class="donate-flex-container form-layout-1 input-fields {{vm.nthRow}}" ng-attr-style="{{vm.inputContainerStyle(vm.component.formSettings)}}">
                                <div ng-attr-style="{{vm.fieldStyle(vm.component.formSettings)}}" class="flex-item form-group {{vm.fieldClass()}}" ng-if="val.visible" ng-repeat="val in vm.component.contactInfo" ng-class="{ 'has-error' : (formBuilder.{{val.name}}.$invalid || formBuilder.{{val.name}}.$error.$required) && !formBuilder.{{val.name}}.$pristine }">
                                    <label class="control-label">{{val.label || val.type}} <span ng-if="!val.optional" class="required">*</span></label>
                                    <input ng-if="val.name !== 'message'" type="text" class="form-control" ng-model="vm.formBuilder[val.name]" ng-attr-style="{{vm.inputStyle(vm.component.formSettings)}}" name="{{val.name}}" ng-required='!val.optional' ng-pattern="vm.addPattern(val)">
                                    <textarea ng-if="val.name === 'message'" class="form-control input-lg" name="message" rows="5" ng-model="vm.formBuilder[val.name]" ng-attr-style="{{vm.inputStyle(vm.component.formSettings)}}" name="{{val.name}}" ng-required='!val.optional' ng-pattern="vm.addPattern(val)"></textarea>
                                </div>
                            </div>
                            <div ng-switch-when="2" class="flex-container form-layout-2 input-fields {{vm.nthRow}}" ng-attr-style="{{vm.inputContainerStyle(vm.component.formSettings)}}">
                                <div ng-attr-style="{{vm.fieldStyle(vm.component.formSettings)}}" class="flex-item form-group {{vm.fieldClass()}}" ng-if="val.visible" ng-repeat="val in vm.component.contactInfo" ng-class="{ 'has-error' : (formBuilder.{{val.name}}.$invalid || formBuilder.{{val.name}}.$error.$required) && !formBuilder.{{val.name}}.$pristine }">
                                    <label class="col-sm-10 control-label">{{val.label || val.type}} <span ng-if="!val.optional" class="required">*</span></label>
                                    <div class="col-sm-10">
                                        <input type="text" ng-if="val.name !== 'message'" class="form-control" ng-model="vm.formBuilder[val.name]" ng-attr-style="{{vm.inputStyle(vm.component.formSettings)}}" name="{{val.name}}" ng-required='!val.optional' ng-pattern="vm.addPattern(val)">
                                        <textarea ng-if="val.name === 'message'" class="form-control input-lg" name="message" rows="5" ng-model="vm.formBuilder[val.name]" ng-attr-style="{{vm.inputStyle(vm.component.formSettings)}}" name="{{val.name}}" ng-required='!val.optional' ng-pattern="vm.addPattern(val)"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div ng-switch-when="3" class="flex-container form-layout-3 col-sm-12 input-fields {{vm.nthRow}}" ng-attr-style="{{vm.inputContainerStyle(vm.component.formSettings)}}">
                                <div class="col-sm-6">
                                    <div ng-attr-style="{{vm.fieldStyle(vm.component.formSettings)}}" class="flex-item form-group {{vm.fieldClass()}}" ng-if="val.visible && val.name !== 'message'" ng-repeat="val in vm.component.contactInfo" ng-class="{ 'has-error' : (formBuilder.{{val.name}}.$invalid || formBuilder.{{val.name}}.$error.$required) && !formBuilder.{{val.name}}.$pristine }">
                                        <span ng-if="!val.optional" class="required no-label">*</span>
                                        <input placeholder="{{val.label || val.type}}" type="text" class="form-control" ng-model="vm.formBuilder[val.name]" ng-attr-style="{{vm.inputStyle(vm.component.formSettings)}}" name="{{val.name}}" ng-required='!val.optional' ng-pattern="vm.addPattern(val)">
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div ng-attr-style="{{vm.fieldStyle(vm.component.formSettings)}}" class="flex-item form-group" ng-if="val.visible && val.name === 'message'" ng-repeat="val in vm.component.contactInfo" ng-class="{ 'has-error' : (formBuilder.{{val.name}}.$invalid || formBuilder.{{val.name}}.$error.$required) && !formBuilder.{{val.name}}.$pristine }">
                                        <span ng-if="!val.optional" class="required no-label no-label-textarea">*</span>
                                        <textarea placeholder="{{val.label || val.type}}" class="form-control input-lg" name="message" rows="5" ng-model="vm.formBuilder[val.name]" ng-attr-style="{{vm.inputStyle(vm.component.formSettings)}}" name="{{val.name}}" ng-required='!val.optional' ng-pattern="vm.addPattern(val)"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div ng-switch-when="4" class="flex-container form-layout-4 input-fields {{vm.nthRow}}" ng-attr-style="{{vm.inputContainerStyle(vm.component.formSettings)}}">
                                <div ng-attr-style="{{vm.fieldStyle(vm.component.formSettings)}}" class="flex-item form-group {{vm.fieldClass()}}" ng-if="val.visible" ng-repeat="val in vm.component.contactInfo" ng-class="{ 'has-error' : (formBuilder.{{val.name}}.$invalid || formBuilder.{{val.name}}.$error.$required) && !formBuilder.{{val.name}}.$pristine }">
                                    <span ng-if="!val.optional" class="required no-label">*</span>
                                    <input ng-if="val.name !== 'message'" placeholder="{{val.label || val.type}}" type="text" class="form-control" ng-model="vm.formBuilder[val.name]" ng-attr-style="{{vm.inputStyle(vm.component.formSettings)}}" name="{{val.name}}" ng-required='!val.optional' ng-pattern="vm.addPattern(val)">
                                    <textarea ng-if="val.name === 'message'" placeholder="{{val.label || val.type}}" class="form-control input-lg" name="message" rows="5" ng-model="vm.formBuilder[val.name]" ng-attr-style="{{vm.inputStyle(vm.component.formSettings)}}" name="{{val.name}}" ng-required='!val.optional' ng-pattern="vm.addPattern(val)"></textarea>
                                </div>
                            </div>
                            <div ng-switch-default class="flex-container form-layout-custom input-fields {{vm.nthRow}}" ng-attr-style="{{vm.inputContainerStyle(vm.component.formSettings)}}">
                                <div ng-attr-style="{{vm.fieldStyle(vm.component.formSettings)}}" class="flex-item form-group {{vm.fieldClass()}}" ng-if="val.visible" ng-repeat="val in vm.component.contactInfo" ng-class="{ 'has-error' : (formBuilder.{{val.name}}.$invalid || formBuilder.{{val.name}}.$error.$required) && !formBuilder.{{val.name}}.$pristine }">
                                    <span ng-if="!val.optional" class="required no-label">*</span>
                                    <input ng-if="val.name !== 'message'" type="text" class="form-control" ng-model="vm.formBuilder[val.name]" ng-attr-style="{{vm.inputStyle(vm.component.formSettings)}}" name="{{val.name}}" ng-required='!val.optional' ng-pattern="vm.addPattern(val)" placeholder="{{val.label || val.type}}">
                                    <textarea ng-if="val.name === 'message'" class="form-control input-lg" name="message" rows="5" ng-model="vm.formBuilder[val.name]" ng-attr-style="{{vm.inputStyle(vm.component.formSettings)}}" name="{{val.name}}" ng-required='!val.optional' ng-pattern="vm.addPattern(val)" placeholder="{{val.label || val.type}}"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="clearfix mb15"></div>
                        <div ng-show="vm.formSuccess">
                            <div class="row thank-you animated" ng-class="{fadeOut: !vm.formSuccess, tada: vm.formSuccess}">
                                <h3 class="center mb20" ng-bind-html="vm.component.formSettings.successMessage || 'Thank You for Submitting!'"></h3>
                            </div>
                        </div>
                        <div ng-show="vm.formError">
                            <div class="row thank-you animated" ng-class="{fadeOut: !vm.formError, tada: vm.formError}">
                                <h3 class="center mb20" ng-bind-html="vm.component.formSettings.errorMessage || 'Error while Submitting!'"></h3>
                            </div>
                        </div>
                    </fieldset>
                </form>
                <div class='form-group'>
                    <div class="checkbox">
                        <label>
                            <input type="checkbox" ng-model="vm.isAnonymous">Anonymous</label>
                    </div>
                </div>
            </div>

            <div class="donate-step thank-you" ng-show="vm.checkoutModalState == 2">
                <!-- <h3 class="donate-step-header center mb20">Payment Choice</h3> -->
                <div class="alert alert-danger" ng-show='vm.showPaypalErrorMsg'>Try again with paypal or use Credit Card?</div>
                <div class="payment-panel" ng-show='vm.paypalInfo' ng-class='{"col-sm-6": vm.stripeInfo, "col-sm-12": !vm.stripeInfo}'>
                    <div class="panel animated no-radius text-center margin-bottom-0 cursor-pointer" ng-class="{true:'panel-light-grey pulse',false:'panel-white'}">
                        <div class="panel-body" ng-click="vm.showPaypalLoading || vm.paypalPayment()" ng-disabled='vm.showPaypalLoading'>
                            <img class="img-responsive inline-block" src="/images/simple-cart-paypal.png" />
                            <h3 class="StepTitle margin-top-10">Paypal</h3>
                            <p class="text-small">
                                Checkout with Paypal
                                <img src='/images/paypal-loading.gif' ng-show='vm.showPaypalLoading' />
                            </p>
                        </div>
                    </div>
                </div>
                <div class="payment-panel" ng-show='vm.stripeInfo' ng-class='{"col-sm-6": vm.paypalInfo, "col-sm-12": !vm.paypalInfo}'>
                    <div class="panel animated no-radius text-center margin-bottom-0 cursor-pointer" ng-class="{true:'panel-light-grey pulse',false:'panel-white'}">
                        <div class="panel-body" ng-click="vm.setCheckoutState(4)">
                            <img class="img-responsive inline-block" src="/images/simple-cart-stripe.png" />
                            <h3 class="StepTitle margin-top-10">Credit Card</h3>
                            <p class="text-small center">
                                Checkout with a Credit Card
                                <br>(Powered by Stripe)
                            </p>
                        </div>
                    </div>
                </div>
                <div class="clearfix" style="margin-bottom:30px"></div>
            </div>

            <div class="donate-step thank-you" ng-show="vm.checkoutModalState == 3">
                <!-- <h3 class="donate-step-header center mb20">Paypal Payment</h3> -->
                <form action="{{vm.paypalURL}}" target="_self" class="center standard">
                    <!-- <label for="buy">Buy Now:</label> -->
                    <input type="image" id="submitBtn" value="Pay with PayPal" src="https://www.paypalobjects.com/en_US/i/btn/btn_paynowCC_LG.gif" ng-click='vm.paypalLoginClickFn()'>
                    <input id="type" type="hidden" name="expType" value="light">
                    <input id="paykey" type="hidden" name="paykey" value="{{vm.paypalKey}}">
                </form>
            </div>

            <div class="donate-step payment" ng-show="vm.checkoutModalState == 4">
                <div class="col-sm-12 col-xs-12 information">
                    <div class="clearfix"></div>
                    <div id="card-wrapper-{{vm.component._id}}"></div>
                    <div class="clearfix margin-bottom-30"></div>
                    <div class="active col-xs-12 donation-card-info">
                        <form id="donation-card-details-{{vm.component._id}}" name="donation-card-details" action="">
                            <div class="row">
                                <div id="card_number" class="form-group small-6 columns col-sm-6 has-feedback">
                                    <input placeholder="Card number" ng-blur="vm.checkCardNumber()" type="text" name="number" id="number" class="form-control">
                                    <span class="glyphicon form-control-feedback"></span>
                                    <span class="error help-block" />
                                </div>
                                <div class="visible-xs mb20"></div>
                                <div id="card_name" class="form-group small-6 columns col-sm-6 has-feedback">
                                    <input placeholder="Full name" type="text" id="name" name="name" class="form-control" ng-blur="vm.checkCardName()">
                                    <span class="glyphicon form-control-feedback"></span>
                                    <span class="error help-block" />
                                </div>
                            </div>
                            <div class="clearfix mb20"></div>
                            <div class="row">
                                <div id="card_expiry" class="form-group small-3 columns col-xs-6 has-feedback">
                                    <input placeholder="MM/YY" ng-blur="vm.checkCardExpiry()" type="text" id="expiry" name="expiry" class="form-control">
                                    <span class="glyphicon form-control-feedback"></span>
                                    <span class="error help-block" />
                                </div>
                                <div id="card_cvc" class="form-group small-3 columns col-xs-6 has-feedback">
                                    <input placeholder="CVC" ng-blur="vm.checkCardCvv()" type="text" id="cvc" name="cvc" class="form-control">
                                    <span class="glyphicon form-control-feedback"></span>
                                    <span class="error help-block" />
                                </div>
                            </div>
                            <div class="clearfix mb20"></div>
                            <h4 ng-if="vm.failedOrderMessage.length" class="center" style="color: #a94442;">{{vm.failedOrderMessage}}</h4>
                        </form>
                    </div>
                </div>
            </div>

            <div class="donate-step thank-you" ng-show="vm.checkoutModalState == 5">

                <div class="clearfix" style="margin-bottom:30px"></div>

                <div class="col-xs-12 text-center">
                    <span class="fa fa-check-circle fa-5x text-green"></span>
                </div>

                <div class="clearfix" style="margin-bottom:30px"></div>

                <h3 class="donate-step-header center mb20">
                                        Thank you for your {{vm.formBuilder.amount | currency:undefined:0}} donation.
                                    </h3>

                <p class="center">
                    Help raise even more money by sharing this page.
                </p>

                <div class="donate-social-share">
                    <a class="btn btn-xs btn-twitter" socialshare socialshare-via="indigenous_io" socialshare-text="Home" socialshare-provider="twitter" socialshare-popup-height="400">
                        <span class="fa fa-twitter"></span> Tweet
                    </a>
                    <a class="btn btn-xs btn-facebook" href="javascript:void(0)" socialshare socialshare-url="{{vm.shareUrl}}" socialshare-provider="facebook" socialshare-via="{{vm.facebookClientID}}" socialshare-popup-height="400" socialshare-redirect-uri="https://www.facebook.com/dialog/return/close">
                        <span class="fa fa-facebook"></span> Share
                    </a>
                </div>
            </div>

            <div class="donate-step processing" ng-show="vm.checkoutModalState == 6">
                <h3 class="center donate-step-header mb20">Donation Processing...</h3>
                <div class="text-center padding-20 donate-step-processing-icon">
                    <span class="fa fa-spinner fa-spin fa-4x"></span>
                </div>
                <div style="margin-bottom:30px"></div>
            </div>
        </div>
        <!-- <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">{{vm.component.modalSettings.closeBtnText}}</button>
                                <button type="button" class="btn btn-primary" ng-disabled="formBuilder.$invalid">{{vm.component.modalSettings.submitBtnText}}</button>
                            </div> -->
        <div class="modal-footer billing-footer" ng-show="vm.checkoutModalState == 1">
            <button class="btn ssb-theme-btn btn-success btn-payment pull-right" ng-click="vm.setCheckoutState(2)" ng-disabled='vm.formInvalidFn(formBuilder)'> Next <i class="fa fa-chevron-right"></i></button>
        </div>
        <div class="modal-footer billing-footer" ng-show="vm.checkoutModalState == 2">
            <button class="btn ssb-theme-btn pull-left btn-info back-to-shopping-cart" ng-click="vm.setCheckoutState(1)"><i class="fa fa-chevron-left"></i> Back</button>
        </div>
        <div class="modal-footer billing-footer" ng-show="vm.checkoutModalState == 3">
            <button class="btn btn-danger pull-left" ng-click="vm.deleteOrderFn(vm.order)"><i class="fa fa-trash"></i> Cancel</button>
        </div>
        <div class="modal-footer cart-footer" ng-show="vm.checkoutModalState == 4">
            <button class="btn ssb-theme-btn btn-info continue-shopping pull-left" ng-click="vm.setCheckoutState(2)"><i class="fa fa-chevron-left"></i> Back
            </button>
            <button class="btn ssb-theme-btn btn-orange btn-checkout pull-right" ng-click="vm.makeCartPayment()"><i class="fa fa-shopping-cart"></i> Checkout</button>
        </div>
        <div class="modal-footer cart-footer" ng-show="vm.checkoutModalState == 5">
            <button type="button" class="btn ssb-theme-btn pull-right" data-dismiss="modal" ng-click='vm.closeModalFn()'>Close</button>
        </div>
    </div>
</script>