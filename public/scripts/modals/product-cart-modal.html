<script type="text/ng-template" id="product-cart-modal">
  <div id="cart-checkout-modal">
    <div class="modal-header">
      <button type="button" class="close" ng-click='close()' aria-hidden="true">&times;</button>
      <h4 class="modal-title"><i class="fa fa-shopping-cart"></i> My Cart</h4>
    </div>
    <div class="modal-body" stop-event="touchend">
      <div class="shopping-cart" ng-if="checkoutModalState == 1">
        <div class="order-line-items" ng-class="{'col-sm-8':cartDetails.length > 0, 'col-sm-12': cartDetails.length <= 0}">
          <div class="mb15"></div>
            <form name='itemQuantityForm'>
              <ul>
                <li ng-repeat="item in cartDetails track by $index">
                  <div class="col-sm-12">
                    <div class="line-item-header row">
                      <h4 class="col-sm-5">{{item.name}}</h4>
                      <div class="col-sm-3">
                        <input name='quantity-input-{{$index}}' type="number" min='1' ng-model="item.quantity" ng-change="cookieUpdateQuantityFn(item); calculateTotalChargesfn()" class="form-control spinner-input quantity">
                      </div>
                      <p class="price col-sm-3"><span ng-class="{'shopping-cart-strikethrough text-small': item.onSaleToday}">{{item.regular_price | currency}} </span><span ng-if="item.onSaleToday">{{item.sale_price | currency}}</span></p>
                      <div class="col-sm-1">
                        <button type="button" class="close" aria-hidden="true" ng-click="removeFromCart(true, item)">Ã—</button>
                      </div>
                    </div>
                    <p if="item.description" class="description">
                      {{item.description | characters : 150 : true}}
                    </p>
                    <div class="col-sm-12 row" ng-if="item.variation">
                      <ul class="variations">
                        <li style="display:inline-block" ng-repeat="attribute in item.attributes">{{attribute.name}}: {{attribute.option}}</li>
                      </ul>
                    </div>
                  </div>
                  <div class="clearfix"></div>
                </li>
              </ul>
            </form>
          <div ng-if="!cartDetails || cartDetails.length <= 0" class="empty-cart-container">
            <div class="empty-cart">
              <i class="fa fa-3x fa-shopping-cart"></i>
              <h2>No Items Added to the cart</h2>
            </div>
          </div>
        </div>
        <div class="col-sm-4 gray-bg order-summary" ng-if="cartDetails.length > 0">
          <p>{{totalNums.total}}</p>
          <div data-ng-include=" '../views/partials/order-summary.html' "></div>
        </div>
      </div>
      <div class="row billing-shipping" ng-if="checkoutModalState == 2">
        <div class="col-sm-8 col-xs-12 information margin-top-15">
          <ul class="nav nav-tabs hidden">
            <li class="active">
              <a href="#billing" data-toggle="tab">
                <strong>Billing</strong>
              </a>
            </li>
            <li class="shipping-tab hidden">
              <a href="#shipping" data-toggle="tab">
                <strong>Shipping</strong>
              </a>
            </li>
          </ul>
          <div class="tab-content mb30">
            <div class="tab-pane active" id="billing">
              <div>
                <h3 class="margin-top-0">
                  {{addresses.labelText}}
                </h3>
              </div>
              <div class="row">
                <div class="col-sm-6">
                  <div class="form-group has-feedback" ng-class="{'has-error': emptyFirstName}">
                    <label class="control-label" for="firstName">First Name</label>
                    <input type="text" placeholder="First Name" class="form-control" id="firstName" ng-model="newContact.first" ng-blur="checkBillingFirst(newContact.first); cookieUpdateContactFn()">
                    <span class="help-block" ng-if="emptyFirstName"></i>Required</span>
                  </div>
                </div>
                <div class="col-sm-6">
                  <div class="form-group" ng-class="{'has-error': emptyLastName}">
                    <label class="control-label" for="lastName">Last Name</label>
                    <input type="text" placeholder="Last Name" class="form-control" id="lastName" ng-blur="checkBillingLast(newContact.last); cookieUpdateContactFn()" ng-model="newContact.last">
                    <span class="help-block" ng-if="emptyLastName"></i>Required</span>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-6">
                  <div class="form-group" ng-class="{'has-error': emptyEmail || invalidEmail}">
                    <label class="control-label" for="email">Email</label>
                    <input type="text" placeholder="Email" class="form-control" id="email" ng-blur="checkBillingEmail(newContact.details[0].emails[0].email); cookieUpdateContactFn()" ng-model="newContact.details[0].emails[0].email">
                    <span class="help-block" ng-if="emptyEmail"></i>Required</span>
                    <span class="help-block" ng-if="invalidEmail"></i>Invalid</span>
                  </div>
                </div>
                <div class="col-sm-6">
                  <div class="form-group" ng-class="{'has-error': invalidPhone}">
                    <label class="control-label" for="checkout-billing-phone-number">Phone</label>
                    <input type="text" ng-blur="checkBillingPhone(newContact.details[0].phones[0].number); cookieUpdateContactFn()" placeholder="Phone" class="form-control" id="checkout-billing-phone-number" ng-model="newContact.details[0].phones[0].number" ind-international-tel-number name="phone">
                    <span class="help-block" ng-if="invalidPhone"></i>Invalid</span>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-6">
                  <div class="form-group" ng-class="{'has-error': emptyAddress}">
                    <label class="control-label" for="address">Address</label>
                    <input type="text" ng-blur="checkBillingAddress(newContact.details[0].addresses[0].address); cookieUpdateContactFn()" placeholder="Address" class="form-control" id="address" ng-model="newContact.details[0].addresses[0].address">
                    <span class="help-block" ng-if="emptyAddress"></i>Required</span>
                  </div>
                </div>
                <div class="col-sm-6">
                  <div class="form-group">
                    <label class="control-label" for="address2">Address 2</label>
                    <input type="text" placeholder="Address 2" class="form-control" id="address2" ng-model="newContact.details[0].addresses[0].address2" ng-blur='cookieUpdateContactFn()'>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-4">
                  <div class="form-group" ng-class="{'has-error': emptyCity}">
                    <label class="control-label" for="city">City</label>
                    <input type="text" ng-blur="checkBillingCity(newContact.details[0].addresses[0].city); cookieUpdateContactFn()" placeholder="City" class="form-control" id="city" ng-model="newContact.details[0].addresses[0].city">
                    <span class="help-block" ng-if="emptyCity"></i>Required</span>
                  </div>
                </div>
                <div class="col-sm-5">
                  <div class="form-group" ng-class="{'has-error': emptyState}">
                    <label class="control-label" for="state">State</label>
                    <select ng-change="checkBillingState(newContact.details[0].addresses[0].state); cookieUpdateContactFn()" placeholder="State" class="form-control" id="state" ng-model="newContact.details[0].addresses[0].state" ng-options="state.abbr as state.name for state in shippingStates">
                          <option value="">-- select --</option>
                      </select>
                    <span class="help-block" ng-if="emptyState"></i>Required</span>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-group" ng-class="{'has-error': invalidZipCode || emptyZipCode}">
                    <label class="control-label" for="zipCode">Zip Code</label>
                    <input type="text" placeholder="Zip Code" class="form-control" id="zipCode" ng-model="newContact.details[0].addresses[0].zip" ng-blur="billingPostCodeChanged(newContact.details[0].addresses[0].zip, newContact.details[0].addresses[0].state); cookieUpdateContactFn()">
                    <span class="help-block" ng-if="emptyZipCode"></i>Required.</span>
                    <span class="help-block" ng-if="invalidZipCode"></i>Zip Code is not valid.</span>
                  </div>
                </div>
              </div>
              <div class="checkbox">
                <label>
                  <input type="checkbox" ng-model="addresses.shipping" ng-change="cookieUpdateContactShippingValueFn()">Separate Shipping address
                </label>
              </div>
            </div>
            <div class="tab-pane hidden" id="shipping">
              <div class="row">
                <div class="col-sm-6">
                  <div class="form-group">
                    <label class="control-label" for="firstName">First Name</label>
                    <input type="text" class="form-control" id="firstName">
                  </div>
                </div>
                <div class="col-sm-6">
                  <div class="form-group">
                    <label class="control-label" for="lastName">Last Name</label>
                    <input type="text" class="form-control" id="lastName">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-6">
                  <div class="form-group">
                    <label class="control-label" for="address">Address</label>
                    <input type="text" class="form-control" id="address">
                  </div>
                </div>
                <div class="col-sm-4">
                  <div class="form-group">
                    <label class="control-label" for="city">City</label>
                    <input type="text" class="form-control" id="city">
                  </div>
                </div>
                <div class="col-sm-2">
                  <div class="form-group">
                    <label class="control-label" for="state">State</label>
                    <input type="text" class="form-control" id="state">
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-6">
                  <div class="form-group">
                    <label class="control-label" for="zipCode">Zip Code</label>
                    <input type="text" class="form-control" id="zipCode">
                  </div>
                </div>
                <div class="col-sm-6">
                  <div class="form-group">
                    <label class="control-label" for="phone">Phone</label>
                    <input type="text" class="form-control" id="phone">
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="form-group margin-bottom-10 col-xs-12" ng-if="!showTax">
            <small ng-if="settings.taxbased === 'customer_shipping' || settings.taxbased === 'customer_billing'">Note: Shipping and taxes are estimated and will be updated during checkout based on your billing and shipping information.</small>
          </div>
        </div>
        <div class="col-sm-4 col-xs-12 gray-bg order-summary">
          <div data-ng-include=" '../views/partials/order-summary.html' "></div>
        </div>
      </div>

      <div class="row billing-shipping" ng-if="checkoutModalState == 8">
        <div class="col-sm-8 col-xs-12 information margin-top-15">
          <div class="tab-content mb30">
            <div class="tab-pane active" id="billing">
              <div class="margin-bottom-10">
                <h3 class="margin-top-0">
                  Shipping Address
                </h3>
              </div>
              <div class="row">
                <div class="col-sm-6">
                  <div class="form-group has-feedback" ng-class="{'has-error': emptyShippingFirstName}">
                    <label class="control-label" for="firstName">First Name</label>
                    <input type="text" placeholder="First Name" class="form-control" id="shippingFirstName" ng-model="newShippingContactAddress.first_name" ng-blur="checkShippingFirst(newShippingContactAddress.first_name); cookieUpdateContactShippingFn()">
                    <span class="help-block" ng-if="emptyShippingFirstName"></i>Required</span>
                  </div>
                </div>
                <div class="col-sm-6">
                  <div class="form-group" ng-class="{'has-error': emptyShippingLastName}">
                    <label class="control-label" for="lastName">Last Name</label>
                    <input type="text" placeholder="Last Name" class="form-control" id="shippingLastName" ng-blur="checkShippingLast(newShippingContactAddress.last_name); cookieUpdateContactShippingFn()" ng-model="newShippingContactAddress.last_name">
                    <span class="help-block" ng-if="emptyShippingLastName"></i>Required</span>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-6">
                  <div class="form-group" ng-class="{'has-error': emptyShippingAddress}">
                    <label class="control-label" for="address">Address</label>
                    <input type="text" ng-blur="checkShippingAddress(newShippingContactAddress.address_1); cookieUpdateContactShippingFn()" placeholder="Address" class="form-control" id="shippingAddress" ng-model="newShippingContactAddress.address_1">
                    <span class="help-block" ng-if="emptyShippingAddress"></i>Required</span>
                  </div>
                </div>
                <div class="col-sm-6">
                  <div class="form-group">
                    <label class="control-label" for="address2">Address 2</label>
                    <input type="text" placeholder="Address 2" class="form-control" id="ShippingAddress2" ng-model="newShippingContactAddress.address_2" ng-blur='cookieUpdateContactShippingFn()'>
                  </div>
                </div>
              </div>
              <div class="row">
                <div class="col-sm-4">
                  <div class="form-group" ng-class="{'has-error': emptyShippingCity}">
                    <label class="control-label" for="city">City</label>
                    <input type="text" ng-blur="checkShippingCity(newShippingContactAddress.city); cookieUpdateContactShippingFn()" placeholder="City" class="form-control" id="shippingCity" ng-model="newShippingContactAddress.city">
                    <span class="help-block" ng-if="emptyShippingCity"></i>Required</span>
                  </div>
                </div>
                <div class="col-sm-5">
                  <div class="form-group" ng-class="{'has-error': emptyShippingState}">
                    <label class="control-label" for="state">State</label>
                    <select ng-change="checkShippingState(newShippingContactAddress.state); cookieUpdateContactShippingFn()" placeholder="State" class="form-control" id="ShippingState" ng-model="newShippingContactAddress.state" ng-options="state.abbr as state.name for state in shippingStates">
                          <option value="">-- select --</option>
                      </select>
                    <span class="help-block" ng-if="emptyShippingState"></i>Required</span>
                  </div>
                </div>
                <div class="col-sm-3">
                  <div class="form-group" ng-class="{'has-error': invalidShippingZipCode || emptyShippingZipCode}">
                    <label class="control-label" for="zipCode">Zip Code</label>
                    <input type="text" placeholder="Zip Code" class="form-control" id="shippingZipCode" ng-model="newShippingContactAddress.postcode" ng-blur="shippingPostCodeChanged(newShippingContactAddress.postcode, newShippingContactAddress.state); cookieUpdateContactShippingFn()">
                    <span class="help-block" ng-if="emptyShippingZipCode"></i>Required.</span>
                    <span class="help-block" ng-if="invalidShippingZipCode"></i>Zip Code is not valid.</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="form-group margin-bottom-10 col-xs-12" ng-if="!showTax">
            <small ng-if="settings.taxbased === 'customer_shipping' || settings.taxbased === 'customer_billing'">Note: Shipping and taxes are estimated and will be updated during checkout based on your billing and shipping information.</small>
          </div>
        </div>
        <div class="col-sm-4 col-xs-12 gray-bg order-summary">
          <div data-ng-include=" '../views/partials/order-summary.html' "></div>
        </div>
    </div>

      <div class="row payment" ng-show="checkoutModalState == 3">
        <div class="col-sm-8 col-xs-12 information">
          <div class="clearfix margin-bottom-20"></div>
          <div id="card-wrapper-{{component._id}}"></div>
          <div class="clearfix margin-bottom-20"></div>
          <div class="active col-xs-12 product-card-info">
            <form id="product-card-details-{{component._id}}" name="product-card-details" action="">
              <div class="row">
                <div id="card_number" class="form-group small-6 columns col-sm-6 has-feedback">
                  <input placeholder="Card number" ng-blur="checkCardNumber()" type="text" name="number" id="number" class="form-control">
                  <span class="glyphicon form-control-feedback"></span>
                  <span class="error help-block" />
                </div>
                <div id="card_name" class="form-group small-6 columns col-sm-6 has-feedback">
                  <input placeholder="Full name" type="text" id="name" name="name" class="form-control" ng-blur="checkCardName()">
                  <span class="glyphicon form-control-feedback"></span>
                  <span class="error help-block" />
                </div>
              </div>
              <div class="row">
                <div id="card_expiry" class="form-group small-3 columns col-xs-6 has-feedback">
                  <input placeholder="MM/YY" ng-blur="checkCardExpiry()" type="text" id="expiry" name="expiry" class="form-control">
                  <span class="glyphicon form-control-feedback"></span>
                  <span class="error help-block" />
                </div>
                <div id="card_cvc" class="form-group small-3 columns col-xs-6 has-feedback">
                  <input placeholder="CVC" ng-blur="checkCardCvv()" type="text" id="cvc" name="cvc" class="form-control">
                  <span class="glyphicon form-control-feedback"></span>
                  <span class="error help-block" />
                </div>
              </div>
            <!-- Coupon DETAILS -->
              <div class="row">
                <div class="form-group columns col-xs-12 has-feedback" ng-class="{'has-error': !couponIsValid && couponChecked && !checkingCoupon && checkoutOrder.coupon, 'has-success': couponIsValid && !checkingCoupon && checkoutOrder.coupon}" id="card_coupon">
                  <input class="form-control" type="text" ng-change="checkCoupon()" ng-model="checkoutOrder.coupon" placeholder="Coupon Code" ng-model-options="{ debounce: 800 }"  id="order_coupon_code"/>
                  <span class="form-control-feedback" ng-class="{'glyphicon glyphicon-remove': !couponIsValid && couponChecked && !checkingCoupon && checkoutOrder.coupon, 'glyphicon glyphicon-ok': couponIsValid && checkoutOrder.coupon && !checkingCoupon}"></span>
                  <span class="coupon-spinner" ng-class="{'fa fa-2x fa-spinner fa-spin':checkingCoupon}"></span>
                  <span class="error help-block" ng-if="!couponIsValid && couponChecked && !checkingCoupon && checkoutOrder.coupon">Invalid Coupon</span>
                  <span class="success help-block" ng-if="checkoutOrder.coupon && couponIsValid && couponChecked && !checkingCoupon">Coupon Accepted</span>
                </div>
              </div>
            </form>
            <h4 ng-if="failedOrderMessage.length" class="center" style="color: #a94442;">{{failedOrderMessage}}</h4>
          </div>
        </div>
        <div class="col-sm-4 col-xs-12 gray-bg order-summary">
          <div data-ng-include=" '../views/partials/order-summary.html' "></div>
        </div>
      </div>
      <div class="row processing" style="" ng-if="checkoutModalState == 4">
        <h3 class="center  mb20">Order Processing</h3>
        <div class="text-center padding-20">
          <span class="fa fa-spinner fa-spin fa-4x"></span>
        </div>
        <div style="margin-bottom:30px"></div>
      </div>
      <div class="row thank-you" style="" ng-if="checkoutModalState == 5">
        <h3 class="center mb20">Thank you for your Purchase.</h3>
        <p class="center">You will be receiving an order summary by email shortly.</p>
        <div class="clearfix" style="margin-bottom:30px"></div>
        <div class="col-xs-12 text-center">
          <span class="fa fa-check-circle fa-5x text-green"></span>
        </div>
      </div>
      <div class="row thank-you" style="" ng-if="checkoutModalState == 6">
        <h3 class="center mb20">Payment Choice</h3>
        <div class="alert alert-danger" ng-show='showPaypalErrorMsg'>Try again with paypal or use Credit Card?</div>
        <div ng-show='paypalInfo' ng-class='{"col-sm-6": stripeInfo, "col-sm-12": !stripeInfo}'>
          <div class="panel animated no-radius text-center margin-bottom-0 cursor-pointer" ng-class="{true:'panel-light-grey pulse',false:'panel-white'}">
            <div class="panel-body" ng-class="{'bg-light-grey': hover1}" ng-mouseenter="hover1 = true" ng-mouseleave="hover1 = false" ng-click="showPaypalLoading || paypalPayment()" ng-disabled='showPaypalLoading'>
              <span class="fa-stack fa-2x"> <i class="fa fa-square fa-stack-2x text-primary"></i> <i class="fa fa-envelope fa-stack-1x fa-inverse"></i> </span>
              <h3 class="StepTitle margin-top-10">Paypal</h3>
              <p class="text-small">
                Checkout with Paypal
                <img src='/images/paypal-loading.gif' ng-show='showPaypalLoading' />
              </p>
            </div>
          </div>
        </div>
        <div ng-show='stripeInfo' ng-class='{"col-sm-6": paypalInfo, "col-sm-12": !paypalInfo}'>
          <div class="panel animated no-radius text-center margin-bottom-0 cursor-pointer" ng-class="{true:'panel-light-grey pulse',false:'panel-white'}">
            <div class="panel-body" ng-class="{'bg-light-grey': hover2}" ng-mouseenter="hover2 = true" ng-mouseleave="hover2 = false" ng-click="setCheckoutState(false, 3)">
              <span class="fa-stack fa-2x"> <i class="fa fa-square fa-stack-2x text-primary"></i> <i class="fa fa-envelope fa-stack-1x fa-inverse"></i> </span>
              <h3 class="StepTitle margin-top-10">Credit Card</h3>
              <p class="text-small">
                Checkout with a Credit Card (Powered by Stripe)
              </p>
            </div>
          </div>
        </div>
        <div class="clearfix" style="margin-bottom:30px"></div>
      </div>
      <div class="row thank-you" style="" ng-if="checkoutModalState == 7">

        <h3 class="center mb20">Paypal Payment</h3>
        <form id="payPalform" action="{{paypalURL}}" target="_self" class="center standard">
          <!-- <label for="buy">Buy Now:</label> -->
          <input type="image" id="submitBtn" value="Pay with PayPal" src="https://www.paypalobjects.com/en_US/i/btn/btn_paynowCC_LG.gif" ng-click='paypalLoginClickFn()'>
          <input id="type" type="hidden" name="expType" value="{{checkoutExpType|| 'light'}}">
          <input id="paykey" type="hidden" name="paykey" value="{{paypalKey}}">
        </form>
      </div>
      <div class="clearfix"></div>
    </div>
    <div class="modal-footer cart-footer" ng-hide="checkoutModalState !== 6">
      <button class="btn ssb-theme-btn btn-info continue-shopping pull-left" ng-click="setCheckoutState(true, addresses.shipping ? 8 : 2)"><i class="fa fa-chevron-left"></i> Back
      </button>
    </div>
    <div class="modal-footer cart-footer" ng-hide="checkoutModalState !== 7">
      <button class="btn btn-danger pull-left" ng-click="deleteOrderFn(order)"><i class="fa fa-trash"></i> Cancel</button>
    </div>
    <div class="modal-footer cart-footer" ng-hide="checkoutModalState !== 3">
      <button class="btn ssb-theme-btn btn-orange btn-checkout pull-right" ng-click="makeCartPayment()" ng-disabled="checkingCoupon"><i class="fa fa-shopping-cart"></i> Checkout</button>
      <button class="btn ssb-theme-btn btn-info continue-shopping pull-left" ng-click="setCheckoutState(true, paypalInfo && !hasSubscriptionProduct ? 6 : addresses.shipping ? 8 : 2)"><i class="fa fa-chevron-left"></i> Back
      </button>
    </div>
    <div class="modal-footer billing-footer" ng-hide="checkoutModalState !== 2">
      <button class="btn ssb-theme-btn btn-success btn-payment pull-right" ng-click="validateAddressDetails(newContact.details[0].addresses[0], newContact.details[0].emails[0].email, newContact.details[0].phones[0].number); scrollToElement();"><i class="fa fa-credit-card"></i> {{addresses.buttonText}} <i class="fa fa-chevron-right"></i></button>

      <button class="btn ssb-theme-btn pull-left btn-info back-to-shopping-cart" ng-click="setCheckoutState(true, 1)"><i class="fa fa-chevron-left"></i> Back
      </button>
    </div>
    <div class="modal-footer billing-footer" ng-hide="checkoutModalState !== 8">
      <button class="btn ssb-theme-btn btn-success btn-payment pull-right" ng-click="validateShippingAddressDetails(); scrollToElement();"><i class="fa fa-credit-card"></i> Payment <i class="fa fa-chevron-right"></i></button>

      <button class="btn ssb-theme-btn pull-left btn-info back-to-shopping-cart" ng-click="setCheckoutState(true, 2)"><i class="fa fa-chevron-left"></i> Back
      </button>
    </div>
    <div class="modal-footer payment-footer" ng-hide="checkoutModalState !== 1">
      <button class="btn ssb-theme-btn btn-success btn-confirm-payment pull-right" ng-disabled="!cartDetails || cartDetails.length <= 0 || !cartValidItemCountFn()" ng-click="setCheckoutState(true, 2)"> Next <i class="fa fa-chevron-right"></i>
      </button>
      <button class="btn ssb-theme-btn pull-left btn-info back-to-billing-shipping" ng-click='close()' ng-click="setCheckoutState(true, 1)"><i class="fa fa-chevron-left"></i> Continue Shopping
      </button>
    </div>
  </div>
</script>
<script type="text/javascript">
    if( navigator.userAgent.match(/iPhone|iPad|iPod/i) ) {
        var styleEl = document.createElement('style'), styleSheet;
        document.head.appendChild(styleEl);
        styleSheet = styleEl.sheet;
        styleSheet.insertRule(".modal { position:absolute; bottom:auto; }", 0);
    }
</script>
