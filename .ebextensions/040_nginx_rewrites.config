files:
  "/tmp/indigeweb_http_to_https_redirect.txt":
    owner: root
    group: root
    mode: "000644"
    content: |
        # REDIRECT HTTP to HTTPS - indigeweb-500
        if ($http_x_forwarded_proto != 'https') {
          rewrite ^ https://$host$request_uri? permanent;
        }

  "/tmp/indigeweb_https_redirect.sh":
    owner: root
    group: root
    mode: "000744"
    content: |
      #!/bin/bash
      #
      cfgFile='/tmp/deployment/config/#etc#nginx#conf.d#00_elastic_beanstalk_proxy.conf'
      #
      # check if pattern matches, if not then add to file
      if ( ! grep -qi indigeweb-500 ${cfgFile} ); then
        sed -ie '/location \/ {/r /tmp/indigeweb_http_to_https_redirect.txt' ${cfgFile}
      fi
 
container_commands:
  000-setup-nginx:
    command: "echo"
